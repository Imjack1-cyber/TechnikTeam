-- This script populates the wiki_documentation table with the first batch of entries.
-- This content should be used for the V8__Populate_wiki_data.sql migration file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('pom.xml', '1.  **File Overview & Purpose**\n\n    This is the Project Object Model (POM) file for Maven, the build and dependency management tool for this project. It defines the project''s coordinates, dependencies, build settings, and plugins. It is the central configuration file for building the `TechnikTeam.war` artifact.\n\n2.  **Architectural Role**\n\n    This is a core project configuration file, not belonging to a specific architectural tier. It defines the project''s structure and the libraries that will be available at runtime for all tiers.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Guice**: Used for dependency injection throughout the application, decoupling components and managing object lifecycles.\n    *   **Flyway**: Manages database schema migrations, ensuring the database is always in a consistent and up-to-date state.\n    *   **MySQL Connector/J & HikariCP**: The JDBC driver for MySQL and a high-performance connection pool for efficient database access.\n    *   **Jakarta EE APIs**: Provides the core Servlet, JSP, and WebSocket APIs, which are the foundation of the web application.\n    *   **Log4j 2**: A robust logging framework used for application-wide logging and auditing.\n    *   **Spring Security Crypto**: Used specifically for its `BCryptPasswordEncoder` to securely hash and verify user passwords.\n    *   **SortableJS (WebJar)**: A client-side library for enabling drag-and-drop functionality, used on the admin feedback board.\n\n4.  **In-Depth Breakdown**\n\n    *   **`<properties>`**: Defines common version numbers for dependencies (`guice.version`, `flyway.version`, etc.) and sets the project encoding and Java compiler level to `21`.\n    *   **`<dependencies>`**: Contains the list of all external libraries the project depends on. Key groups include:\n        *   **Dependency Injection**: `guice` and `guice-servlet` are the core of the DI framework.\n        *   **Database**: `flyway-core`, `flyway-mysql`, `mysql-connector-j`, and `HikariCP` provide everything needed for database migration and connection pooling.\n        *   **Web & Servlet APIs**: `jakarta.servlet-api`, `jakarta.websocket-api`, and `jakarta.servlet.jsp.jstl` are essential for building the web layer. Note that the Servlet and WebSocket APIs are `provided`, meaning the application server (like Tomcat) is expected to supply them.\n        *   **Utilities**: Various libraries for tasks like JSON serialization (`gson`), password hashing (`spring-security-crypto`), iCalendar generation (`ical4j`), caching (`caffeine`), and WebAuthn/Passkey support (`webauthn-server-core`).\n    *   **`<build>`**: Configures the Maven build process.\n        *   **`<finalName>`**: Sets the name of the output WAR file to `TechnikTeam.war`.\n        *   **`<plugins>`**:\n            *   `maven-compiler-plugin`: Configures the Java compiler version.\n            *   `maven-war-plugin`: Configures how the WAR file is assembled. `failOnMissingWebXml` is set to `false` because the application uses Jakarta EE 5.0+ annotations and a `web.xml` is not strictly required, although one is present.'),
('src/main/java/de/technikteam/config/DateFormatter.java', '1.  **File Overview & Purpose**\n\n    This is a utility class providing static methods for consistent date and time formatting throughout the application. It ensures that all `java.time.LocalDateTime` objects are displayed in a standardized, German-locale format (e.g., \"10.06.2025, 17:45 Uhr\").\n\n2.  **Architectural Role**\n\n    This is a cross-cutting concern utility, used primarily in the **Model** and **View** tiers. Models use it to provide pre-formatted strings for JSPs, and JSPs can use it via EL functions if needed, ensuring a consistent user experience.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `java.time.LocalDateTime`: The modern Java date-time API object that this class formats.\n    *   `java.time.format.DateTimeFormatter`: The core Java class used for defining and applying date-time format patterns.\n\n4.  **In-Depth Breakdown**\n\n    *   **`formatDateTime(LocalDateTime ldt)`**\n        *   **Method Signature:** `public static String formatDateTime(LocalDateTime ldt)`\n        *   **Purpose:** Formats a `LocalDateTime` into a full date and time string.\n        *   **Parameters:**\n            *   `ldt` (LocalDateTime): The date-time object to format.\n        *   **Returns:** A formatted string like \"dd.MM.yyyy, HH:mm\" (e.g., \"10.06.2025, 17:45\"), or an empty string if the input is null.\n        *   **Side Effects:** None.\n\n    *   **`formatDate(LocalDateTime ldt)`**\n        *   **Method Signature:** `public static String formatDate(LocalDateTime ldt)`\n        *   **Purpose:** Formats a `LocalDateTime` into a date-only string.\n        *   **Parameters:**\n            *   `ldt` (LocalDateTime): The date-time object to format.\n        *   **Returns:** A formatted string like \"dd.MM.yyyy\" (e.g., \"10.06.2025\"), or an empty string if the input is null.\n        *   **Side Effects:** None.\n\n    *   **`formatDateTimeRange(LocalDateTime start, LocalDateTime end)`**\n        *   **Method Signature:** `public static String formatDateTimeRange(LocalDateTime start, LocalDateTime end)`\n        *   **Purpose:** Intelligently formats a date range. It provides a more compact format if the start and end times are on the same day.\n        *   **Parameters:**\n            *   `start` (LocalDateTime): The start of the range.\n            *   `end` (LocalDateTime): The end of the range (can be null).\n        *   **Returns:** A user-friendly string representing the range.\n            *   If `end` is null: \"10.06.2025, 17:45 Uhr\"\n            *   If same day: \"10.06.2025, 17:45 - 19:00 Uhr\"\n            *   If different days: \"10.06.2025, 17:45 Uhr - 11.06.2025, 18:00 Uhr\"\n        *   **Side Effects:** None.'),
('src/main/java/de/technikteam/config/GuiceConfig.java', '1.  **File Overview & Purpose**\n\n    This class serves as the central configuration entry point for the Google Guice dependency injection framework. As a `GuiceServletContextListener`, it is automatically invoked by the servlet container on application startup, creating the main Guice `Injector` that will manage the lifecycle of all services, DAOs, and servlets.\n\n2.  **Architectural Role**\n\n    This is a core **Configuration** file that bootstraps the entire application''s architecture. It connects the servlet container''s lifecycle to the Guice dependency injection container.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Guice (`com.google.inject.Guice`)**: The main class from the Guice library used to create the injector.\n    *   **Guice Servlet (`com.google.inject.servlet.GuiceServletContextListener`)**: The base class that integrates Guice with the Jakarta Servlet lifecycle.\n    *   `ServiceModule.java`: The custom module where all the application''s bindings (dependencies) are defined.\n\n4.  **In-Depth Breakdown**\n\n    *   **`getInjector()`**\n        *   **Method Signature:** `protected Injector getInjector()`\n        *   **Purpose:** This is the core method of the `GuiceServletContextListener`. It is called once by the container when the application starts. Its responsibility is to create and return the application''s central `Injector`.\n        *   **Parameters:** None.\n        *   **Returns:** The configured `Injector` instance.\n        *   **Side Effects:** It instantiates the `ServiceModule`, which in turn defines all the dependency injection bindings for the entire application. The returned injector is then stored in the `ServletContext` by the `GuiceFilter` for later use.'),
('src/main/java/de/technikteam/config/LocalDateAdapter.java', '1.  **File Overview & Purpose**\n\n    This is a custom serializer for the Gson library, specifically designed to handle the `java.time.LocalDate` class. Its purpose is to ensure `LocalDate` objects are consistently converted into a standard `YYYY-MM-DD` string format when serializing Java objects to JSON.\n\n2.  **Architectural Role**\n\n    This is a **Configuration** / **Utility** class that operates at the boundary between the **Service/Controller Tiers** and the **View/Client-Side Tier**. It is used by any servlet that needs to serialize data containing `LocalDate` objects into JSON for an API response.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Gson (`com.google.gson.JsonSerializer`)**: The core interface from the Gson library that this class implements to provide custom serialization logic.\n    *   **java.time.LocalDate**: The modern Java Date API class for representing a date without time-of-day.\n\n4.  **In-Depth Breakdown**\n\n    *   **`serialize(LocalDate date, Type typeOfSrc, JsonSerializationContext context)`**\n        *   **Method Signature:** `public JsonElement serialize(LocalDate date, Type typeOfSrc, JsonSerializationContext context)`\n        *   **Purpose:** This method is called by Gson whenever it encounters a `LocalDate` object during serialization. It formats the date into an ISO standard string.\n        *   **Parameters:**\n            *   `date` (LocalDate): The `LocalDate` object to be serialized.\n            *   `typeOfSrc` (Type): The specific generic type of the source object.\n            *   `context` (JsonSerializationContext): The context for serialization that Gson is using.\n        *   **Returns:** A `JsonPrimitive` containing the date as a string in `YYYY-MM-DD` format (e.g., \"2025-07-25\"), or `null` if the input date is null.\n        *   **Side Effects:** None.'),
('src/main/java/de/technikteam/config/LocalDateTimeAdapter.java', '1.  **File Overview & Purpose**\n\n    This is a custom `TypeAdapter` for the Gson library, designed to handle both serialization and deserialization of `java.time.LocalDateTime` objects. It ensures these objects are consistently formatted as ISO 8601 strings (e.g., \"2025-07-25T10:30:00\") in JSON, which is a robust and standard way to exchange date-time information.\n\n2.  **Architectural Role**\n\n    This is a **Configuration** / **Utility** class. It is crucial for the **Web/Controller Tier**''s API servlets that consume or produce JSON containing `LocalDateTime` objects. Unlike a simple serializer, a `TypeAdapter` handles both directions of data conversion.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Gson (`com.google.gson.TypeAdapter`)**: The base class from the Gson library for creating custom serialization and deserialization logic.\n    *   **java.time.LocalDateTime**: The modern Java date-time API class this adapter handles.\n\n4.  **In-Depth Breakdown**\n\n    *   **`write(JsonWriter out, LocalDateTime value)`**\n        *   **Method Signature:** `public void write(JsonWriter out, LocalDateTime value) throws IOException`\n        *   **Purpose:** Serializes a `LocalDateTime` object to its JSON string representation.\n        *   **Parameters:**\n            *   `out` (JsonWriter): The Gson stream writer.\n            *   `value` (LocalDateTime): The object to write.\n        *   **Returns:** void.\n        *   **Side Effects:** Writes the ISO-formatted date-time string or `null` to the output JSON stream.\n\n    *   **`read(JsonReader in)`**\n        *   **Method Signature:** `public LocalDateTime read(JsonReader in) throws IOException`\n        *   **Purpose:** Deserializes an ISO-formatted date-time string from JSON into a `LocalDateTime` object.\n        *   **Parameters:**\n            *   `in` (JsonReader): The Gson stream reader.\n        *   **Returns:** A `LocalDateTime` object, or `null` if the JSON value was null.\n        *   **Side Effects:** Reads from the input JSON stream.'),
('src/main/java/de/technikteam/config/Permissions.java', '1.  **File Overview & Purpose**\n\n    This final class acts as a central, static repository for all permission key constants used in the application. Its primary purpose is to eliminate \"magic strings\" when checking for user permissions, thereby improving code readability, maintainability, and preventing hard-to-find bugs from typos.\n\n2.  **Architectural Role**\n\n    This is a cross-cutting **Configuration** file. It is used by the **Service Tier** (e.g., `AuthorizationService`), the **Web/Controller Tier** (e.g., `AdminFilter`, servlets), and the **View Tier** (JSPs) to perform consistent permission checks.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This class is self-contained.\n\n4.  **In-Depth Breakdown**\n\n    The class contains a series of `public static final String` constants. Each constant represents a specific, granular permission within the system. The constants are grouped by functional area (e.g., User Management, Event Management) for clarity.\n\n    *   **`ACCESS_ADMIN_PANEL`**: The most powerful permission. It grants unrestricted access to all administrative functions, acting as a \"superuser\" or \"root\" key.\n    *   **`USER_*` constants**: Permissions related to creating, reading, updating, deleting, and resetting passwords for user accounts.\n    *   **`EVENT_*` constants**: Permissions for managing events, including creating, editing, deleting, assigning personnel, and managing tasks within an event.\n    *   **`ACHIEVEMENT_VIEW`**: A special key used specifically by the `NavigationRegistry` to determine if the \"Abzeichen\" link should be visible in the admin sidebar. It''s a meta-permission based on having any other achievement-related CRUD permission.\n    *   **`ADMIN_DASHBOARD_ACCESS`**: Another special key for the `NavigationRegistry` that grants visibility to the \"Admin Dashboard\" link if the user has *any* administrative permission.'),
('src/main/java/de/technikteam/config/ServiceModule.java', '1.  **File Overview & Purpose**\n\n    This is the core configuration module for the Google Guice dependency injection framework. It defines all the application''s bindings, instructing Guice how to create and wire together objects. It binds service interfaces to their implementations, registers DAOs as singletons, and maps URL patterns to their corresponding servlets.\n\n2.  **Architectural Role**\n\n    This is a central **Configuration** file that orchestrates the entire application''s object graph. It defines the relationships between the **Web/Controller**, **Service**, and **DAO** tiers.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Guice Servlet (`com.google.inject.servlet.ServletModule`)**: The base class for modules that configure servlets and filters.\n\n4.  **In-Depth Breakdown**\n\n    *   **`configureServlets()`**: This method contains all the binding logic.\n        *   **Service, DAO, and Action Bindings**: The first section uses `bind(ClassName.class).in(Scopes.SINGLETON);` to register all service, DAO, and action classes as singletons. This ensures that only one instance of each of these classes exists throughout the application''s lifecycle, which is crucial for managing shared resources like caches and database connections.\n        *   **Servlet Bindings**: The second section explicitly binds every servlet class in the application as a singleton. This is a prerequisite before they can be mapped to a URL.\n        *   **Servlet Mappings**: The final, large section uses `serve(\"url-pattern\").with(ServletClass.class);` to map URL patterns to the servlets that should handle them. This is the heart of the application''s routing.\n            *   It maps public-facing URLs like `/home` and `/lager`.\n            *   It maps all administrative URLs under `/admin/*`.\n            *   It maps all API endpoints under `/api/*`.\n            *   The `FrontControllerServlet` is mapped to `/admin/action/*` to handle various administrative POST actions using a Command pattern.'),
('src/main/java/de/technikteam/dao/AchievementDAO.java', '1.  **File Overview & Purpose**\n\n    This Data Access Object (DAO) is responsible for all database interactions related to achievements. It handles CRUD (Create, Read, Update, Delete) operations on the `achievements` table and manages the relationship between users and achievements in the `user_achievements` junction table.\n\n2.  **Architectural Role**\n\n    This class belongs to the **DAO (Data Access) Tier**. It directly interacts with the database to persist and retrieve achievement data. It is exclusively called by the `AchievementService` and administrative servlets like `AdminAchievementServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Used to inject the `DatabaseManager` for obtaining database connections.\n    *   `DatabaseManager`: Provides the connection pool for all database operations.\n    *   `Achievement` (Model): The data model object that this DAO creates and populates.\n\n4.  **In-Depth Breakdown**\n\n    *   **`getAllAchievements()`**: Retrieves a list of all defined achievement templates from the `achievements` table.\n    *   **`getAchievementById(int id)`**: Fetches a single achievement template by its primary key.\n    *   **`createAchievement(Achievement achievement)`**: Inserts a new achievement template into the `achievements` table.\n    *   **`updateAchievement(Achievement achievement)`**: Updates an existing achievement template''s name, description, or icon. The `achievement_key` is immutable.\n    *   **`deleteAchievement(int id)`**: Deletes an achievement template from the `achievements` table.\n    *   **`getAchievementsForUser(int userId)`**: Retrieves all achievements that a specific user has earned, joining `achievements` and `user_achievements` tables. It also populates the `earnedAt` timestamp.\n    *   **`grantAchievementToUser(int userId, String achievementKey)`**: Grants an achievement to a user by inserting a record into the `user_achievements` table. It first checks if the user already has the achievement to prevent duplicates.\n    *   **`hasAchievement(int userId, String achievementKey)`**: Checks if a user has already earned a specific achievement.\n    *   **`mapResultSetToAchievement(ResultSet rs)`**: A private helper method to map a row from a `ResultSet` to an `Achievement` model object, reducing code duplication.'),
('src/main/java/de/technikteam/dao/AdminLogDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages all interactions with the `admin_logs` table. Its sole purpose is to create and retrieve audit log entries, providing a history of administrative actions performed within the application.\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It provides a structured way for the `AdminLogService` to persist audit trails to the database.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `AdminLog` (Model): The data model representing a single log entry.\n\n4.  **In-Depth Breakdown**\n\n    *   **`createLog(AdminLog log)`**\n        *   **Method Signature:** `public void createLog(AdminLog log)`\n        *   **Purpose:** Inserts a new log entry into the `admin_logs` table.\n        *   **Parameters:**\n            *   `log` (AdminLog): The log entry object containing the admin''s username, action type, and details.\n        *   **Returns:** void.\n        *   **Side Effects:** Writes a new record to the database. It includes robust error logging to ensure that a failure to log does not crash the primary operation.\n\n    *   **`getAllLogs()`**\n        *   **Method Signature:** `public List<AdminLog> getAllLogs()`\n        *   **Purpose:** Retrieves all log entries from the database, ordered from newest to oldest.\n        *   **Parameters:** None.\n        *   **Returns:** A `List` of `AdminLog` objects.\n        *   **Side Effects:** Performs a database read.\n\n    *   **`getRecentLogs(int limit)`**\n        *   **Method Signature:** `public List<AdminLog> getRecentLogs(int limit)`\n        *   **Purpose:** Retrieves the most recent log entries up to a specified limit. Used for dashboard widgets.\n        *   **Parameters:**\n            *   `limit` (int): The maximum number of log entries to retrieve.\n        *   **Returns:** A `List` of `AdminLog` objects.\n        *   **Side Effects:** Performs a database read with a `LIMIT` clause.'),
('src/main/java/de/technikteam/dao/AttachmentDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO is responsible for managing file attachments associated with parent entities like Events or Meetings. It provides a unified interface for CRUD operations on the `attachments` table, abstracting away the polymorphic relationship defined by the `parent_type` and `parent_id` columns.\n\n2.  **Architectural Role**\n\n    This is a **DAO (Data Access) Tier** class. It is called by services (`EventService`, `MeetingService`) and servlets (`AdminEventServlet`, `AdminMeetingServlet`) that need to manage attachments for their respective entities.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `Attachment` (Model): The data model object this DAO works with.\n\n4.  **In-Depth Breakdown**\n\n    *   **`addAttachment(Attachment attachment, Connection conn)`**: Inserts a new attachment record into the database within an existing transaction.\n    *   **`getAttachmentsForParent(String parentType, int parentId, String userRole)`**: Retrieves all attachments for a specific parent (e.g., all attachments for Event with ID 5). It filters the results based on the user''s role (`ADMIN` or `NUTZER`), ensuring non-admins cannot see admin-only files.\n    *   **`getAttachmentById(int attachmentId)`**: Fetches a single attachment''s metadata by its unique ID. This is used by the `DownloadServlet` to verify existence and get the file path.\n    *   **`deleteAttachment(int attachmentId)`**: Deletes an attachment record from the database. Note: This does not delete the physical file from the disk; that is the responsibility of the calling service or servlet.\n    *   **`mapResultSetToAttachment(ResultSet rs)`**: A private helper method to convert a database row into an `Attachment` object.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/dao/MaintenanceLogDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages all database interactions with the `maintenance_log` table. Its purpose is to create and retrieve maintenance history for specific inventory items, tracking actions like repairs or marking an item for maintenance.\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is used by the `StorageService` and `AdminStorageServlet` to log maintenance activities and by the `StorageItemDetailsServlet` to display an item''s maintenance history.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `MaintenanceLogEntry` (Model): The data model representing a single maintenance log entry.\n\n4.  **In-Depth Breakdown**\n\n    *   **`createLog(MaintenanceLogEntry log)`**\n        *   **Method Signature:** `public boolean createLog(MaintenanceLogEntry log)`\n        *   **Purpose:** Inserts a new maintenance record into the `maintenance_log` table.\n        *   **Parameters:**\n            *   `log` (MaintenanceLogEntry): An object containing the item ID, user ID, action taken, notes, and any associated cost.\n        *   **Returns:** `true` on successful insertion, `false` otherwise.\n        *   **Side Effects:** Writes a new record to the database.\n\n    *   **`getHistoryForItem(int itemId)`**\n        *   **Method Signature:** `public List<MaintenanceLogEntry> getHistoryForItem(int itemId)`\n        *   **Purpose:** Retrieves the complete maintenance history for a specific storage item, ordered from newest to oldest. It joins with the `users` table to get the username of the person who performed the action.\n        *   **Parameters:**\n            *   `itemId` (int): The ID of the storage item.\n        *   **Returns:** A `List` of `MaintenanceLogEntry` objects.\n        *   **Side Effects:** Performs a database read.'),
('src/main/java/de/technikteam/dao/MeetingAttendanceDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO handles all database interactions for the `meeting_attendance` table. It is responsible for tracking which users have attended specific meetings, which is the basis for granting qualifications.\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is used by the `AdminAttendanceServlet` and `MatrixServlet` to update and display attendance records.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `MeetingAttendance` (Model): The data model representing a user''s attendance at a meeting.\n\n4.  **In-Depth Breakdown**\n\n    *   **`setAttendance(int userId, int meetingId, boolean attended, String remarks)`**\n        *   **Method Signature:** `public boolean setAttendance(int userId, int meetingId, boolean attended, String remarks)`\n        *   **Purpose:** Sets or updates a user''s attendance status for a meeting. It uses an `INSERT ... ON DUPLICATE KEY UPDATE` SQL statement, which allows this single method to handle both initial registration and subsequent changes without needing to check for a pre-existing record.\n        *   **Parameters:** All parameters correspond to the columns in the `meeting_attendance` table.\n        *   **Returns:** `true` on success, `false` on SQL error.\n        *   **Side Effects:** Writes or updates a record in the database.\n\n    *   **`getAllAttendance()`**\n        *   **Method Signature:** `public List<MeetingAttendance> getAllAttendance()`\n        *   **Purpose:** Retrieves all attendance records from the database. This is used by the `MatrixServlet` to build a comprehensive map of all user attendance for display in the qualification matrix.\n        *   **Parameters:** None.\n        *   **Returns:** A `List` of all `MeetingAttendance` objects.\n        *   **Side Effects:** Performs a database read.\n\n    *   **`mapResultSetToAttendance(ResultSet rs)`**: A private helper method to map a database row to a `MeetingAttendance` object.'),
('src/main/java/de/technikteam/dao/MeetingDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages all database operations for the `meetings` table. It handles the CRUD lifecycle of individual, schedulable meeting instances, which are always children of a parent `Course`. It also manages user sign-ups for meetings via the `meeting_attendance` table.\n\n2.  **Architectural Role**\n\n    This class belongs to the **DAO (Data Access) Tier**. It is primarily used by the `AdminMeetingServlet` for managing meetings and by public-facing servlets like `MeetingServlet` and `MeetingDetailsServlet` to display meeting information to users.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `Meeting`, `User` (Models): The data models this DAO works with.\n\n4.  **In-Depth Breakdown**\n\n    *   **CRUD Operations (`createMeeting`, `getMeetingById`, `updateMeeting`, `deleteMeeting`)**: Standard methods for managing meeting records. `deleteMeeting` will cascade-delete all associated attendance records.\n    *   **Listing Methods (`getMeetingsForCourse`, `getAllMeetings`, `getAllUpcomingMeetings`)**: Various methods to retrieve lists of meetings, either for a specific course, for all courses, or only upcoming ones for the calendar view. These queries join with `courses` and `users` to enrich the `Meeting` object with the parent course name and leader''s username.\n    *   **User-Specific Queries (`getUpcomingMeetingsForUser`, `isUserAssociatedWithMeeting`)**:\n        *   `getUpcomingMeetingsForUser`: Fetches upcoming meetings for a specific user and calculates their attendance status (`ANGEMELDET`, `ABGEMELDET`, or `OFFEN`) for each.\n        *   `isUserAssociatedWithMeeting`: A simple check to see if a user is signed up for a meeting, used for authorization checks.\n    *   **`mapResultSetToMeeting(ResultSet rs)`**: A private helper to populate a `Meeting` object from a database row, including data from joined tables.'),
('src/main/java/de/technikteam/dao/PasskeyDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO is responsible for all database interactions related to WebAuthn/Passkey credentials. It handles the storage, retrieval, and management of public key credentials in the `user_passkeys` table, which enables passwordless authentication for users.\n\n2.  **Architectural Role**\n\n    This class is a critical component of the **DAO (Data Access) Tier**. It provides the persistence layer for the `PasskeyService`, allowing it to manage the lifecycle of user credentials securely.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `PasskeyCredential` (Model): The data model representing a stored credential.\n\n4.  **In-Depth Breakdown**\n\n    *   **`saveCredential(PasskeyCredential credential)`**: Inserts a new passkey record into the database after a user successfully completes the registration ceremony.\n    *   **`getCredentialsByUserId(int userId)`**: Retrieves all passkeys registered by a specific user. This is used during the authentication process where the server can suggest known credentials to the browser.\n    *   **`getCredentialById(String credentialId)`**: Fetches a single credential by its unique `credential_id` (a Base64URL string). This is the primary lookup method during an authentication ceremony to verify a user''s login attempt.\n    *   **`deleteCredential(int credentialDbId, int userId)`**: Removes a passkey from the database. It requires both the internal database ID and the user''s ID to ensure a user can only delete their own credentials.\n    *   **`updateSignatureCount(String credentialId, long newSignatureCount)`**: Updates the signature counter for a credential after a successful authentication. This is a security measure to help detect cloned authenticators.\n    *   **`mapResultSetToCredential(ResultSet rs)`**: A private helper method to map a database row to a `PasskeyCredential` object.'),
('src/main/java/de/technikteam/dao/PermissionDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO provides read-only access to the application''s permission system. Its primary responsibilities are to fetch all available permission definitions from the `permissions` table and to retrieve the specific set of permissions granted to an individual user from the `user_permissions` junction table.\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is used by the `UserDAO` to populate a `User` object with their complete set of permissions upon login, and by the `AdminUserServlet` to display the list of all possible permissions in the user editing modal.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `Permission` (Model): The data model representing a single permission definition.\n\n4.  **In-Depth Breakdown**\n\n    *   **`getAllPermissions()`**\n        *   **Method Signature:** `public List<Permission> getAllPermissions()`\n        *   **Purpose:** Retrieves a complete list of all permissions defined in the system.\n        *   **Parameters:** None.\n        *   **Returns:** A `List` of `Permission` objects.\n        *   **Side Effects:** Performs a database read on the `permissions` table.\n\n    *   **`getPermissionIdsForUser(int userId)`**\n        *   **Method Signature:** `public Set<Integer> getPermissionIdsForUser(int userId)`\n        *   **Purpose:** Fetches the set of primary key IDs for all permissions directly assigned to a specific user.\n        *   **Parameters:**\n            *   `userId` (int): The ID of the user.\n        *   **Returns:** A `Set` of integer permission IDs.\n        *   **Side Effects:** Performs a database read on the `user_permissions` table.'),
('src/main/java/de/technikteam/dao/ProfileChangeRequestDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages the lifecycle of user profile change requests. It handles all database operations for the `profile_change_requests` table, including creating new requests, fetching pending requests for administrators, and updating their status upon approval or denial.\n\n2.  **Architectural Role**\n\n    This class belongs to the **DAO (Data Access) Tier**. It is used by the `ProfileServlet` when a user submits a change request and by the `AdminChangeRequestServlet` and its associated `Action` classes (`ApproveChangeAction`, `DenyChangeAction`) for processing these requests.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `ProfileChangeRequest` (Model): The data model for a change request.\n\n4.  **In-Depth Breakdown**\n\n    *   **`createRequest(ProfileChangeRequest request)`**: Inserts a new profile change request into the database with a ''PENDING'' status.\n    *   **`getRequestById(int id)`**: Retrieves a single request by its ID, joining with the `users` table to get the requester''s and reviewer''s usernames.\n    *   **`getPendingRequests()`**: Fetches all requests that currently have a ''PENDING'' status, for display on the admin requests page.\n    *   **`hasPendingRequest(int userId)`**: A quick check to determine if a user already has a pending request, used to prevent them from submitting multiple requests.\n    *   **`updateRequestStatus(int requestId, String status, int adminId)`**: Updates a request''s status to ''APPROVED'' or ''DENIED'', and records which admin reviewed it and when.\n    *   **`mapResultSetToRequest(ResultSet rs)`**: A private helper method to map a database row to a `ProfileChangeRequest` object.'),
('src/main/java/de/technikteam/dao/ReportDAO.java', '1.  **File Overview & Purpose**\n\n    This is a specialized DAO designed for generating analytical reports and summaries. Unlike other DAOs that focus on CRUD operations for single entities, this class contains complex, aggregate SQL queries that summarize data across multiple tables for administrative dashboards and dedicated report pages.\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is used by the `AdminReportServlet` and `AdminDashboardService` to fetch data for visualization and export. It encapsulates the most complex SQL logic in the application.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n\n4.  **In-Depth Breakdown**\n\n    *   **`getEventParticipationSummary()`**: Calculates the number of assigned participants for each event.\n    *   **`getUserActivityStats()`**: Aggregates statistics for each user, counting how many events they''ve signed up for and how many meetings they''ve attended.\n    *   **`getInventoryUsageFrequency()`**: Calculates the total number of times each inventory item has been checked out.\n    *   **`getTotalInventoryValue()`**: Calculates the total monetary value of all items in stock by multiplying quantity by price.\n    *   **`getEventCountByMonth(int months)`**: Generates a time-series dataset of how many events occurred each month over a given period, used for the trend chart on the dashboard.\n    *   **`getUserParticipationStats(int limit)`**: Retrieves the top N most active users based on the number of events they have been assigned to.'),
('src/main/java/de/technikteam/dao/RoleDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO provides read-only access to the user roles defined in the `roles` table. It features a simple caching mechanism using Caffeine to avoid repeatedly querying the database for the list of roles, which changes very infrequently.\n\n2.  **Architectural Role**\n\n    This class belongs to the **DAO (Data Access) Tier**. It is used by the `AdminUserServlet` to populate the roles dropdown in the user editing modal.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   **Caffeine (`com.github.benmanes.caffeine.cache.LoadingCache`)**: A high-performance caching library used to cache the list of roles in memory.\n\n4.  **In-Depth Breakdown**\n\n    *   **`RoleDAO(DatabaseManager dbManager)` (Constructor)**: Initializes the Caffeine `LoadingCache`. The cache is configured to expire after one hour and to hold only one entry (the list of all roles). The `build` method provides the loader function (`fetchAllRolesFromDb`) that is called automatically on a cache miss.\n    *   **`getAllRoles()`**: The main public method. It retrieves the list of all roles from the cache using `roleCache.get(ALL_ROLES_KEY)`. If the cache is empty or expired, the loader function is automatically triggered.\n    *   **`fetchAllRolesFromDb()`**: A private method that performs the actual database query to get all roles. This method is only called when the cache needs to be populated.'),
('src/main/java/de/technikteam/dao/StatisticsDAO.java', '1.  **File Overview & Purpose**\n\n    This is a specialized, read-only DAO for retrieving simple statistical counts from the database. It is used to quickly fetch aggregate numbers for display on the admin dashboard without the overhead of more complex reporting queries.\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is used by the `AdminDashboardServlet` to gather high-level metrics about the system''s state.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n\n4.  **In-Depth Breakdown**\n\n    *   **`getUserCount()`**: Executes a `SELECT COUNT(*)` query on the `users` table to get the total number of registered users.\n    *   **`getActiveEventCount()`**: Executes a `SELECT COUNT(*)` query on the `events` table to count events that have not yet finished.\n    *   **`getCount(String sql)`**: A private helper method that takes a SQL `COUNT` query as a string, executes it, and returns the integer result, reducing code duplication.'),
('src/main/java/de/technikteam/dao/StorageDAO.java', '1.  **File Overview & Purpose**\n\n    This is the primary DAO for managing the inventory, handling all database operations for the `storage_items` table. It provides comprehensive CRUD functionality, methods for handling defective and repaired items, and transactional logic for checking items in and out.\n\n2.  **Architectural Role**\n\n    This class is a cornerstone of the **DAO (Data Access) Tier**. It is used extensively by the `StorageService` to perform transactional operations and by various servlets (`StorageServlet`, `AdminStorageServlet`, `AdminDefectServlet`) to display and manage inventory data.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `StorageItem` (Model): The data model for an inventory item.\n\n4.  **In-Depth Breakdown**\n\n    *   **Listing Methods (`getAllItemsGroupedByLocation`, `getAllItems`, `getDefectiveItems`, `getLowStockItems`)**: Provide different views of the inventory data, tailored for specific pages like the public lager view or admin dashboard widgets.\n    *   **CRUD Operations (`createItem`, `getItemById`, `updateItem`, `deleteItem`)**: Standard methods for managing the lifecycle of `StorageItem` records. The `updateItem` method is particularly comprehensive, updating nearly every column.\n    *   **Transactional Methods (`performCheckout`, `performCheckin`)**: These methods are designed to be called within a transaction managed by the `StorageService`. They update an item''s `quantity`, `status`, and `current_holder_user_id` atomically. The `performCheckout` query includes a `WHERE` clause to prevent checking out more items than are available.\n    *   **Defect & Repair Management (`updateDefectiveStatus`, `permanentlyReduceQuantities`, `repairItems`)**:\n        *   `updateDefectiveStatus`: Increases the `defective_quantity` for an item.\n        *   `permanentlyReduceQuantities`: Decreases both `quantity` and `defective_quantity`, effectively removing an unrepairable item from the total stock.\n        *   `repairItems`: Decreases the `defective_quantity`, moving an item back into the available pool.\n    *   **`mapResultSetToStorageItem(ResultSet rs)`**: A private helper method to construct a `StorageItem` object from a database query result.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/filter/AdminFilter.java', '1.  **File Overview & Purpose**\n\n    This servlet filter acts as a security gate for all administrative sections of the application. It intercepts every request to URLs matching `/admin/*` and `/api/admin/*` to ensure that only authenticated users with appropriate administrative permissions can access them.\n\n2.  **Architectural Role**\n\n    This class is a core component of the **Web/Controller Tier**. It enforces access control at the entry point of the application, before any admin servlet or API endpoint is executed. It relies on the `User` object stored in the session, which is populated by the `AuthenticationFilter`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Jakarta Servlet API (`jakarta.servlet.Filter`)**: The core interface for implementing a web filter.\n    *   `User` (Model): The object representing the logged-in user, retrieved from the `HttpSession`.\n\n4.  **In-Depth Breakdown**\n\n    *   **`init(FilterConfig filterConfig)`**: Called once by the servlet container on startup. It logs a confirmation message that the filter has been initialized.\n\n    *   **`doFilter(ServletRequest req, ServletResponse res, FilterChain chain)`**\n        *   **Method Signature:** `public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) throws IOException, ServletException`\n        *   **Purpose:** This is the main logic of the filter, executed for every matching request.\n        *   **Parameters:**\n            *   `req` (ServletRequest): The incoming request.\n            *   `res` (ServletResponse): The outgoing response.\n            *   `chain` (FilterChain): An object that allows the filter to pass the request along to the next entity in the chain (another filter or the target servlet).\n        *   **Logic:**\n            1.  It first checks if a user session exists and if a `User` object is present. If not, it redirects the user to the `/login` page.\n            2.  If a user is logged in, it calls the `user.hasAdminAccess()` method. This method centrally determines if the user has any permission that qualifies them for admin access.\n            3.  If `hasAdminAccess()` returns `true`, it calls `chain.doFilter()`, allowing the request to proceed to the requested admin page or API.\n            4.  If `hasAdminAccess()` returns `false`, it logs a warning, sets a user-facing error message in the session, and sends an HTTP 403 (Forbidden) error back to the client.\n\n    *   **`destroy()`**: Called when the application is shut down. Logs a confirmation message.'),
('src/main/java/de/technikteam/filter/AuthenticationFilter.java', '1.  **File Overview & Purpose**\n\n    This is the primary authentication filter for the entire application. It intercepts every single request (`/*`) to determine if the user is authenticated. It protects all resources except for a defined set of public paths and resource prefixes.\n\n2.  **Architectural Role**\n\n    This class is a fundamental component of the **Web/Controller Tier**. It acts as the first line of defense, ensuring that unauthenticated users cannot access any protected part of the application.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Jakarta Servlet API (`jakarta.servlet.Filter`)**: The interface it implements.\n    *   `User` (Model): The object it looks for in the `HttpSession` to verify authentication.\n\n4.  **In-Depth Breakdown**\n\n    *   **Static Fields:**\n        *   `PUBLIC_PATHS`: A `Set` containing specific URL paths that do not require authentication (e.g., `/login`, `/logout`).\n        *   `PUBLIC_RESOURCE_PREFIXES`: A `Set` containing URL prefixes for static resources (like CSS, JS, images) and the passkey authentication API (`/api/auth`) that must be publicly accessible.\n    *   **`doFilter(ServletRequest req, ServletResponse res, FilterChain chain)`**:\n        *   **Purpose:** The core filter logic.\n        *   **Logic:**\n            1.  It retrieves the current `HttpSession` (without creating one if it doesn''t exist).\n            2.  It extracts the request path and sanitizes it by removing any `jsessionid` path parameters.\n            3.  It checks if a `User` object exists in the session to determine the `isLoggedIn` status.\n            4.  It checks if the requested path is in the `PUBLIC_PATHS` set or starts with any of the `PUBLIC_RESOURCE_PREFIXES`.\n            5.  If the user is logged in OR the resource is public, it calls `chain.doFilter()` to allow the request to proceed.\n            6.  If the user is not logged in AND the resource is not public, it logs a warning and redirects the user to the `/login` page.'),
('src/main/java/de/technikteam/filter/CharacterEncodingFilter.java', '1.  **File Overview & Purpose**\n\n    This is a simple but critical utility filter that ensures all incoming requests and outgoing responses are handled using the UTF-8 character encoding. This is essential for correctly processing and displaying international characters, such as German umlauts (ä, ö, ü), which might be present in user input or database content.\n\n2.  **Architectural Role**\n\n    This class is a low-level infrastructure component in the **Web/Controller Tier**. It should be the first filter in the chain to ensure that character encoding is set before any other filter or servlet attempts to read request parameters or write to the response.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Jakarta Servlet API (`jakarta.servlet.Filter`)**: The interface it implements.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doFilter(ServletRequest request, ServletResponse response, FilterChain chain)`**:\n        *   **Purpose:** Sets the character encoding for the request and response.\n        *   **Logic:**\n            1.  It calls `request.setCharacterEncoding(\"UTF-8\")`. This must be done *before* any parameters are read from the request.\n            2.  It calls `response.setCharacterEncoding(\"UTF-8\")`. This informs the browser how to interpret the response body.\n            3.  It then calls `chain.doFilter(request, response)` to pass control to the next filter in the chain.'),
('src/main/java/de/technikteam/listener/AppContextListener.java', '1.  **File Overview & Purpose**\n\n    This is a Jakarta EE lifecycle listener that executes code when the web application is shut down. Its primary responsibility is to perform critical cleanup of resources that are managed outside the servlet container''s direct control, specifically the MySQL JDBC driver. This prevents memory leaks in long-running application servers like Tomcat.\n\n2.  **Architectural Role**\n\n    This is a core **Configuration** / **Infrastructure** component. It hooks into the servlet container''s lifecycle to ensure a clean shutdown of the application.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Jakarta Servlet API (`jakarta.servlet.ServletContextListener`)**: The interface it implements to listen for application startup and shutdown events.\n    *   **MySQL Connector/J (`com.mysql.cj.jdbc.AbandonedConnectionCleanupThread`)**: A specific class from the MySQL driver that manages a background thread. This listener explicitly shuts it down.\n    *   **java.sql.DriverManager**: The standard Java class for managing JDBC drivers.\n\n4.  **In-Depth Breakdown**\n\n    *   **`contextInitialized(ServletContextEvent sce)`**: This method is called when the application starts. It currently only logs an informational message.\n\n    *   **`contextDestroyed(ServletContextEvent sce)`**:\n        *   **Purpose:** This method is called by the servlet container just before the application is undeployed or the server is shut down.\n        *   **Logic:**\n            1.  **Shutdown MySQL Cleanup Thread:** It calls `AbandonedConnectionCleanupThread.checkedShutdown()` to gracefully stop a background thread started by the MySQL JDBC driver. This prevents the thread from outliving the application and causing a memory leak.\n            2.  **Deregister JDBC Driver:** It iterates through all registered JDBC drivers using `DriverManager.getDrivers()`. For each driver, it checks if the driver was loaded by the web application''s own classloader. If so, it calls `DriverManager.deregisterDriver()` to remove it. This is the crucial step to allow the classloader and the driver''s classes to be garbage collected, preventing a common source of memory leaks in Java web applications.'),
('src/main/java/de/technikteam/listener/ApplicationInitializerListener.java', '1.  **File Overview & Purpose**\n\n    This is a Jakarta EE lifecycle listener that runs once when the application context is first initialized. Its sole responsibility is to set up and execute database migrations using the Flyway library. This ensures that the database schema is at the correct version before the application starts handling requests.\n\n2.  **Architectural Role**\n\n    This is a critical **Configuration** / **Infrastructure** component. It acts as the bootstrap for the **DAO Tier**, ensuring the database schema is consistent with what the application''s code expects. It runs before any servlets or DAOs are instantiated.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Jakarta Servlet API (`jakarta.servlet.ServletContextListener`)**: The interface it implements.\n    *   **Flyway (`org.flywaydb.core.Flyway`)**: The core library used to manage and apply database migrations.\n    *   `ConfigurationService`: Used to retrieve the database connection details from `config.properties`.\n\n4.  **In-Depth Breakdown**\n\n    *   **`contextInitialized(ServletContextEvent sce)`**:\n        *   **Purpose:** This method is called by the servlet container when the application starts up.\n        *   **Logic:**\n            1.  It instantiates a `ConfigurationService` to load the application''s properties.\n            2.  It configures a `Flyway` instance with the database URL, user, and password from the configuration.\n            3.  `locations(\"classpath:db/migration\")`: It tells Flyway to look for SQL migration scripts on the classpath in the `db/migration` folder.\n            4.  `baselineOnMigrate(true)`: This allows Flyway to automatically create its schema history table if it doesn''t exist, which is useful for the first-time deployment on an empty database.\n            5.  `flyway.migrate()`: This is the command that executes the migration. Flyway connects to the database, checks its history table, and applies any new, unapplied migration scripts in version order.\n            6.  **CORRECTION**: The code was updated to use the `result.migrationsExecuted` getter method instead of direct field access, resolving a compiler warning.\n            7.  It logs the outcome of the migration. If the migration fails (`!result.success`), it throws a `RuntimeException`, which will prevent the application from starting successfully.\n\n    *   **`contextDestroyed(ServletContextEvent sce)`**: This method is called on shutdown and currently only logs an informational message.'),
('src/main/java/de/technikteam/listener/SessionListener.java', '1.  **File Overview & Purpose**\n\n    This is a Jakarta EE lifecycle listener that monitors the creation and destruction of `HttpSession` objects. Its purpose is to keep the `SessionManager`''s central registry of active sessions up-to-date.\n\n2.  **Architectural Role**\n\n    This is an infrastructure component in the **Web/Controller Tier**. It provides the mechanism for the `SessionManager` to track all active user sessions across the application.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Jakarta Servlet API (`jakarta.servlet.http.HttpSessionListener`)**: The interface it implements to receive session lifecycle events.\n    *   `SessionManager`: The singleton class that this listener updates.\n\n4.  **In-Depth Breakdown**\n\n    *   **`sessionCreated(HttpSessionEvent se)`**\n        *   **Method Signature:** `public void sessionCreated(HttpSessionEvent se)`\n        *   **Purpose:** This method is called by the servlet container immediately after a new session is created.\n        *   **Logic:** It retrieves the new `HttpSession` from the event object and passes it to `SessionManager.addSession()` to add it to the central registry.\n        *   **Side Effects:** Adds a session to the `SessionManager`''s concurrent map.\n\n    *   **`sessionDestroyed(HttpSessionEvent se)`**\n        *   **Method Signature:** `public void sessionDestroyed(HttpSessionEvent se)`\n        *   **Purpose:** This method is called by the servlet container just before a session is invalidated (either due to timeout or an explicit `invalidate()` call).\n        *   **Logic:** It retrieves the `HttpSession` being destroyed and passes it to `SessionManager.removeSession()` to remove it from the central registry.\n        *   **Side Effects:** Removes a session from the `SessionManager`''s concurrent map.'),
('src/main/java/de/technikteam/model/Achievement.java', '1.  **File Overview & Purpose**\n\n    This is a Plain Old Java Object (POJO) that serves as the data model for an achievement. It represents a record from the `achievements` table and includes fields for its programmatic key, user-facing name, description, and associated FontAwesome icon. A transient field, `earnedAt`, is used to store when a specific user earned the achievement.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used to transfer achievement data between the `AchievementDAO`, `AchievementService`, and the servlets/JSPs.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `java.time.LocalDateTime`: Used for the `earnedAt` field.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key.\n        *   `achievementKey`: A unique, immutable string identifier used programmatically to grant achievements (e.g., \"EVENT_PARTICIPANT_5\").\n        *   `name`: The user-visible name of the achievement (e.g., \"Erfahrener Techniker\").\n        *   `description`: A user-visible description of how to earn the achievement.\n        *   `iconClass`: The FontAwesome CSS class for the achievement''s icon (e.g., \"fa-star\").\n        *   `earnedAt`: A transient field populated when fetching achievements for a specific user, indicating when they received it.\n    *   **`getFormattedEarnedAt()`**: A convenience method that uses the `DateFormatter` utility to provide a display-ready date string for the JSP views.\n    *   **Getters and Setters**: Standard boilerplate methods for accessing and modifying the object''s properties.'),
('src/main/java/de/technikteam/model/AdminLog.java', '1.  **File Overview & Purpose**\n\n    This is a POJO representing a single audit log entry from the `admin_logs` table. It models an administrative action, capturing who performed it, what they did, when they did it, and any relevant details.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It''s created by the `AdminLogService` to be persisted by the `AdminLogDAO`, and it''s retrieved by the `AdminLogDAO` to be displayed in the `admin_log.jsp` view.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `DateFormatter`: Used for the `getFormattedActionTimestamp()` convenience method.\n    *   `java.time.LocalDateTime`: Used for the `actionTimestamp` field.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the log entry.\n        *   `adminUsername`: The username of the administrator who performed the action.\n        *   `actionType`: A short, programmatic string identifying the type of action (e.g., \"CREATE_USER\", \"DELETE_EVENT\").\n        *   `details`: A human-readable text description of the action.\n        *   `actionTimestamp`: The exact date and time the action occurred.\n    *   **`getFormattedActionTimestamp()`**: A view-helper method that provides a pre-formatted string for the timestamp, suitable for direct use in JSPs.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/ApiResponse.java', '1.  **File Overview & Purpose**\n\n    This is a standard Data Transfer Object (DTO) used to create consistent JSON responses for all API endpoints. It enforces a uniform structure containing a success status, a human-readable message, and an optional data payload, which simplifies client-side handling of AJAX requests.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**, but its primary use is within the **Web/Controller Tier**. Servlets and Action classes create instances of `ApiResponse` to structure their JSON output before serialization with Gson.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This is a self-contained POJO.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `success` (boolean): `true` if the operation was successful, `false` otherwise.\n        *   `message` (String): A user-friendly message describing the outcome of the operation (e.g., \"User successfully created.\", \"Invalid password.\").\n        *   `data` (Object): An optional payload containing any relevant data to be sent back to the client (e.g., the newly created User object, a list of items).\n    *   **Static Factory Methods (`success`, `error`)**:\n        *   **Purpose:** These provide a convenient and readable way to construct `ApiResponse` objects without needing to call the constructor directly.\n        *   **Examples:**\n            *   `ApiResponse.success(\"Operation complete.\")`\n            *   `ApiResponse.error(\"Failed to find item.\")`\n            *   `ApiResponse.success(\"User found.\", userObject)'),
('src/main/java/de/technikteam/model/Attachment.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a file attachment record from the `attachments` table. It models a polymorphic relationship, linking a physical file to a parent entity (which can be either an ''EVENT'' or a ''MEETING'') and defines the visibility of the attachment based on user roles.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It''s used to transfer attachment metadata between the `AttachmentDAO`, services, and servlets.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `java.time.LocalDateTime`: For the `uploadedAt` timestamp.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the attachment record.\n        *   `parentType`: An enum-like string (`\"EVENT\"` or `\"MEETING\"`) indicating the type of entity this attachment belongs to.\n        *   `parentId`: The foreign key ID of the parent entity (e.g., the `event.id`).\n        *   `filename`: The original, user-facing name of the file.\n        *   `filepath`: The unique, sanitized path of the file on the server''s filesystem.\n        *   `uploadedAt`: The timestamp of when the file was uploaded.\n        *   `requiredRole`: An enum-like string (`\"NUTZER\"` or `\"ADMIN\"`) that determines the minimum role required to view and download the file.\n    *   **Getters and Setters**: Standard methods for property access.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/model/Course.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a \"course template\" from the `courses` table. It defines the general properties of a type of training or qualification, such as \"Grundlehrgang Tontechnik\", but does not represent a specific, schedulable event.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Model Tier**. It is used to transfer data about course templates between the `CourseDAO` and the `AdminCourseServlet` for management purposes.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This is a self-contained POJO.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the course.\n        *   `name`: The full, user-facing name of the course (e.g., \"Grundlehrgang Tontechnik\").\n        *   `abbreviation`: A short abbreviation (e.g., \"TON-GL\") used for display in compact views like the Qualification Matrix.\n        *   `description`: A general description of the course content and goals.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/DashboardDataDTO.java', '1.  **File Overview & Purpose**\n\n    This is a Data Transfer Object (DTO) designed to aggregate all the necessary information for rendering the dynamic widgets on the admin dashboard. It bundles data from multiple sources into a single object, simplifying the data retrieval process in the `AdminDashboardService` and its delivery to the `AdminDashboardApiServlet`.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Model Tier**. It acts as a data container, facilitating communication between the **Service Tier** (`AdminDashboardService`) and the **Web/Controller Tier** (`AdminDashboardApiServlet`).\n\n3.  **Key Dependencies & Libraries**\n\n    *   `Event`, `StorageItem`, `AdminLog`: The model classes for the data it contains.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `upcomingEvents` (List<Event>): A list of the next few upcoming events.\n        *   `lowStockItems` (List<StorageItem>): A list of inventory items whose available quantity is below a certain threshold.\n        *   `recentLogs` (List<AdminLog>): A list of the most recent administrative actions.\n        *   `eventTrendData` (List<Map<String, Object>>): Time-series data for the event trend chart, with each map representing a month and its event count.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/Event.java', '1.  **File Overview & Purpose**\n\n    This is a comprehensive model representing a single event from the `events` table. It contains not only the core event data but also serves as an aggregator for all related information, such as assigned users, tasks, skill requirements, and reserved materials. It also includes transient fields for UI logic, like `isUserQualified`.\n\n2.  **Architectural Role**\n\n    This class is a central part of the **Model Tier**. It''s heavily used across all tiers: created and populated by the `EventDAO`, manipulated in the `EventService`, and passed to JSPs in the **View Tier** for detailed display.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `DateFormatter`: Used for convenience methods that provide display-ready date strings.\n    *   `User`, `SkillRequirement`, `EventTask`, etc.: Other model classes that this class aggregates.\n\n4.  **In-Depth Breakdown**\n\n    *   **Core Fields:**\n        *   `id`, `name`, `eventDateTime`, `endDateTime`, `description`, `location`, `status`, `leaderUserId`: These map directly to columns in the `events` table.\n    *   **Aggregated Lists:**\n        *   `skillRequirements`, `assignedAttendees`, `eventTasks`, `chatMessages`, `attachments`, `reservedItems`, `customFields`: These are lists of related objects, populated by the `EventDAO` or `EventDetailsServlet` when a detailed view of the event is required. They are \"transient\" in the sense that they are not columns in the `events` table itself.\n    *   **Transient UI Fields:**\n        *   `userAttendanceStatus`: Stores the current user''s specific status for this event (e.g., \"ANGEMELDET\", \"ZUGEWIESEN\").\n        *   `isUserQualified`: A boolean flag indicating if the current user meets the skill requirements for this event.\n    *   **Convenience Methods:**\n        *   `getFormattedEventDateTime`, `getFormattedEventDateTimeRange`: Use the `DateFormatter` to provide JSP-ready strings for event times, encapsulating the formatting logic within the model.'),
('src/main/java/de/technikteam/model/EventAttendance.java', '1.  **File Overview & Purpose**\n\n    This POJO models a single record from the `event_attendance` table. It represents a user''s sign-up status for a specific event, which is distinct from their final assignment to the event team.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It''s used to transfer data about user sign-ups between the `EventDAO` and servlets that need to check or display this information.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This is a self-contained POJO.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `eventId`: Foreign key to the `events` table.\n        *   `userId`: Foreign key to the `users` table.\n        *   `username`: A transient field, populated from a JOIN, for display purposes.\n        *   `signupStatus`: An enum-like string (`\"ANGEMELDET\"` or `\"ABGEMELDET\"`) representing the user''s voluntary status.\n        *   `commitmentStatus`: An enum-like string (`\"BESTÄTIGT\"`, `\"OFFEN\"`, etc.) that an admin could potentially set, though this feature might not be fully implemented.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/EventChatMessage.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a single message from the `event_chat_messages` table. It contains all the data for a chat message, including the content, sender information, timestamps, and state flags for edits and deletions.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It''s created and managed by the `EventChatDAO` and serialized to JSON by the `EventChatSocket` for real-time communication with the client-side chat interface.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `java.time.LocalDateTime` and `DateTimeFormatter`: Used for handling and formatting timestamps.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`, `eventId`, `userId`, `username`, `messageText`, `sentAt`: Core message data.\n        *   `edited`: A boolean flag that is set to `true` if the message content has been updated.\n        *   `isDeleted`: A boolean flag for soft-deletes.\n        *   `deletedByUserId`, `deletedByUsername`, `deletedAt`: Fields to track who performed a soft delete and when.\n        *   `chatColor`: The sender''s preferred chat color, fetched via a JOIN in the DAO.\n    *   **Formatting Methods (`getFormattedSentAt`, `getFormattedDeletedAt`)**: Convenience methods to provide display-ready time strings for the UI.'),
('src/main/java/de/technikteam/model/EventCustomField.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a custom field definition for an event''s sign-up form, corresponding to a record in the `event_custom_fields` table. It defines the properties of a question asked to users during sign-up, such as its name, type (e.g., text, boolean), and whether it''s required.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used to transfer data about custom field definitions between the `EventCustomFieldDAO`, `EventService`, and the `EventCustomFieldsApiServlet` which provides this data to the frontend.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This is a self-contained POJO.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the custom field.\n        *   `eventId`: A foreign key linking this field to a specific event.\n        *   `fieldName`: The question or label for the field (e.g., \"T-Shirt Größe\").\n        *   `fieldType`: An enum-like string (`\"TEXT\"`, `\"BOOLEAN\"`, etc.) that determines the type of input rendered on the frontend.\n        *   `isRequired`: A boolean flag indicating if the user must provide an answer to sign up.\n        *   `fieldOptions`: A string (potentially JSON) to store options for field types like ''DROPDOWN'' or ''CHECKBOX_GROUP''.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/EventCustomFieldResponse.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a user''s response to a specific custom field for an event. It corresponds to a record in the `event_custom_field_responses` table, linking a user, a custom field, and their provided answer.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is created by the `EventActionServlet` when a user submits their sign-up form and is passed to the `EventCustomFieldDAO` for persistence.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This is a self-contained POJO.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the response.\n        *   `fieldId`: A foreign key linking this response to a specific `EventCustomField`.\n        *   `userId`: A foreign key linking this response to the user who submitted it.\n        *   `responseValue`: The user''s answer, stored as a string.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/EventTask.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a single task associated with an event, corresponding to a record in the `event_tasks` table. It contains the task''s description and status, and also serves as an aggregator for related data like assigned users, required items, and kits.\n\n2.  **Architectural Role**\n\n    This class is a central part of the **Model Tier**. It is used to transfer detailed task information between the `EventTaskDAO`, the `EventDetailsServlet`, and the JSP view.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `User`, `StorageItem`, `InventoryKit`: Model classes that this class aggregates in lists.\n\n4.  **In-Depth Breakdown**\n\n    *   **Core Fields:**\n        *   `id`, `eventId`, `description`, `details`, `status`, `displayOrder`, `requiredPersons`: These map directly to columns in the `event_tasks` table.\n    *   **Aggregated Lists:**\n        *   `assignedUsers`: A list of `User` objects directly assigned to this task.\n        *   `requiredItems`: A list of `StorageItem` objects needed for this task.\n        *   `requiredKits`: A list of `InventoryKit` objects needed for this task.\n    *   **Transient UI Fields:**\n        *   `eventName`: The name of the parent event, populated for display on the user dashboard.\n        *   `assignedUsernames`: A transient string field, which is not used. The getter method provides the same functionality dynamically.\n    *   **Convenience Methods:**\n        *   `getAssignedUsernames()`: A view-helper method that generates a comma-separated string of assigned usernames from the `assignedUsers` list, providing a display-ready value for JSPs.'),
('src/main/java/de/technikteam/model/FeedbackForm.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a feedback form, corresponding to a record in the `feedback_forms` table. It acts as a container for feedback responses related to a specific event.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is created and retrieved by the `EventFeedbackDAO` and used by the `FeedbackServlet` to manage the event feedback process.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `java.time.LocalDateTime`: For the `createdAt` timestamp.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the feedback form.\n        *   `eventId`: A foreign key linking this form to a specific `Event`.\n        *   `title`: The title of the feedback form, typically including the event name.\n        *   `createdAt`: The timestamp of when the form record was created.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/FeedbackResponse.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a user''s submitted feedback for a specific event, corresponding to a record in the `feedback_responses` table. It captures a user''s rating and textual comments for a given feedback form.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is created in the `FeedbackServlet` with data from a user''s form submission and is passed to the `EventFeedbackDAO` to be saved to the database.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `java.time.LocalDateTime`: For the `submittedAt` timestamp.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the response.\n        *   `formId`: A foreign key linking this response to a `FeedbackForm`.\n        *   `userId`: A foreign key linking this response to the submitting `User`.\n        *   `rating`: An integer representing the user''s rating (e.g., 1-5 stars).\n        *   `comments`: The user''s textual feedback or suggestions.\n        *   `submittedAt`: The timestamp of when the feedback was submitted.\n        *   `username`: A transient field, populated from a JOIN, for display purposes.\n    *   **Getters and Setters**: Standard methods for property access.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/model/FeedbackSubmission.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a general feedback submission (e.g., bug report, feature request) from a user, corresponding to a record in the `feedback_submissions` table. It includes details about the submission, its current status in the workflow, and its display order on the admin Kanban board.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used to transfer feedback data between the `FeedbackSubmissionDAO` and the servlets responsible for handling feedback (`FeedbackServlet`, `MyFeedbackServlet`, `AdminFeedbackServlet`).\n\n3.  **Key Dependencies & Libraries**\n\n    *   `DateFormatter`: Used for the `getFormattedSubmittedAt()` convenience method.\n    *   `java.time.LocalDateTime`: Used for the `submittedAt` field.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`, `userId`, `subject`, `content`, `submittedAt`: Core data of the submission.\n        *   `username`: Transient field for the submitter''s name.\n        *   `displayTitle`: An optional, admin-editable title to clarify the subject.\n        *   `status`: An enum-like string (`\"NEW\"`, `\"VIEWED\"`, `\"PLANNED\"`, etc.) representing its stage in the Kanban workflow.\n        *   `displayOrder`: An integer used to maintain the order of cards within a status column on the Kanban board.\n    *   **`getFormattedSubmittedAt()`**: A view-helper method providing a pre-formatted string for the submission timestamp.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/File.java', '1.  **File Overview & Purpose**\n\n    This POJO represents the metadata for a single file stored in the system, corresponding to a record in the `files` table. It holds information about the file''s name, its physical location on the server, its category, and access restrictions.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It''s used to transfer file metadata between the `FileDAO` and various servlets that display or manage files.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `DateFormatter`: Used for the `getFormattedUploadedAt()` convenience method.\n    *   `java.time.LocalDateTime`: Used for the `uploadedAt` field.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`, `filename`, `filepath`, `categoryId`, `uploadedAt`: Core metadata mapping to table columns.\n        *   `categoryName`: A transient field, populated by a JOIN, for easy display in views.\n        *   `requiredRole`: An enum-like string (`\"NUTZER\"` or `\"ADMIN\"`) to control access.\n        *   `content`: A transient field used to hold the file''s text content when it is being read for the Markdown editor.\n    *   **`getFormattedUploadedAt()`**: A view-helper method that provides a display-ready timestamp.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/FileCategory.java', '1.  **File Overview & Purpose**\n\n    This is a simple POJO representing a category for organizing files, corresponding to a record in the `file_categories` table. It provides a way to group related documents in the UI.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used by the `FileDAO` and passed to the `AdminFileManagementServlet` to display and manage file categories.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This is a self-contained POJO.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the category.\n        *   `name`: The user-visible name of the category.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/InventoryKit.java', '1.  **File Overview & Purpose**\n\n    This POJO represents an \"inventory kit\" or a \"case,\" corresponding to a record in the `inventory_kits` table. A kit is a conceptual container that groups a predefined list of `StorageItem`s together, such as \"Audio Kit A\" or \"Lighting Case 1\".\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used to transfer data about kits between the `InventoryKitDAO` and the `AdminKitServlet` for management, and the `PackKitServlet` for displaying packing lists.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `InventoryKitItem`: The model class representing the items contained within this kit.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the kit.\n        *   `name`: The user-facing name of the kit (e.g., \"Mics and Stands\").\n        *   `description`: A brief description of the kit''s purpose.\n        *   `location`: The physical storage location of the assembled kit (e.g., \"Lager, Schrank 3\").\n        *   `items` (List<InventoryKitItem>): A list of the items and their quantities that belong to this kit. This is populated by a JOIN query in the DAO.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/InventoryKitItem.java', '1.  **File Overview & Purpose**\n\n    This POJO represents an entry in the `inventory_kit_items` junction table. It defines the relationship between an `InventoryKit` and a `StorageItem`, specifying the quantity of that item that belongs in the kit.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is primarily used within the `InventoryKit` model to represent the contents of a kit.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This is a self-contained POJO.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `kitId`: Foreign key to the `inventory_kits` table.\n        *   `itemId`: Foreign key to the `storage_items` table.\n        *   `quantity`: The number of this specific item that should be in the kit.\n        *   `itemName`: A transient field, populated from a JOIN in the DAO, to display the item''s name without needing to fetch the full `StorageItem` object.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/MaintenanceLogEntry.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a single record from the `maintenance_log` table. It captures the history of maintenance actions performed on a specific `StorageItem`, including repairs, marking for maintenance, and associated notes or costs.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is created by servlets like `AdminStorageServlet` to be persisted by the `MaintenanceLogDAO`, and is retrieved to be displayed on the `storage_item_details.jsp` page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `DateFormatter`: Used for the `getFormattedLogDate()` convenience method.\n    *   `java.time.LocalDateTime`: Used for the `logDate` field.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the log entry.\n        *   `itemId`: Foreign key to the `storage_items` table.\n        *   `userId`: Foreign key to the `users` table, indicating who performed the action.\n        *   `logDate`: The timestamp of the maintenance action.\n        *   `action`: A string describing the action (e.g., \"Marked for Maintenance\", \"Returned to Service\").\n        *   `notes`: Free-text notes from the user about the action.\n        *   `cost`: The cost associated with the maintenance, if any.\n        *   `username`: A transient field, populated by a JOIN, for displaying the user''s name.\n    *   **`getFormattedLogDate()`**: A view-helper method to provide a pre-formatted timestamp string.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/Meeting.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a specific, schedulable session or \"meeting\" for a course, corresponding to a record in the `meetings` table. Unlike a `Course` which is a template, a `Meeting` has a concrete date, time, and location.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used to transfer data about scheduled meetings between the `MeetingDAO`, various servlets (e.g., `MeetingServlet`, `AdminMeetingServlet`), and the JSP views.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `DateFormatter`: Used for convenience methods that provide display-ready date and time strings.\n    *   `java.time.LocalDateTime`: Used for the meeting''s start and end times.\n\n4.  **In-Depth Breakdown**\n\n    *   **Core Fields:**\n        *   `id`, `courseId`, `name`, `meetingDateTime`, `endDateTime`, `leaderUserId`, `description`, `location`: These map directly to columns in the `meetings` table.\n    *   **Transient UI Fields:**\n        *   `parentCourseName`: The name of the `Course` this meeting belongs to, populated by a JOIN.\n        *   `leaderUsername`: The name of the user leading the meeting, populated by a JOIN.\n        *   `userAttendanceStatus`: Stores the current logged-in user''s sign-up status for this meeting (`ANGEMELDET`, `ABGEMELDET`, `OFFEN`).\n    *   **Convenience Methods (`getFormatted...`)**: These methods use the `DateFormatter` to provide JSP-ready strings for the meeting''s date and time range, encapsulating formatting logic.'),
('src/main/java/de/technikteam/model/MeetingAttendance.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a user''s attendance record for a specific meeting, corresponding to a row in the `meeting_attendance` table. It tracks whether a user was present and allows for optional administrative remarks.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used to transfer attendance data between the `MeetingAttendanceDAO` and the servlets that manage and display this information, most notably the `MatrixServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This is a self-contained POJO.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `userId`: Foreign key to the `users` table.\n        *   `meetingId`: Foreign key to the `meetings` table.\n        *   `attended`: A boolean flag indicating if the user was present (`true`) or not (`false`).\n        *   `remarks`: An optional string for administrative notes, such as \"excused absence\".\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/NavigationItem.java', '1.  **File Overview & Purpose**\n\n    This is a simple, immutable POJO used to represent a single link in the application''s sidebar navigation. It holds all the necessary data to render a navigation item, including its label, URL, icon, and the permission required to view it.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. Instances of this class are created and managed exclusively by the `NavigationRegistry` utility and are stored in the user''s session to be rendered by the `main_header.jspf` fragment on every page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields (all `final`):**\n        *   `label`: The user-visible text of the link (e.g., \"Dashboard\").\n        *   `url`: The relative URL for the link (e.g., \"/home\").\n        *   `icon`: The FontAwesome CSS class for the link''s icon (e.g., \"fa-home\").\n        *   `requiredPermission`: The permission key (from the `Permissions` class) that a user must have to see this link. A `null` value indicates the link is visible to all authenticated users.\n    *   **Constructor and Getters**: A standard constructor to initialize the final fields and getters to access their values. There are no setters, making the object immutable.'),
('src/main/java/de/technikteam/model/ParticipationHistory.java', '1.  **File Overview & Purpose**\n\n    This is a Data Transfer Object (DTO) designed specifically for reporting purposes. It aggregates data from multiple tables (`users`, `events`, `event_attendance`, `event_assignments`) to create a flattened view of a user''s participation in an event. It does not map to a single database table.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Model Tier**. It is used by the `ReportDAO` to structure the results of complex analytical queries and is then passed to the `AdminReportServlet` for display or export.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `java.time.LocalDateTime`: For the `eventDate` field.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `username`: The name of the user.\n        *   `eventName`: The name of the event.\n        *   `eventDate`: The date and time of the event.\n        *   `status`: The user''s status for that event (e.g., \"ZUGEWIESEN\", \"ANGEMELDET\").\n    *   **Getters and Setters**: Standard methods for property access.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/model/PasskeyCredential.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a WebAuthn/Passkey credential stored in the `user_passkeys` table. It holds all the necessary information for a user to perform a passwordless login, including the public key, credential ID, and a signature counter for security.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used to transfer credential data between the `PasskeyDAO` and the `PasskeyService`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `java.time.LocalDateTime`: For the `createdAt` timestamp.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The internal primary key in the database.\n        *   `userId`: Foreign key linking the credential to a `User`.\n        *   `name`: A user-provided name for the device (e.g., \"My Laptop\").\n        *   `userHandle`: A unique identifier for the user, provided during registration.\n        *   `credentialId`: The globally unique, URL-safe Base64 encoded ID for this credential.\n        *   `publicKey`: The user''s public key, encoded as a string.\n        *   `signatureCount`: A counter that is incremented on each successful authentication to help prevent credential cloning.\n        *   `createdAt`: The timestamp of when the credential was registered.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/Permission.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a single, defined permission from the `permissions` table. It models a granular action that can be assigned to a user, providing a structured object containing the permission''s unique key and a human-readable description.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used by the `PermissionDAO` to represent permission data retrieved from the database and is passed to the `AdminUserServlet` to populate the permissions checklist in the user editing modal.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This is a self-contained POJO.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the permission.\n        *   `permissionKey`: The unique string identifier for the permission (e.g., \"USER_CREATE\"). This key is used for programmatic checks.\n        *   `description`: A user-friendly description of what the permission allows (e.g., \"Kann neue Benutzer anlegen.\").\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/ProfileChangeRequest.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a user''s request to modify their own profile data, corresponding to a record in the `profile_change_requests` table. It captures who made the request, what changes they requested (as a JSON string), its current status, and who reviewed it.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used to transfer request data between the `ProfileChangeRequestDAO` and the servlets that handle the request workflow (`ProfileServlet` for creation, `AdminChangeRequestServlet` for review).\n\n3.  **Key Dependencies & Libraries**\n\n    *   `java.time.LocalDateTime`: For the `requestedAt` and `reviewedAt` timestamps.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the request.\n        *   `userId`: Foreign key of the user who made the request.\n        *   `username`: Transient field for the requester''s name, for display in the admin UI.\n        *   `requestedChanges`: A JSON string containing a map of the fields to be changed and their new values (e.g., `{\"email\":\"new@email.com\", \"className\":\"11a\"}`).\n        *   `status`: An enum-like string (`\"PENDING\"`, `\"APPROVED\"`, `\"DENIED\"`) indicating the state of the request.\n        *   `requestedAt`: Timestamp of when the request was submitted.\n        *   `reviewedByAdminId`: Foreign key of the admin who reviewed the request.\n        *   `reviewedByAdminName`: Transient field for the admin''s name.\n        *   `reviewedAt`: Timestamp of when the request was reviewed.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/Role.java', '1.  **File Overview & Purpose**\n\n    This is a simple POJO representing a user role from the `roles` table. It defines a high-level grouping of users (e.g., \"ADMIN\", \"NUTZER\").\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used by the `RoleDAO` to represent role data and is passed to the `AdminUserServlet` to populate the roles dropdown list.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This is a self-contained POJO.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the role.\n        *   `roleName`: The unique name of the role (e.g., \"ADMIN\").\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/SkillRequirement.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a single skill requirement for an event, corresponding to a record in the `event_skill_requirements` table. It links an event to a specific course (acting as the \"skill\") and specifies how many people with that qualification are needed.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used to transfer data about an event''s personnel needs between the `EventDAO`, `EventService`, and the `AdminEventServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This is a self-contained POJO.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `requiredCourseId`: The foreign key ID of the `Course` that represents the required skill.\n        *   `requiredPersons`: The number of people with this skill needed for the event.\n        *   `courseName`: A transient field, populated by a JOIN, to display the name of the required course in the UI.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/StorageItem.java', '1.  **File Overview & Purpose**\n\n    This is a comprehensive model representing a single inventory item from the `storage_items` table. It contains all the core data about an item, such as its name, location, and quantities, as well as transient fields and convenience methods for UI display logic.\n\n2.  **Architectural Role**\n\n    This class is a central part of the **Model Tier**. It''s used across all tiers: managed by the `StorageDAO`, manipulated by the `StorageService`, and displayed in various views like `lager.jsp` and `admin_storage_list.jsp`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **Core Fields:**\n        *   Maps directly to the columns in the `storage_items` table: `id`, `name`, `location`, `cabinet`, `compartment`, `quantity` (total including defective), `maxQuantity`, `defectiveQuantity`, `defectReason`, `weightKg`, `priceEur`, `imagePath`, `status`, `currentHolderUserId`, `assignedEventId`.\n    *   **Transient UI Fields:**\n        *   `currentHolderUsername`: The name of the user who has checked out the item, populated by a JOIN.\n    *   **Convenience Methods:**\n        *   **`getAvailableQuantity()`**: Calculates the non-defective, available quantity (`quantity` - `defectiveQuantity`). This is a crucial piece of business logic encapsulated within the model.\n        *   **`getAvailabilityStatus()`**: Returns a human-readable status string (\"Vollständig\", \"Niedriger Bestand\", \"Vergriffen\") based on the available quantity relative to the maximum quantity.\n        *   **`getAvailabilityStatusCssClass()`**: Returns a corresponding CSS class (`status-ok`, `status-warn`, `status-danger`) for the availability status, simplifying JSP logic.'),
('src/main/java/de/technikteam/model/StorageLogEntry.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a single transaction log entry from the `storage_log` table. It serves as a historical record of an item being checked in or out of the inventory.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is created by the `StorageService` to be persisted by the `StorageLogDAO`, and is retrieved by the DAO to be displayed on the `storage_item_details.jsp` page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `DateFormatter`: Used for the `getFormattedTimestamp()` method.\n    *   `java.time.LocalDateTime` and `DateTimeFormatter`: For handling and formatting the transaction timestamp.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`, `itemId`, `userId`, `notes`, `eventId`, `transactionTimestamp`: These map directly to table columns.\n        *   `quantityChange`: An integer representing the change in quantity. It is negative for check-outs and positive for check-ins.\n        *   `username`: A transient field, populated by a JOIN, for displaying the name of the user who performed the transaction.\n    *   **Convenience Methods (`getFormattedTimestamp`, `getTransactionTimestampLocaleString`)**: Provide different formatted string representations of the `transactionTimestamp` for use in the UI.'),
('src/main/java/de/technikteam/model/SystemStatsDTO.java', '1.  **File Overview & Purpose**\n\n    This is a Data Transfer Object (DTO) designed to hold a snapshot of the server''s system-level statistics. It aggregates various metrics like CPU, RAM, and disk usage into a single, clean object for easy serialization and transport to the client.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is created by the `SystemInfoService` and serialized to JSON by the `SystemStatsApiServlet` to provide real-time data for the admin system status page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This is a self-contained POJO.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `cpuLoad` (double): The system-wide CPU load as a percentage (0.0 - 100.0).\n        *   `totalMemory` (long): Total physical RAM in Gigabytes.\n        *   `usedMemory` (long): Used physical RAM in Gigabytes.\n        *   `totalDiskSpace` (long): Total disk space of the root partition in Gigabytes.\n        *   `usedDiskSpace` (long): Used disk space of the root partition in Gigabytes.\n        *   `uptime` (String): A human-readable string representing the server uptime (e.g., \"5 Tage, 10 Stunden, 3 Minuten\").\n        *   `batteryPercentage` (int): The current battery level as a percentage (0-100), or -1 if not available.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/TodoCategory.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a category in the To-Do list feature, corresponding to a record in the `todo_categories` table. It acts as a container for a list of related `TodoTask` objects.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used by the `TodoDAO` and `TodoService` to structure the To-Do list data for the `AdminTodoApiServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `TodoTask`: The model class for the tasks contained within this category.\n    *   `java.util.List`: Used for the `tasks` collection.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the category.\n        *   `name`: The name of the category (e.g., \"Urgent Bugs\", \"Feature Ideas\").\n        *   `displayOrder`: An integer that determines the vertical sorting of categories on the board.\n        *   `tasks` (List<TodoTask>): A list of task objects that belong to this category.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/model/TodoTask.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a single task item in the To-Do list feature, corresponding to a record in the `todo_tasks` table. It contains the task''s content, its completion status, and its display order within its category.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used as a child object within the `TodoCategory` model and is managed by the `TodoDAO` and `TodoService`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This is a self-contained POJO.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the task.\n        *   `categoryId`: A foreign key linking the task to its parent `TodoCategory`.\n        *   `content`: The text of the to-do item.\n        *   `isCompleted`: A boolean flag indicating whether the task is done.\n        *   `displayOrder`: An integer that determines the sorting of tasks within a category.\n    *   **Getters and Setters**: Standard methods for property access.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/model/User.java', '1.  **File Overview & Purpose**\n\n    This is the central model representing a user in the application, corresponding to a record in the `users` table. It holds all core profile information, as well as the user''s role and the complete, resolved set of their permissions. It includes a key business logic method `hasAdminAccess()` for authorization checks.\n\n2.  **Architectural Role**\n\n    This is a critical class in the **Model Tier**. A `User` object is stored in the `HttpSession` upon successful login and is accessed by nearly every other component in the application—from filters and servlets for authorization to DAOs for identifying the actor in log entries.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `Permissions`: The constants class is used within the `hasAdminAccess()` method.\n    *   `DateFormatter`: Used by the `getFormattedCreatedAt()` convenience method.\n\n4.  **In-Depth Breakdown**\n\n    *   **Core Fields:**\n        *   `id`, `username`, `roleId`, `createdAt`, `classYear`, `className`, `email`, `chatColor`, `theme`: These map to columns in the `users` table.\n    *   **Aggregated/Transient Fields:**\n        *   `roleName`: The name of the user''s role, populated by a JOIN in the `UserDAO`.\n        *   `permissions` (Set<String>): The complete set of permission keys the user has. This is populated at login time by the `UserDAO` by resolving both direct and role-based permissions.\n    *   **`hasAdminAccess()`**\n        *   **Method Signature:** `public boolean hasAdminAccess()`\n        *   **Purpose:** A crucial piece of business logic encapsulated in the model. It provides a single, reliable way to determine if a user should have access to administrative areas.\n        *   **Logic:** It returns `true` if the user has the master `ACCESS_ADMIN_PANEL` permission, or if they have *any* other permission that implies administrative capabilities (e.g., any `_CREATE`, `_DELETE`, `_MANAGE` permission). This is more flexible than just checking for the \"ADMIN\" role name.\n    *   **`getFormattedCreatedAt()`**: A view-helper method to provide a JSP-ready string for the user''s registration date.\n    *   **Constructors and Getters/Setters**: Includes a default constructor, a convenience constructor, and standard property accessors.'),
('src/main/java/de/technikteam/model/UserQualification.java', '1.  **File Overview & Purpose**\n\n    This POJO represents a user''s qualification, linking a user to a course. It corresponds to a record in the `user_qualifications` table and tracks the user''s status for that course (e.g., \"BESUCHT\", \"ABSOLVIERT\"), the date of completion, and any administrative remarks.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used to transfer qualification data between the `UserQualificationsDAO` and the servlets that display this information, such as the `ProfileServlet` and the `MatrixServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `java.time.LocalDate`: Used for the `completionDate` field.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `userId`: Foreign key to the `users` table.\n        *   `courseId`: Foreign key to the `courses` table.\n        *   `courseName`: A transient field, populated by a JOIN, for displaying the course''s name.\n        *   `status`: An enum-like string indicating the user''s progress in the course.\n        *   `completionDate`: The date on which the user achieved \"ABSOLVIERT\" status.\n        *   `remarks`: Optional administrative notes.\n    *   **Getters and Setters**: Standard methods for property access.'),
('src/main/java/de/technikteam/service/AchievementService.java', '1.  **File Overview & Purpose**\n\n    This service class contains the business logic for checking and granting achievements to users based on specific trigger events. It decouples the achievement logic from the DAOs and the servlets where the triggering actions occur.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Service Tier**. It is called by other components (like `AdminEventServlet` after an event is marked as ''ABGESCHLOSSEN'') to evaluate a user''s progress and potentially award new achievements. It coordinates between the `AchievementDAO` and other DAOs (`EventDAO`) to gather the necessary data for its checks.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `AchievementDAO` and `EventDAO`.\n    *   `AchievementDAO`: Used to check if a user already has an achievement and to grant new ones.\n    *   `EventDAO`: Used to fetch data about a user''s event history (participation count, leadership count).\n\n4.  **In-Depth Breakdown**\n\n    *   **`checkAndGrantAchievements(User user, String triggerType)`**\n        *   **Method Signature:** `public void checkAndGrantAchievements(User user, String triggerType)`\n        *   **Purpose:** The main entry point for the service. It acts as a router, calling specific check methods based on the `triggerType`.\n        *   **Parameters:**\n            *   `user` (User): The user whose achievements should be checked.\n            *   `triggerType` (String): A string identifying the event that triggered the check (e.g., \"EVENT_COMPLETED\").\n        *   **Side Effects:** Can lead to database writes via the `achievementDAO.grantAchievementToUser` method.\n\n    *   **`checkEventParticipationAchievements(User user)`**\n        *   **Method Signature:** `private void checkEventParticipationAchievements(User user)`\n        *   **Purpose:** Checks if the user has met the criteria for event participation achievements (e.g., 1, 5, or 10 completed events).\n        *   **Logic:** It fetches the number of completed events for the user from the `EventDAO` and then calls `achievementDAO.grantAchievementToUser` for each milestone the user has reached.\n        *   **Side Effects:** Database writes.\n\n    *   **`checkEventLeaderAchievements(User user)`**\n        *   **Method Signature:** `private void checkEventLeaderAchievements(User user)`\n        *   **Purpose:** Checks if the user has met the criteria for event leadership achievements.\n        *   **Logic:** It calculates the number of completed events where the user was the leader and grants the corresponding achievement if the criteria are met.\n        *   **Side Effects:** Database writes.'),
('src/main/java/de/technikteam/service/AdminDashboardService.java', '1.  **File Overview & Purpose**\n\n    This service class is responsible for aggregating all the data required for the administrative dashboard. It acts as a facade, coordinating calls to various DAOs to collect information for the different dashboard widgets (Upcoming Events, Low Stock, Recent Logs, Event Trend) and assembling it into a single `DashboardDataDTO`.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Service Tier**. It encapsulates the business logic for what data should be displayed on the admin dashboard. It is called by the `AdminDashboardApiServlet` to provide the data needed for the dynamic, client-side rendering of the dashboard.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `EventDAO`, `StorageDAO`, `AdminLogDAO`, and `ReportDAO`.\n    *   `EventDAO`: Used to fetch upcoming events.\n    *   `StorageDAO`: Used to fetch items with low stock levels.\n    *   `AdminLogDAO`: Used to fetch the most recent log entries.\n    *   `ReportDAO`: Used to fetch the time-series data for the event trend chart.\n    *   `DashboardDataDTO` (Model): The Data Transfer Object this service populates and returns.\n\n4.  **In-Depth Breakdown**\n\n    *   **`getDashboardData()`**\n        *   **Method Signature:** `public DashboardDataDTO getDashboardData()`\n        *   **Purpose:** The single public method of this service. It orchestrates the data retrieval for the entire admin dashboard.\n        *   **Parameters:** None.\n        *   **Returns:** A fully populated `DashboardDataDTO` object containing all the data required by the dashboard''s widgets.\n        *   **Side Effects:** Performs multiple read operations on the database via the injected DAOs. It uses a `WIDGET_LIMIT` constant to control the number of items fetched for list-based widgets.'),
('src/main/java/de/technikteam/service/AdminLogService.java', '1.  **File Overview & Purpose**\n\n    This service provides a centralized and safe way to create audit log entries. It acts as an abstraction layer over the `AdminLogDAO`, adding input sanitization and structured logging to ensure that all administrative actions are reliably recorded in both the database and the application logs.\n\n2.  **Architectural Role**\n\n    This is a cross-cutting concern that belongs to the **Service Tier**. It is injected into and used by numerous other services and servlets throughout the administrative side of the application whenever a state-changing action is performed.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `AdminLogDAO`.\n    *   `AdminLogDAO`: The DAO used to persist the log entries.\n    *   `Log4j`: Used to write the audit message to the main application log file in addition to the database.\n\n4.  **In-Depth Breakdown**\n\n    *   **`log(String adminUsername, String actionType, String details)`**\n        *   **Method Signature:** `public void log(String adminUsername, String actionType, String details)`\n        *   **Purpose:** Creates and persists a new audit log entry.\n        *   **Parameters:**\n            *   `adminUsername` (String): The username of the admin performing the action.\n            *   `actionType` (String): A short, standardized key for the action (e.g., \"CREATE_USER\").\n            *   `details` (String): A human-readable description of the action.\n        *   **Returns:** void.\n        *   **Side Effects:**\n            1.  **Sanitization:** It first sanitizes all input strings to remove newlines, preventing log injection or formatting issues.\n            2.  **Application Logging:** It logs the audit event to the application''s main log file at the `INFO` level with a clear `[AUDIT]` prefix.\n            3.  **Database Logging:** It creates an `AdminLog` model object and passes it to the `AdminLogDAO` to be written to the database.\n            4.  **Error Handling:** It wraps the entire process in a `try-catch` block to ensure that a failure in the logging mechanism (e.g., a database connection issue) does not crash the primary operation that was being logged. A critical error is logged if this happens.'),
('src/main/java/de/technikteam/service/AuthorizationService.java', '1.  **File Overview & Purpose**\n\n    This service provides a centralized mechanism for performing permission checks. It encapsulates the logic for determining whether a given user has the authority to perform a specific action, based on the set of permissions associated with their user object.\n\n2.  **Architectural Role**\n\n    This is a cross-cutting concern that belongs to the **Service Tier**. It is used by servlets and action classes in the **Web/Controller Tier** to enforce fine-grained access control before executing sensitive operations.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `User` (Model): The object containing the user''s set of permissions.\n\n4.  **In-Depth Breakdown**\n\n    *   **`checkPermission(User user, String permissionKey)`**\n        *   **Method Signature:** `public boolean checkPermission(User user, String permissionKey)`\n        *   **Purpose:** Determines if a user has a specific permission.\n        *   **Parameters:**\n            *   `user` (User): The user object to check.\n            *   `permissionKey` (String): The string key of the permission to verify (e.g., \"USER_CREATE\").\n        *   **Returns:** `true` if the user has the permission, `false` otherwise.\n        *   **Logic:**\n            1.  It first performs null checks on the user and their permissions set.\n            2.  It implements a \"superuser\" check: if the user has the `ACCESS_ADMIN_PANEL` permission, the method immediately returns `true`, granting access to any action.\n            3.  Otherwise, it checks if the user''s `permissions` set contains the requested `permissionKey`.'),
('src/main/java/de/technikteam/service/ConfigurationService.java', '1.  **File Overview & Purpose**\n\n    This service is responsible for loading and providing access to the application''s configuration settings from the `config.properties` file. As a Guice Singleton, it ensures that the properties file is read only once at application startup, and the settings are then available globally.\n\n2.  **Architectural Role**\n\n    This is a core **Infrastructure/Configuration** component that supports all other tiers. It is injected into any class that needs access to configuration parameters, such as the `DatabaseManager` (for DB credentials) and file handling servlets (for the upload directory path).\n\n3.  **Key Dependencies & Libraries**\n\n    *   `java.util.Properties`: The standard Java class used to load and store the key-value pairs from the `.properties` file.\n\n4.  **In-Depth Breakdown**\n\n    *   **`ConfigurationService()` (Constructor)**\n        *   **Purpose:** Loads the `config.properties` file from the classpath when the application starts.\n        *   **Side Effects:** Reads the properties file and populates the internal `Properties` object. If the file cannot be found or read, it logs a fatal error and throws a `RuntimeException`, preventing the application from starting in a misconfigured state.\n\n    *   **`getProperty(String key)`**\n        *   **Method Signature:** `public String getProperty(String key)`\n        *   **Purpose:** Retrieves the value for a given configuration key.\n        *   **Parameters:**\n            *   `key` (String): The name of the property to retrieve.\n        *   **Returns:** The property value as a `String`, or `null` if the key is not found.\n\n    *   **`getProperty(String key, String defaultValue)`**\n        *   **Method Signature:** `public String getProperty(String key, String defaultValue)`\n        *   **Purpose:** Retrieves the value for a given configuration key, returning a default value if the key is not found.\n        *   **Parameters:**\n            *   `key` (String): The name of the property to retrieve.\n            *   `defaultValue` (String): The value to return if the key is not present in the properties file.\n        *   **Returns:** The property value or the default value.'),
('src/main/java/de/technikteam/service/EventService.java', '1.  **File Overview & Purpose**\n\n    This service class orchestrates the complex business logic for creating and updating events. It manages the transactional saving of an event and all its related data (skill requirements, material reservations, custom fields, attachments) in a single, atomic operation.\n\n2.  **Architectural Role**\n\n    This class is a key component of the **Service Tier**. It is called by the `AdminEventServlet` to handle form submissions for creating or editing events. It coordinates multiple DAOs (`EventDAO`, `AttachmentDAO`, `EventCustomFieldDAO`) within a single database transaction to ensure data integrity.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the various DAOs, `DatabaseManager`, `ConfigurationService`, and `AdminLogService`.\n    *   `EventDAO`: For managing the core event record and its direct relationships.\n    *   `AttachmentDAO`: For saving new file attachment records.\n    *   `EventCustomFieldDAO`: For saving custom field definitions.\n    *   `DatabaseManager`: Used to get a connection and manage the transaction (`setAutoCommit`, `commit`, `rollback`).\n\n4.  **In-Depth Breakdown**\n\n    *   **`createOrUpdateEvent(Event event, boolean isUpdate, User adminUser, HttpServletRequest request)`**\n        *   **Method Signature:** `public int createOrUpdateEvent(...)`\n        *   **Purpose:** The main method of the service. It handles the entire process of saving an event and its associated data within a single database transaction.\n        *   **Parameters:**\n            *   `event` (Event): The core event object to save.\n            *   `isUpdate` (boolean): A flag to determine if this is a new event (`INSERT`) or an existing one (`UPDATE`).\n            *   `adminUser` (User): The administrator performing the action, for logging purposes.\n            *   `request` (HttpServletRequest): The request object, used to retrieve arrays of related data like skill requirements, item reservations, and uploaded files.\n        *   **Returns:** The ID of the created or updated event, or `0` on failure.\n        *   **Side Effects:**\n            1.  **Transaction Management:** It gets a connection from the `DatabaseManager` and sets `autoCommit` to `false`.\n            2.  **Core Event Save:** It calls either `eventDAO.createEvent` or `eventDAO.updateEvent`.\n            3.  **Associated Data Save:** It calls the respective DAOs to save skill requirements, reservations, and custom fields, all using the same `Connection` object.\n            4.  **File Upload:** It handles any uploaded file (`Part`) by saving it to disk and creating a corresponding record in the `attachments` table.\n            5.  **Commit/Rollback:** If all operations succeed, it calls `conn.commit()`. If any exception occurs, it calls `conn.rollback()` to undo all changes, ensuring the database remains in a consistent state.\n\n    *   **`signOffUserFromRunningEvent(...)`**: Contains the logic to sign a user off and send a notification to the event leader.'),
('src/main/java/de/technikteam/service/NotificationService.java', '1.  **File Overview & Purpose**\n\n    This service implements a server-side push notification system using Server-Sent Events (SSE). It manages persistent HTTP connections with clients, allowing the server to push real-time updates to the frontend. It is implemented as a thread-safe Singleton to provide a single, global point for broadcasting messages.\n\n2.  **Architectural Role**\n\n    This is a cross-cutting **Infrastructure/Service Tier** component. It is called by various other services and servlets (e.g., `EventService`, `AdminUserServlet`, `EventChatSocket`) whenever a state change occurs that needs to be reflected in real-time on other users'' browsers. The `NotificationServlet` is the client-facing entry point that registers clients with this service.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Jakarta Servlet API (`jakarta.servlet.AsyncContext`)**: Used to manage the long-lived asynchronous connections required for SSE.\n    *   **Gson**: Used to serialize notification payloads into JSON strings before sending them to the client.\n\n4.  **In-Depth Breakdown**\n\n    *   **Singleton Implementation**: The service uses a private constructor and a static `INSTANCE` field with a `getInstance()` method to ensure only one instance exists for the entire application.\n    *   **`contextsByUser` (Map<Integer, List<AsyncContext>>)**: A thread-safe `ConcurrentHashMap` that is the core of the service. It maps a `userId` to a list of all active SSE connections for that user (a user can have multiple browser tabs open).\n    *   **`register(HttpServletRequest request)`**: Called by the `NotificationServlet` when a client connects. It starts an `AsyncContext`, sets its timeout to infinite, and adds it to the `contextsByUser` map.\n    *   **`broadcastGenericMessage(String message)`**: Sends a simple text message to *all* connected clients.\n    *   **`broadcastUIUpdate(String type, Object payload)`**: Sends a structured update message to *all* connected clients, indicating a specific type of UI change (e.g., \"user_updated\") and providing the relevant data.\n    *   **`sendNotificationToUser(int userId, Map<String, Object> payload)`**: Sends a targeted notification to all active sessions for a *single* user. This is used for user-specific alerts like mentions or invitations.\n    *   **`sendEventInvitation(...)`**: A specialized convenience method that constructs and sends an event invitation notification.\n    *   **`sendMessageToContext(...)`**: A private helper method that handles the actual writing of the SSE-formatted data (`data: ...\\n\\n`) to a client''s response stream. It includes robust error handling to detect and remove disconnected clients, preventing memory leaks.'),
('src/main/java/de/technikteam/service/PasskeyService.java', '1.  **File Overview & Purpose**\n\n    This service class encapsulates the server-side business logic for WebAuthn/Passkey authentication. It handles the start and finish of both the registration and authentication ceremonies. **Note: The current implementation is a placeholder/simulation** and does not perform the actual cryptographic operations required for a secure WebAuthn flow. It demonstrates the API structure and interaction with the DAO layer.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Service Tier**. It is called by the Passkey API servlets (`RegistrationStartServlet`, `AuthenticationFinishServlet`, etc.) to process passkey-related requests. It coordinates between the client-side WebAuthn API and the `PasskeyDAO` for credential storage.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `PasskeyDAO` and `UserDAO`.\n    *   `PasskeyDAO`: Used to store and retrieve passkey credential data.\n    *   `UserDAO`: Used to retrieve user information during the ceremonies.\n\n4.  **In-Depth Breakdown**\n\n    *   **`startRegistration(User user)`**\n        *   **Purpose:** Generates the initial challenge and options required by the browser to start the passkey creation process.\n        *   **Logic (Simulated):** Generates a random challenge string and constructs a JSON object containing the Relying Party (RP) information, user details, and public key parameters. In a real implementation, this would use a library like `webauthn-server-core` to generate a cryptographically secure challenge and store it in the session.\n        *   **Returns:** A JSON string with the `PublicKeyCredentialCreationOptions`.\n\n    *   **`finishRegistration(int userId, String credentialData, String deviceName)`**\n        *   **Purpose:** Receives the response from the browser''s `navigator.credentials.create()` call and saves the new credential.\n        *   **Logic (Simulated):** It does not validate the `credentialData`. Instead, it creates a new `PasskeyCredential` object with simulated data (random user handle, credential ID, and a placeholder public key) and saves it via the `PasskeyDAO`.\n        *   **Returns:** `true` on successful save.\n\n    *   **`startAuthentication(String username)`**\n        *   **Purpose:** Generates the challenge and options for the browser to start the passkey authentication process.\n        *   **Logic (Simulated):** Generates a random challenge. In a real implementation, it would also fetch the `credentialId`s for the given username from the DAO to include in the `allowCredentials` list.\n        *   **Returns:** A JSON string with the `PublicKeyCredentialRequestOptions`.\n\n    *   **`finishAuthentication(String credentialData)`**\n        *   **Purpose:** Receives the response from the browser''s `navigator.credentials.get()` call, verifies it, and logs the user in.\n        *   **Logic (Simulated):** This is the most significant simulation. It **does not perform any cryptographic verification**. It simply fetches a hardcoded user (admin user with ID 1) from the `UserDAO` and returns it, effectively logging them in. In a real implementation, this method would be the most complex, involving fetching the stored public key, verifying the signature against the challenge, and updating the signature counter.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/service/StorageService.java', '1.  **File Overview & Purpose**\n\n    This service class contains the business logic for all inventory-related state changes. It provides transactional methods for processing check-ins/check-outs and for managing the status of defective items, ensuring that all related database updates and logging occur as a single, atomic operation.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Service Tier**. It is called by the `StorageTransactionServlet` and `AdminStorageServlet` to execute inventory operations. It coordinates multiple DAOs (`StorageDAO`, `StorageLogDAO`, `EventDAO`) and the `AdminLogService` within a database transaction.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the DAOs, `DatabaseManager`, and `AdminLogService`.\n    *   `DatabaseManager`: Used to manage database connections and transactions.\n    *   `StorageDAO`: For updating the `storage_items` table.\n    *   `StorageLogDAO`: For creating entries in the `storage_log` table.\n    *   `AdminLogService`: For creating entries in the `admin_logs` table.\n\n4.  **In-Depth Breakdown**\n\n    *   **`processTransaction(int itemId, int quantity, String type, User user, Integer eventId, String notes)`**\n        *   **Method Signature:** `public boolean processTransaction(...)`\n        *   **Purpose:** Handles the check-out and check-in of inventory items within a database transaction.\n        *   **Logic:**\n            1.  Opens a database connection and disables auto-commit.\n            2.  Retrieves the `StorageItem` to perform validation checks (e.g., sufficient stock for checkout).\n            3.  Calls the appropriate method on `StorageDAO` (`performCheckout` or `performCheckin`).\n            4.  If the DAO operation is successful, it calls `StorageLogDAO.logTransaction` to record the event.\n            5.  It then calls `AdminLogService.log` to create an audit trail.\n            6.  If all steps succeed, it calls `conn.commit()`.\n            7.  If any step fails, it calls `conn.rollback()` and logs the error, ensuring the database remains in a consistent state.\n        *   **Returns:** `true` if the entire transaction was successful, `false` otherwise.\n\n    *   **`updateDefectiveItemStatus(int itemId, String status, int quantity, String reason, User adminUser)`**\n        *   **Method Signature:** `public boolean updateDefectiveItemStatus(...)`\n        *   **Purpose:** Manages the process of marking items as defective or unrepairable within a transaction.\n        *   **Logic:** Similar to `processTransaction`, it wraps the database operations in a transaction.\n            *   If `status` is `\"UNREPAIRABLE\"`, it calls `storageDAO.permanentlyReduceQuantities`, which decreases both the total and defective counts.\n            *   If `status` is `\"DEFECT\"`, it calls `storageDAO.updateDefectiveStatus`, which increases the defective count.\n            *   It logs the action to the `admin_logs` table.\n        *   **Returns:** `true` on success, `false` on failure.'),
('src/main/java/de/technikteam/service/SystemInfoService.java', '1.  **File Overview & Purpose**\n\n    This service is responsible for gathering and formatting live system statistics from the host operating system. It uses Java''s Management Extensions (JMX) and, for Linux-specific data like uptime and battery, reads directly from the `/proc` and `/sys` filesystems to provide a snapshot of the server''s health.\n\n2.  **Architectural Role**\n\n    This is a specialized **Service Tier** component. It is called by the `SystemStatsApiServlet` to provide real-time data for the admin system status page. It is designed to be platform-aware, providing graceful fallbacks for metrics that are not available on non-Linux systems.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **JMX (`com.sun.management.OperatingSystemMXBean`)**: The core Java API for accessing operating system-level metrics like CPU load and memory usage.\n    *   `java.nio.file.Files`: Used to read system files for Linux-specific stats.\n\n4.  **In-Depth Breakdown**\n\n    *   **`getSystemStats()`**\n        *   **Method Signature:** `public SystemStatsDTO getSystemStats()`\n        *   **Purpose:** The main public method that collects all system metrics.\n        *   **Logic:**\n            1.  Gets an instance of `OperatingSystemMXBean`.\n            2.  Retrieves CPU load (`getSystemCpuLoad`), total and free physical memory.\n            3.  Retrieves total and usable disk space for the root partition (`/`).\n            4.  Calls the private helper methods `getSystemUptime()` and `getBatteryPercentage()`.\n            5.  Populates and returns a `SystemStatsDTO` with the collected data, converting byte values to Gigabytes where appropriate.\n        *   **Returns:** A `SystemStatsDTO` object.\n\n    *   **`getSystemUptime()`**: A private helper that reads the uptime in seconds from `/proc/uptime` on Linux and formats it into a human-readable \"days, hours, minutes\" string. It returns \"Nicht verfügbar\" on non-Linux systems or if the file cannot be read.\n\n    *   **`getBatteryPercentage()`**: A private helper that reads the battery capacity from `/sys/class/power_supply/BAT0/capacity` on Linux. It returns `-1` if the file doesn''t exist (e.g., on a desktop or non-Linux system), which signals the UI to hide the battery widget.'),
('src/main/java/de/technikteam/service/TodoService.java', '1.  **File Overview & Purpose**\n\n    This service class encapsulates the business logic for the administrative To-Do list feature. It provides transactional methods for creating, updating, reordering, and deleting To-Do categories and tasks, ensuring that both the database operations and the corresponding audit logs are handled correctly.\n\n2.  **Architectural Role**\n\n    This class is part of the **Service Tier**. It is used exclusively by the `AdminTodoApiServlet` to perform all state-changing operations on the To-Do list. It coordinates the `TodoDAO` and `AdminLogService`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`, `TodoDAO`, and `AdminLogService`.\n    *   `DatabaseManager`: Used for managing database transactions.\n    *   `TodoDAO`: The DAO for all To-Do list database operations.\n    *   `AdminLogService`: Used to create an audit trail for every action performed.\n\n4.  **In-Depth Breakdown**\n\n    *   **`getAllTodos()`**: A simple pass-through method to retrieve all categories and their tasks from the DAO.\n    *   **`createCategory(String name, User admin)`**: Creates a new To-Do category and logs the action.\n    *   **`createTask(int categoryId, String content, User admin)`**: Creates a new task within a category and logs the action.\n    *   **`updateTask(int taskId, String content, Boolean isCompleted, User admin)`**: A transactional method to update a task''s content and/or completion status. It logs the specific action performed.\n    *   **`deleteTask(int taskId, User admin)`**: Deletes a task and logs the action.\n    *   **`deleteCategory(int categoryId, User admin)`**: Deletes a category (which cascades to its tasks) and logs the action.\n    *   **`reorder(Map<String, List<Integer>> reorderData, User admin)`**\n        *   **Method Signature:** `public boolean reorder(Map<String, List<Integer>> reorderData, User admin)`\n        *   **Purpose:** A transactional method to handle complex reordering operations from the drag-and-drop UI.\n        *   **Logic:** It opens a transaction and calls the DAO''s batch update methods to persist the new order of categories and the new order/category assignment of tasks. It commits the transaction if successful and logs a single \"reorder\" event.\n        *   **Returns:** `true` on success, `false` on failure.'),
('src/main/java/de/technikteam/service/UserService.java', '1.  **File Overview & Purpose**\n\n    This service class contains the business logic for user management operations that require database transactions. It orchestrates the creation and updating of users and their associated permissions as a single, atomic operation to ensure data integrity.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Service Tier**. It is used by the `Action` classes (`CreateUserAction`, `UpdateUserAction`) which are invoked by the `FrontControllerServlet`. It provides a higher-level abstraction over the `UserDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`, `UserDAO`, and `AdminLogService`.\n    *   `DatabaseManager`: Used to obtain a connection and manage transactions.\n    *   `UserDAO`: The DAO for performing the actual user and permission database operations.\n    *   `AdminLogService`: Used to create an audit log entry for the actions.\n\n4.  **In-Depth Breakdown**\n\n    *   **`createUserWithPermissions(User user, String password, String[] permissionIds, String adminUsername)`**\n        *   **Method Signature:** `public int createUserWithPermissions(...)`\n        *   **Purpose:** Creates a new user and assigns their initial permissions within a single database transaction.\n        *   **Logic:**\n            1.  Begins a transaction by disabling auto-commit.\n            2.  Calls `userDAO.createUser()` to insert the new user record.\n            3.  If the user is created successfully (returns a new ID), it calls `userDAO.updateUserPermissions()` to set their permissions.\n            4.  If both operations succeed, it commits the transaction.\n            5.  It then logs the successful creation event to the admin log.\n            6.  If any step fails, it rolls back the transaction.\n        *   **Returns:** The ID of the newly created user, or `0` on failure.\n\n    *   **`updateUserWithPermissions(User user, String[] permissionIds)`**\n        *   **Method Signature:** `public boolean updateUserWithPermissions(...)`\n        *   **Purpose:** Updates a user''s profile information and their set of permissions within a single database transaction.\n        *   **Logic:**\n            1.  Begins a transaction.\n            2.  Calls `userDAO.updateUser()` to save changes to the user''s profile.\n            3.  Calls `userDAO.updateUserPermissions()` to overwrite the user''s existing permissions with the new set.\n            4.  Commits the transaction if both operations succeed, otherwise rolls back.\n        *   **Returns:** `true` if the transaction was successful, `false` otherwise.'),
('src/main/java/de/technikteam/servlet/admin/action/Action.java', '1.  **File Overview & Purpose**\n\n    This is the interface that defines the contract for the Command pattern used in the `FrontControllerServlet`. Each class that implements this interface represents a single, self-contained, executable administrative action. This pattern promotes a clean separation of concerns, making the `FrontControllerServlet` a simple dispatcher and encapsulating all business logic for an action in its own class.\n\n2.  **Architectural Role**\n\n    This interface is a core part of the **Web/Controller Tier**''s design. It defines the structure for the command objects that are managed by Guice and executed by the Front Controller.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `ApiResponse` (Model): The standardized response object that all actions must return.\n    *   **Jakarta Servlet API**: For the `HttpServletRequest` and `HttpServletResponse` parameters.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Method Signature:** `ApiResponse execute(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException`\n        *   **Purpose:** This is the single method that all action classes must implement. It contains the complete logic for processing a specific request, including parameter validation, authorization checks, calls to service or DAO layers, and constructing the final `ApiResponse`.\n        *   **Parameters:**\n            *   `request`: The HTTP request object, providing access to parameters, the session, etc.\n            *   `response`: The HTTP response object, which can be used to send errors directly if needed.\n        *   **Returns:** An `ApiResponse` object summarizing the outcome of the action.'),
('src/main/java/de/technikteam/servlet/admin/action/ApproveChangeAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class encapsulates the business logic for approving a user''s profile change request. It retrieves the request, applies the changes to the target user''s profile, updates the request status, and triggers a real-time notification to force the user to log out for security reasons.\n\n2.  **Architectural Role**\n\n    This class is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It coordinates between the `ProfileChangeRequestDAO` and `UserDAO` to perform a multi-step, state-changing operation.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the necessary DAOs and services.\n    *   `ProfileChangeRequestDAO`: To fetch the request and update its status.\n    *   `UserDAO`: To fetch the user to be updated and save the changes.\n    *   `AdminLogService`: To create an audit trail for the approval.\n    *   `NotificationService`: To send a real-time logout notification to the affected user.\n    *   `SessionManager`: To invalidate all of the user''s active sessions.\n    *   **Gson**: To deserialize the `requestedChanges` JSON string into a `Map`.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** Performs the approval logic.\n        *   **Logic:**\n            1.  **Authorization:** Checks if the admin has `USER_UPDATE` permission.\n            2.  **Data Retrieval:** Fetches the `ProfileChangeRequest` and the target `User` object.\n            3.  **Apply Changes:** It deserializes the JSON string of requested changes into a `Map`. It then iterates through this map and applies the new values to the `userToUpdate` object.\n            4.  **Database Updates:** It calls `userDAO.updateUser()` to save the changes and `requestDAO.updateRequestStatus()` to mark the request as \"APPROVED\".\n            5.  **Logging & Notification:** If the updates are successful, it logs the action, sends a real-time notification to the user, and calls `SessionManager.invalidateSessionsForUser()` to terminate all of the user''s sessions, forcing them to log back in and get a fresh user object.\n            6.  **Response:** Returns an `ApiResponse` indicating success or failure.'),
('src/main/java/de/technikteam/servlet/admin/action/CreateUserAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class encapsulates the logic for creating a new user. It handles parameter validation, checks the password against the security policy, and calls the `UserService` to perform the transactional creation of the user and their permissions.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It acts as a controller for the user creation process, delegating the core transactional logic to the `UserService`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `UserService` and `RoleDAO`.\n    *   `UserService`: The service that handles the transactional creation of a user and their permissions.\n    *   `RoleDAO`: Used to enrich the response object with the role name after creation.\n    *   `PasswordPolicyValidator`: To ensure the new user''s password meets security standards.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** The main execution method for the create user action.\n        *   **Logic:**\n            1.  **Authorization:** Checks if the admin has `USER_CREATE` permission.\n            2.  **Parameter Retrieval:** Gets all user data (username, password, role, etc.) and permission IDs from the request.\n            3.  **Password Validation:** Calls `PasswordPolicyValidator.validate()` on the new password. If it fails, it immediately returns an error `ApiResponse`.\n            4.  **Object Creation:** Creates a new `User` model object and populates it with the form data.\n            5.  **Service Call:** Calls `userService.createUserWithPermissions()`, passing in the new user object, the password, and the permission IDs. This service method handles the database transaction.\n            6.  **Response:** If the service call is successful (returns a new user ID), it enriches the `User` object with its new role name and returns it in a successful `ApiResponse`. Otherwise, it returns an error response.'),
('src/main/java/de/technikteam/servlet/admin/action/DeleteFeedbackAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class encapsulates the logic for deleting a feedback submission. It handles the database operation and logs the action.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It is triggered by an AJAX call from the admin feedback board UI.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `FeedbackSubmissionDAO` and `AdminLogService`.\n    *   `FeedbackSubmissionDAO`: The DAO used to perform the deletion.\n    *   `AdminLogService`: To create an audit trail of the deletion.\n    *   `NotificationService`: To broadcast a UI update to other connected admins.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** Deletes a feedback submission record.\n        *   **Logic:**\n            1.  **Authorization:** Ensures the user has admin access.\n            2.  **Parameter Parsing:** Retrieves the `submissionId` from the request.\n            3.  **Database Deletion:** Calls `submissionDAO.deleteSubmission()`.\n            4.  **Logging & Notification:** If the deletion is successful, it logs the action and broadcasts a `feedback_deleted` UI update via the `NotificationService` so that the item disappears from the board for all other watching admins.\n            5.  **Response:** Returns an `ApiResponse` indicating success or failure.'),
('src/main/java/de/technikteam/servlet/admin/action/DeleteUserAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class encapsulates the logic for deleting a user account. It includes several important security checks to prevent administrators from deleting themselves or other higher-privileged administrators.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It handles the user deletion process, which is a critical and destructive action.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `UserDAO` and `AdminLogService`.\n    *   `UserDAO`: The DAO used to delete the user record.\n    *   `AdminLogService`: To create an audit trail of the deletion.\n    *   `NotificationService`: To broadcast a UI update to other connected admins.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** Performs a secure deletion of a user account.\n        *   **Logic:**\n            1.  **Authorization:** Checks if the performing admin has the `USER_DELETE` permission.\n            2.  **Self-Deletion Check:** It verifies that the admin is not trying to delete their own account (`loggedInAdmin.getId() == userIdToDelete`).\n            3.  **Privilege Escalation Check:** It fetches the user to be deleted and checks if they have the master `ACCESS_ADMIN_PANEL` permission. If so, it only allows the deletion if the *performing* admin also has this master permission. This prevents a lower-level admin from deleting a superuser.\n            4.  **Database Deletion:** If all checks pass, it calls `userDAO.deleteUser()`.\n            5.  **Logging & Notification:** If the deletion is successful, it logs the action and broadcasts a `user_deleted` UI update so the user is removed from the user list for all watching admins.\n            6.  **Response:** Returns an `ApiResponse` indicating success or failure.'),
('src/main/java/de/technikteam/servlet/admin/action/DenyChangeAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class encapsulates the logic for denying a user''s profile change request. It updates the request''s status in the database to \"DENIED\" and creates an audit log entry.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It is called via an AJAX request from the admin requests page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `ProfileChangeRequestDAO` and `AdminLogService`.\n    *   `ProfileChangeRequestDAO`: The DAO used to fetch the request and update its status.\n    *   `AdminLogService`: To create an audit trail of the denial.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** Processes the denial of a change request.\n        *   **Logic:**\n            1.  **Authorization:** Checks if the admin has `USER_UPDATE` permission.\n            2.  **Data Validation:** It retrieves the request by its ID and ensures it is still in a \"PENDING\" state to prevent race conditions.\n            3.  **Database Update:** It calls `requestDAO.updateRequestStatus()`, passing the new status \"DENIED\" and the admin''s ID.\n            4.  **Logging:** If the update is successful, it logs the denial action.\n            5.  **Response:** Returns an `ApiResponse` indicating success or failure.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/servlet/admin/action/GetFeedbackDetailsAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class is a simple data retrieval command. Its sole purpose is to fetch the full details of a single feedback submission from the database and return it as the data payload in an `ApiResponse`.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It serves as an API endpoint for the client-side JavaScript (`admin_feedback.js`) to populate the feedback details modal.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `FeedbackSubmissionDAO`.\n    *   `FeedbackSubmissionDAO`: The DAO used to retrieve the feedback entry by its ID.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** Fetches and returns the details of one feedback submission.\n        *   **Logic:**\n            1.  It parses the `submissionId` from the request parameters.\n            2.  It calls `submissionDAO.getSubmissionById()`.\n            3.  If a submission is found, it returns an `ApiResponse.success` with the `FeedbackSubmission` object as the data payload.\n            4.  If no submission is found, it returns an `ApiResponse.error`.'),
('src/main/java/de/technikteam/servlet/admin/action/ResetPasswordAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class handles the administrative function of resetting a user''s password. It generates a new, secure random password, updates the user''s password hash in the database, and returns the new password to the admin so it can be communicated to the user.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It is a critical security-related action.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `UserDAO` and `AdminLogService`.\n    *   `UserDAO`: Used to save the new password hash.\n    *   `AdminLogService`: To create an audit trail of the password reset.\n    *   `java.security.SecureRandom`: Used to generate a cryptographically strong random password.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** Resets a user''s password.\n        *   **Logic:**\n            1.  **Authorization:** Checks if the admin has `USER_PASSWORD_RESET` permission.\n            2.  It fetches the target `User` object to ensure it exists.\n            3.  It calls the private `generateRandomPassword()` method to create a new, compliant password.\n            4.  It calls `userDAO.changePassword()` to hash and save the new password.\n            5.  If successful, it logs the action and returns an `ApiResponse.success`. The new password is included in the response''s data payload so the client-side script can display it to the admin.\n\n    *   **`generateRandomPassword(int length)`**: A private helper method that generates a secure, random password of a given length, containing a mix of character types.'),
('src/main/java/de/technikteam/servlet/admin/action/UnlockUserAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class provides the functionality to manually unlock a user account that has been locked due to too many failed login attempts. It interacts with the static `LoginAttemptManager` to clear the lockout status for a given username.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It provides an administrative override for the brute-force protection mechanism.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `AdminLogService`.\n    *   `LoginServlet.LoginAttemptManager`: The static inner class that manages lockout state.\n    *   `AdminLogService`: To create an audit trail of the unlock action.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** Unlocks a user account.\n        *   **Logic:**\n            1.  **Authorization:** Ensures the performing user is a full admin (`hasAdminAccess()`).\n            2.  It retrieves the `usernameToUnlock` from the request.\n            3.  It calls the static method `LoginServlet.LoginAttemptManager.clearLoginAttempts(usernameToUnlock)`, which removes all lockout and failed attempt records for that user from the in-memory maps.\n            4.  It logs the action and returns an `ApiResponse.success`.'),
('src/main/java/de/technikteam/servlet/admin/action/UpdateFeedbackOrderAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class handles the complex logic of updating the feedback board after a drag-and-drop operation. It receives the ID of the moved item, its new status (based on the column it was dropped into), and the new order of all items in that destination column. It performs these updates within a single database transaction.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It is the server-side endpoint for the drag-and-drop functionality on the feedback Kanban board.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `FeedbackSubmissionDAO`, `AdminLogService`, and `DatabaseManager`.\n    *   `DatabaseManager`: To manage the database transaction.\n    *   `FeedbackSubmissionDAO`: Provides the transactional methods `updateStatus` and `updateOrderForStatus`.\n    *   `AdminLogService`: For auditing the reorder action.\n    *   **Gson**: For deserializing the JSON payload from the client.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** Persists the new state of the Kanban board after a drag-and-drop.\n        *   **Logic:**\n            1.  **Transaction Management:** It opens a database connection and disables auto-commit.\n            2.  **Payload Parsing:** It retrieves the JSON payload containing the `submissionId`, `newStatus`, and the array of `orderedIds` for the destination column.\n            3.  **Database Updates:** It performs two separate updates within the transaction:\n                *   Calls `submissionDAO.updateStatus()` to change the status of the card that was moved.\n                *   Calls `submissionDAO.updateOrderForStatus()` with the list of all IDs in the destination column to perform a batch update of their `display_order`.\n            4.  **Commit/Rollback:** It commits the transaction if both operations succeed, or rolls back if an error occurs.\n            5.  **Logging & Response:** It logs the action and returns an `ApiResponse`.'),
('src/main/java/de/technikteam/servlet/admin/action/UpdateFeedbackStatusAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class handles updates to a feedback submission made via the details modal (not via drag-and-drop). It allows an admin to change a submission''s status and its optional display title.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It is the endpoint for the save button in the feedback details modal.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `FeedbackSubmissionDAO` and `AdminLogService`.\n    *   `FeedbackSubmissionDAO`: The DAO used to update the record.\n    *   `AdminLogService`: For auditing the status change.\n    *   `NotificationService`: To broadcast a UI update to other connected admins.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** Updates a feedback submission''s details.\n        *   **Logic:**\n            1.  **Authorization:** Ensures the user is an admin.\n            2.  **Parameter Parsing:** Retrieves `submissionId`, `newStatus`, and `displayTitle` from the request.\n            3.  **Database Update:** Calls `submissionDAO.updateStatusAndTitle()` to persist the changes.\n            4.  **Logging & Notification:** If successful, it logs the action and broadcasts a `feedback_status_updated` UI update to other clients, so they see the change in real-time.\n            5.  **Response:** Returns a standard `ApiResponse`.'),
('src/main/java/de/technikteam/servlet/admin/action/UpdateUserAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class encapsulates the logic for updating an existing user''s profile and permissions. It constructs a `User` object with the new data and calls the `UserService` to perform the transactional update.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It is the endpoint for the \"Save\" button in the user edit modal.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects `UserDAO`, `RoleDAO`, `UserService`, and `AdminLogService`.\n    *   `UserService`: The service that handles the transactional update of a user and their permissions.\n    *   `UserDAO`: To fetch the original user data for logging and comparison.\n    *   `AdminLogService`: To create a detailed audit log of what was changed.\n    *   `NotificationService`: To broadcast the user update to other clients.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** The main execution method for the update user action.\n        *   **Logic:**\n            1.  **Authorization:** Checks if the admin has `USER_UPDATE` permission.\n            2.  **Fetch Original User:** Retrieves the original `User` object from the database to compare against the new values.\n            3.  **Build Updated User:** Creates a new `User` object and populates it with the data from the form submission.\n            4.  **Change Detection:** It compares each field of the new user object with the original one and builds a detailed `changes` string for the audit log (e.g., \"Benutzername von ''old'' zu ''new'', Rolle-ID von ''1'' zu ''3'', ...\").\n            5.  **Service Call:** Calls `userService.updateUserWithPermissions()` to perform the transactional database update.\n            6.  **Session Update (Self-Edit):** If an admin updates their own profile, it refreshes the `User` object in their session to immediately reflect the changes.\n            7.  **Logging & Notification:** It logs the action with the detailed `changes` string and broadcasts a `user_updated` UI update.\n            8.  **Response:** Returns an `ApiResponse.success` with the refreshed user object as the data payload.'),
('src/main/java/de/technikteam/servlet/admin/api/AdminTodoApiServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet provides a complete JSON API for the administrative To-Do list feature. It handles all CRUD and reordering operations for To-Do categories and tasks, allowing the frontend (`admin_todo.js`) to manage the entire feature asynchronously without full page reloads.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier** (specifically, the API sub-layer). It receives AJAX requests, validates them, calls the `TodoService` to perform the business logic and database operations, and returns a standardized `ApiResponse` in JSON format.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `TodoService`.\n    *   `TodoService`: The service layer component that contains the transactional logic for all To-Do list operations.\n    *   **Gson**: Used for both deserializing incoming JSON payloads (for the `doPut` method) and serializing the `ApiResponse` for the response.\n    *   `CSRFUtil`: For security validation on all state-changing requests (POST, PUT, DELETE).\n\n4.  **In-Depth Breakdown**\n\n    This servlet implements `doGet`, `doPost`, `doPut`, and `doDelete` to correspond to RESTful principles.\n\n    *   **`doGet(...)`**: Fetches and returns the entire list of categories with their nested tasks as a JSON array.\n    *   **`doPost(...)`**: Handles the creation of new items. It uses an `action` parameter to distinguish between creating a category (`\"createCategory\"`) and creating a task (`\"createTask\"`).\n    *   **`doPut(...)`**: Handles updates. It reads a JSON payload from the request body and uses an `action` parameter within that payload to differentiate between updating a task''s content/status (`\"updateTask\"`) and reordering items (`\"reorder\"`).\n    *   **`doDelete(...)`**: Handles deletion. It checks for either a `taskId` or `categoryId` parameter in the URL to determine what to delete.\n    *   **`sendJsonResponse(...)`**: A private helper method to standardize the process of setting the HTTP status code, content type, and writing the JSON response.'),
('src/main/java/de/technikteam/servlet/admin/api/CrewFinderApiServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves a specialized JSON API endpoint for the \"Crew Finder\" feature. Given an event ID, it identifies all users who are both qualified (meet all skill requirements) and available (not assigned to a conflicting event) for that specific event.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier** (API sub-layer). It is called via an AJAX request from the event creation/editing modal in `admin_events_list.js`. It interacts directly with the `EventDAO` to execute the complex query required.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `EventDAO`.\n    *   `EventDAO`: Contains the `getQualifiedAndAvailableUsersForEvent()` method, which performs the core database query.\n    *   **Gson**: Used to serialize the resulting list of `User` objects into a JSON array.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles the GET request to find available crew members.\n        *   **Logic:**\n            1.  **Parameter Validation:** It requires an `eventId` parameter.\n            2.  **Authorization:** It performs a crucial authorization check to ensure the requesting user is either an admin or the leader of the specified event.\n            3.  **Data Fetching:** It calls `eventDAO.getQualifiedAndAvailableUsersForEvent(eventId)`. This single DAO call encapsulates the complex SQL logic involving subqueries and joins to determine user qualification and availability.\n            4.  **JSON Response:** It serializes the list of qualified `User` objects into JSON and writes it to the response.'),
('src/main/java/de/technikteam/servlet/api/AdminDashboardApiServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet acts as the JSON API endpoint for the dynamic widgets on the administrative dashboard. It is designed to be called periodically via AJAX from the client-side to refresh the dashboard with the latest data.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier** (API sub-layer). It is the data source for the `admin_dashboard.js` script. It delegates the task of data aggregation to the `AdminDashboardService`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `AdminDashboardService`.\n    *   `AdminDashboardService`: The service that contains the business logic for gathering all the necessary dashboard data.\n    *   **Gson**: Used to serialize the `DashboardDataDTO` into a JSON object.\n    *   `LocalDateTimeAdapter`: A custom Gson adapter required to correctly serialize `LocalDateTime` objects within the DTO.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for dashboard data.\n        *   **Logic:**\n            1.  It calls `dashboardService.getDashboardData()` to get the fully populated `DashboardDataDTO`.\n            2.  It serializes this DTO object into a JSON string.\n            3.  It sets the response content type to `application/json` and writes the JSON string to the response.'),
('src/main/java/de/technikteam/servlet/api/CalendarApiServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves as a JSON API endpoint to provide event and meeting data for a full-featured calendar component on the client side. It fetches all upcoming events and meetings from the respective DAOs and formats them into a structure that is compatible with libraries like FullCalendar.js.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It acts as a dedicated data source for the client-side calendar view, responding to AJAX requests from the `calendar.js` script. It directly interacts with the `EventDAO` and `MeetingDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `EventDAO` and `MeetingDAO`.\n    *   `EventDAO`, `MeetingDAO`: DAOs used to fetch all active and upcoming calendar entries.\n    *   **Gson**: Used to serialize the list of calendar entries into a JSON array.\n    *   `LocalDateTimeAdapter`: A custom Gson adapter to ensure `LocalDateTime` objects are serialized into the correct ISO 8601 format that FullCalendar can parse.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests to fetch calendar data.\n        *   **Logic:**\n            1.  It calls `eventDAO.getAllActiveAndUpcomingEvents()` and `meetingDAO.getAllUpcomingMeetings()` to get the raw data.\n            2.  It iterates through both lists, creating a `Map<String, String>` for each entry.\n            3.  Each map is populated with keys that FullCalendar expects: `title`, `start`, `end`, and `url`.\n            4.  It also adds custom properties like `backgroundColor` and `borderColor` to visually distinguish between events and meetings in the calendar.\n            5.  Finally, it serializes the combined list of maps into a JSON string and writes it to the response.\n        *   **Side Effects:** Performs database reads.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/servlet/api/EventChatApiServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet provides a JSON API endpoint for fetching the chat history of a specific event. It is called by the client-side `eventDetails.js` script when a user opens an event details page to populate the chat box with previous messages.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier** (API sub-layer). It acts as the data source for the initial state of the event chat. It interacts directly with the `EventChatDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `EventChatDAO`.\n    *   `EventChatDAO`: The DAO used to retrieve the list of messages for an event.\n    *   **Gson**: Used to serialize the list of `EventChatMessage` objects into a JSON array.\n    *   `LocalDateTimeAdapter`: A custom adapter required for correct JSON serialization of `LocalDateTime` objects.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for an event''s chat history.\n        *   **Logic:**\n            1.  **Parameter Validation:** It expects an `eventId` parameter and returns a 400 Bad Request error if it is missing or invalid.\n            2.  **Data Fetching:** It calls `chatDAO.getMessagesForEvent(eventId)` to get the complete, ordered chat history.\n            3.  **JSON Response:** It serializes the returned list into a JSON string and writes it to the response.'),
('src/main/java/de/technikteam/servlet/api/EventCustomFieldsApiServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet provides a public JSON API endpoint to fetch the custom sign-up fields for a specific event. It is called by the client-side `events.js` script when a user clicks the \"Anmelden\" (Sign Up) button to dynamically build the sign-up modal form.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier** (API sub-layer). It is a public-facing API, meaning it can be accessed without full admin rights, but the user must still be authenticated (as enforced by the `AuthenticationFilter`).\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `EventCustomFieldDAO`.\n    *   `EventCustomFieldDAO`: The DAO used to retrieve the custom field definitions for an event.\n    *   **Gson**: Used to serialize the list of `EventCustomField` objects into a JSON array.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for an event''s custom sign-up fields.\n        *   **Logic:**\n            1.  **Parameter Validation:** It requires an `eventId` parameter.\n            2.  **Data Fetching:** It calls `customFieldDAO.getCustomFieldsForEvent(eventId)` to get the list of field definitions.\n            3.  **JSON Response:** It serializes the returned list into a JSON string and writes it to the response.'),
('src/main/java/de/technikteam/servlet/api/MarkdownApiServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is a dedicated endpoint for saving content from the real-time Markdown editor. It receives the updated content and file ID, validates the user''s permission, and persists the changes to the physical file on the server.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier** (API sub-layer). It handles state-changing POST requests from the `admin_editor.js` script. It interacts with the `FileDAO` to write to the file system and update the database record.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `FileDAO` and `AdminLogService`.\n    *   `FileDAO`: Used to get the file''s path, update its physical content, and \"touch\" its database record to update the timestamp.\n    *   `AdminLogService`: To create an audit trail of the file modification.\n    *   `CSRFUtil`: For security validation.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doPost(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles the POST request to save Markdown content.\n        *   **Logic:**\n            1.  **Security:** It performs authentication, authorization (`FILE_UPDATE` permission), and CSRF token validation.\n            2.  **Parameter Validation:** It retrieves the `fileId` and `content` from the request.\n            3.  **Data Retrieval:** It fetches the `File` object from the database using the `fileId` to get its physical `filepath`.\n            4.  **Persistence:**\n                *   It calls `fileDAO.updateFileContent()` to overwrite the file on disk with the new content.\n                *   It calls `fileDAO.touchFileRecord()` to update the `uploaded_at` timestamp in the database, indicating a modification.\n            5.  **Logging & Feedback:** It logs the update action to the admin log and sets a success message in the session.\n            6.  **Redirect:** It redirects the user back to the editor page for the same file.'),
('src/main/java/de/technikteam/servlet/api/StorageHistoryApiServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet provides a JSON API endpoint for fetching the transaction history of a specific storage item. It is used by the `storage_item_details.jsp` page to dynamically load and display the log of check-ins and check-outs for an item.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier** (API sub-layer). It responds to AJAX requests from the client-side. It interacts directly with the `StorageLogDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `StorageLogDAO`.\n    *   `StorageLogDAO`: The DAO used to retrieve the transaction history for an item.\n    *   **Gson**: Used to serialize the list of `StorageLogEntry` objects into a JSON array.\n    *   `LocalDateTimeAdapter`: A custom adapter required for correct JSON serialization of `LocalDateTime` objects.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for an item''s history.\n        *   **Logic:**\n            1.  **Parameter Validation:** It expects an `itemId` parameter and returns a 400 Bad Request error if it''s missing or invalid.\n            2.  **Data Fetching:** It calls `logDAO.getHistoryForItem(itemId)` to get the complete transaction log for the specified item.\n            3.  **JSON Response:** It serializes the returned list into a JSON string and writes it to the response.'),
('src/main/java/de/technikteam/servlet/api/SystemStatsApiServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet provides a JSON API endpoint that exposes live system statistics of the server. It is designed to be polled by the administrative system status page to create a real-time monitoring dashboard.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier** (API sub-layer). It is the data source for the `admin_system.js` script. It delegates the task of collecting system metrics to the `SystemInfoService`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `SystemInfoService`.\n    *   `SystemInfoService`: The service that contains the logic for gathering OS-level statistics.\n    *   **Gson**: Used to serialize the `SystemStatsDTO` into a JSON object.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for system statistics.\n        *   **Logic:**\n            1.  It calls `systemInfoService.getSystemStats()` to get a fresh snapshot of the server''s CPU, RAM, disk, and other metrics.\n            2.  It serializes the resulting `SystemStatsDTO` object into a JSON string.\n            3.  It sets the response content type to `application/json` and writes the JSON string to the response.'),
('src/main/java/de/technikteam/servlet/api/UserPreferencesApiServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is a dedicated API endpoint for saving user-specific preferences. Currently, its only function is to handle the user''s choice of theme (light/dark) and persist it to the database.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier** (API sub-layer). It handles asynchronous POST requests from the `main.js` script, which are triggered when the user clicks the theme toggle switch. It interacts directly with the `UserDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `UserDAO`.\n    *   `UserDAO`: Used to update the theme preference in the `users` table.\n    *   `CSRFUtil`: For security validation.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doPost(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles the POST request to update the user''s theme.\n        *   **Logic:**\n            1.  **Security & Authentication:** It ensures a user is logged in and validates the CSRF token.\n            2.  **Parameter Validation:** It retrieves the `theme` parameter and validates it against a `Set` of allowed values (`\"light\"`, `\"dark\"`) to prevent arbitrary data being saved.\n            3.  **Database Update:** It calls `userDAO.updateUserTheme()` to persist the new theme preference.\n            4.  **Session Update:** If the database update is successful, it also updates the `theme` property of the `User` object in the current session. This ensures that subsequent page loads will render with the correct theme without needing a new database query.\n            5.  **Response:** It returns an HTTP 200 OK status on success or an appropriate error code on failure.'),
('src/main/java/de/technikteam/servlet/api/passkey/AuthenticationFinishServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is the server-side endpoint for completing a WebAuthn/Passkey authentication ceremony. It receives the credential assertion from the browser, validates it, and if successful, establishes a new user session.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier** (API sub-layer). It works in tandem with `AuthenticationStartServlet` and the `passkey_auth.js` script to handle passwordless logins. It delegates the complex validation logic to the `PasskeyService`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `PasskeyService`.\n    *   `PasskeyService`: The service that performs the (simulated) cryptographic verification of the passkey assertion.\n    *   **Gson**: Used to serialize the `ApiResponse`.\n    *   `CSRFUtil`, `NavigationRegistry`: For setting up the user session upon successful login.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doPost(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles the POST request containing the WebAuthn credential from the client.\n        *   **Logic:**\n            1.  It reads the JSON payload from the request body.\n            2.  It calls `passkeyService.finishAuthentication()` with the payload.\n            3.  **Success Path:** If the service returns a `User` object, the authentication was successful.\n                *   It establishes a new, clean session for the user.\n                *   It stores the `User` object, a new CSRF token, and the user''s navigation items in the session.\n                *   It returns an `ApiResponse.success` with the user object as the data payload.\n            4.  **Failure Path:** If the service returns `null`, the authentication failed. It returns an `ApiResponse.error` with an HTTP 401 Unauthorized status.'),
('src/main/java/de/technikteam/servlet/api/passkey/AuthenticationStartServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is the server-side endpoint for initiating a WebAuthn/Passkey authentication ceremony. It generates a cryptographic challenge and the necessary options for the browser''s `navigator.credentials.get()` API call.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier** (API sub-layer). It is the first step in the passkey login flow, called via AJAX from `passkey_auth.js` when the user clicks the \"Login with Passkey\" button. It delegates the logic to the `PasskeyService`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `PasskeyService`.\n    *   `PasskeyService`: The service responsible for generating the challenge and options.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doPost(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles the POST request to start the authentication process.\n        *   **Logic:**\n            1.  It retrieves the `username` from the request.\n            2.  It calls `passkeyService.startAuthentication(username)`. The service generates a challenge (and in a real implementation, would store it in the session) and constructs the `PublicKeyCredentialRequestOptions` JSON.\n            3.  It sets the response content type to `application/json` and writes the JSON options string back to the client.'),
('src/main/java/de/technikteam/servlet/api/passkey/RegistrationFinishServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is the server-side endpoint for completing a WebAuthn/Passkey registration ceremony. It receives the new public key credential from the browser, validates it, and saves it to the database, associating it with the logged-in user.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier** (API sub-layer). It is called via AJAX from `passkey_auth.js` after the user has successfully created a new passkey on their device. It delegates the validation and persistence logic to the `PasskeyService`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `PasskeyService`.\n    *   `PasskeyService`: The service that performs the (simulated) validation and saves the new credential via the `PasskeyDAO`.\n    *   **Gson**: Used to serialize the `ApiResponse`.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doPost(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles the POST request containing the new credential data.\n        *   **Logic:**\n            1.  **Authentication:** It ensures that a user is currently logged into a session before allowing them to register a new device.\n            2.  It retrieves the user-provided `deviceName` from the URL parameters and the credential data (JSON) from the request body.\n            3.  It calls `passkeyService.finishRegistration()` with the user''s ID, the credential data, and the device name.\n            4.  Based on the boolean result from the service, it returns either an `ApiResponse.success` or an `ApiResponse.error` to the client.'),
('src/main/java/de/technikteam/servlet/api/passkey/RegistrationStartServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is the server-side endpoint for initiating a WebAuthn/Passkey registration ceremony. For an already authenticated user, it generates a cryptographic challenge and the necessary options for the browser''s `navigator.credentials.create()` API call.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier** (API sub-layer). It is the first step in the \"add a new device\" flow, called via AJAX from `passkey_auth.js` when a user clicks the \"Register New Device\" button on their profile page. It delegates the logic to the `PasskeyService`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `PasskeyService`.\n    *   `PasskeyService`: The service responsible for generating the challenge and options for registration.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles the GET request to start the registration process.\n        *   **Logic:**\n            1.  **Authentication:** It retrieves the `User` object from the session to ensure only a logged-in user can register a new device.\n            2.  It calls `passkeyService.startRegistration(user)`. The service generates a challenge (which, in a real implementation, would be stored in the session for later verification) and constructs the `PublicKeyCredentialCreationOptions` JSON.\n            3.  It sets the response content type to `application/json` and writes the JSON options string back to the client.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/servlet/http/SessionManager.java', '1.  **File Overview & Purpose**\n\n    This is a utility class that provides a centralized, static registry of all active `HttpSession` objects in the application. Its primary function is to allow services to find and invalidate all sessions belonging to a specific user, which is a crucial security feature after sensitive operations like a profile change approval.\n\n2.  **Architectural Role**\n\n    This is a cross-cutting **Infrastructure/Utility** class that operates within the **Web/Controller Tier**. It is populated by the `SessionListener` and used by `Action` classes like `ApproveChangeAction`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Jakarta Servlet API (`jakarta.servlet.http.HttpSession`)**: The object type it manages.\n    *   `java.util.concurrent.ConcurrentHashMap`: Used to provide a thread-safe map for storing sessions.\n\n4.  **In-Depth Breakdown**\n\n    *   **`SESSIONS` (static Map)**: A `ConcurrentHashMap` where the key is the session ID and the value is the `HttpSession` object. This map is the central registry.\n    *   **`addSession(HttpSession session)`**: A static method called by `SessionListener` when a new session is created. It adds the session to the map.\n    *   **`removeSession(HttpSession session)`**: A static method called by `SessionListener` when a session is destroyed. It removes the session from the map.\n    *   **`invalidateSessionsForUser(int userId)`**:\n        *   **Method Signature:** `public static void invalidateSessionsForUser(int userId)`\n        *   **Purpose:** The main functional method of the class. It finds all active sessions belonging to a specific user and invalidates them.\n        *   **Logic:** It iterates through the values of the `SESSIONS` map. For each session, it safely retrieves the `User` object, checks if the user''s ID matches the target `userId`, and if so, calls `session.invalidate()`. It includes error handling for already invalidated sessions.'),
('src/main/java/de/technikteam/servlet/CalendarServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for rendering the main calendar page (`/kalender`). It fetches all upcoming events and meetings and prepares several data structures to support different views: a full-grid monthly/weekly calendar for desktop and a simple chronological list for mobile devices.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It gathers data from the `EventDAO` and `MeetingDAO`, performs date-based calculations and groupings, and forwards the prepared data to the `calendar.jsp` view for rendering.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `EventDAO` and `MeetingDAO`.\n    *   `EventDAO`, `MeetingDAO`: DAOs used to fetch calendar entries.\n    *   `java.time` API: Extensively used for date calculations, such as determining the current month, previous/next months, and the days of the week.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the calendar page.\n        *   **Logic:**\n            1.  **Date Calculation:** Determines the current month and year to display, allowing for navigation via URL parameters (`?year=...&month=...`).\n            2.  **Data Fetching:** Calls the DAOs to get lists of all upcoming `Event` and `Meeting` objects.\n            3.  **Data Aggregation:** Creates a unified list of all calendar entries and then groups them into a `Map<LocalDate, List<Map<String, Object>>>`, which is used by the JSP to place entries on the correct days in the monthly view grid.\n            4.  **Monthly View Data:** Calculates the `startDayOfWeekOffset` (how many empty cells to show before the 1st of the month) and the total `daysInMonth`.\n            5.  **Weekly View Data:** Calculates the start date of the current week and creates a list of maps, with each map representing a day of the week.\n            6.  **Mobile View Data:** Calls the `prepareMobileList` helper method to create a single, sorted chronological list for the mobile view.\n            7.  **Forwarding:** Sets all calculated data as request attributes and forwards the request to `calendar.jsp`.\n\n    *   **`prepareMobileList(...)`**: A private helper method that transforms the `Event` and `Meeting` objects into a unified list of maps, each containing display-ready information like the formatted day, month abbreviation, and a unique URL. It then sorts this list chronologically.'),
('src/main/java/de/technikteam/servlet/DownloadServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet handles secure file downloads for both general files (from `files` table) and specific attachments (from `attachments` table). It validates that the user is authenticated and authorized to access the requested file, protects against path traversal attacks, and serves the physical file with the correct headers.\n\n2.  **Architectural Role**\n\n    This class is a critical component of the **Web/Controller Tier**. It acts as a secure gateway between a user''s download request and the physical files stored on the server''s filesystem. It interacts with multiple DAOs to perform authorization checks.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `FileDAO`, `EventDAO`, `MeetingDAO`, `AttachmentDAO`, and `ConfigurationService`.\n    *   DAOs: Used to fetch file metadata and perform authorization checks (e.g., is the user associated with the event the attachment belongs to?).\n    *   `ConfigurationService`: Provides the base path to the file upload directory.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**:\n        *   **Purpose:** Handles a GET request for a file download.\n        *   **Logic:**\n            1.  **Authentication:** Ensures a user is logged in.\n            2.  **Parameter Validation:** Checks for a valid `id` parameter.\n            3.  **Data Retrieval:** It first tries to find the ID in the `attachments` table. If not found, it checks the `files` table. This allows a single download endpoint for both types of files.\n            4.  **Authorization:** It calls `isUserAuthorizedForAttachment` or checks the `required_role` on the `File` object to determine if the user has permission to download the file. Admins are always authorized.\n            5.  **File Serving:** If all checks pass, it calls the `serveFile` helper method.\n            6.  **Error Handling:** Sends appropriate HTTP error codes (400, 401, 403, 404) for various failure scenarios.\n\n    *   **`isUserAuthorizedForAttachment(...)`**: A private helper that encapsulates the logic for checking if a non-admin user can access an attachment. The user must be associated with the parent event or meeting.\n\n    *   **`serveFile(...)`**:\n        *   **Purpose:** The core file-serving logic.\n        *   **Logic:**\n            1.  **Path Traversal Protection:** It constructs the full, canonical path to the requested file and ensures that this path is still within the configured upload directory. This is a critical security measure to prevent users from requesting files outside the intended folder (e.g., `?file=../../../../some/system/file`).\n            2.  **File Existence Check:** Verifies that the file exists and is a regular file.\n            3.  **Set Headers:** It sets the `Content-Type` to `application/octet-stream` to force a download prompt, sets the `Content-Length`, and sets the `Content-Disposition` header with a properly URL-encoded filename.\n            4.  **Streaming:** It opens a `FileInputStream` to the physical file and streams its bytes to the `HttpServletResponse`''s `OutputStream`.'),
('src/main/java/de/technikteam/servlet/EventActionServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet handles user actions related to events, such as signing up or signing off. It processes POST requests from the public events page (`events.jsp`) and updates the user''s attendance status in the database.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Web/Controller Tier**. It acts as a controller for user-initiated event actions. It interacts with the `EventDAO` and `EventCustomFieldDAO` for data persistence and the `EventService` for more complex business logic.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `EventDAO`, `EventCustomFieldDAO`, and `EventService`.\n    *   `EventDAO`: Used for simple sign-up and sign-off operations.\n    *   `EventCustomFieldDAO`: Used to save user responses to any custom fields on the sign-up form.\n    *   `EventService`: Used for the special case of signing off from a running event, which involves sending a notification.\n    *   `CSRFUtil`: Used to validate the CSRF token on every POST request.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doPost(HttpServletRequest request, HttpServletResponse response)`**:\n        *   **Purpose:** The main method that handles all POST requests.\n        *   **Logic:**\n            1.  **Security:** Validates the CSRF token.\n            2.  **Parameter Validation:** Ensures a user is logged in and that `action` and `eventId` parameters are present.\n            3.  **Action Routing:** It uses a `switch` statement on the `action` parameter to delegate to the appropriate handler method.\n            *   `\"signup\"`: Calls `eventDAO.signUpForEvent` and then iterates through any custom field parameters from the request, saving each response via `customFieldDAO.saveResponse`.\n            *   `\"signoff\"`: Calls `eventDAO.signOffFromEvent` for a simple sign-off.\n            *   `\"signOffWithReason\"`: This special case is for events that are already running. It retrieves the reason from the request and calls `eventService.signOffUserFromRunningEvent`, which handles both the database update and sending a notification to the event leader.\n            4.  **Feedback & Redirect:** Sets a success or error message in the session and redirects the user back to the main events page.'),
('src/main/java/de/technikteam/servlet/EventDetailsServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for preparing and displaying the detailed view of a single event. It fetches the core event data and aggregates all related information, such as assigned team members, tasks, attachments, and chat messages, before forwarding the data to the `eventDetails.jsp` page for rendering.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Web/Controller Tier**. It acts as the controller for the event details page. It coordinates multiple DAOs to assemble a complete, aggregated view of an event.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects all necessary DAOs (`EventDAO`, `EventTaskDAO`, `EventChatDAO`, etc.).\n    *   **DAOs**: Each DAO is used to fetch a specific piece of related data (e.g., `taskDAO.getTasksForEvent`, `attachmentDAO.getAttachmentsForParent`).\n    *   **Gson**: Used to serialize various data lists (like users, items, kits) into JSON for use by the client-side JavaScript on the page.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**:\n        *   **Purpose:** Handles GET requests for the event details page.\n        *   **Logic:**\n            1.  **Authentication & Parameter Validation:** Ensures a user is logged in and that a valid `id` parameter is provided.\n            2.  **Fetch Core Event:** Retrieves the main `Event` object using `eventDAO.getEventById`.\n            3.  **Authorization:** Performs a crucial authorization check. A user can only view the details if they are a global admin, the event leader, or are associated with the event (either signed up or assigned). If the check fails, it sends an HTTP 403 (Forbidden) error.\n            4.  **Data Aggregation:** If authorized, it proceeds to fetch all related data from the various DAOs and sets it on the `event` model object. This includes attachments (filtered by the user''s role), skill requirements, reserved items, assigned attendees, and tasks.\n            5.  **Chat History:** If the event''s status is \"LAUFEND\", it fetches the chat history from `chatDAO`.\n            6.  **JSON Serialization:** It serializes data needed for client-side modals (like the list of assigned users and all available items/kits for the task editor) into JSON strings and places them in request attributes.\n            7.  **Forwarding:** It sets the fully populated `event` object as a request attribute and forwards to `eventDetails.jsp`.'),
('src/main/java/de/technikteam/servlet/EventServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves the main \"Veranstaltungen\" (Events) page. Its primary role is to fetch a list of all upcoming and active events, determine the current user''s qualification and sign-up status for each, and then pass this enriched data to the `events.jsp` view for rendering.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It acts as the controller for the public event listing. It interacts with the `EventDAO` to retrieve data and applies business logic to determine user-specific states for each event.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `EventDAO`.\n    *   `EventDAO`: Used to fetch all upcoming events and the specific events a user is qualified for.\n    *   `User` (Model): The logged-in user object, retrieved from the session.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the main events page.\n        *   **Logic:**\n            1.  **Authentication:** Ensures a user is logged in.\n            2.  **Fetch All Events:** It retrieves a list of *all* active and upcoming events via `eventDAO.getAllActiveAndUpcomingEvents()`.\n            3.  **Fetch Qualified Events:** It makes a second, more complex call to `eventDAO.getUpcomingEventsForUser()`. This method returns only the events for which the current user meets the skill requirements and also includes their current sign-up status (`ANGEMELDET`, `ABGEMELDET`, or `OFFEN`).\n            4.  **Data Enrichment:** It iterates through the list of all events. For each event, it checks if its ID is present in the list of qualified events.\n                *   If it is, it sets the `isUserQualified` flag to `true` and copies the `userAttendanceStatus` to the event object.\n                *   If it is not, `isUserQualified` remains `false` (its default), which will cause the \"Anmelden\" button to be disabled in the JSP.\n            5.  **Forwarding:** It sets the final, enriched list of all upcoming events as a request attribute and forwards to `events.jsp`.'),
('src/main/java/de/technikteam/servlet/FeedbackServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet handles all user interactions with the feedback system. It serves two distinct purposes based on the `action` parameter: displaying the general feedback form and handling its submission, as well as managing the event-specific feedback workflow.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Web/Controller Tier**. It acts as a controller for both general and event-specific feedback. It interacts with the `FeedbackSubmissionDAO` for general feedback and the `EventFeedbackDAO` for event-specific feedback.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects `EventFeedbackDAO`, `FeedbackSubmissionDAO`, and `EventDAO`.\n    *   `FeedbackSubmissionDAO`: For creating general feedback entries.\n    *   `EventFeedbackDAO`: For creating event feedback forms and saving responses.\n    *   `EventDAO`: To get event details when creating an event feedback form.\n    *   `CSRFUtil`: For security validation on all POST requests.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(...)`**:\n        *   **Purpose:** Renders the appropriate feedback form.\n        *   **Logic:** It checks the `action` parameter.\n            *   If `action=submitEventFeedback`, it calls `showSubmitEventFeedbackForm()` to display the star rating form for a specific event.\n            *   Otherwise, it forwards to the `feedback.jsp` page for general feedback.\n\n    *   **`doPost(...)`**:\n        *   **Purpose:** Handles the submission of feedback forms.\n        *   **Logic:** After validating the CSRF token, it routes based on the `action` parameter.\n            *   `\"submitGeneralFeedback\"`: Calls `handleGeneralFeedback()`.\n            *   `\"submitEventFeedbackResponse\"`: Calls `handleEventFeedbackResponse()`.\n\n    *   **`handleGeneralFeedback(...)`**:\n        *   **Purpose:** Validates and saves a general feedback submission.\n        *   **Logic:** It retrieves the subject and content from the request, performs validation, creates a `FeedbackSubmission` object, and saves it using `submissionDAO`. It sets appropriate session messages and redirects.\n\n    *   **`handleEventFeedbackResponse(...)`**:\n        *   **Purpose:** Saves a user''s response to an event feedback form.\n        *   **Logic:** It parses the form ID, rating, and comments, creates a `FeedbackResponse` object, and saves it using `eventFeedbackDAO`. It then redirects the user to their profile page.\n\n    *   **`showSubmitEventFeedbackForm(...)`**:\n        *   **Purpose:** Prepares the data for the event-specific feedback form.\n        *   **Logic:**\n            1.  It retrieves the `Event` object.\n            2.  It checks if a `FeedbackForm` already exists for this event using `eventFeedbackDAO`. If not, it creates one.\n            3.  It checks if the user has already submitted feedback for this form. If so, it redirects them to their profile with an info message.\n            4.  Otherwise, it sets the `event` and `form` objects as request attributes and forwards to `feedback_form.jsp`.'),
('src/main/java/de/technikteam/servlet/FileServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for displaying the public-facing \"Dateien & Dokumente\" page. It fetches the list of files and categories that the currently logged-in user is authorized to see and forwards this data to the `dateien.jsp` view for rendering.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Web/Controller Tier**. It acts as the controller for the public file listing page. It interacts directly with the `FileDAO` to retrieve data.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `FileDAO`.\n    *   `FileDAO`: The DAO used to fetch the list of files, grouped by category.\n    *   `User` (Model): The user object from the session, used to determine which files should be visible.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the `/dateien` page.\n        *   **Logic:**\n            1.  Retrieves the `User` object from the session.\n            2.  Calls `fileDAO.getAllFilesGroupedByCategory(user)`. This DAO method contains the authorization logic to filter out admin-only files if the user is not an admin.\n            3.  Sets the resulting map of grouped files as a request attribute named `fileData`.\n            4.  Forwards the request to `views/public/dateien.jsp`.'),
('src/main/java/de/technikteam/servlet/HomeServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves as the controller for the user''s main dashboard or home page. It is responsible for fetching personalized data for the logged-in user, such as their upcoming assigned events, their open tasks, and other general upcoming events they might be interested in.\n\n2.  **Architectural Role**\n\n    This class is a key component of the **Web/Controller Tier**. It acts as the entry point for the user after logging in. It interacts with the `EventDAO` and `EventTaskDAO` to aggregate the data needed for the dashboard widgets.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `EventDAO` and `EventTaskDAO`.\n    *   `EventDAO`: Used to fetch the user''s assigned events and general upcoming events.\n    *   `EventTaskDAO`: Used to fetch the user''s open tasks across all events.\n    *   `User` (Model): The user object from the session, whose ID is used in the DAO queries.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the `/home` page.\n        *   **Logic:**\n            1.  **Authentication Check:** A crucial defensive check ensures that a `User` object exists in the session. If not, it redirects to the login page.\n            2.  **Data Fetching:** It makes three separate calls to the DAOs:\n                *   `eventDAO.getAssignedEventsForUser()`: Gets the top 5 events the user is *assigned* to.\n                *   `eventTaskDAO.getOpenTasksForUser()`: Gets all open tasks assigned to the user.\n                *   `eventDAO.getUpcomingEventsForUser()`: Gets the top 5 general upcoming events for which the user is qualified but not necessarily assigned.\n            3.  **Forwarding:** It sets the three lists of data as request attributes (`assignedEvents`, `openTasks`, `upcomingEvents`) and forwards the request to `views/public/home.jsp`.'),
('src/main/java/de/technikteam/servlet/IcalServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet generates an iCalendar (`.ics`) feed of all active and upcoming events and meetings. This allows users to subscribe to the application''s schedule using external calendar applications like Google Calendar, Outlook, or Apple Calendar.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It acts as a specialized API endpoint that produces data in the iCalendar format instead of HTML or JSON. It interacts with the `EventDAO` and `MeetingDAO` to source its data.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `EventDAO` and `MeetingDAO`.\n    *   **iCal4j (`net.fortuna.ical4j.*`)**: The core third-party library used to programmatically build the iCalendar data structure.\n    *   `EventDAO`, `MeetingDAO`: Used to fetch all public calendar entries.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests to `/calendar.ics`.\n        *   **Logic:**\n            1.  **Initialize Calendar:** Creates a new iCal4j `Calendar` object and sets the standard `PRODID` and `VERSION` properties.\n            2.  **Fetch Events & Meetings:** Retrieves all active and upcoming events and meetings from the DAOs.\n            3.  **Create VEvents:** It iterates through both lists. For each `Event` and `Meeting`, it creates a `VEvent` component.\n            4.  **Populate VEvent Properties:** It populates each `VEvent` with standard iCalendar properties:\n                *   `UID`: A unique identifier for the event.\n                *   `DTSTART` / `DTEND`: The start and end times. It correctly converts the Java `LocalDateTime` to a `java.util.Date` required by iCal4j.\n                *   `SUMMARY`: The event/meeting title.\n                *   `DESCRIPTION`: The event/meeting description.\n                *   `LOCATION`: The event/meeting location.\n                *   `URL`: A direct link back to the event/meeting details page within the application.\n            5.  **Set Response Headers:** It sets the `Content-Type` to `text/calendar` and the `Content-Disposition` to `inline`, suggesting to the browser that it should be opened by a calendar application.\n            6.  **Output:** Uses a `CalendarOutputter` from iCal4j to write the fully constructed calendar object to the servlet''s response stream.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/servlet/ImageServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for securely serving images stored in the `images` subdirectory of the main upload folder. It prevents direct access to the filesystem, performs authorization checks, and includes protection against path traversal attacks.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Web/Controller Tier**. It acts as a secure proxy for image files, ensuring that only authenticated users can access them and that they cannot request files outside the designated image directory.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `ConfigurationService`.\n    *   `ConfigurationService`: Provides the base path for file uploads.\n    *   `User` (Model): Retrieved from the session for authentication and logging purposes.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for images.\n        *   **Logic:**\n            1.  **Authentication:** Checks for a valid user session.\n            2.  **Parameter Validation:** Ensures the `file` parameter is present.\n            3.  **Path Traversal Protection:** This is the most critical security feature.\n                *   It constructs the canonical (absolute) path for both the base image directory and the requested file.\n                *   It then checks if the canonical path of the requested file *starts with* the canonical path of the base directory. If not, it means the user is trying to access a file outside the intended directory (e.g., using `../`), a path traversal attack.\n                *   In case of a detected attack, it logs a `FATAL` error and returns a 403 Forbidden error.\n            4.  **File Existence Check:** Verifies that the requested file exists and is not a directory.\n            5.  **Set Headers:** It determines the MIME type of the image (e.g., `image/jpeg`, `image/png`) and sets the `Content-Type`, `Content-Length`, and `Content-Disposition: inline` headers. `inline` suggests that the browser should display the image directly rather than prompting for a download.\n            6.  **Streaming:** It streams the file''s bytes from a `FileInputStream` to the response''s `OutputStream`.'),
('src/main/java/de/technikteam/servlet/LoginServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet handles the user authentication process. It serves the login page (`login.jsp`) for GET requests and processes login form submissions for POST requests. It includes logic for validating credentials, managing failed login attempts, and implementing an escalating lockout mechanism to thwart brute-force attacks.\n\n2.  **Architectural Role**\n\n    This class is a central part of the **Web/Controller Tier**. It is the main entry point for user authentication. It interacts directly with the `UserDAO` to validate credentials and manages the `HttpSession` to establish a logged-in state.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `UserDAO`.\n    *   `UserDAO`: Used to validate the username and password against the database.\n    *   `NavigationRegistry`: Used to build the user-specific navigation menu after a successful login.\n    *   `CSRFUtil`: Used to generate and store a new CSRF token in the session upon successful login.\n\n4.  **In-Depth Breakdown**\n\n    *   **`LoginAttemptManager` (Inner Class):**\n        *   **Purpose:** A static inner class that encapsulates all logic related to tracking and managing failed login attempts.\n        *   **`MAX_ATTEMPTS`**: The number of failed attempts before a lockout is triggered.\n        *   **`LOCKOUT_DURATIONS_MS`**: An array defining the escalating lockout durations in milliseconds for subsequent lockouts.\n        *   **`isLockedOut(String username)`**: Checks if a user is currently within a lockout period.\n        *   **`recordFailedLogin(String username)`**: Increments the failed attempt counter for a user. If the count reaches the maximum, it initiates a lockout.\n        *   **`clearLoginAttempts(String username)`**: Resets all attempt counters and lockout information for a user, typically after a successful login.\n\n    *   **`doPost(HttpServletRequest request, HttpServletResponse response)`**:\n        *   **Purpose:** Processes the login form submission.\n        *   **Logic:**\n            1.  Retrieves `username` and `password` from the request.\n            2.  **Lockout Check:** First, it checks if the user is currently locked out using `LoginAttemptManager.isLockedOut()`. If so, it sets session attributes to inform the JSP and redirects back.\n            3.  **Credential Validation:** It calls `userDAO.validateUser()`.\n            4.  **Success Path:** If `validateUser` returns a `User` object, it means the login was successful.\n                *   It clears any previous failed login attempts for that user.\n                *   It invalidates the old session and creates a new one to prevent session fixation attacks.\n                *   It stores the `User` object in the new session.\n                *   It generates a new CSRF token.\n                *   It builds the user''s navigation menu and stores it in the session.\n                *   It redirects the user to the `/home` page.\n            5.  **Failure Path:** If `validateUser` returns `null`, the login failed.\n                *   It records the failed attempt using `LoginAttemptManager.recordFailedLogin()`.\n                *   It sets error messages and the failed username in the session for the JSP to display.\n                *   It redirects the user back to the `/login` page.\n\n    *   **`doGet(...)`**: Simply forwards the request to the `login.jsp` view.'),
('src/main/java/de/technikteam/servlet/LogoutServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet handles the user logout process. It invalidates the current user''s session, effectively logging them out, and then redirects them to the login page with a success message.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It is the dedicated endpoint for terminating a user''s authenticated session.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Jakarta Servlet API (`jakarta.servlet.http.HttpSession`)**: Used to access and invalidate the user''s session.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests to the `/logout` URL.\n        *   **Logic:**\n            1.  It retrieves the current `HttpSession` without creating a new one (`request.getSession(false)`).\n            2.  If a session exists, it logs which user is logging out and then calls `session.invalidate()`. This is the core action that removes all session attributes and effectively logs the user out.\n            3.  It then creates a *new* session (`request.getSession(true)`) to store a \"successMessage\" that can be displayed on the login page.\n            4.  Finally, it redirects the user to the `/login` page.'),
('src/main/java/de/technikteam/servlet/MarkdownEditorServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves the real-time Markdown editor page. It is responsible for fetching the content of a specific Markdown file, performing authorization checks to determine if the user can view or edit the file, and then forwarding the data to the `admin_editor.jsp` view.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It acts as the controller for the collaborative editor view. It interacts with the `FileDAO` to retrieve file metadata and content.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `FileDAO` and `ConfigurationService`.\n    *   `FileDAO`: Used to get the file''s metadata and read its physical content.\n    *   `ConfigurationService`: Provides the base path to the upload directory.\n    *   `User` (Model): The user object from the session, used for authorization.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the `/editor` page.\n        *   **Logic:**\n            1.  **Authentication & Parameter Validation:** Ensures a user is logged in and that a valid `fileId` is provided.\n            2.  **Fetch File Metadata:** Retrieves the `File` object from the database using `fileDAO.getFileById()`.\n            3.  **Authorization:** It checks the user''s permissions (`FILE_UPDATE` or `ACCESS_ADMIN_PANEL` for editing, `FILE_READ` for viewing). Based on the check, it sets an `editorMode` attribute (\"edit\" or \"view\") for the JSP. If the user has neither permission, it returns a 403 Forbidden error.\n            4.  **Fetch File Content:** It reads the physical file''s content from the disk using the path stored in the `dbFile` object. It includes error handling for cases where the file is in the database but missing from the disk.\n            5.  **Forwarding:** It sets the `file` object and its `fileContent` as request attributes and forwards to `admin_editor.jsp`.'),
('src/main/java/de/technikteam/servlet/MeetingActionServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet handles user actions related to meetings, specifically signing up for and signing off from a meeting. It processes POST requests from the public meetings list page (`lehrgaenge.jsp`).\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It acts as the controller for user-initiated meeting attendance changes. It interacts directly with the `MeetingAttendanceDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `MeetingAttendanceDAO`.\n    *   `MeetingAttendanceDAO`: The DAO used to update the user''s attendance status.\n    *   `CSRFUtil`: Used for security validation.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doPost(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles POST requests for meeting actions.\n        *   **Logic:**\n            1.  **Security & Validation:** It validates the CSRF token and ensures a user is logged in and that `action` and `meetingId` parameters are present.\n            2.  **Action Handling:**\n                *   If `action` is `\"signup\"`, it calls `attendanceDAO.setAttendance()` with `attended=true`.\n                *   If `action` is `\"signoff\"`, it calls `attendanceDAO.setAttendance()` with `attended=false`.\n            3.  **Feedback & Redirect:** It sets a success message in the session and redirects the user back to the `/lehrgaenge` page.'),
('src/main/java/de/technikteam/servlet/MeetingDetailsServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for preparing and displaying the detailed view of a single meeting. It fetches the meeting''s data and its associated file attachments, performs an authorization check, and forwards the information to the `meetingDetails.jsp` view.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It acts as the controller for the meeting details page. It interacts with the `MeetingDAO` and `AttachmentDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `MeetingDAO` and `AttachmentDAO`.\n    *   `MeetingDAO`: Used to fetch the core meeting data and check for user association.\n    *   `AttachmentDAO`: Used to fetch attachments specific to this meeting.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the meeting details page.\n        *   **Logic:**\n            1.  **Authentication & Validation:** Ensures a user is logged in and a valid `id` parameter is present.\n            2.  **Fetch Meeting Data:** Retrieves the `Meeting` object from the DAO.\n            3.  **Authorization:** A user is authorized to view the details if they are an admin, the meeting leader, or a participant. If not, it sends a 403 Forbidden error.\n            4.  **Fetch Attachments:** It calls `attachmentDAO.getAttachmentsForParent()`, passing \"MEETING\" as the type and filtering by the user''s role to determine which attachments should be visible.\n            5.  **Forwarding:** Sets the `meeting` and `attachments` as request attributes and forwards to `meetingDetails.jsp`.'),
('src/main/java/de/technikteam/servlet/MeetingServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves the main \"Lehrgänge\" (Courses/Meetings) page. It fetches the list of all upcoming meetings and determines the current user''s sign-up status for each one.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Web/Controller Tier**. It acts as the controller for the public listing of schedulable meetings. It interacts directly with the `MeetingDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `MeetingDAO`.\n    *   `MeetingDAO`: Used to fetch the upcoming meetings and the user''s status for each.\n    *   `User` (Model): The user object from the session, used to get user-specific data.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the `/lehrgaenge` page.\n        *   **Logic:**\n            1.  Retrieves the logged-in `User`.\n            2.  Calls `meetingDAO.getUpcomingMeetingsForUser(user)`. This single DAO call efficiently retrieves all upcoming meetings and, through a `LEFT JOIN`, also fetches the user''s attendance status (`ANGEMELDET`, `ABGEMELDET`, or `OFFEN`) for each.\n            3.  Sets the resulting list of `Meeting` objects as a request attribute.\n            4.  Forwards the request to `views/public/lehrgaenge.jsp`.'),
('src/main/java/de/technikteam/servlet/MyFeedbackServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves the \"Mein Feedback\" page, which allows users to view the status of their own previously submitted feedback. It fetches all submissions made by the currently logged-in user.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It acts as the controller for a user''s personal feedback history view. It interacts directly with the `FeedbackSubmissionDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `FeedbackSubmissionDAO`.\n    *   `FeedbackSubmissionDAO`: The DAO used to retrieve submissions by user ID.\n    *   `User` (Model): The user object from the session.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the `/my-feedback` page.\n        *   **Logic:**\n            1.  Ensures a user is logged in.\n            2.  Calls `submissionDAO.getSubmissionsByUserId()` using the logged-in user''s ID.\n            3.  Sets the resulting list of `FeedbackSubmission` objects as a request attribute.\n            4.  Forwards the request to `views/public/my_feedback.jsp`.'),
('src/main/java/de/technikteam/servlet/NotificationServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is the client-facing endpoint for establishing a Server-Sent Events (SSE) connection. Authenticated clients connect to this servlet to receive real-time push notifications from the server. This servlet''s only job is to register the client''s connection with the `NotificationService`.\n\n2.  **Architectural Role**\n\n    This is a specialized controller in the **Web/Controller Tier**. It handles the initial setup of the long-lived HTTP connection required for SSE. All subsequent communication is managed by the `NotificationService`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `NotificationService`: The singleton service where the client connection is registered.\n    *   **Jakarta Servlet API (`AsyncContext`)**: The underlying mechanism used to keep the connection open asynchronously.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests to `/notifications`.\n        *   **Logic:**\n            1.  **Authentication:** It ensures a user is logged in. Unauthorized requests are rejected.\n            2.  **Set SSE Headers:** It sets the necessary HTTP headers for an SSE connection: `Content-Type: text/event-stream`, `Cache-Control: no-cache`, and `Connection: keep-alive`.\n            3.  **Register with Service:** It calls `NotificationService.getInstance().register(request)`. This call is the core of the servlet; it starts an `AsyncContext`, effectively handing off the connection to the `NotificationService` to be managed for the duration of the SSE session.'),
('src/main/java/de/technikteam/servlet/PackKitServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet generates a printable \"packing list\" page for a specific inventory kit. It is designed to be accessed via a QR code, providing a simple, mobile-friendly checklist of items that belong in a particular case or kit.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It acts as a controller for a read-only, utility view. It interacts directly with the `InventoryKitDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `InventoryKitDAO`.\n    *   `InventoryKitDAO`: Used to fetch the kit''s details and its list of required items.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the `/pack-kit` URL.\n        *   **Logic:**\n            1.  **Parameter Validation:** It requires a `kitId` parameter.\n            2.  **Data Fetching:**\n                *   It retrieves the main `InventoryKit` object (for its name and description) using `kitDAO.getKitById()`.\n                *   It retrieves the list of `InventoryKitItem`s for that kit using `kitDAO.getItemsForKit()`.\n            3.  **Forwarding:** It sets the `kit` and `kitItems` as request attributes and forwards to `views/public/pack_kit.jsp`. This JSP is styled for a clean, printable view and has the main navigation hidden.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/servlet/PasswordServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet manages the process for a logged-in user to change their own password. It handles rendering the password change form for GET requests and processes the form submission for POST requests, including validation of the current password, new password confirmation, and adherence to the password policy.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Web/Controller Tier**. It is a self-contained controller for a specific user action. It interacts with the `UserDAO` for credential validation and updates, and uses the `PasswordPolicyValidator` for business logic.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `UserDAO`.\n    *   `UserDAO`: Used to validate the user''s current password and to save the new hashed password.\n    *   `PasswordPolicyValidator`: A utility class that enforces complexity requirements for new passwords.\n    *   `CSRFUtil`: Used to validate the CSRF token on the POST request.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(...)`**: Simply forwards the request to the `passwort.jsp` view, which contains the password change form.\n\n    *   **`doPost(HttpServletRequest request, HttpServletResponse response)`**:\n        *   **Purpose:** Processes the password change form submission.\n        *   **Logic:**\n            1.  **Authentication & Security:** Ensures a user is logged in and validates the CSRF token.\n            2.  **Parameter Retrieval:** Gets the `currentPassword`, `newPassword`, and `confirmPassword` from the request.\n            3.  **Current Password Validation:** It calls `userDAO.validateUser()` with the current user''s name and the provided `currentPassword`. If this fails, it sets an error message and redirects back.\n            4.  **Confirmation Check:** It verifies that `newPassword` and `confirmPassword` are identical.\n            5.  **Policy Validation:** It calls `PasswordPolicyValidator.validate()` on the `newPassword`. If the new password does not meet the complexity requirements, it sets an error message with the specific reason and redirects.\n            6.  **Database Update:** If all checks pass, it calls `userDAO.changePassword()` to hash and save the new password.\n            7.  **Feedback & Redirect:** It sets a success or error message in the session and redirects the user back to the `/passwort` page.'),
('src/main/java/de/technikteam/servlet/ProfileServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves as the controller for the \"Mein Profil\" (My Profile) page. For GET requests, it aggregates and displays a comprehensive overview of the logged-in user''s data, including their profile information, event history, qualifications, achievements, and registered passkeys. For POST requests, it handles various profile-related actions like submitting a profile change request or deleting a passkey.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It acts as a central hub for user-specific data display and modification. It interacts with a wide range of DAOs to collect the necessary information.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects `EventDAO`, `UserQualificationsDAO`, `UserDAO`, `AchievementDAO`, `PasskeyDAO`, and `ProfileChangeRequestDAO`.\n    *   **DAOs**: Each DAO is used to fetch a specific slice of the user''s data.\n    *   **Gson**: Used to serialize the JSON payload for the profile change request.\n    *   `CSRFUtil`: For validating all POST actions.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(...)`**:\n        *   **Purpose:** Gathers all data for the profile page.\n        *   **Logic:** It makes calls to multiple DAOs (`eventDAO.getEventHistoryForUser`, `qualificationsDAO.getQualificationsForUser`, etc.) to fetch all the different pieces of information. It also checks if the user has an outstanding change request using `requestDAO.hasPendingRequest()`. All retrieved data is set as request attributes before forwarding to `profile.jsp`.\n\n    *   **`doPost(...)`**:\n        *   **Purpose:** Handles various actions submitted from the profile page.\n        *   **Logic:** After validating the CSRF token, it uses a `switch` statement on the `action` parameter to route to the appropriate handler method.\n\n    *   **`handleDeletePasskey(...)`**: Deletes a user''s passkey credential after they confirm the action.\n\n    *   **`handleUpdateChatColor(...)`**: Updates the user''s preferred chat color in the database and in their current session object.\n\n    *   **`handleProfileChangeRequest(...)`**:\n        *   **Purpose:** Handles the submission of a profile data change request from the user. This is an AJAX endpoint.\n        *   **Logic:**\n            1.  It compares the submitted form values (`email`, `classYear`, `className`) with the values in the current user''s session object.\n            2.  It builds a `Map` containing only the fields that have actually changed.\n            3.  If there are no changes, it returns an error response.\n            4.  If there are changes, it serializes the `Map` to a JSON string.\n            5.  It creates a new `ProfileChangeRequest` object, sets the JSON string as the `requestedChanges`, and saves it to the database via the `requestDAO`.\n            6.  It returns a JSON `ApiResponse` indicating success or failure.'),
('src/main/java/de/technikteam/servlet/RootServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is mapped to the root URL (`/`) of the application. Its sole purpose is to act as a router, directing users to the appropriate starting page based on their authentication status.\n\n2.  **Architectural Role**\n\n    This class is a simple entry point in the **Web/Controller Tier**. It ensures users landing on the base URL are sent to either the login page or their dashboard, preventing them from seeing a blank or error page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Jakarta Servlet API**: The base `HttpServlet` class.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles all GET requests to the application''s root context.\n        *   **Logic:**\n            1.  It checks the `HttpSession` for a `User` object.\n            2.  If a `User` object exists (the user is logged in), it sends a redirect to the `/home` servlet.\n            3.  If no `User` object exists (the user is not logged in), it sends a redirect to the `/login` servlet.'),
('src/main/java/de/technikteam/servlet/StorageItemActionServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves the dedicated \"QR Action\" page, which is designed to be accessed by scanning a QR code associated with an inventory item. It provides a simplified, mobile-friendly interface for performing a quick check-in or check-out transaction for a specific item.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Web/Controller Tier**. It acts as the controller for the QR code landing page. It interacts with the `StorageDAO` and `EventDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `StorageDAO` and `EventDAO`.\n    *   `StorageDAO`: To fetch the details of the specific item.\n    *   `EventDAO`: To fetch a list of active events to populate the \"assign to event\" dropdown.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests, typically from a QR code scan.\n        *   **Logic:**\n            1.  **Parameter Validation:** It requires an `id` parameter identifying the storage item.\n            2.  **Data Fetching:**\n                *   It retrieves the full `StorageItem` object using `storageDAO.getItemById()`.\n                *   It fetches all currently active events using `eventDAO.getActiveEvents()`.\n            3.  **Error Handling:** If the item ID is invalid or the item is not found, it sends an appropriate HTTP error.\n            4.  **Forwarding:** It sets the `item` and `activeEvents` as request attributes and forwards to `views/public/qr_action.jsp`. This JSP has a simplified layout without the main navigation, optimized for quick actions on a mobile device.'),
('src/main/java/de/technikteam/servlet/StorageItemDetailsServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for displaying the detailed information page for a single inventory item. It aggregates the item''s core data, its transaction history, and its maintenance history into a single view.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It acts as the controller for the item details page. It coordinates calls to `StorageDAO`, `StorageLogDAO`, and `MaintenanceLogDAO` to build a complete picture of the item.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the three DAOs responsible for storage data.\n    *   `StorageDAO`: To fetch the main `StorageItem` object.\n    *   `StorageLogDAO`: To fetch the item''s checkout/checkin history.\n    *   `MaintenanceLogDAO`: To fetch the item''s repair/maintenance history.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the item details page.\n        *   **Logic:**\n            1.  **Parameter Validation:** It validates that a numerical `id` parameter is present.\n            2.  **Data Fetching:** It makes three separate DAO calls:\n                *   `storageDAO.getItemById()` to get the core item details.\n                *   `storageLogDAO.getHistoryForItem()` to get the transaction log.\n                *   `maintenanceLogDAO.getHistoryForItem()` to get the maintenance log.\n            3.  **Error Handling:** If the item is not found, it sends an HTTP 404 error.\n            4.  **Forwarding:** It sets the `item`, `history`, and `maintenanceHistory` as request attributes and forwards the request to `views/public/storage_item_details.jsp`.'),
('src/main/java/de/technikteam/servlet/StorageServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves the main public-facing \"Lager\" (Inventory) page. Its job is to fetch all inventory items, grouped by their physical location, and prepare the data for display in the `lager.jsp` view.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Web/Controller Tier**. It acts as the controller for the main inventory overview page. It interacts with the `StorageDAO` and `EventDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `StorageDAO` and `EventDAO`.\n    *   `StorageDAO`: Used to fetch all inventory items, grouped by location.\n    *   `EventDAO`: Used to fetch a list of active events to populate the dropdown in the transaction modal.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the `/lager` page.\n        *   **Logic:**\n            1.  It calls `storageDAO.getAllItemsGroupedByLocation()` to retrieve all storage items, pre-organized into a `Map` where keys are location names and values are lists of items in that location.\n            2.  It calls `eventDAO.getActiveEvents()` to get a list of events that can be associated with a transaction.\n            3.  It sets both the `storageData` map and the `activeEvents` list as request attributes.\n            4.  It forwards the request to `views/public/lager.jsp`.'),
('src/main/java/de/technikteam/servlet/StorageTransactionServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet processes inventory transaction requests (check-ins and check-outs) submitted from the public inventory page (`lager.jsp`) or the QR action page (`qr_action.jsp`). It acts as the endpoint for these state-changing operations, delegating the complex transactional logic to the `StorageService`.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It receives form data, performs basic validation, and then calls the **Service Tier** (`StorageService`) to execute the core business logic. It should not contain any transaction management or complex logic itself.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `StorageService`.\n    *   `StorageService`: The service that handles the transactional logic of checking items in or out.\n    *   `CSRFUtil`: Used for security validation on the POST request.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doPost(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles POST requests to perform a storage transaction.\n        *   **Logic:**\n            1.  **Security & Validation:** It validates the CSRF token and retrieves the logged-in `User` from the session.\n            2.  **Parameter Parsing:** It parses all necessary parameters from the request: `itemId`, `quantity`, `type` (\"checkout\" or \"checkin\"), `notes`, and the optional `eventId`.\n            3.  **Service Call:** It calls `storageService.processTransaction()` with the parsed parameters. This single method call handles the entire transactional operation.\n            4.  **Feedback & Redirect:** Based on the boolean result from the service call, it sets either a `successMessage` or an `errorMessage` in the user''s session.\n            5.  It then redirects the user back to their original page (either `/lager` or the QR action page, determined by the `redirectUrl` parameter).'),
('src/main/java/de/technikteam/servlet/TaskActionServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves as a dedicated controller for all actions related to event tasks. It handles a variety of POST requests for creating, updating, deleting, and changing the status of tasks, as well as user-specific actions like claiming or un-claiming a task.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Web/Controller Tier**. It acts as a command handler for task-related operations, primarily receiving requests from the `eventDetails.jsp` page. It coordinates between user actions and the `EventTaskDAO`, and performs necessary authorization checks.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `EventTaskDAO`, `EventDAO`, and `AdminLogService`.\n    *   `EventTaskDAO`: The primary DAO for all task-related database operations.\n    *   `EventDAO`: Used to fetch event details for authorization checks (e.g., to verify if the current user is the event leader).\n    *   `AdminLogService`: To log administrative actions like creating or deleting tasks.\n    *   `CSRFUtil`: For security validation on all POST requests.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doPost(HttpServletRequest request, HttpServletResponse response)`**:\n        *   **Purpose:** The main entry point that routes requests based on the `action` parameter.\n        *   **Logic:** After authenticating the user and validating the CSRF token, it uses a `switch` statement to delegate to the appropriate handler method (`handleSaveTask`, `handleDeleteTask`, etc.).\n\n    *   **`handleSaveTask(...)`**:\n        *   **Purpose:** Handles both creation and updating of a task.\n        *   **Logic:**\n            1.  Performs an authorization check: only an admin or the event leader can save a task.\n            2.  It constructs an `EventTask` object from the request parameters.\n            3.  It determines if it''s a create or update based on the presence of a `taskId`.\n            4.  It collects arrays of associated data (assigned user IDs, required item IDs, etc.) from the request.\n            5.  It calls the transactional `taskDAO.saveTask()` method, which handles saving the task and all its relationships.\n            6.  Logs the action and sets a session message before redirecting back to the event details page.\n\n    *   **`handleDeleteTask(...)`**:\n        *   **Purpose:** Deletes a task.\n        *   **Logic:** Performs an authorization check (admin or event leader), then calls `taskDAO.deleteTask()`, logs the action, sets a session message, and redirects.\n\n    *   **`handleUserTaskAction(...)`**:\n        *   **Purpose:** Handles actions that a regular participant can perform on a task.\n        *   **Logic:**\n            *   For `updateStatus` (e.g., marking as \"ERLEDIGT\"), it checks if the user is an admin, the leader, or an assignee of the task.\n            *   For `claim` and `unclaim`, it checks if the user is a participant in the event.\n            *   It then calls the appropriate `EventTaskDAO` method to perform the action.'),
('src/main/java/de/technikteam/util/CSRFUtil.java', '1.  **File Overview & Purpose**\n\n    This is a critical security utility class that provides methods to protect the application against Cross-Site Request Forgery (CSRF) attacks. It implements the synchronizer token pattern by generating a secure, random token, storing it in the user''s session, and providing a method to validate that incoming state-changing requests include this same token.\n\n2.  **Architectural Role**\n\n    This is a cross-cutting **Security/Utility** component. It is used throughout the **Web/Controller Tier**. The `storeToken` method is called by the `LoginServlet`, and the `isTokenValid` method is called at the beginning of the `doPost` method of nearly every servlet that handles form submissions.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `java.security.SecureRandom`: Used to generate cryptographically strong random bytes for the token.\n    *   `java.util.Base64`: Used to encode the random bytes into a URL-safe string.\n\n4.  **In-Depth Breakdown**\n\n    *   **`storeToken(HttpSession session)`**:\n        *   **Purpose:** Generates a new CSRF token and saves it in the user''s session.\n        *   **Logic:** It calls the private `generateToken()` method and sets the result as a session attribute with the key `\"csrfToken\"`. This should be called upon successful login to establish the initial token.\n\n    *   **`generateToken()`**:\n        *   **Purpose:** A private helper to create a secure, random token.\n        *   **Logic:** It uses `SecureRandom` to generate 32 random bytes and then Base64-encodes them into a URL-safe, padding-free string.\n\n    *   **`isTokenValid(HttpServletRequest request)`**:\n        *   **Purpose:** The main validation method. It compares the token submitted in a request parameter with the token stored in the session.\n        *   **Logic:** It retrieves the token from the session and the token from the request parameter named `\"csrfToken\"`. It performs null/empty checks and then uses `Objects.equals()` for a timing-attack-safe comparison. It returns `true` only if both tokens exist and are identical.\n\n    *   **`getCsrfInputField(HttpSession session)`**: A utility method intended for use in JSPs (though the project uses direct EL `$${sessionScope.csrfToken}` instead). It generates the complete `<input type=\"hidden\" ...>` HTML tag needed in forms.'),
('src/main/java/de/technikteam/util/DaoUtils.java', '1.  **File Overview & Purpose**\n\n    This is a small utility class that provides common helper methods for DAO classes. Its purpose is to encapsulate reusable database-related logic, reducing code duplication across the DAO layer.\n\n2.  **Architectural Role**\n\n    This is a utility class for the **DAO (Data Access) Tier**.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `java.sql.ResultSet`: The JDBC class it operates on.\n\n4.  **In-Depth Breakdown**\n\n    *   **`hasColumn(ResultSet rs, String columnName)`**\n        *   **Method Signature:** `public static boolean hasColumn(ResultSet rs, String columnName) throws SQLException`\n        *   **Purpose:** Safely checks if a given `ResultSet` contains a column with a specific name, ignoring case.\n        *   **Logic:** It retrieves the `ResultSetMetaData`, iterates through all columns, and compares the provided `columnName` with each column''s name in a case-insensitive manner.\n        *   **Use Case:** This is extremely useful in DAOs that perform complex JOINs where a column might be present in some results but not others (e.g., `holder_username` in `StorageDAO`). Using this check before calling `rs.getString(\"columnName\")` prevents a `SQLException` if the column doesn''t exist for a particular row.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/util/MarkdownUtil.java', '1.  **File Overview & Purpose**\n\n    This is a security utility class designed to sanitize user-provided Markdown content. It strips out potentially dangerous HTML tags and attributes (like `<script>` tags and `onclick` handlers) to prevent Cross-Site Scripting (XSS) vulnerabilities before the content is stored or rendered.\n\n2.  **Architectural Role**\n\n    This is a cross-cutting **Security/Utility** component. It is used in the **Web/Controller Tier** (specifically in WebSocket endpoints like `DocumentEditorSocket` and `EventChatSocket`) to clean user input before it is broadcast to other clients or saved.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `java.util.regex.Pattern`: The core Java class for regular expressions, used to define the sanitization rules.\n\n4.  **In-Depth Breakdown**\n\n    *   **Static Patterns:**\n        *   `SCRIPT_PATTERN`: Matches and removes entire `<script>...</script>` blocks.\n        *   `ON_ATTRIBUTE_PATTERN`: Matches and removes any HTML attribute that starts with \"on\" (e.g., `onclick`, `onmouseover`).\n        *   `JAVASCRIPT_URI_PATTERN`: Matches and neutralizes `href` or `src` attributes that use the `javascript:` pseudo-protocol.\n    *   **`sanitize(String markdown)`**\n        *   **Method Signature:** `public static String sanitize(String markdown)`\n        *   **Purpose:** Applies a series of regular expression replacements to remove malicious content from a string.\n        *   **Parameters:**\n            *   `markdown` (String): The raw, potentially unsafe, user-submitted string.\n        *   **Returns:** A sanitized version of the string, safe for rendering in an HTML context (after being processed by a Markdown parser).\n        *   **Side Effects:** None.'),
('src/main/java/de/technikteam/util/NavigationRegistry.java', '1.  **File Overview & Purpose**\n\n    This class serves as a centralized, static registry for all navigation links in the application''s sidebar. It defines the complete set of possible navigation items and provides a single method to generate a user-specific list of links based on their assigned permissions. This approach ensures a single source of truth for the site''s navigation structure and access control.\n\n2.  **Architectural Role**\n\n    This is a **Configuration/Utility** class that primarily supports the **Web/Controller Tier**. It is called by the `LoginServlet` to populate the user''s session with their authorized navigation menu, which is then rendered by `main_header.jspf` on every page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `Permissions`: The class containing all permission key constants.\n    *   `NavigationItem` (Model): The object used to represent each link.\n    *   `User` (Model): The user object, which contains the permissions used for filtering.\n\n4.  **In-Depth Breakdown**\n\n    *   **`ALL_ITEMS` (static List)**: A static list that is initialized once with `NavigationItem` objects for every possible link in the application, for both the user and admin sections. Each item is defined with its label, URL, icon, and the required permission key. Links available to all authenticated users have a `null` permission.\n    *   **`getNavigationItemsForUser(User user)`**\n        *   **Method Signature:** `public static List<NavigationItem> getNavigationItemsForUser(User user)`\n        *   **Purpose:** To filter the master `ALL_ITEMS` list down to only those items the provided user is authorized to see.\n        *   **Parameters:**\n            *   `user` (User): The currently logged-in user.\n        *   **Returns:** A `List` of `NavigationItem` objects that should be rendered in the sidebar for that user.\n        *   **Logic:** It uses a Java Stream to filter `ALL_ITEMS`. An item is included if:\n            1.  Its required permission is `null` (it''s a public link for logged-in users).\n            2.  The user has the master `ACCESS_ADMIN_PANEL` permission.\n            3.  The user has the specific permission required by the item.\n            4.  It handles special cases like `ADMIN_DASHBOARD_ACCESS` and `ACHIEVEMENT_VIEW`, which are meta-permissions that depend on the user having *any* other relevant admin permission.'),
('src/main/java/de/technikteam/util/PasswordPolicyValidator.java', '1.  **File Overview & Purpose**\n\n    This is a utility class for enforcing a strong password policy. It provides a single static method to validate a given password against a set of predefined complexity rules (minimum length, character types). This ensures that all new passwords set in the application, whether during user creation or a password change, meet the required security standards.\n\n2.  **Architectural Role**\n\n    This is a cross-cutting **Security/Utility** component. It is used in the **Web/Controller Tier** by the `PasswordServlet` and in the **Service Tier** via the `CreateUserAction` to validate passwords before they are hashed and stored.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `java.util.regex.Pattern`: Used to define the regular expressions for checking character types.\n\n4.  **In-Depth Breakdown**\n\n    *   **Static Patterns & Constants**:\n        *   `MIN_LENGTH`: Defines the minimum required password length.\n        *   `HAS_UPPERCASE`, `HAS_LOWERCASE`, `HAS_DIGIT`, `HAS_SPECIAL_CHAR`: Pre-compiled `Pattern` objects for efficient checking of required character types.\n    *   **`ValidationResult` (Inner Class)**: A simple record-like class to return both a boolean `isValid` status and a user-friendly `message` explaining the result.\n    *   **`validate(String password)`**\n        *   **Method Signature:** `public static ValidationResult validate(String password)`\n        *   **Purpose:** The main validation logic.\n        *   **Logic:**\n            1.  It checks for null or empty passwords.\n            2.  It creates a list of error messages.\n            3.  It checks the password against each rule (`MIN_LENGTH`, `HAS_UPPERCASE`, etc.) and adds a descriptive error string to the list for each rule that fails.\n            4.  If the `errors` list is empty, it returns a successful `ValidationResult`.\n            5.  If there are errors, it joins them into a single, comprehensive error message (e.g., \"Das Passwort muss mindestens 10 Zeichen lang sein, mindestens einen Großbuchstaben enthalten.\") and returns a failed `ValidationResult`.'),
('src/main/java/de/technikteam/websocket/ChatSessionManager.java', '1.  **File Overview & Purpose**\n\n    This class is a thread-safe singleton manager for WebSocket sessions related to event chats. It maintains a map of active chat rooms, where each room (keyed by an event ID) contains a set of connected user sessions. This allows for targeted message broadcasting to all participants in a specific event''s chat.\n\n2.  **Architectural Role**\n\n    This is a core **Infrastructure** component for the real-time communication feature, operating within the **Web/Controller Tier**. It is exclusively used by the `EventChatSocket` WebSocket endpoint to manage session lifecycle and broadcast messages.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Jakarta WebSocket API (`jakarta.websocket.Session`)**: The object representing a single client connection.\n    *   `java.util.concurrent.ConcurrentHashMap` & `CopyOnWriteArraySet`: Thread-safe collection classes are used to safely manage sessions from multiple concurrent WebSocket threads.\n\n4.  **In-Depth Breakdown**\n\n    *   **Singleton Implementation**: Uses a private constructor and a static `INSTANCE` field to ensure only one manager exists per application.\n    *   **`sessionsByEvent` (Map)**: The central data structure. The key is the `eventId` as a string, and the value is a `CopyOnWriteArraySet` of `Session` objects. `CopyOnWriteArraySet` is chosen for its thread-safety, being particularly efficient when reads and iterations are more common than writes (add/remove).\n    *   **`addSession(String eventId, Session session)`**: Adds a new user''s session to the set for the corresponding event room.\n    *   **`removeSession(String eventId, Session session)`**: Removes a user''s session when they disconnect. If a room becomes empty, it is removed from the main map to conserve memory.\n    *   **`broadcast(String eventId, String message)`**: Sends a message to *every* active and open session in a specific event room.\n    *   **`broadcastExcept(String eventId, String message, Session excludeSession)`**: Sends a message to every active session in a room *except* the one that originated the message. This is used to prevent a user from receiving an echo of their own message.'),
('src/main/java/de/technikteam/websocket/DocumentEditorSocket.java', '1.  **File Overview & Purpose**\n\n    This class is a WebSocket endpoint that enables real-time, collaborative editing of Markdown files. It manages WebSocket connections for specific document editing sessions, receives content updates from one client, sanitizes them, saves them to the file system, and broadcasts the changes to all other clients editing the same document.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It provides the server-side logic for the real-time editor feature. It interacts with the `DocumentSessionManager` for session handling, the `FileDAO` for persistence, and the `MarkdownUtil` for security.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Uses static injection to receive a `FileDAO` instance from Guice.\n    *   **Jakarta WebSocket API (`@ServerEndpoint`, `@OnOpen`, etc.)**: The core annotations for defining a WebSocket endpoint.\n    *   `DocumentSessionManager`: The singleton used to manage sessions for different document rooms.\n    *   `FileDAO`: To read the file path and write updated content to the disk.\n    *   `MarkdownUtil`: For sanitizing user-provided content to prevent XSS.\n    *   **Gson**: For parsing incoming JSON messages.\n\n4.  **In-Depth Breakdown**\n\n    *   **`onOpen(...)`**:\n        *   **Purpose:** Handles a new client connection.\n        *   **Logic:** It retrieves the `User` object from the `EndpointConfig` (placed there by the `GuiceAwareServerEndpointConfigurator`). It performs an authorization check to ensure the user has `FILE_UPDATE` permission. If authorized, it adds the session to the `DocumentSessionManager` for the given `fileId`. If not, it closes the connection.\n    *   **`onMessage(...)`**:\n        *   **Purpose:** Receives a message from a client.\n        *   **Logic:** It parses the incoming JSON message. If the message `type` is `\"content_update\"`, it calls `handleContentUpdate`.\n    *   **`handleContentUpdate(...)`**:\n        *   **Purpose:** The core logic for processing a content change.\n        *   **Logic:**\n            1.  It retrieves the `File` metadata from the `FileDAO` to get the physical `filepath`.\n            2.  It sanitizes the received `content` using `MarkdownUtil.sanitize()`.\n            3.  It calls `fileDAO.updateFileContent()` to write the new content to the physical file.\n            4.  It calls `fileDAO.touchFileRecord()` to update the file''s modification timestamp.\n            5.  It constructs a broadcast message and uses `DocumentSessionManager.broadcastExcept()` to send the updated content to all other clients in the same editing session.\n    *   **`onClose(...)`** and **`onError(...)`**: Standard methods to handle session disconnection and errors by removing the session from the manager and logging the error.'),
('src/main/java/de/technikteam/websocket/DocumentSessionManager.java', '1.  **File Overview & Purpose**\n\n    This class is a thread-safe singleton manager for WebSocket sessions related to the collaborative document editor. It mirrors the functionality of `ChatSessionManager` but is specifically for document editing rooms, mapping file IDs to sets of connected editor sessions.\n\n2.  **Architectural Role**\n\n    This is an **Infrastructure** component within the **Web/Controller Tier**. It is used exclusively by the `DocumentEditorSocket` to manage session lifecycle and broadcast document updates.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Jakarta WebSocket API (`jakarta.websocket.Session`)**: The object representing a single client connection.\n    *   `java.util.concurrent.ConcurrentHashMap` & `CopyOnWriteArraySet`: Thread-safe collections for managing sessions.\n\n4.  **In-Depth Breakdown**\n\n    This class''s implementation is nearly identical to `ChatSessionManager`, but for a different domain.\n    *   **Singleton Implementation**: Standard private constructor and `getInstance()` method.\n    *   **`sessionsByFile` (Map)**: The central map where the key is the `fileId` (as a string) and the value is a `CopyOnWriteArraySet` of `Session` objects.\n    *   **`addSession(String fileId, Session session)`**: Adds a session to the room for a given file.\n    *   **`removeSession(String fileId, Session session)`**: Removes a session and cleans up the room if it becomes empty.\n    *   **`broadcastExcept(String fileId, String message, Session excludeSession)`**: Broadcasts a message (the new document content) to all clients editing the file *except* the client who sent the update.'),
('src/main/java/de/technikteam/websocket/EventChatSocket.java', '1.  **File Overview & Purpose**\n\n    This class is the WebSocket endpoint that powers the real-time chat feature for events. It manages client connections for specific event chat rooms, processes incoming messages (new, edit, delete), persists them to the database, and broadcasts them to all participants in the room. It also handles advanced features like user mentions.\n\n2.  **Architectural Role**\n\n    This is a key component of the **Web/Controller Tier**. It provides the real-time communication layer for events. It interacts with the `ChatSessionManager` for session management and various DAOs (`EventChatDAO`, `EventDAO`, `UserDAO`) for data persistence and validation.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Uses static injection to receive DAO and service instances from Guice.\n    *   **Jakarta WebSocket API (`@ServerEndpoint`, etc.)**: The core WebSocket annotations.\n    *   `ChatSessionManager`: To manage sessions and broadcast messages.\n    *   `EventChatDAO`: To save, update, and delete messages in the database.\n    *   `EventDAO`: To verify user association with the event.\n    *   `UserDAO`: To look up users for mentions.\n    *   `NotificationService`: To send out-of-app notifications for mentions.\n    *   `MarkdownUtil`: For sanitizing message content.\n\n4.  **In-Depth Breakdown**\n\n    *   **`onOpen(...)`**: Handles new connections. It authorizes the user by checking if they are associated with the event (`eventDAO.isUserAssociatedWithEvent`). If so, it adds their session to the `ChatSessionManager`.\n    *   **`onMessage(...)`**: The main message router. It parses the incoming JSON message and delegates to a specific handler based on the message `type`.\n    *   **`handleNewMessage(...)`**: Sanitizes the message content, saves it to the database via `chatDAO.postMessage()`, broadcasts the saved message (now with an ID and timestamp) to all clients in the room, and calls `handleMentions()`.\n    *   **`handleUpdateMessage(...)`**: Handles a message edit request. It calls `chatDAO.updateMessage()`, which verifies that the user is the original author, and then broadcasts the update to all clients.\n    *   **`handleDeleteMessage(...)`**: Handles a message delete request. It calls `chatDAO.deleteMessage()`, which performs a soft delete and checks if the user is the author or an admin/leader. It then broadcasts a special `message_soft_deleted` event to clients.\n    *   **`handleMentions(...)`**: Parses the message text for `@username` patterns. For each valid mention of a user who is not the sender, it sends a targeted, out-of-app notification via the `NotificationService`.'),
('src/main/java/de/technikteam/websocket/GetHttpSessionConfigurator.java', '1.  **File Overview & Purpose**\n\n    This is a custom WebSocket `ServerEndpointConfig.Configurator`. Its purpose is to intercept the WebSocket handshake process to extract the `HttpSession` from the initial HTTP upgrade request. It then retrieves the authenticated `User` object from the session and places it into the WebSocket session''s user properties map, making it accessible to the WebSocket endpoint''s methods (`@OnOpen`, `@OnMessage`, etc.).\n\n2.  **Architectural Role**\n\n    This is a critical **Infrastructure/Configuration** component for the WebSocket layer. It bridges the gap between the standard HTTP session-based authentication and the WebSocket protocol, enabling secure, authenticated WebSocket communication.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Jakarta WebSocket API (`ServerEndpointConfig.Configurator`)**: The base class it extends.\n    *   `User` (Model): The object it retrieves from the `HttpSession`.\n\n4.  **In-Depth Breakdown**\n\n    *   **`USER_PROPERTY_KEY`**: A static constant defining the key used to store the `User` object in the WebSocket session''s user properties.\n    *   **`servletContext`**: A static volatile field to hold a reference to the `ServletContext`, which is needed by the `GuiceAwareServerEndpointConfigurator`.\n    *   **`modifyHandshake(...)`**:\n        *   **Purpose:** This method is called by the WebSocket container during the handshake.\n        *   **Logic:**\n            1.  It accesses the `HttpSession` from the `HandshakeRequest`.\n            2.  If a session exists, it retrieves the `User` object stored under the attribute key `\"user\"`.\n            3.  If a `User` object is found, it adds it to the `ServerEndpointConfig`''s user properties map using the `USER_PROPERTY_KEY`. This makes the user object available within the WebSocket endpoint instance.\n            4.  It also caches a reference to the `ServletContext` for Guice integration.'),
('src/main/java/de/technikteam/websocket/GuiceAwareServerEndpointConfigurator.java', '1.  **File Overview & Purpose**\n\n    This is a custom WebSocket `ServerEndpointConfig.Configurator` that integrates Google Guice with the Jakarta WebSocket lifecycle. Its primary function is to ensure that WebSocket endpoint instances (like `EventChatSocket`) are created by the Guice `Injector` instead of the container''s default mechanism. This allows for dependency injection into the WebSocket classes.\n\n2.  **Architectural Role**\n\n    This is a core **Infrastructure/Configuration** component that enables dependency injection for the WebSocket layer. It is declared on each `@ServerEndpoint` annotation (e.g., `@ServerEndpoint(value = \"/ws/chat/{eventId}\", configurator = GuiceAwareServerEndpointConfigurator.class)`).\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Guice (`com.google.inject.Injector`)**: The dependency injection container.\n    *   **Jakarta WebSocket API (`ServerEndpointConfig.Configurator`)**: The base class it extends.\n    *   `GetHttpSessionConfigurator`: It composes this configurator to also handle session extraction during the handshake.\n\n4.  **In-Depth Breakdown**\n\n    *   **`getEndpointInstance(Class<T> endpointClass)`**:\n        *   **Purpose:** This method is called by the WebSocket container when it needs a new instance of an endpoint class. This override intercepts that call.\n        *   **Logic:**\n            1.  It retrieves the `ServletContext` (which was cached by `GetHttpSessionConfigurator`).\n            2.  It retrieves the Guice `Injector` from the `ServletContext` attributes (where it was placed by the `GuiceConfig` listener).\n            3.  It calls `injector.getInstance(endpointClass)` to have Guice create the endpoint instance. This handles constructor injection.\n            4.  It then calls `injector.injectMembers(instance)`. This crucial step performs member injection, including `@Inject` on static fields, which is the pattern used by the WebSocket endpoints in this project.\n        *   **Returns:** A fully dependency-injected instance of the WebSocket endpoint.\n\n    *   **`modifyHandshake(...)`**: This method is also overridden to ensure that the logic from `GetHttpSessionConfigurator` (extracting the user from the session) is also executed during the handshake process.'),
('src/main/resources/log4j2.xml', '1.  **File Overview & Purpose**\n\n    This is the configuration file for the Log4j 2 logging framework. It defines how log messages generated by the application are formatted and where they are sent. This configuration uses a JSON Template Layout for structured logging.\n\n2.  **Architectural Role**\n\n    This is a core **Configuration** file that governs a critical cross-cutting concern: logging. It is loaded by Log4j at application startup.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Log4j 2**: The logging framework this file configures.\n\n4.  **In-Depth Breakdown**\n\n    *   **`<Configuration>`**: The root element. `status=\"WARN\"` means that Log4j will only report its own internal status messages if they are at the WARN level or higher.\n    *   **`<Appenders>`**: Defines the destinations for log messages.\n        *   **`<Console name=\"Console\">`**: Defines an appender that writes to the standard console output (e.g., the Tomcat log file or terminal).\n        *   **`<JsonTemplateLayout>`**: Specifies that log messages should be formatted as JSON objects. The structure of these objects is defined in the `Log4j2JsonTemplate.json` file (not provided, but would typically include fields like timestamp, level, loggerName, message, and stack trace). This is highly beneficial for log aggregation and analysis tools.\n    *   **`<Loggers>`**: Configures which log messages are captured.\n        *   **`<Root level=\"info\">`**: The default logger. It captures all messages at the `INFO` level and higher from any class and sends them to the \"Console\" appender.\n        *   **`<Logger name=\"de.technikteam\" level=\"debug\">`**: A specific logger for the application''s own packages. It sets the logging level to `DEBUG`, which is more verbose than the root logger. `additivity=\"false\"` prevents messages from being passed up to the root logger, avoiding duplicate log output.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/webapp/css/style.css', '1.  **File Overview & Purpose**\n\n    This is the main and only stylesheet for the entire TechnikTeam application. It defines the visual appearance of all pages, components, and elements. It uses a modern, component-based approach with CSS variables for theming, responsive design with media queries, and specific styles for various application states.\n\n2.  **Architectural Role**\n\n    This file is the core of the **View/Client-Side Tier''s** presentation layer. It is included in `main_header.jspf` and thus applied to every page of the application.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **FontAwesome**: While not directly imported, the HTML relies on FontAwesome classes (e.g., `fa-home`, `fa-users-cog`), which are loaded via a CDN link in `main_header.jspf`. This stylesheet provides styling for those icons.\n\n4.  **In-Depth Breakdown**\n\n    *   **Section 1: Theme & Color Palette**:\n        *   Defines CSS custom properties (variables) for the entire color scheme, spacing, and layout dimensions (e.g., `--primary-color`, `--sidebar-width`).\n        *   Includes a `[data-theme=\"dark\"]` block that overrides these variables to provide a complete dark mode theme.\n    *   **Section 2: Base & Typography**:\n        *   Provides a CSS reset (`* { box-sizing: border-box; ... }`).\n        *   Sets base font styles, sizes, and colors for the body, headings (`h1`, `h2`, etc.), and links.\n    *   **Section 3: Layout & Containers**:\n        *   Defines the main layout structure, including the sidebar and main content area.\n        *   Styles the primary container element, `.card`, which is used ubiquitously for content blocks.\n        *   Defines the `.dashboard-grid` for responsive, multi-column layouts.\n    *   **Section 4: Navigation**:\n        *   Contains all styles for the desktop sidebar (`.sidebar`) and the mobile header (`.mobile-header`).\n        *   Includes styles for the \"hamburger\" menu toggle (`.mobile-nav-toggle`) and the page overlay (`.page-overlay`) for mobile view.\n    *   **Section 5: Components**:\n        *   Defines styles for reusable components like buttons (`.btn`), form elements (`.form-group`), modals (`.modal-overlay`), and message banners (`.success-message`).\n    *   **Section 6: Tables & Responsive Lists**:\n        *   Styles for standard data tables (`.data-table`).\n        *   Defines the mobile-first \"card list\" (`.mobile-card-list`) and uses media queries to switch to the desktop table view (`.desktop-table-wrapper`) on larger screens.\n    *   **Section 7: Utility & Page-Specific**: Contains miscellaneous styles for specific pages like the login box, QR action page, and the admin matrix''s sticky headers/columns.\n    *   **Subsequent Sections**: Include styles for error pages, the real-time chat interface, the Markdown editor, print media, and the custom calendar views.'),
('src/main/webapp/js/main.js', '1.  **File Overview & Purpose**\n\n    This is the global JavaScript file included on every page of the application. It handles core UI functionalities such as mobile navigation, theme switching, persistent sidebar scrolling, and the setup of global components like the confirmation modal and the real-time notification system (Server-Sent Events).\n\n2.  **Architectural Role**\n\n    This file is a central component of the **View/Client-Side Tier**. It provides the foundational interactive behavior for the entire application.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `marked.js`: A client-side library for converting Markdown text into HTML.\n    *   `diff_match_patch.js`: A library for text comparison, likely used by the editor.\n\n4.  **In-Depth Breakdown**\n\n    *   **`DOMContentLoaded` Listener**: The entire script is wrapped in this event listener to ensure the DOM is fully loaded before any scripts are executed.\n\n    *   **Global Password Visibility Toggle**: An event listener on the `document.body` uses event delegation to handle clicks on any `.password-toggle-icon`. It toggles the associated password input field''s type between `password` and `text`.\n\n    *   **Mobile Navigation**: Manages the toggling of the `nav-open` class on the `<body>` element when the mobile hamburger menu icon (`.mobile-nav-toggle`) or the overlay (`.page-overlay`) is clicked.\n\n    *   **Active Nav Link Highlighting**: On page load, it determines the current URL path and adds an `active-nav-link` class to the corresponding link in the sidebar, providing visual feedback to the user about their location in the application.\n\n    *   **Theme Switcher**:\n        *   Initializes the theme based on the `data-theme` attribute on the `<html>` tag (set by the server) or a value from `localStorage`.\n        *   Listens for changes on the theme toggle switches.\n        *   When toggled, it updates the `data-theme` attribute on the `<html>` element, saves the new theme to `localStorage` for persistence, and sends an asynchronous `fetch` request to `/api/user/preferences` to save the preference on the server.\n\n    *   **Global Confirmation Modal (`showConfirmationModal`)**:\n        *   It dynamically creates and injects a confirmation modal into the DOM.\n        *   It exposes a global function `window.showConfirmationModal(message, onConfirm)` that can be called from any other script to show a confirmation dialog.\n        *   It attaches event listeners to forms with the `.js-confirm-form` class, intercepting their submission to first show the confirmation modal.\n\n    *   **Global Toast Notifications (`showToast`)**:\n        *   Exposes a global function `window.showToast(message, type)` that dynamically creates and displays a short-lived notification message at the bottom of the screen.\n\n    *   **Server-Sent Events (SSE) Notifications**:\n        *   If the user is logged in, it establishes an SSE connection to the `/notifications` endpoint.\n        *   The `onmessage` handler parses the incoming event data. It distinguishes between different event types:\n            *   `ui_update`: Calls the `handleUIUpdate` function to process real-time updates to the page content (e.g., a user''s role changing).\n            *   `logout_notification`: Shows a toast and forces a logout after a delay.\n            *   Other types: Calls `showBrowserNotification` to display a desktop notification.\n\n    *   **`handleUIUpdate(payload)`**: A function that acts as a router for different real-time UI updates broadcast by the server. It finds the relevant elements on the current page and updates their content or state without a full page reload.\n\n    *   **`showBrowserNotification(payload)`**: A function that handles the logic for requesting permission and displaying native browser desktop notifications.'),
('src/main/webapp/js/admin/admin_achievements.js', '1.  **File Overview & Purpose**\n\n    This JavaScript file provides the client-side interactivity for the \"Erfolge & Abzeichen verwalten\" (Manage Achievements & Badges) page (`admin_achievements.jsp`). It handles the logic for the create/edit modal, including dynamically building the achievement key and fetching data for existing achievements via AJAX.\n\n2.  **Architectural Role**\n\n    This script is part of the **View/Client-Side Tier**. It enhances the static HTML served by the `AdminAchievementServlet` with dynamic behavior.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This is a self-contained script using standard browser APIs.\n\n4.  **In-Depth Breakdown**\n\n    *   **DOM Element Caching**: At the start, it gets and stores references to the modal and all its form elements.\n    *   **`updateKey()` function**: This is the core logic for the \"create\" modal.\n        *   It reads the value from the \"Art des Erfolgs\" (Type of Achievement) dropdown.\n        *   Based on the selected type (`EVENT_PARTICIPANT`, `QUALIFICATION`, etc.), it shows or hides the relevant sub-form groups (for number input or course selection).\n        *   It constructs the programmatic `achievement_key` string by concatenating the selected values (e.g., `EVENT_PARTICIPANT_5`).\n        *   It updates a preview element (`#generated-key-preview`) for the admin to see and sets the value of a hidden input field (`#achievement-key-hidden`) that will be submitted with the form.\n    *   **\"New Achievement\" Button Listener**:\n        *   Attaches a `click` listener to `#new-achievement-btn`.\n        *   When clicked, it resets the form, sets the modal title to \"Neuen Erfolg anlegen\", sets the form''s `action` to \"create\", and ensures the dynamic key builder is visible.\n    *   **\"Edit Achievement\" Button Listener**:\n        *   Attaches `click` listeners to all `.edit-achievement-btn` buttons.\n        *   When clicked, it triggers an asynchronous `fetch` request to the `AdminAchievementServlet`''s API endpoint (`?action=getAchievementData&id=...`).\n        *   **AJAX Call**:\n            *   **URL:** `/admin/achievements?action=getAchievementData&id=[ID]`\n            *   **Method:** `GET`\n            *   **Trigger:** Clicking an \"Edit\" button.\n        *   Upon receiving a successful JSON response, it populates the modal''s form fields with the fetched achievement data, sets the `action` to \"update\", and hides the key builder (since keys are immutable).'),
('src/main/webapp/js/admin/admin_course_list.js', '1.  **File Overview & Purpose**\n\n    This JavaScript file provides the client-side logic for the \"Lehrgangs-Vorlagen verwalten\" (Manage Course Templates) page (`admin_course_list.jsp`). It primarily handles the create/edit modal, fetching data for existing course templates to pre-fill the form.\n\n2.  **Architectural Role**\n\n    This script is part of the **View/Client-Side Tier**. It adds dynamic functionality to the `admin_course_list.jsp` page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This script uses standard browser APIs.\n\n4.  **In-Depth Breakdown**\n\n    *   **\"New Template\" Button Listener**:\n        *   Attaches a `click` listener to `#new-course-btn`.\n        *   When clicked, it resets the modal form, sets the title to indicate creation, and sets the hidden `action` input''s value to `\"create\"`.\n    *   **\"Edit Template\" Button Listeners**:\n        *   Attaches `click` listeners to all `.edit-course-btn` buttons.\n        *   When an edit button is clicked, it sets the modal title and the hidden `action` input''s value to `\"update\"`.\n        *   It then makes an asynchronous `fetch` request to the `AdminCourseServlet` to get the data for the selected course.\n        *   **AJAX Call**:\n            *   **URL:** `/admin/lehrgaenge?action=getCourseData&id=[ID]`\n            *   **Method:** `GET`\n            *   **Trigger:** Clicking an \"Edit\" button.\n        *   On success, it parses the JSON response and populates the modal''s input fields (`name`, `abbreviation`, `description`) with the fetched data.'),
('src/main/webapp/js/admin/admin_dashboard.js', '1.  **File Overview & Purpose**\n\n    This script provides the dynamic, auto-refreshing functionality for the Admin Dashboard (`admin_dashboard.jsp`). It makes an AJAX call to fetch all necessary widget data and then uses this data to render the content of the widgets and the event trend chart.\n\n2.  **Architectural Role**\n\n    This script is a key component of the **View/Client-Side Tier**. It is responsible for making the admin dashboard a live, interactive view of the system''s current state.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Chart.js**: An external charting library used to render the event trend graph.\n\n4.  **In-Depth Breakdown**\n\n    *   **`fetchData()` function**:\n        *   **Purpose:** The core function that fetches and renders all dashboard data.\n        *   **AJAX Call**:\n            *   **URL:** `/api/admin/dashboard-data`\n            *   **Method:** `GET`\n            *   **Trigger:** On page load and every 60 seconds thereafter.\n        *   **Logic:**\n            1.  Makes a `fetch` request to the API endpoint.\n            2.  On success, it receives a JSON object (`DashboardDataDTO`) containing lists of upcoming events, low-stock items, recent logs, and chart data.\n            3.  It then calls separate render functions for each piece of data (`renderUpcomingEvents`, `renderLowStockItems`, etc.).\n    *   **Render Functions (`render...`)**:\n        *   Each function (`renderUpcomingEvents`, `renderLowStockItems`, `renderRecentLogs`) is responsible for taking a list of data objects and generating the appropriate HTML to display within its corresponding widget container.\n        *   They handle the case where no data is available by displaying an appropriate message.\n        *   `renderLowStockItems` also dynamically creates and prepends an alert banner if there are items with low stock.\n    *   **`renderEventTrendChart(trendData)`**:\n        *   This function takes the time-series data for the event trend.\n        *   It configures a `Chart.js` line chart with the appropriate labels, data, and styling options.\n        *   It destroys any existing chart instance before creating a new one to prevent memory leaks on refresh.\n    *   **Initialization**: The script calls `fetchData()` once on page load and then sets up a `setInterval` to call `fetchData()` again every 60 seconds, keeping the dashboard data fresh.'),
('src/main/webapp/js/admin/admin_defect_list.js', '1.  **File Overview & Purpose**\n\n    This JavaScript file provides the client-side logic for the \"Defekte Artikel verwalten\" (Manage Defective Items) page. Its sole responsibility is to handle the opening of the modal for editing an item''s defect status and pre-filling it with the correct data.\n\n2.  **Architectural Role**\n\n    This script is part of the **View/Client-Side Tier**, adding interactivity to the `admin_defect_list.jsp` page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This script uses standard browser APIs.\n\n4.  **In-Depth Breakdown**\n\n    *   **`DOMContentLoaded` Listener**: The script waits for the DOM to be fully loaded.\n    *   **Event Listener on `.defect-modal-btn`**:\n        *   It attaches a `click` event listener to every button with the class `.defect-modal-btn`.\n        *   When a button is clicked, the listener function executes.\n        *   **Logic:**\n            1.  It reads all the necessary data from the button''s `data-*` attributes (e.g., `data-item-id`, `data-item-name`, `data-max-qty`).\n            2.  It uses this data to populate the fields of the defect modal (`#defect-modal`).\n            3.  It sets the `max` attribute on the quantity input to prevent the admin from marking more items as defective than exist in total.\n            4.  The modal itself is shown via the `data-modal-target` attribute, which is handled by the global `main.js` script.'),
('src/main/webapp/js/admin/admin_editor.js', '1.  **File Overview & Purpose**\n\n    This script provides the client-side logic for the real-time collaborative Markdown editor. It manages the WebSocket connection for synchronization, handles the live preview rendering, and controls the view/edit mode toggle.\n\n2.  **Architectural Role**\n\n    This is a complex component of the **View/Client-Side Tier**. It creates a rich, interactive user experience for editing Markdown files.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **marked.js**: The Markdown rendering library, included in the footer.\n    *   **WebSocket API**: The native browser API used for real-time, bidirectional communication with the server (`DocumentEditorSocket`).\n\n4.  **In-Depth Breakdown**\n\n    *   **`connect()` function**:\n        *   **Purpose:** Establishes and manages the WebSocket connection.\n        *   **`socket.onopen`**: Logs a successful connection and updates the status indicator to \"Verbunden\".\n        *   **`socket.onmessage`**: This is the core of the real-time collaboration. When a `content_update` message is received from the server (sent by another user), it updates the editor''s content with the new payload while attempting to preserve the current user''s cursor position. It then re-renders the preview.\n        *   **`socket.onclose`**: Updates the status indicator and schedules a reconnection attempt after 5 seconds.\n        *   **`socket.onerror`**: Logs errors and updates the status indicator.\n    *   **`sendContentUpdate()` function**:\n        *   **Purpose:** Sends the editor''s current content to the server via the WebSocket.\n        *   **Logic:** It constructs a JSON message with `type: ''content_update''` and the editor''s content as the payload, then sends it through the socket. It also provides visual feedback by changing the status indicator to \"Speichern...\".\n    *   **Event Listeners**:\n        *   **`editor.addEventListener(''input'', ...)`**: This is the primary trigger for synchronization.\n            *   On every key press, it immediately calls `renderMarkdown` to update the live preview.\n            *   It uses a `debounceTimer` (`setTimeout`) to call `sendContentUpdate` only after the user has stopped typing for 500ms. This prevents sending a WebSocket message on every single keystroke, reducing network traffic.\n        *   **`toggle.addEventListener(''change'', ...)`**: Handles the view/edit mode switch by toggling the `display` style of the editor and preview panes.'),
('src/main/webapp/js/admin/admin_events_list.js', '1.  **File Overview & Purpose**\n\n    This is a large and complex JavaScript file that provides all the client-side interactivity for the \"Eventverwaltung\" (Event Management) page. It handles the multi-tabbed create/edit modal, dynamic row creation for requirements and reservations, AJAX calls to fetch data, and the \"Crew Finder\" functionality.\n\n2.  **Architectural Role**\n\n    This is a major component of the **View/Client-Side Tier**. It transforms the static `admin_events_list.jsp` into a rich, single-page-application-like interface for managing events.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This script is self-contained and uses standard browser APIs (`fetch`, DOM manipulation).\n\n4.  **In-Depth Breakdown**\n\n    *   **Data Initialization**: It parses JSON data embedded in the JSP for all courses, items, and kits. This data is used to populate dropdowns in dynamically created rows.\n    *   **Assign Users Modal (`openAssignModal`)**:\n        *   **AJAX Call**: `fetch(''/admin/veranstaltungen?action=getAssignmentData&id=...'')`\n        *   **Purpose**: Fetches the list of users who have signed up for an event and the IDs of those who are already assigned to the final team. It then dynamically builds the checklist of users for the assignment modal.\n    *   **Dynamic Row Creation (`addRequirementRow`, `addReservationRow`, `addCustomFieldRow`)**: These functions dynamically create the HTML for new rows in the \"Bedarf\" (Requirements) and \"Material\" tabs of the event modal, allowing admins to add multiple skill requirements or item reservations.\n    *   **Kit Selection Logic**: The `change` listener on the kit dropdown (`#kit-selection-modal`) fetches the contents of the selected kit via an AJAX call and then calls `addReservationRow` for each item in the kit, automatically populating the reservation list.\n    *   **Crew Finder Logic**: The `click` listener on `#find-crew-btn` triggers an AJAX call to the `/api/admin/crew-finder` endpoint. It sends the current `eventId` and receives a list of qualified and available users, which it then uses to populate the Crew Finder modal''s checklist.\n    *   **Event Modal Management (`openEventModal`, `closeEventModal`, `resetEventModal`)**:\n        *   **New Event**: The listener for `#new-event-btn` resets the modal to a blank state and opens it.\n        *   **Edit Event**: Listeners for `.edit-event-btn` trigger an AJAX call to `/admin/veranstaltungen?action=getEventData` to fetch all data for an existing event. The success callback then populates every field and dynamically creates all the necessary rows in all the tabs of the modal before showing it.\n    *   **Tabbed Modal Logic**: Manages the active state for the tabs and content panes within the event modal.'),
('src/main/webapp/js/admin/admin_feedback.js', '1.  **File Overview & Purpose**\n\n    This script provides the interactivity for the administrative \"Feedback Board\" (`admin_feedback.jsp`). Its main functions are to enable drag-and-drop functionality for the feedback cards between status columns and to handle the display and submission of the details modal.\n\n2.  **Architectural Role**\n\n    This script is part of the **View/Client-Side Tier**. It turns the static Kanban board into a dynamic, interactive tool for managing the feedback workflow.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **SortableJS**: A third-party library for creating drag-and-drop lists. It is the core dependency for the reordering functionality.\n\n4.  **In-Depth Breakdown**\n\n    *   **API Object**: The script defines a local `api` object that encapsulates all `fetch` calls to the `FrontControllerServlet`''s feedback actions. This keeps the API interaction logic clean and separate.\n    *   **Details Modal Logic**:\n        *   It attaches a `click` listener to the main board container (`.feedback-board`) using event delegation.\n        *   When a `.feedback-card-item` is clicked, it makes an AJAX call to `feedback.getDetails`.\n        *   **AJAX Call (Details)**: `POST /admin/action/feedback?action=getDetails`\n        *   On success, it populates the details modal with the fetched data and displays it.\n    *   **Modal Form Submission**:\n        *   The `submit` listener on the modal form (`#feedback-details-form`) prevents the default submission.\n        *   It makes an AJAX call to `feedback.updateStatus`, sending the updated status and display title.\n        *   **AJAX Call (Update)**: `POST /admin/action/feedback?action=updateStatus`\n        *   On success, it shows a toast notification and reloads the page to reflect the changes.\n    *   **SortableJS Initialization**:\n        *   It iterates through each column (`.feedback-list`) and initializes `Sortable` on it.\n        *   `group: ''feedback''` allows cards to be dragged between columns.\n        *   `onEnd: handleReorder`: This is the crucial callback. It is triggered after a drag-and-drop operation is completed.\n    *   **`handleReorder(evt)` function**:\n        *   **Purpose**: This function is called by SortableJS when a card is dropped.\n        *   **Logic**:\n            1.  It identifies the card that was moved (`evt.item`), the column it was moved to (`evt.to`), and the new status associated with that column.\n            2.  It creates a `reorderData` object containing the ID of the moved card, its new status, and an array of all card IDs in their new order within the destination column.\n            3.  It sends this data in a single AJAX call to `feedback.reorder`.\n            *   **AJAX Call (Reorder)**: `POST /admin/action/feedback?action=reorder`\n            4.  The server-side `UpdateFeedbackOrderAction` then processes this request within a single transaction, updating the moved card''s status and the `display_order` of all cards in the destination column.'),
('src/main/webapp/js/admin/admin_files.js', '1.  **File Overview & Purpose**\n\n    This JavaScript file provides the client-side interactivity for the \"Datei- & Kategorienverwaltung\" (File & Category Management) page (`admin_files.jsp`). It handles the logic for opening and populating the \"Upload New Version\" and \"Reassign File\" modals.\n\n2.  **Architectural Role**\n\n    This script is part of the **View/Client-Side Tier**. It enhances the static HTML of the file management page with dynamic modal interactions.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This script uses standard browser APIs.\n\n4.  **In-Depth Breakdown**\n\n    *   **\"Upload New Version\" Modal Logic**:\n        *   It attaches a `click` listener to every button with the class `.upload-new-version-btn`.\n        *   When a button is clicked, the listener retrieves the `fileId` and `fileName` from the button''s `data-*` attributes.\n        *   It then populates the hidden `fileId` input and the `<strong>` tag in the modal with this data before displaying the modal.\n\n    *   **\"Reassign File\" Modal Logic**:\n        *   It attaches a `click` listener to every button with the class `.reassign-file-btn`.\n        *   Similar to the upload modal, it retrieves the `fileId` and `fileName` from the button''s attributes.\n        *   It populates the corresponding elements in the reassign modal before displaying it to the user.\n\n    *   **File Input Size Validation**:\n        *   It attaches a `change` listener to all inputs with the class `.file-input`.\n        *   It checks the size of the selected file against the `data-max-size` attribute on the input.\n        *   If the file is too large, it displays a warning message and clears the file input to prevent form submission with an invalid file.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/webapp/js/admin/admin_kits.js', '1.  **File Overview & Purpose**\n\n    This script provides all interactivity for the \"Kit-Verwaltung\" (Kit Management) page. It handles the create/edit modal for kit metadata, the accordion-style display of kit contents, and the dynamic addition and removal of item rows within a kit.\n\n2.  **Architectural Role**\n\n    This is a key script in the **View/Client-Side Tier**, transforming the `admin_kits.jsp` page into a dynamic interface for managing complex kit objects.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. It uses standard browser APIs for DOM manipulation and `fetch` for AJAX calls.\n\n4.  **In-Depth Breakdown**\n\n    *   **Data Initialization**: On load, it parses two JSON blobs embedded in the JSP:\n        *   `allItemsData`: Contains all items, including their available quantities, used for validation.\n        *   `allSelectableItemsData`: A potentially simpler list used to populate the item dropdowns.\n    *   **Create/Edit Kit Modal Logic**: Handles opening the main kit modal (`#kit-modal`) and pre-filling its fields (`name`, `description`, `location`) based on the clicked button''s `data-*` attributes.\n    *   **Accordion Logic**: Attaches a `click` listener to each `.kit-header`. When clicked, it toggles the `display` style of the next element (`.kit-content`) and updates the chevron icon (`.toggle-icon`) to indicate an open or closed state.\n    *   **Dynamic Item Row Logic**:\n        *   `createItemRow()`: A factory function that creates a new HTML row for an item within a kit. The row includes a dropdown of all storage items, a quantity input, and a remove button.\n        *   **Event Delegation**: It uses a single event listener on `document.body` to handle clicks for both adding (`.btn-add-kit-item-row`) and removing (`.btn-remove-kit-item-row`) item rows. This is efficient and works for dynamically created elements.\n        *   `updateMaxQuantity()`: An important validation function. When an item is selected in a row''s dropdown, this function finds the corresponding item in the `allItems` data, and sets the `max` attribute on the quantity input to prevent the admin from adding more items to a kit than are available in stock.'),
('src/main/webapp/js/admin/admin_matrix.js', '1.  **File Overview & Purpose**\n\n    This JavaScript file provides the interactivity for the \"Qualifikations-Matrix\" (`admin_matrix.jsp`). Its sole function is to handle the click events on the table cells, open the attendance modal, and populate it with the correct data for the selected user and meeting.\n\n2.  **Architectural Role**\n\n    This script is part of the **View/Client-Side Tier**. It makes the static matrix table interactive.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **`openModal(cell)` function**:\n        *   **Purpose:** To populate and display the attendance modal.\n        *   **Logic:** It reads all necessary information (user ID, user name, meeting ID, meeting name, current attendance status, remarks) from the `data-*` attributes of the clicked table cell (`<td>`). It then uses this data to set the values of the input fields and the title within the `#attendance-modal`. Finally, it makes the modal visible by adding the `.active` class.\n    *   **Event Listeners**:\n        *   It attaches a `click` listener to every cell with the class `.qual-cell` to trigger the `openModal` function.\n        *   It adds listeners for closing the modal, either by clicking the close button, clicking the overlay background, or pressing the `Escape` key.'),
('src/main/webapp/js/admin/admin_meeting_list.js', '1.  **File Overview & Purpose**\n\n    This script provides the client-side interactivity for the page that lists all meetings for a specific course (`admin_meeting_list.jsp`). It manages the create/edit modal, including fetching data for existing meetings via AJAX and handling dynamic attachment display.\n\n2.  **Architectural Role**\n\n    This script is part of the **View/Client-Side Tier**. It enhances the meeting management page with dynamic modal functionality.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **Modal Management (`openModal`, `closeModal`, `resetModal`)**: Standard functions to control the visibility and state of the `#meeting-modal`. The `resetModal` function is important for clearing all fields and the dynamic attachments list before opening the modal for a new or different meeting.\n    *   **\"New Meeting\" Button Listener**: Resets the modal, sets its title and action for creation, and opens it.\n    *   **\"Edit Meeting\" Button Listeners**:\n        *   **AJAX Call**: `fetch(''/admin/meetings?action=getMeetingData&id=...'')`\n        *   **Purpose**: When an \"Edit\" button is clicked, it makes an AJAX call to fetch the full data for that meeting, including its list of attachments.\n        *   **Logic**: On success, it parses the JSON response and populates all form fields in the modal. It then iterates through the fetched attachments and calls `addAttachmentRow` for each one to dynamically build the list of existing attachments.\n    *   **`addAttachmentRow(...)` function**:\n        *   **Purpose:** Dynamically creates an `<li>` element for an existing attachment and adds it to the list in the modal.\n        *   **Logic:** The created element includes a link to download the file and a \"remove\" button. The remove button''s `onclick` handler is wired to show a confirmation modal and, if confirmed, submit a hidden form to the `AdminMeetingServlet` to delete the attachment.'),
('src/main/webapp/js/admin/admin_reports.js', '1.  **File Overview & Purpose**\n\n    This script is responsible for rendering the charts on the main \"Berichte & Analysen\" (Reports & Analytics) page. It reads the chart data, which has been serialized into JSON and embedded in the JSP, and uses the Chart.js library to create the visualizations.\n\n2.  **Architectural Role**\n\n    This script is part of the **View/Client-Side Tier**. It handles the data visualization aspect of the reporting dashboard.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Chart.js**: The third-party library used for creating charts.\n\n4.  **In-Depth Breakdown**\n\n    *   **`getJsonData(id)` function**: A helper function to safely find an element by its ID and parse its JSON content, with error handling.\n    *   **Event Trend Chart Logic**:\n        *   It retrieves the data for the event trend chart from the `<script id=\"eventTrendData\">` tag.\n        *   It processes the data into `labels` (months) and `data` (event counts) arrays.\n        *   It creates a new `Chart` instance, configuring it as a `line` chart with specific styling (fill color, border color) and options (e.g., forcing the y-axis to start at zero).\n    *   **User Activity Chart Logic**:\n        *   It retrieves the data for the user activity chart.\n        *   It processes the data into `labels` (usernames) and `data` (participation counts) arrays.\n        *   It creates a new `Chart` instance, configuring it as a `bar` chart. The `indexAxis: ''y''` option is used to create a horizontal bar chart, which is better for displaying lists of names.'),
('src/main/webapp/js/admin/admin_requests.js', '1.  **File Overview & Purpose**\n\n    This script provides the client-side logic for the \"Anträge\" (Requests) page. It handles the submission of the \"Approve\" and \"Deny\" actions for user profile change requests via AJAX, preventing a full page reload.\n\n2.  **Architectural Role**\n\n    This script is part of the **View/Client-Side Tier**. It makes the request management page more interactive and responsive.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **`handleRequestAction(form)` function**:\n        *   **Purpose:** A central function to handle both approve and deny actions.\n        *   **AJAX Call**: `POST /admin/action/request?action=[approve|deny]`\n        *   **Logic:**\n            1.  It creates a `URLSearchParams` object from the submitted form''s data. This is a crucial step to ensure the request is sent with the `application/x-www-form-urlencoded` content type, which the `FrontControllerServlet` expects.\n            2.  It sends the `fetch` request.\n            3.  On a successful response (`response.ok && result.success`), it displays a success toast and then smoothly fades out and removes the corresponding table row from the DOM, providing immediate visual feedback that the request has been processed.\n            4.  On failure, it displays an error toast.\n    *   **Event Listeners**:\n        *   It attaches `submit` listeners to all `.js-approve-request-form` and `.js-deny-request-form` forms.\n        *   These listeners prevent the default form submission and instead call the global `showConfirmationModal`. The `handleRequestAction` function is passed as the callback to be executed only if the admin confirms the action in the modal.'),
('src/main/webapp/js/admin/admin_roles.js', '1.  **File Overview & Purpose**\n\n    This JavaScript file provides the client-side interactivity for the \"Rollen & Berechtigungen\" (Roles & Permissions) page (`admin_roles.jsp`). It handles opening the permissions modal for a specific role and dynamically populating it with a checklist of all available permissions, pre-checking the ones already assigned to that role.\n\n2.  **Architectural Role**\n\n    This script is part of the **View/Client-Side Tier**, adding dynamic functionality to the role management page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This script uses standard browser APIs.\n\n4.  **In-Depth Breakdown**\n\n    *   **Data Initialization**: It parses the `allPermissions` JSON data embedded in the JSP into a JavaScript object.\n    *   **`openModal(btn)` function**:\n        *   **Purpose:** To populate and display the permissions modal.\n        *   **AJAX Call**:\n            *   **URL:** `/admin/roles?action=getRolePermissions&roleId=[ID]`\n            *   **Method:** `GET`\n            *   **Trigger:** Clicking an \"Edit Permissions\" button.\n        *   **Logic:**\n            1.  It retrieves the `roleId` and `roleName` from the clicked button''s `data-*` attributes.\n            2.  It displays a \"Loading...\" message in the modal.\n            3.  It makes a `fetch` request to get the set of permission IDs currently assigned to that role.\n            4.  On success, it clears the loading message and dynamically builds the entire permissions checklist.\n            5.  **Checklist Generation**: It iterates through the `allPermissions` data (grouped by category), creating a `<label>` and `<input type=\"checkbox\">` for each permission. It uses the fetched `assignedIds` set to determine which checkboxes should be pre-checked.\n            6.  A special check is included to disable the `ACCESS_ADMIN_PANEL` checkbox for the \"ADMIN\" role to prevent an administrator from accidentally locking themselves out of the system.'),
('src/main/webapp/js/admin/admin_storage_list.js', '1.  **File Overview & Purpose**\n\n    This script provides the interactivity for the main \"Lagerverwaltung\" (Inventory Management) page (`admin_storage_list.jsp`). It manages the various modals used for editing items, updating defect status, logging repairs, and managing maintenance status. It also handles the image lightbox functionality.\n\n2.  **Architectural Role**\n\n    This script belongs to the **View/Client-Side Tier**. It enhances the user experience of the inventory management page with dynamic modals and image previews.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **Confirmation Forms**: It attaches submit listeners to `.js-confirm-form` (like the delete button) to show a confirmation modal before proceeding.\n    *   **Lightbox Logic**:\n        *   It attaches `click` listeners to all image triggers (`.lightbox-trigger`).\n        *   When a trigger is clicked, it sets the `src` of the main lightbox image (`#lightbox-image`) and displays the lightbox overlay.\n        *   It includes listeners to close the lightbox when the close button is clicked, the overlay is clicked, or the Escape key is pressed.\n    *   **Item Create/Edit Modal Logic**:\n        *   Handles the \"New Item\" button to open a blank modal.\n        *   For \"Edit Item\" buttons, it makes an AJAX `fetch` call to `/admin/lager?action=getItemData&id=...` to get the latest data for that item.\n        *   Upon receiving the JSON data, it populates all the fields in the item edit modal before displaying it.\n    *   **Defect, Repair, and Maintenance Modals**: Each of these sections has a similar pattern. It finds all buttons that trigger a specific modal (e.g., `.defect-modal-btn`) and attaches a click listener. The listener reads the relevant item data from the button''s `data-*` attributes and uses it to pre-fill the corresponding modal''s form fields before making it visible.'),
('src/main/webapp/js/admin/admin_system.js', '1.  **File Overview & Purpose**\n\n    This script provides the live-updating functionality for the \"Systemstatus\" page. It periodically fetches system statistics from a dedicated API endpoint and updates the progress bars and text on the page to reflect the current server load.\n\n2.  **Architectural Role**\n\n    This script is part of the **View/Client-Side Tier**. It turns the static `admin_system.jsp` page into a real-time monitoring dashboard.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **`updateUI(stats)` function**:\n        *   **Purpose:** Takes a `SystemStatsDTO` JSON object and updates the DOM elements.\n        *   **Logic:** It calculates percentages for CPU, RAM, and Disk usage and updates the `width` of the progress bar elements and the content of the text elements.\n        *   It includes a specific check for the `uptime` field. If the value is \"Nicht verfügbar\", it finds the parent `.card` element and hides it entirely, fulfilling a specific user wish. It does the same for the battery card if the battery percentage is negative.\n    *   **`fetchStats()` function**:\n        *   **Purpose:** The core function that performs the data fetching.\n        *   **AJAX Call**: `GET /api/admin/system-stats`\n        *   **Logic:** It calls the API endpoint using `fetch`. If the request is successful, it passes the resulting JSON data to the `updateUI` function. It includes error handling to display an error message in the UI if the API call fails.\n    *   **Initialization and Interval**:\n        *   It calls `fetchStats()` immediately on page load to get the initial data.\n        *   It uses `setInterval(fetchStats, 5000)` to automatically re-fetch the data every 5 seconds.\n        *   It also includes an event listener for `visibilitychange` to pause the interval when the browser tab is not active, saving system resources.'),
('src/main/webapp/js/admin/admin_users.js', '1.  **File Overview & Purpose**\n\n    This is a complex script that provides all client-side logic for the main \"Benutzerverwaltung\" (User Management) page. It manages the multi-tabbed create/edit modal, dynamically populates the permissions checklist, and handles all user actions (create, update, delete, password reset, unlock) via AJAX calls to the `FrontControllerServlet`.\n\n2.  **Architectural Role**\n\n    This is a major component of the **View/Client-Side Tier**, providing a single-page-application-like experience for user management.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **Modal Management & Permission Population**:\n        *   It pre-loads all available permissions from an embedded JSON blob.\n        *   The `populatePermissions` function dynamically builds the entire, grouped checklist of permissions inside the modal.\n        *   The \"New User\" button listener opens the modal with a blank form and the full, unchecked permissions list.\n        *   The \"Edit User\" button listeners make an AJAX call (`GET /admin/mitglieder?action=getUserData`) to fetch the specific user''s data and their currently assigned permission IDs, which are then used to pre-check the correct boxes in the modal.\n    *   **Main Form Submission (Create/Update)**:\n        *   The `submit` listener on the main modal form (`#user-modal-form`) prevents the default submission.\n        *   It makes a `POST` request to `/admin/action/user`, using `URLSearchParams(new FormData(form))` to correctly serialize the form data.\n        *   On success, it shows a toast notification. If it was an \"update\" action, it calls `updateTableRow` to update the user''s data in the main table in real-time. If it was a \"create\" action, it reloads the page to display the new user.\n    *   **AJAX Action Handler (`handleAjaxFormSubmit`)**:\n        *   This function handles the other actions (delete, reset password, unlock) which are triggered by separate forms in the main table.\n        *   It also uses `URLSearchParams(new FormData(form))` for correct serialization.\n        *   **For Password Resets**: On success, it dynamically creates and prepends a persistent alert banner to the top of the page to display the new temporary password to the admin.\n        *   **For Deletes**: On success, it calls `removeTableRow` to remove the user''s row from the table without a page reload.\n    *   **Confirmation Logic**: All state-changing actions (delete, reset, unlock) are wrapped in a call to the global `showConfirmationModal` to prevent accidental clicks.'),
('src/main/webapp/js/auth/login.js', '1.  **File Overview & Purpose**\n\n    This script provides client-side functionality for the login page, specifically for managing the lockout timer display.\n\n2.  **Architectural Role**\n\n    This is a client-side script for the **View Tier**. It enhances the user experience of the login page during a lockout period.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **`DOMContentLoaded` Listener**: The script runs after the page has loaded.\n    *   **Lockout Timer Logic**:\n        *   It checks for the existence of the `#lockout-timer` element, which is only rendered by `login.jsp` if a lockout is active.\n        *   If the timer exists, it reads the lockout end time (`data-end-time`) and the lockout level (`data-lockout-level`) from its data attributes.\n        *   It uses `setInterval` to run a function every second.\n        *   This function calculates the remaining seconds of the lockout.\n        *   It updates the text content of the `#lockout-timer` element to display a countdown (e.g., \"Bitte versuchen Sie es in 0 Minute(n) und 59 Sekunde(n) erneut.\").\n        *   When the timer reaches zero, it clears the interval and forces a page reload, which removes the lockout message and re-enables the login form.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/webapp/js/auth/logout.js', '1.  **File Overview & Purpose**\n\n    This is a simple script for the logout confirmation page (`logout.jsp`). Its only purpose is to automatically redirect the user back to the login page after a short delay.\n\n2.  **Architectural Role**\n\n    This is a client-side script for the **View Tier**. It provides a simple UX enhancement.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **`setTimeout`**: The entire script consists of a single `setTimeout` call. It is set to 5000 milliseconds (5 seconds). After the timeout expires, it changes `window.location.href` to the login page, automatically redirecting the user.'),
('src/main/webapp/js/auth/passkey_auth.js', '1.  **File Overview & Purpose**\n\n    This script handles all client-side logic for WebAuthn (Passkey) registration and authentication. It interacts with the browser''s `navigator.credentials` API and communicates with the server-side passkey API endpoints.\n\n2.  **Architectural Role**\n\n    This is a crucial script in the **View/Client-Side Tier**, providing the functionality for passwordless login and device registration. It is used on both the `login.jsp` and `profile.jsp` pages.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Web Authentication API (`navigator.credentials`)**: The native browser API for creating and retrieving public key credentials.\n\n4.  **In-Depth Breakdown**\n\n    *   **Utility Functions (`bufferDecode`, `bufferEncode`)**: These are essential helper functions for converting between the `ArrayBuffer` format used by the WebAuthn API and the URL-safe Base64 string format used for JSON communication with the server.\n\n    *   **Registration Logic (`register-passkey-btn`)**:\n        1.  **Start:** Makes a `fetch` call to `/api/auth/passkey/register/start` to get a challenge and creation options from the server.\n        2.  **Decode:** It decodes the Base64URL challenge and user ID into `ArrayBuffer`s.\n        3.  **Browser API:** It calls `navigator.credentials.create()` with the options from the server. This is where the browser/OS takes over and prompts the user to create a passkey (e.g., via Windows Hello, Touch ID).\n        4.  **Encode:** It takes the resulting credential object and encodes its `ArrayBuffer` fields back into Base64URL strings.\n        5.  **Prompt:** It uses a `prompt()` dialog to ask the user for a friendly name for the new device.\n        6.  **Finish:** It sends the encoded credential and the device name to `/api/auth/passkey/register/finish` via a `POST` request to complete the registration on the server.\n\n    *   **Delete Logic (`.delete-passkey-btn`)**: Attaches a listener to the delete buttons on the profile page, wrapping the form submission in a confirmation modal.\n\n    *   **Login Logic (`#login-passkey-btn`)**:\n        1.  **Start:** It makes a `fetch` call to `/api/auth/passkey/login/start`, sending the username, to get a challenge from the server.\n        2.  **Decode:** It decodes the challenge into an `ArrayBuffer`.\n        3.  **Browser API:** It calls `navigator.credentials.get()` with the challenge. The browser/OS prompts the user to authenticate with their passkey.\n        4.  **Encode:** It encodes the resulting assertion object''s fields into Base64URL strings.\n        5.  **Finish:** It sends the encoded assertion to `/api/auth/passkey/login/finish` via a `POST` request. If the server successfully verifies the assertion, it returns a success response, and the script redirects the user to the home page.'),
('src/main/webapp/js/error/error400.js', '1.  **File Overview & Purpose**\n\n    This script provides a simple, animated \"console output\" effect for the custom 400 Bad Request error page. It simulates a protocol droid analyzing the faulty request to provide a more engaging user experience than a static error page.\n\n2.  **Architectural Role**\n\n    This is a client-side script for the **View Tier**, specifically for an error page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **`printLine()` function**:\n        *   **Purpose:** A recursive function that \"types\" out pre-defined lines of text one by one.\n        *   **Logic:** It takes one line from the `lines` array, creates a `<p>` element for it, and appends it to the output `pre` tag. It then uses `setTimeout` with a random delay to call itself, creating the appearance of a live analysis.\n        *   When all lines have been printed, it fades in the \"Go Back\" button.'),
('src/main/webapp/js/error/error401.js', '1.  **File Overview & Purpose**\n\n    This script provides a visual animation for the 401 Unauthorized error page. It simulates a card scanner denying access, creating a more thematic and engaging user experience for what is otherwise a simple error.\n\n2.  **Architectural Role**\n\n    This is a client-side script for the **View Tier**, specific to the 401 error page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **`runScan()` function**:\n        *   **Purpose:** A function that steps through a pre-defined sequence of states to animate the scanner.\n        *   **`steps` Array**: An array of objects, where each object defines the text to display, the color of the text and light, the duration of the step, and the target progress bar width.\n        *   **Logic:** The function is called recursively using `setTimeout`. In each step, it updates the text content, the color of the light and status text, and the width of the progress bar based on the current object in the `steps` array. After the final \"VERWEIGERT\" (Denied) step, it fades in the redirect button.'),
('src/main/webapp/js/error/error403.js', '1.  **File Overview & Purpose**\n\n    This script creates an animated \"hacker-style\" terminal output effect for the 403 Forbidden error page. It simulates a security system logging an unauthorized access attempt, providing a more immersive experience for this type of error.\n\n2.  **Architectural Role**\n\n    This is a client-side script for the **View Tier**, specific to the 403 error page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **`type(text, element, delay)` function**: An `async` helper function that simulates typing by appending one character at a time to an element with a specified delay.\n    *   **`addLine(text, className)` function**: An `async` helper that creates a new line element in the console and uses the `type` function to write text to it.\n    *   **`runSequence()` function**:\n        *   **Purpose:** The main `async` function that orchestrates the entire animation sequence.\n        *   **Logic:** It calls `addLine` in sequence with different texts and CSS classes (`info`, `ok`, `warn`, `fail`) to simulate a system log. It uses `await new Promise(resolve => setTimeout(resolve, ...))` to pause between lines, creating a realistic timing effect. After the sequence is complete, it fades in the redirect button and sets a timeout to automatically redirect the user to the home page after 5 seconds.'),
('src/main/webapp/js/error/error404.js', '1.  **File Overview & Purpose**\n\n    This script creates a simulated Linux/bash terminal interface for the 404 Not Found error page. It animates the typing of a command to find the requested resource and displays the classic \"No such file or directory\" error, making the page more engaging.\n\n2.  **Architectural Role**\n\n    This is a client-side script for the **View Tier**, specific to the 404 error page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **`type(...)` and `addLine(...)`**: Helper functions similar to the `error403.js` script for creating the animated typing effect.\n    *   **`runSequence()` function**:\n        *   **Purpose:** Orchestrates the terminal animation.\n        *   **Logic:**\n            1.  It gets the requested URI from a `data-` attribute on the `<body>` tag.\n            2.  It animates typing a command like `ls -l /nonexistent/page`.\n            3.  It then animates the display of the error message.\n            4.  Finally, it \"types\" a clickable link to the home page, providing a clear way for the user to recover.'),
('src/main/webapp/js/error/error500.js', '1.  **File Overview & Purpose**\n\n    This script provides an interactive \"system diagnostic\" for the 500 Internal Server Error page. It allows the user to click a button to run a simulated diagnostic routine that \"types\" out a humorous sequence of system checks, providing an engaging distraction from the server error.\n\n2.  **Architectural Role**\n\n    This is a client-side script for the **View Tier**, specific to the 500 error page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **`steps` Array**: Contains the sequence of diagnostic messages, each with a `type` (`info`, `ok`, `warn`, `fail`) that corresponds to a CSS class for styling.\n    *   **`typeText(...)`**: An `async` helper function for the animated typing effect.\n    *   **Button Event Listener**:\n        *   Attaches a `click` listener to the `#diagnostic-btn`.\n        *   When clicked, it disables the button and iterates through the `steps` array, calling `typeText` for each line with a delay.\n        *   After the sequence completes, it re-enables the button, allowing the user to run the \"diagnostic\" again.'),
('src/main/webapp/js/error/error503.js', '1.  **File Overview & Purpose**\n\n    This script creates an animated \"system reboot\" sequence for the 503 Service Unavailable error page. It simulates a server console printing reboot messages and updates a progress bar, providing a thematic experience for this type of error.\n\n2.  **Architectural Role**\n\n    This is a client-side script for the **View Tier**, specific to the 503 error page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **`steps` Array**: An array of objects, each defining a line of text to print, the delay before the next line, and the target progress bar width for that step.\n    *   **`runSequence()` function**:\n        *   **Purpose:** A recursive function that executes the reboot sequence.\n        *   **Logic:** It takes the current step from the `steps` array, creates a `<p>` element for the text, and updates the width of the progress bar. It then uses `setTimeout` with the step''s defined delay to call itself, proceeding to the next step.\n        *   After the final step, it automatically redirects the user to the login page.'),
('src/main/webapp/js/public/calendar.js', '1.  **File Overview & Purpose**\n\n    This script is responsible for initializing the FullCalendar library on the calendar page (`calendar.jsp`). It configures the calendar''s appearance, behavior, and data source.\n\n2.  **Architectural Role**\n\n    This is a client-side script for the **View Tier**. It is the sole component responsible for rendering the interactive desktop calendar.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **FullCalendar.js**: The third-party library that this script configures and renders. It is loaded via CDN.\n\n4.  **In-Depth Breakdown**\n\n    *   **`DOMContentLoaded` Listener**: Ensures the script runs after the DOM is ready.\n    *   **Initialization Logic**:\n        1.  It gets a reference to the container element, `#calendar-container`.\n        2.  It checks if the element exists in the DOM.\n        3.  It creates a new `FullCalendar.Calendar` instance.\n        4.  **Configuration Object**:\n            *   `initialView: ''dayGridMonth''`: Sets the default view to the monthly grid.\n            *   `locale: ''de''`: Sets the language to German.\n            *   `headerToolbar`: Configures the navigation buttons (prev/next, today, view switchers).\n            *   `events: ''/api/calendar/entries''`: This is the crucial part. It tells FullCalendar to fetch its event data from the application''s `CalendarApiServlet` endpoint via an AJAX request.\n            *   `eventClick`: Defines a callback function that is executed when a user clicks on an event in the calendar. It prevents the default action and redirects the user to the event''s details page within the application.\n        5.  **`calendar.render()`**: This final call instructs FullCalendar to render itself inside the container element.'),
('src/main/webapp/js/public/dateien.js', '1.  **File Overview & Purpose**\n\n    This script provides the client-side logic for the \"Dateien & Dokumente\" (Files & Documents) page. Its function is to handle the \"Upload New Version\" modal, populating it with the correct file information when a user clicks the corresponding button.\n\n2.  **Architectural Role**\n\n    This is a client-side script for the **View Tier**, adding modal interactivity to the `dateien.jsp` page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **Event Listener on `.upload-new-version-btn`**:\n        *   It attaches a `click` listener to every \"Upload New Version\" button.\n        *   When a button is clicked, it retrieves the `fileId` and `fileName` from the button''s `data-*` attributes.\n        *   It then populates the hidden `fileId` input and the `<strong>` tag in the `#upload-version-modal` with this data.\n        *   Finally, it makes the modal visible. The modal''s form submission is a standard HTML POST, not handled by this script.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/webapp/js/public/eventDetails.js', '1.  **File Overview & Purpose**\n\n    This is a large, complex script that provides all the client-side interactivity for the Event Details page (`eventDetails.jsp`). It manages the task creation/editing modal, handles the real-time event chat via WebSockets, and controls user actions on tasks like marking them as done or claiming them.\n\n2.  **Architectural Role**\n\n    This is a major component of the **View/Client-Side Tier**, transforming the event details page into a dynamic and collaborative workspace.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **marked.js**: For rendering Markdown in the chat messages and task details.\n    *   **WebSocket API**: For the real-time chat functionality.\n\n4.  **In-Depth Breakdown**\n\n    *   **Task Modal Logic**:\n        *   It pre-loads all users, items, and kits from embedded JSON blobs in the JSP.\n        *   It manages the state of the multi-tabbed task modal, including resetting the form (`resetModal`) and pre-populating it for editing based on the selected task''s data from the `allTasks` JSON.\n        *   It includes functions (`addItemRow`, `addKitRow`) to dynamically add new rows for material and kit requirements to the task form.\n    *   **Event Delegation for Task Actions**: It uses a single listener on `document.body` to handle clicks on the \"Add Item\" and \"Add Kit\" buttons, which is efficient and works for dynamically created modals.\n    *   **Task Status/Claim Logic**: It attaches a listener to the main task container to handle clicks on \"Mark as Done\", \"Claim\", and \"Unclaim\" buttons. These actions trigger `fetch` POST requests to the `TaskActionServlet`.\n    *   **Real-Time Chat Logic**:\n        *   **WebSocket Connection**: The `connect()` function establishes and manages the WebSocket connection to `/ws/chat/{eventId}`. It includes logic for automatic reconnection on close.\n        *   **`socket.onmessage`**: The core message handler. It parses incoming JSON messages from the server and uses a `switch` statement on the message `type` to call the appropriate rendering function (`appendMessage`, `handleSoftDelete`, `handleUpdate`).\n        *   **Rendering Functions (`appendMessage`, etc.)**: These functions are responsible for dynamically creating the HTML for chat bubbles, correctly styling them based on the current user, handling the display of deleted/edited states, and creating the options menu (edit/delete buttons).\n        *   **Message Submission**: The chat form''s `submit` listener sends new messages to the server through the WebSocket.\n        *   **Mentions (`@`)**: It includes logic to detect when a user types \"@\" and show a popup of available users to mention.'),
('src/main/webapp/js/public/events.js', '1.  **File Overview & Purpose**\n\n    This script provides the client-side logic for the main \"Veranstaltungen\" (Events) page. It handles the sign-up modal, including fetching and displaying any custom fields required for the event. It also contains the special logic for handling sign-offs from events that are already running.\n\n2.  **Architectural Role**\n\n    This is a client-side script for the **View/Client-Side Tier**, adding dynamic modal functionality to the `events.jsp` page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **Sign-up Modal Logic (`openSignupModal`)**:\n        *   **AJAX Call**: `GET /api/public/event-custom-fields?eventId=[ID]`\n        *   **Purpose**: When a user clicks an \"Anmelden\" (Sign Up) button, this function is triggered. It first opens the modal and then makes an AJAX call to fetch the list of custom fields for that specific event.\n        *   **Logic**: It dynamically builds the HTML for the custom input fields (e.g., `<input type=\"text\">` or `<select>`) based on the data received from the API and injects them into the modal. If there are no custom fields, it displays a simple message.\n    *   **Sign-off Logic**:\n        *   It attaches a `submit` listener to all sign-off forms (`.js-signoff-form`).\n        *   **Conditional Behavior**: It checks the `data-event-status` attribute on the form.\n            *   If the status is `\"LAUFEND\"`, it `preventDefault()` to stop the submission, and instead opens the `#signoff-reason-modal`, populating it with the correct `eventId`.\n            *   If the status is anything else, it also calls `preventDefault()` but then immediately calls the global `showConfirmationModal`, allowing the standard submission to proceed only after user confirmation.'),
('src/main/webapp/js/public/lager.js', '1.  **File Overview & Purpose**\n\n    This script provides the client-side logic for the main public \"Lager\" (Inventory) page (`lager.jsp`). It handles the transaction modal (for checking items in and out) and the image lightbox.\n\n2.  **Architectural Role**\n\n    This is a client-side script for the **View/Client-Side Tier**, adding interactivity to the main inventory view.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **Transaction Modal Logic (`openModal`)**:\n        *   It attaches a `click` listener to every `.transaction-btn`.\n        *   When a button is clicked, it reads the item''s data from the button''s `data-*` attributes.\n        *   It populates the modal''s title and hidden `itemId` field.\n        *   **Dynamic Validation**: This is a key feature. It uses the `data-*` attributes to set the `max` attribute on the quantity input. When the user hovers over the \"Entnehmen\" (Checkout) button, the `max` is set to the available quantity. When they hover over the \"Einräumen\" (Checkin) button, the `max` is set to the available space (if `max_quantity` is defined). This provides real-time validation feedback to the user.\n        *   It also disables the checkout or checkin buttons if no items are available or if the item is at maximum capacity, respectively.\n    *   **Lightbox Logic**: This is identical to the lightbox logic in `admin_storage_list.js`, providing a consistent image preview experience across both public and admin views.'),
('src/main/webapp/js/public/profile.js', '1.  **File Overview & Purpose**\n\n    This script provides the interactivity for the \"Mein Profil\" (My Profile) page. It handles the toggling between view and edit modes for the user''s profile data and manages the AJAX submission of profile change requests.\n\n2.  **Architectural Role**\n\n    This is a client-side script for the **View/Client-Side Tier**, enhancing the `profile.jsp` page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **`toggleEditMode(isEditing)` function**:\n        *   **Purpose:** A central function to switch the profile form between a read-only state and an editable state.\n        *   **Logic:** It iterates over all fields with the `.editable-field` class, toggling their `readOnly` attribute and changing their styling to provide visual feedback. It also toggles the visibility of the \"Edit\", \"Submit\", and \"Cancel\" buttons. When entering edit mode, it stores the original values of the fields in an `originalValues` object so they can be restored if the user cancels.\n    *   **Event Listeners**:\n        *   A `click` listener on the \"Edit\" button calls `toggleEditMode(true)`.\n        *   A `click` listener on the \"Cancel\" button restores the original values and calls `toggleEditMode(false)`.\n    *   **Form Submission (`profileForm.addEventListener(''submit'', ...)`**:\n        *   **Purpose:** Handles the submission of a profile change request via AJAX.\n        *   **AJAX Call**: `POST /profil?action=requestProfileChange`\n        *   **Logic:**\n            1.  It prevents the default form submission.\n            2.  It creates a `URLSearchParams` object from the form data to ensure correct content type.\n            3.  It sends the `fetch` request.\n            4.  On a successful response, it shows a success toast, switches back to view mode, and reloads the page to show the \"pending request\" message.\n            5.  On failure, it shows an error toast.'),
('src/main/webapp/js/public/qr_action.js', '1.  **File Overview & Purpose**\n\n    This is a small, focused script for the \"QR Action\" page (`qr_action.jsp`). Its purpose is to provide dynamic validation for the quantity input based on whether the user is about to check an item in or out.\n\n2.  **Architectural Role**\n\n    This is a client-side script for the **View/Client-Side Tier**, providing a specific usability enhancement for the QR code workflow.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **Data Retrieval**: On load, it reads the item''s quantity details from `data-*` attributes on the main form element.\n    *   **Dynamic Validation**:\n        *   It attaches `click` listeners to both the \"Checkout\" and \"Checkin\" buttons.\n        *   **Checkout**: When the checkout button is clicked (just before form submission), it sets the `max` attribute of the quantity input to the `availableQty`.\n        *   **Checkin**: When the checkin button is clicked, it calculates the available space (`maxQty - totalQty`) and sets the `max` attribute accordingly. This ensures that the browser''s native form validation will prevent the user from submitting an invalid quantity for the chosen action.'),
('src/main/webapp/js/public/storage_item_details.js', '1.  **File Overview & Purpose**\n\n    This script provides client-side interactivity for the \"Artikeldetails\" (Item Details) page (`storage_item_details.jsp`). Its main functions are to handle the image lightbox and the tabbed interface for switching between transaction history and maintenance history.\n\n2.  **Architectural Role**\n\n    This script is part of the **View/Client-Side Tier**, enhancing the user experience on the item details page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **Lightbox Logic**:\n        *   Attaches `click` listeners to `.lightbox-trigger` elements.\n        *   When a trigger is clicked, it sets the `src` of the main lightbox image and displays the lightbox overlay.\n        *   Includes listeners to close the lightbox when the close button, overlay, or Escape key is used.\n    *   **Tabbed Interface Logic**:\n        *   It attaches a `click` listener to all `.modal-tab-button` buttons.\n        *   When a button is clicked, it removes the `active` class from all tab buttons and content panes.\n        *   It then adds the `active` class to the clicked button and to the content pane whose ID matches the button''s `data-tab` attribute, effectively showing the correct content.'),
('src/main/webapp/WEB-INF/jspf/common_modals.jspf', '1.  **File Overview & Purpose**\n\n    This JSP fragment is intended as a placeholder for any future modals that might be used globally across the application. Currently, the primary global modal (the confirmation dialog) is created dynamically by `main.js`, so this file is effectively empty but serves an architectural purpose.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** component, designed for inclusion in the main page footer.'),
('src/main/webapp/WEB-INF/jspf/error_footer.jspf', '1.  **File Overview & Purpose**\n\n    This JSP fragment defines the closing HTML structure for all custom error pages. It closes the main content `div`s and includes the global `main.js` script.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** component, part of the standardized error page layout. Its structure ensures that even error pages have a consistent HTML foundation.'),
('src/main/webapp/WEB-INF/jspf/error_header.jspf', '1.  **File Overview & Purpose**\n\n    This JSP fragment defines the opening HTML structure for all custom error pages. It includes the HTML head, doctype, meta tags, and the link to the main `style.css`. It also opens the main content wrapper `div`s.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** component that ensures a consistent look and feel across all error pages by providing a standardized header.'),
('src/main/webapp/WEB-INF/jspf/event_modals.jspf', '1.  **File Overview & Purpose**\n\n    This JSP fragment contains the HTML structure for the modals used in the administrative event management page (`admin_events_list.jsp`). It defines the multi-tabbed \"Create/Edit Event\" modal and the \"Assign Users\" modal.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** component. It is included by `admin_events_list.jsp` to keep the main page''s code cleaner by separating out the complex modal markup.\n\n3.  **In-Depth Breakdown**\n\n    *   **Event Create/Edit Modal (`#event-modal`)**:\n        *   **Multi-Tab Structure**: Contains tabs for \"General\", \"Requirements\", \"Reservations\", \"Attachments\", and \"Custom Fields\". The content for each tab is within a `.modal-tab-content` div.\n        *   **Dynamic Containers**: Includes empty `div`s like `#modal-requirements-container` which are populated dynamically by `admin_events_list.js` when an event is edited.\n        *   **Forms**: Contains the main form for creating/updating an event. The `action` and hidden `id` fields are populated by JavaScript.\n    *   **Assign Users Modal (`#assign-users-modal`)**:\n        *   Contains a form and a container `div` (`#user-checkboxes-container`) that is dynamically filled with a checklist of users via an AJAX call in the JavaScript.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/webapp/WEB-INF/jspf/main_footer.jspf', '1.  **File Overview & Purpose**\n\n    This is the global footer fragment included at the bottom of every standard application page. It closes the main `<body>` and `<html>` tags and includes the core JavaScript libraries and the main application script.\n\n2.  **Architectural Role**\n\n    This is a fundamental **View Tier** component that ensures all pages have access to the necessary client-side scripts.\n\n3.  **In-Depth Breakdown**\n\n    *   **`<script>` tags**:\n        *   Includes third-party libraries like `marked.js` and `diff_match_patch.js` from the local `/vendor/` directory.\n        *   Crucially, it includes `main.js`, which contains the global application logic.'),
('src/main/webapp/WEB-INF/jspf/main_header.jspf', '1.  **File Overview & Purpose**\n\n    This is the global header fragment included at the top of every standard application page. It contains the HTML head section, including meta tags, the title, and CSS links. It also renders the sidebar navigation and the mobile header.\n\n2.  **Architectural Role**\n\n    This is a fundamental **View Tier** component that provides a consistent header, navigation, and visual style for the entire application.\n\n3.  **In-Depth Breakdown**\n\n    *   **`<head>` Section**:\n        *   Sets the character encoding and viewport.\n        *   Dynamically sets the page title using a parameter: `$${param.pageTitle}`.\n        *   Links to the FontAwesome CDN and the local `style.css`.\n        *   Includes a critical inline script to set the `data-theme` attribute on the `<html>` tag *before* the page renders, preventing a \"flash of unthemed content\" when a user has the dark theme selected.\n        *   Conditionally includes the FullCalendar CSS if the page is the calendar.\n    *   **`<body>` Section**:\n        *   Includes several `data-*` attributes (`data-context-path`, `data-is-logged-in`, `data-csrf-token`) that make essential server-side information easily accessible to the global `main.js` script.\n    *   **Sidebar (`<aside class=\"sidebar\">`)**:\n        *   Renders the entire navigation menu.\n        *   It iterates through the `navigationItems` list (which was placed in the session at login).\n        *   It uses `<c:if>` tags to separate the list into \"User Area\" and \"Admin Area\" sections.\n        *   It dynamically adds the `active-nav-link` class to the link corresponding to the current page.\n    *   **Mobile Header (`<header class=\"mobile-header\">`)**: Contains the markup for the top bar visible on mobile devices, including the hamburger menu toggle.'),
('src/main/webapp/WEB-INF/jspf/message_banner.jspf', '1.  **File Overview & Purpose**\n\n    This JSP fragment is responsible for displaying session-based feedback messages to the user (e.g., success, error, or info banners). After displaying a message, it removes it from the session to ensure it is only shown once.\n\n2.  **Architectural Role**\n\n    This is a reusable **View Tier** component. It is included at the top of most pages to provide a consistent mechanism for showing feedback after a form submission or other action.\n\n3.  **In-Depth Breakdown**\n\n    *   It contains three separate `<c:if>` blocks, one for each message type: `successMessage`, `errorMessage`, and `infoMessage`.\n    *   Inside each block, it displays the message text from the session scope (`$${sessionScope.successMessage}`).\n    *   Immediately after displaying the message, it uses `<c:remove>` to delete the attribute from the session, preventing it from being shown again on the next page load.\n    *   It also handles a special case for displaying the new password after an admin-initiated password reset.'),
('src/main/webapp/WEB-INF/jspf/storage_modals.jspf', '1.  **File Overview & Purpose**\n\n    This JSP fragment contains the HTML structure for all modals related to inventory management. This includes modals for transactions (check-in/out), maintenance status, defect status, and creating/editing an item.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** component. It is included by `lager.jsp` and `admin_storage_list.jsp` to provide the necessary modal dialogs without cluttering the main page markup.\n\n3.  **In-Depth Breakdown**\n\n    *   **Transaction Modal (`#transaction-modal`)**: Used on the public inventory page for checking items in and out. The event dropdown is dynamically populated with a list of active events passed from the servlet.\n    *   **Maintenance Modal (`#maintenance-modal`)**: An admin-only modal to change an item''s status to or from \"MAINTENANCE\".\n    *   **Defect Modal (`#defect-modal`)**: An admin-only modal to report a certain quantity of an item as defective or unrepairable.\n    *   **Item Create/Edit Modal (`#item-modal`)**: A comprehensive admin-only modal with fields for all of a storage item''s properties.'),
('src/main/webapp/WEB-INF/jspf/table_scripts.jspf', '1.  **File Overview & Purpose**\n\n    This JSP fragment contains reusable JavaScript code for client-side table filtering and sorting. It is designed to be included on any page that features a data table or a searchable list.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** component that provides shared client-side functionality.\n\n3.  **In-Depth Breakdown**\n\n    *   **Table Filtering Logic**:\n        *   It attaches an `input` event listener to the element with the ID `#table-filter`.\n        *   On each keystroke, it gets the search term and converts it to lowercase.\n        *   It iterates through all elements with the class `.searchable-table` or `.searchable-list`.\n        *   For each table/list, it iterates through its rows or items and checks if the item''s text content includes the search term.\n        *   It toggles the `display` style of the row/item to show or hide it based on the match.\n    *   **Table Sorting Logic**:\n        *   It attaches `click` listeners to all table headers (`<th>`) with the class `.sortable`.\n        *   When a header is clicked, it determines the sort direction (ascending or descending) and the data type to sort by (`string` or `number`, from a `data-sort-type` attribute).\n        *   It converts the table rows into an array, sorts the array using a custom comparison function based on the selected column and data type, and then re-appends the sorted rows back into the `<tbody>`.\n        *   It also toggles CSS classes on the header to display a visual indicator for the current sort order.'),
('src/main/webapp/WEB-INF/jspf/task_modal.jspf', '1.  **File Overview & Purpose**\n\n    This JSP fragment defines the complex modal used for creating and editing tasks within an event on the `eventDetails.jsp` page.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** component, included by `eventDetails.jsp` to separate the modal''s extensive markup.\n\n3.  **In-Depth Breakdown**\n\n    *   **Core Task Fields**: Contains input fields for the task''s `description`, `details`, `displayOrder`, and `status`.\n    *   **Assignment Logic**:\n        *   Includes radio buttons to switch between \"Direct Assignment\" and \"Open Pool\".\n        *   Contains container divs (`#task-user-checkboxes`, `#pool-assignment-fields`) that are dynamically populated and shown/hidden by `eventDetails.js` based on the selected assignment type.\n    *   **Material & Kits**:\n        *   Includes empty container divs (`#task-items-container`, `#task-kits-container`) where dynamic rows for required items and kits are added by the JavaScript.\n        *   Contains the \"Add Material\" and \"Add Kit\" buttons that trigger the row creation.\n    *   **Action Buttons**: Includes the \"Save Task\" and \"Delete Task\" buttons. The delete button is hidden by default and only shown when editing an existing task.'),
('src/main/webapp/WEB-INF/jspf/user_modals.jspf', '1.  **File Overview & Purpose**\n\n    This JSP fragment defines the modal used for creating and editing user accounts on the `admin_users.jsp` page. It features a tabbed interface to separate general user information from granular permission settings.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** component, included by `admin_users.jsp`.\n\n3.  **In-Depth Breakdown**\n\n    *   **Tabbed Interface**: Contains the button and content pane structure for the \"Allgemein\" (General) and \"Berechtigungen\" (Permissions) tabs.\n    *   **General Tab**: Includes input fields for all core user properties (`username`, `password`, `roleId`, `classYear`, `className`, `email`). The password field is designed to be optional when editing a user.\n    *   **Permissions Tab**: Contains an empty container div (`#permissions-checkbox-container`). This div is populated dynamically by `admin_users.js` with a complete, grouped checklist of all available permissions in the system.'),
('src/main/webapp/views/admin/admin_achievements.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the administrative page for managing achievements. It displays a table of all existing achievements and includes a \"New Achievement\" button that opens a modal for creating or editing entries.\n\n2.  **Architectural Role**\n\n    This is a core view in the **View Tier**. It receives a list of `Achievement` objects and a list of `Course` objects from the `AdminAchievementServlet` and renders them.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `admin_achievements.js`: Provides all client-side interactivity for the modal.\n    *   JSTL Core Library: Used to iterate through the `allAchievements` list and render the table rows.\n\n4.  **In-Depth Breakdown**\n\n    *   **Main Content**: Displays a header, a filter input, and the \"New Achievement\" button.\n    *   **Data Table**: Renders a responsive table showing each achievement''s ID, name, description, and the programmatic key. Each row includes an \"Edit\" button that triggers the modal.\n    *   **Modal (`#achievement-modal`)**: Contains the form for creating/updating an achievement.\n        *   It includes a dropdown for the achievement type and dynamic sub-form groups that are shown/hidden by the JavaScript.\n        *   The dropdown for \"Qualification\" achievements is populated by iterating over the `allCourses` list.'),
('src/main/webapp/views/admin/admin_course_list.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the administrative page for managing course templates. It displays a table of all defined courses and includes a modal for creating new ones or editing existing ones.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** file. It receives a list of `Course` objects from the `AdminCourseServlet` and displays them.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `admin_course_list.js`: Provides the client-side logic for the create/edit modal.\n    *   JSTL Core Library: Used to iterate over the `allCourses` list.\n\n4.  **In-Depth Breakdown**\n\n    *   **Main Content**: Renders the page header, filter input, and the \"New Template\" button.\n    *   **Data Table**: Displays a table with each course''s ID, name, abbreviation, and a short description. Each row contains \"Edit\", \"Delete\", and \"Manage Meetings\" buttons.\n    *   **Modal (`#course-modal`)**: Contains a simple form with fields for the course name, abbreviation, and description. The form''s hidden `action` and `courseId` fields are populated by JavaScript.'),
('src/main/webapp/views/admin/admin_dashboard.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the main administrative dashboard. It provides the static HTML structure for the dashboard widgets. The content of these widgets is loaded and refreshed asynchronously by JavaScript.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** file. It acts as the container for the dynamic dashboard. It receives some initial data from the `AdminDashboardServlet` but relies heavily on its associated JavaScript.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `admin_dashboard.js`: The core script that fetches and renders all dynamic widget content.\n    *   **Chart.js**: The charting library, included via CDN link, used to render the event trend graph.\n\n4.  **In-Depth Breakdown**\n\n    *   **Layout**: Uses a CSS grid (`.dashboard-grid`) to create a responsive, multi-column layout.\n    *   **Static Widgets**: Renders the widgets for \"Total Users\", \"Active Events\", and \"Defective Items\" using data passed directly from the servlet.\n    *   **Dynamic Widget Containers**:\n        *   Includes empty `div` containers like `#upcoming-events-list`, `#low-stock-items-list`, and `#recent-logs-list`. These are the targets for the content rendered by `admin_dashboard.js`.\n        *   Includes a `<canvas>` element (`#eventTrendChart`) which is the target for the Chart.js graph.\n    *   **Alert Container**: Includes an empty `div` (`#dashboard-alerts-container`) where the `admin_dashboard.js` can dynamically insert important alerts, such as a \"Low Stock\" warning.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/webapp/views/admin/admin_defect_list.jsp', '1.  **File Overview & Purpose**\n\n    This JSP displays the list of all defective inventory items. It provides a focused view for administrators to see which items need attention.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** file. It receives a list of `StorageItem` objects from the `AdminDefectServlet` and renders them in a table.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `admin_defect_list.js`: Provides the logic for opening and populating the defect management modal.\n    *   `storage_modals.jspf`: Included to provide the HTML for the defect status modal.\n    *   JSTL Core Library: Used to iterate over the `defectiveItems` list.\n\n4.  **In-Depth Breakdown**\n\n    *   **Main Content**: Renders the page header and a filter input.\n    *   **Data Table**: Displays a table showing the defective item''s ID, name, location, total quantity, and defective quantity. Each row includes a button (`.defect-modal-btn`) that opens a modal, allowing an admin to manage the defect status of that specific item.'),
('src/main/webapp/views/admin/admin_editor.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the real-time collaborative Markdown editor. It provides the split-pane layout for the editor and the live preview, and establishes the WebSocket connection.\n\n2.  **Architectural Role**\n\n    This is a rich, interactive view in the **View Tier**. It receives file metadata and initial content from the `MarkdownEditorServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `admin_editor.js`: Contains all the client-side logic for WebSocket communication and live preview rendering.\n    *   **marked.js**: The Markdown rendering library, included in the footer.\n\n4.  **In-Depth Breakdown**\n\n    *   **Data Attributes**: The `<body>` tag includes `data-file-id` and `data-editor-mode` attributes, which are used by the JavaScript to establish the correct WebSocket connection and set the initial editor state (view or edit).\n    *   **Header**: Displays the filename and a live connection status indicator (`#connection-status`).\n    *   **Layout**:\n        *   A `<textarea id=\"editor\">` serves as the raw text input. The initial content is populated directly from the servlet.\n        *   A `<div id=\"preview\">` is the target for the rendered HTML output from marked.js.\n    *   **View/Edit Toggle**: A switch (`<input type=\"checkbox\" id=\"view-toggle\">`) allows the user to toggle between a side-by-side editing view and a full-width preview-only mode.'),
('src/main/webapp/views/admin/admin_events_list.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the main \"Event Management\" page. It displays a table of all events and embeds all necessary data and modals for a rich, single-page-application-like experience.\n\n2.  **Architectural Role**\n\n    This is a complex **View Tier** page. It receives lists of events, courses, users, items, and kits from the `AdminEventServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `admin_events_list.js`: The core script that drives all interactivity.\n    *   `event_modals.jspf`: Included to provide the HTML for the various event-related modals.\n\n4.  **In-Depth Breakdown**\n\n    *   **Data Embedding**: Includes several `<script type=\"application/json\">` tags. This is a key technique used to pass large amounts of data (like the lists of all courses, items, and kits) to the client-side JavaScript without cluttering the HTML. The `admin_events_list.js` script then parses this JSON.\n    *   **Main Table**: Renders a table of all events, showing key information like name, date, location, and status. Each row includes buttons for \"Edit\", \"Delete\", and \"Assign Users\", which trigger the various modals.\n    *   **Modals**: The included `event_modals.jspf` provides the structure for the comprehensive create/edit modal and the user assignment modal.'),
('src/main/webapp/views/admin/admin_feedback.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the administrative \"Feedback Board\" using a Kanban-style layout. It displays feedback submissions as cards organized into columns based on their status.\n\n2.  **Architectural Role**\n\n    This is an interactive **View Tier** page. It receives a map of grouped feedback submissions from the `AdminFeedbackServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `admin_feedback.js`: Provides the drag-and-drop and modal logic.\n    *   **SortableJS**: The third-party library that enables drag-and-drop, included via a WebJar.\n\n4.  **In-Depth Breakdown**\n\n    *   **Board Structure**: It iterates over the `feedbackStatusOrder` list to create the columns (`<div class=\"feedback-column\">`) in the correct order.\n    *   **Columns and Cards**: For each status, it retrieves the corresponding list of submissions from the `groupedSubmissions` map. It then iterates through this list to render each submission as a \"card\" (`<div class=\"feedback-card-item\">`).\n    *   **Data Attributes**: Each card includes `data-id` attributes, which are essential for the JavaScript to identify the submission when it''s clicked or dragged.\n    *   **Details Modal**: Includes the HTML for the `#feedback-details-modal`, which is used to show the full content of a submission and allow the admin to change its status.'),
('src/main/webapp/views/admin/admin_files.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the main \"File & Category Management\" page. It displays files grouped by category and provides forms and modals for creating/managing both files and categories.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** page. It receives a map of grouped files (`groupedFiles`) and a list of all categories (`allCategories`) from the `AdminFileManagementServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `admin_files.js`: Provides client-side logic for the modals.\n    *   JSTL Core Library: Used extensively for iterating over the data structures.\n\n4.  **In-Depth Breakdown**\n\n    *   **Category Management**: Includes forms for creating a new category and a modal (`#edit-category-modal`) for editing existing ones.\n    *   **File Upload Form**: A prominent form at the top of the page for uploading new files.\n    *   **File Display**: It iterates through the `groupedFiles` map. For each category, it renders a heading. It then iterates through the files within that category, displaying each one''s name, upload date, and a set of action buttons (Edit, Reassign, New Version, Delete).\n    *   **Modals**: Includes the modals for uploading a new version and reassigning a file to a different category.'),
('src/main/webapp/views/admin/admin_kits.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the administrative interface for managing inventory kits. It uses an accordion-style layout to display each kit and its contents.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** page. It receives a list of kits with their items (`allKitsWithItems`) and a DTO of all selectable items (`allSelectableItemsJson`) from the `AdminKitServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `admin_kits.js`: The core script that handles all dynamic behavior.\n\n4.  **In-Depth Breakdown**\n\n    *   **Data Embedding**: Like `admin_events_list.jsp`, it embeds the list of all selectable items as a JSON blob inside a `<script>` tag for easy access by the JavaScript.\n    *   **Accordion Layout**: It iterates over the `allKitsWithItems` list. For each kit, it creates a header (`.kit-header`) and a content area (`.kit-content`).\n    *   **Kit Content**: The content area contains a form (`.update-kit-items-form`). Inside this form, it iterates over the `kit.items` list to render the initial rows of items belonging to that kit. Each row contains a dropdown, a quantity input, and a remove button.\n    *   **Modals**: Includes the `#kit-modal` for creating/editing the main kit metadata (name, location, etc.).'),
('src/main/webapp/views/admin/admin_log.jsp', '1.  **File Overview & Purpose**\n\n    This JSP is responsible for rendering the administrative audit log. It displays a chronological list of all actions performed by administrators.\n\n2.  **Architectural Role**\n\n    This is a simple read-only **View Tier** page. It receives a list of `AdminLog` objects from the `AdminLogServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   JSTL Core Library: Used to iterate over the `logs` list.\n    *   `table_scripts.jspf`: Included to provide client-side filtering and sorting for the log table.\n\n4.  **In-Depth Breakdown**\n\n    *   **Main Content**: Displays a header and a filter input for the table.\n    *   **Data Table**: Renders a table with columns for Timestamp, Admin, Action Type, and Details. It uses a `<c:forEach>` loop to iterate through the `logs` collection and display each log entry''s properties.'),
('src/main/webapp/views/admin/admin_matrix.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the complex \"Qualification Matrix\". It constructs a large table showing users versus meetings, with cells indicating attendance status.\n\n2.  **Architectural Role**\n\n    This is a data-dense **View Tier** page. It receives four key data structures from the `MatrixServlet` (`allUsers`, `allCourses`, `meetingsByCourse`, `attendanceMap`) and uses them to build the matrix.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `admin_matrix.js`: Provides the logic for the attendance modal.\n    *   JSTL Core Library: Essential for the nested loops required to build the table.\n\n4.  **In-Depth Breakdown**\n\n    *   **Table Structure**: Uses advanced CSS (`position: sticky`) to create sticky headers for both the user column and the course/meeting rows, making the large table navigable.\n    *   **Header Generation**:\n        *   It uses a nested `<c:forEach>` loop. The outer loop iterates over `allCourses` to create the main column headers (`<th>`).\n        *   The inner loop iterates over `meetingsByCourse[course.id]` to create the sub-header for each meeting under its parent course.\n    *   **Row Generation**:\n        *   The main outer loop iterates over `allUsers` to create each row (`<tr>`). The first cell is the sticky user name.\n    *   **Cell Generation**:\n        *   Inside the user loop, another nested loop iterates over courses and their meetings again.\n        *   For each cell, it constructs a unique key: `$${user.id}-$${meeting.id}`.\n        *   It then uses this key to look up the attendance record directly from the `attendanceMap`: `$${attendanceMap[key]}`.\n        *   Based on the status of the fetched attendance record, it applies a CSS class (`status-attended`, `status-absent`, etc.) to color the cell and displays an appropriate icon.\n        *   Each cell also includes all necessary `data-*` attributes to power the attendance modal.'),
('src/main/webapp/views/admin/admin_meeting_list.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the page for managing the specific meeting instances for a given course template. It lists all scheduled meetings and provides a modal for creating/editing them.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** page. It receives the parent `Course` object and a list of its `meetings` from the `AdminMeetingServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `admin_meeting_list.js`: Provides the client-side interactivity for the modal.\n    *   JSTL Core Library: Used to iterate over the `meetings` list and populate the user dropdown.\n\n4.  **In-Depth Breakdown**\n\n    *   **Header**: Displays the name of the parent course and a \"Back\" button.\n    *   **Main Table**: Shows a list of all meetings for this course, with details like date, time, and leader. Each row has \"Edit\" and \"Delete\" buttons.\n    *   **Modal (`#meeting-modal`)**:\n        *   Contains the form for creating or editing a meeting.\n        *   The \"Leader\" dropdown (`<select>`) is populated by iterating over the `allUsers` list passed from the servlet.\n        *   Includes an area (`#attachments-list`) where existing attachments are dynamically listed by the JavaScript.\n        *   Includes a file input for adding a new attachment when creating or editing a meeting.'),
('src/main/webapp/views/admin/admin_reports.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the main \"Reports & Analytics\" dashboard. It displays several charts visualizing system data and provides links to detailed, tabular reports.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** page focused on data visualization. It receives pre-aggregated data and chart-ready JSON from the `AdminReportServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `admin_reports.js`: The script that initializes the Chart.js instances.\n    *   **Chart.js**: The charting library, included via CDN.\n\n4.  **In-Depth Breakdown**\n\n    *   **Data Embedding**: Similar to other complex pages, it embeds the JSON data for the charts in `<script type=\"application/json\">` tags (`#eventTrendData`, `#userActivityData`), which are then read by `admin_reports.js`.\n    *   **Chart Canvases**: Includes `<canvas>` elements that serve as the rendering targets for the two main charts (Event Trend and User Activity).\n    *   **Detailed Report Links**: Provides a list of links to generate specific tabular reports (e.g., `/admin/berichte?report=eventParticipation`). Each link includes an \"Export to CSV\" counterpart.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/webapp/views/admin/admin_requests.jsp', '1.  **File Overview & Purpose**\n\n    This JSP displays the list of pending user profile change requests for administrative review.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** page. It receives a list of `ProfileChangeRequest` objects from the `AdminChangeRequestServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `admin_requests.js`: Provides the AJAX logic for approving/denying requests.\n    *   JSTL Core Library: To iterate over the `pendingRequests` list.\n\n4.  **In-Depth Breakdown**\n\n    *   **Main Table**: Renders a table of pending requests.\n    *   **Dynamic Content**: For each request, it displays who made the request and when. The \"Requested Changes\" column contains a `<c:forEach>` loop that iterates over the `request.requestedChangesMap` (a map parsed from the JSON in the servlet) to display a human-readable list of the requested changes (e.g., \"Email: new@email.com\").\n    *   **Action Forms**: Each row contains two small, separate forms for \"Approve\" and \"Deny\". These forms are handled by `admin_requests.js` to perform the action via AJAX without a full page reload.'),
('src/main/webapp/views/admin/admin_storage_list.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the main administrative inventory management page. It displays a comprehensive table of all storage items and provides access to various management modals.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** page. It receives a list of `StorageItem` objects from the `AdminStorageServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `admin_storage_list.js`: Provides all client-side logic for modals and the lightbox.\n    *   `storage_modals.jspf`: Included to provide the HTML for all inventory-related modals.\n    *   `table_scripts.jspf`: Included for client-side table sorting and filtering.\n\n4.  **In-Depth Breakdown**\n\n    *   **Main Table**: A large, sortable table displaying all properties of each storage item.\n    *   **Conditional Formatting**: Uses JSTL `<c:if>` tags and EL to conditionally display information, such as the `defectReason` or the `currentHolderUsername`.\n    *   **Action Buttons**: Each row has a set of action buttons that trigger different modals. The `data-*` attributes on these buttons are heavily used to pass the item''s current state to the JavaScript that populates the modals. For example, the \"Repair\" button includes `data-defective-qty`.'),
('src/main/webapp/views/admin/admin_system.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the \"Systemstatus\" page. It provides the static HTML structure, and all data is loaded and updated in real-time by JavaScript.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** page that acts as a container for a live-updating dashboard.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `admin_system.js`: The script that fetches and displays the system stats.\n\n4.  **In-Depth Breakdown**\n\n    *   **Structure**: The page is composed of several `.card` elements, one for each metric (CPU, RAM, Disk, Uptime, Battery).\n    *   **Progress Bars**: Each card contains a `.progress-bar-container` and an inner `.progress-bar`, whose `width` is manipulated by the JavaScript.\n    *   **Placeholders**: The text elements (e.g., `#cpu-text`, `#ram-text`) contain initial \"Loading...\" text, which is replaced by the data fetched via AJAX.\n    *   **Conditional Display**: The Uptime and Battery cards are initially visible but will be hidden by `admin_system.js` if the API reports that the data is not available on the host system.'),
('src/main/webapp/views/admin/admin_user_details.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the detailed profile view of a single user, as seen by an administrator. It displays their core information and their complete event participation history.\n\n2.  **Architectural Role**\n\n    This is a read-only **View Tier** page. It receives a `User` object and their `eventHistory` from the `AdminUserServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   JSTL Core Library: Used to display user properties and iterate over their event history.\n\n4.  **In-Depth Breakdown**\n\n    *   **User Details Card**: Displays all the core profile information for the user (`$${user.username}`, `$${user.email}`, etc.).\n    *   **Event History Table**: Iterates over the `eventHistory` list to show every event the user has been associated with, including the event name, date, and the user''s final status for that event (e.g., \"ZUGWIESEN\").'),
('src/main/webapp/views/admin/admin_users.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the main \"User Management\" page. It displays a table of all users and includes the comprehensive modal for creating and editing users and their permissions.\n\n2.  **Architectural Role**\n\n    This is a complex, interactive **View Tier** page. It receives lists of users, roles, and permissions from the `AdminUserServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `admin_users.js`: The core script that drives all AJAX-based actions and modal logic.\n    *   `user_modals.jspf`: Included to provide the HTML for the user edit modal.\n    *   `table_scripts.jspf`: Included for client-side table sorting and filtering.\n\n4.  **In-Depth Breakdown**\n\n    *   **Data Embedding**: Embeds the grouped permissions map as a JSON blob in a `<script>` tag for use by `admin_users.js`.\n    *   **Main Table**: Displays a list of all users. Each row includes the user''s core data and a set of action buttons/forms (Edit, Details, Reset Password, Unlock, Delete).\n    *   **Action Forms**: Actions like \"Reset Password\" are wrapped in their own `<form>` tags. The submission of these forms is intercepted by `admin_users.js` to be handled via AJAX.\n    *   **Modal**: The included `user_modals.jspf` provides the tabbed modal structure, which is dynamically populated by the JavaScript.'),
('src/main/webapp/views/admin/report_display.jsp', '1.  **File Overview & Purpose**\n\n    This JSP is a generic template for displaying any detailed, tabular report. It receives a list of data, a title, and column headers from the `AdminReportServlet` and renders them in a simple, clean table.\n\n2.  **Architectural Role**\n\n    This is a reusable **View Tier** template.\n\n3.  **Key Dependencies & Libraries**\n\n    *   JSTL Core Library: For iterating over the data.\n    *   `table_scripts.jspf`: For client-side sorting and filtering.\n\n4.  **In-Depth Breakdown**\n\n    *   **Dynamic Title**: The page title and header are set dynamically using `$${reportTitle}`.\n    *   **Dynamic Table Headers**: It iterates over the `columnHeaders` list to dynamically generate the `<th>` elements for the table.\n    *   **Dynamic Table Rows**: It uses a nested loop. The outer loop iterates over each row in the `reportData` list (where each row is a map). The inner loop iterates over the `columnHeaders` list again to ensure that the data for each cell is pulled from the map in the correct order (`row[header]`).'),
('src/main/webapp/views/auth/login.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the application''s login page. It displays the login form and handles the display of error messages, including the lockout timer.\n\n2.  **Architectural Role**\n\n    This is the primary entry point **View Tier** page for unauthenticated users.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `login.js`: Handles the client-side lockout countdown timer.\n    *   `passkey_auth.js`: Provides the logic for the \"Login with Passkey\" button.\n\n4.  **In-Depth Breakdown**\n\n    *   **Error Display**: Uses `<c:if>` to conditionally display login error messages or lockout warnings passed from the `LoginServlet` via the session.\n    *   **Lockout Timer**: If a lockout is active (`$${lockoutEndTime}` is not empty), it renders the `#lockout-timer` div with `data-*` attributes containing the end time. This `div` is then activated by `login.js`.\n    *   **Login Form**: A standard HTML form that POSTs to `/login`. It includes the hidden CSRF token field.\n    *   **Passkey Button**: Includes the \"Login with Passkey\" button, which is controlled by `passkey_auth.js`.'),
('src/main/webapp/views/auth/logout.jsp', '1.  **File Overview & Purpose**\n\n    This JSP displays a simple \"You have been logged out\" confirmation message. It is designed to be shown briefly before the user is automatically redirected.\n\n2.  **Architectural Role**\n\n    This is a transitional **View Tier** page.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `logout.js`: Contains the JavaScript `setTimeout` that automatically redirects the user to the login page.\n\n4.  **In-Depth Breakdown**\n\n    *   The page contains a simple message and a spinner icon to indicate that something is happening. The user is not expected to interact with this page, as the redirect is automatic.'),
('src/main/webapp/views/error/error400.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders a custom, themed page for the HTTP 400 (Bad Request) error.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** component for error handling. It uses the standard error page header and footer fragments.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `error400.js`: Provides the animated \"console output\" effect.\n\n4.  **In-Depth Breakdown**\n\n    *   The page is styled to look like a droid''s diagnostic screen. It contains a `<pre>` tag (`#output`) that serves as the target for the animated text generated by the JavaScript.'),
('src/main/webapp/views/error/error401.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders a custom, themed page for the HTTP 401 (Unauthorized) error.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** component for error handling, designed to provide a more engaging user experience for an authentication failure.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `error401.js`: Provides the card scanner animation.\n\n4.  **In-Depth Breakdown**\n\n    *   The page is styled to look like a security card scanner. The JavaScript animates the scanning light, progress bar, and status text to simulate a failed access attempt before showing the link to the login page.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/webapp/views/error/error403.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders a custom, themed page for the HTTP 403 (Forbidden) error, indicating an authorization failure.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** component for error handling.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `error403.js`: Provides the animated \"security console\" typing effect.\n\n4.  **In-Depth Breakdown**\n\n    *   The page is styled to resemble a security system terminal. The JavaScript simulates the typing of a security log, showing the system identifying the user and then denying access based on their permissions, before displaying a link back to the home page.'),
('src/main/webapp/views/error/error404.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders a custom, themed page for the HTTP 404 (Not Found) error.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** component for error handling.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `error404.js`: Provides the animated \"bash terminal\" effect.\n\n4.  **In-Depth Breakdown**\n\n    *   The page is styled to look like a Linux terminal window. The JavaScript animates the typing of an `ls` command for the requested (but non-existent) resource, displays the \"No such file or directory\" error, and then presents a clickable `cd /home` command to guide the user back to safety.'),
('src/main/webapp/views/error/error500.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders a custom, themed page for the HTTP 500 (Internal Server Error).\n\n2.  **Architectural Role**\n\n    This is a **View Tier** component for error handling.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `error500.js`: Provides the interactive \"system diagnostic\" animation.\n\n4.  **In-Depth Breakdown**\n\n    *   The page is styled to look like a system diagnostic tool. The user can click a button to initiate a simulated diagnostic check, which is animated by the JavaScript to provide a humorous and engaging way to present the server error.'),
('src/main/webapp/views/error/error503.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders a custom, themed page for the HTTP 503 (Service Unavailable) error.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** component for error handling.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `error503.js`: Provides the animated \"system reboot\" console effect.\n\n4.  **In-Depth Breakdown**\n\n    *   The page is styled to look like a server reboot console. The JavaScript animates the typing of reboot sequence messages and updates a progress bar, before automatically redirecting the user to the login page after a delay.'),
('src/main/webapp/views/error/error_generic.jsp', '1.  **File Overview & Purpose**\n\n    This JSP serves as a generic, catch-all error page. It is used for any unhandled exceptions or error codes that do not have a specific, themed page.\n\n2.  **Architectural Role**\n\n    This is the default **View Tier** component for error handling.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   It displays a simple, non-themed error message. It includes a section to display the exception details (`$${requestScope[''jakarta.servlet.error.exception'']}`) which is useful for debugging but should ideally be disabled in a production environment for security reasons.'),
('src/main/webapp/views/public/calendar.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the main \"Kalender\" page. It provides three different views of the schedule: a full-grid monthly calendar (powered by FullCalendar.js), a weekly list, and a simple chronological list optimized for mobile devices.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** page. It receives calendar data and date calculation helpers from the `CalendarServlet` and renders the appropriate view based on the user''s screen size (controlled by CSS).\n\n3.  **Key Dependencies & Libraries**\n\n    *   `calendar.js`: The script that initializes the FullCalendar component.\n    *   **FullCalendar.js**: The third-party library for the interactive calendar, included via CDN in the header.\n    *   JSTL Core & Functions Library: Used for conditional logic and date formatting.\n\n4.  **In-Depth Breakdown**\n\n    *   **View Switching**: The entire page is structured with wrappers (`.desktop-only`, `.mobile-only`) that are shown or hidden by the main `style.css` based on media queries.\n    *   **Desktop View (FullCalendar)**: Contains a single `div` (`#calendar-container`) which is the target for the FullCalendar.js instance created by `calendar.js`.\n    *   **Desktop View (Weekly/Monthly List - Fallback)**: These sections are likely legacy or for non-JS users. They use JSTL loops to build a table-based calendar grid, placing events in the correct cells based on the data maps provided by the servlet.\n    *   **Mobile View**: Renders a simple `<ul>` by iterating over the `mobileEntries` list. Each `<li>` represents a single event or meeting, displaying its date and title.'),
('src/main/webapp/views/public/dateien.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the public \"Dateien & Dokumente\" page. It displays a list of files, grouped by category, that are accessible to the logged-in user.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** page. It receives a map of grouped files (`fileData`) from the `FileServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `dateien.js`: Provides the client-side logic for the \"Upload New Version\" modal.\n    *   JSTL Core Library: Used to iterate over the map of categories and the lists of files.\n\n4.  **In-Depth Breakdown**\n\n    *   **Main Content**: Displays the page header and a search/filter input.\n    *   **File Listing**: It uses a nested `<c:forEach>` loop. The outer loop iterates through the `fileData` map (categories). For each category, it prints a heading. The inner loop then iterates through the files in that category, rendering a `div` for each file.\n    *   **File Item**: Each file item displays an icon, the filename, and the upload date. It includes a \"Download\" button and, if the user has `FILE_UPDATE` permission, a \"New Version\" button that triggers the modal.'),
('src/main/webapp/views/public/eventDetails.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the detailed view of a single event. It is a highly complex and interactive page, displaying event details, a task list, assigned personnel, attachments, and a real-time chat.\n\n2.  **Architectural Role**\n\n    This is a rich, dynamic **View Tier** page. It receives a fully aggregated `Event` object from the `EventDetailsServlet` and uses extensive JavaScript to provide interactivity.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `eventDetails.js`: The core script that manages all client-side logic for tasks, chat, and modals.\n    *   `task_modal.jspf`: Included to provide the HTML for the task creation/editing modal.\n    *   **marked.js**: Used by the JavaScript to render Markdown in the chat and task details.\n\n4.  **In-Depth Breakdown**\n\n    *   **Data Embedding**: Embeds several JSON blobs (`allTasks`, `allUsersForEvent`, `allItems`, `allKits`) in `<script>` tags for use by `eventDetails.js`.\n    *   **Event Information**: Displays the main event details (name, date, location, description, leader).\n    *   **Task List**: Iterates over the `event.eventTasks` list to display all tasks. Each task includes its description, status, and assigned users. Action buttons (Claim, Mark as Done, Edit) are shown conditionally based on the user''s permissions and association with the task.\n    *   **Chat Interface**: If the event is currently active (`event.status == ''LAUFEND''`), it renders the chat container (`#chat-messages-container`) and the message input form. The `eventDetails.js` script populates this container with messages via the WebSocket connection.\n    *   **Attachments**: Displays a list of attachments available to the user.'),
('src/main/webapp/views/public/events.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the main \"Veranstaltungen\" (Events) page, listing all upcoming events and allowing users to sign up or sign off.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** page. It receives an enriched list of `Event` objects from the `EventServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `events.js`: Provides the logic for the sign-up modal and for handling sign-offs from running events.\n    *   JSTL Core Library: Used to iterate over the `upcomingEvents` list.\n\n4.  **In-Depth Breakdown**\n\n    *   **Event Listing**: It iterates over the `upcomingEvents` list, displaying each event in a responsive card layout.\n    *   **Conditional Actions**: The core logic is in the \"Actions\" section of each card.\n        *   It uses `<c:choose>`, `<c:when>`, and `<c:otherwise>` to display the correct button based on the user''s status for that event (`event.userAttendanceStatus`). The options are \"Sign Off\", \"Sign Up\", or a \"Finalized\" message.\n        *   The \"Sign Up\" button is disabled if `!event.isUserQualified`.\n    *   **Modals**:\n        *   `#signup-modal`: The modal for event sign-ups. It contains a container (`#custom-fields-container`) that is dynamically populated with custom fields by `events.js`.\n        *   `#signoff-reason-modal`: A special modal that is shown by `events.js` if a user tries to sign off from an event that is already in progress.'),
('src/main/webapp/views/public/feedback.jsp', '1.  **File Overview & Purpose**\n\n    This JSP provides the form for users to submit general feedback, such as bug reports or feature requests.\n\n2.  **Architectural Role**\n\n    This is a simple form-based **View Tier** page. It submits data to the `FeedbackServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **Form**: Contains a standard HTML form that POSTs to `/feedback`.\n    *   **Fields**: Includes input fields for the `subject` and a `textarea` for the `content` of the feedback.\n    *   **CSRF Token**: Includes the hidden `csrfToken` input field for security.');

-- This script populates the wiki_documentation table with the next batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/webapp/views/public/feedback_form.jsp', '1.  **File Overview & Purpose**\n\n    This JSP displays the feedback form for a *specific* event after it has concluded. It allows users to give a star rating and leave comments.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** page. It receives `event` and `form` objects from the `FeedbackServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **Header**: Displays the title of the event for which feedback is being given.\n    *   **Form**: A form that POSTs to `/feedback`.\n    *   **Star Rating**: Implements a CSS-based star rating input using radio buttons (`<input type=\"radio\">`) and styled `<label>` tags.\n    *   **Fields**: Includes a `textarea` for comments and hidden inputs for the `formId` and `action`.'),
('src/main/webapp/views/public/home.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the user''s main dashboard or home page. It provides a personalized overview of their upcoming responsibilities and tasks.\n\n2.  **Architectural Role**\n\n    This is the main landing page for authenticated users in the **View Tier**. It receives several lists of data from the `HomeServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   JSTL Core Library: Used to iterate over the data lists.\n\n4.  **In-Depth Breakdown**\n\n    *   **Layout**: Uses a responsive grid layout to display multiple widgets.\n    *   **\"My Next Events\" Widget**: Iterates over the `assignedEvents` list to show the top events the user is assigned to.\n    *   **\"My Open Tasks\" Widget**: Iterates over the `openTasks` list, displaying each task and the name of the event it belongs to.\n    *   **\"Upcoming Events\" Widget**: Iterates over the `upcomingEvents` list to show general upcoming events the user might be interested in.\n    *   **Conditional Display**: Each widget uses `<c:choose>` to display an appropriate \"no items\" message if the corresponding list is empty.'),
('src/main/webapp/views/public/lager.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the main public inventory (\"Lager\") page. It displays all inventory items, grouped by location, and provides functionality for users to check items in or out.\n\n2.  **Architectural Role**\n\n    This is an interactive **View Tier** page. It receives a map of grouped items (`storageData`) and a list of `activeEvents` from the `StorageServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `lager.js`: Provides the logic for the transaction modal and image lightbox.\n    *   `storage_modals.jspf`: Included to provide the HTML for the transaction modal.\n\n4.  **In-Depth Breakdown**\n\n    *   **Filtering**: Includes a search input for client-side filtering.\n    *   **Inventory Display**: Uses a nested `<c:forEach>` loop. The outer loop iterates through the `storageData` map to create a heading for each location. The inner loop iterates through the items in that location, rendering a responsive card for each.\n    *   **Item Card**: Each card displays the item''s image, name, and availability status (using the `getAvailabilityStatusCssClass` convenience method from the model). It includes buttons to view details and to open the transaction modal. The transaction button (`.transaction-btn`) is packed with `data-*` attributes holding all the item''s quantity information for use by `lager.js`.'),
('src/main/webapp/views/public/lehrgaenge.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the \"Lehrgänge\" (Courses/Meetings) page, which lists all upcoming training sessions and allows users to sign up or sign off.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** page. It receives a list of `Meeting` objects (enriched with the user''s status) from the `MeetingServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   JSTL Core Library: Used to iterate over the list of meetings.\n\n4.  **In-Depth Breakdown**\n\n    *   **Meeting Listing**: It iterates over the `meetings` list and displays each meeting as a card.\n    *   **Meeting Card**: Each card shows the parent course name, the specific meeting title, date, location, and leader.\n    *   **Action Buttons**: The \"Actions\" section uses a `<c:choose>` block to display the correct button based on the meeting''s `userAttendanceStatus`. Users can see if they are signed up (\"Abmelden\"), not signed up (\"Anmelden\"), or if the meeting is in the past.'),
('src/main/webapp/views/public/meetingDetails.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the detailed view for a single scheduled meeting.\n\n2.  **Architectural Role**\n\n    This is a **View Tier** page. It receives a `Meeting` object and a list of `attachments` from the `MeetingDetailsServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   JSTL Core Library: For displaying meeting properties and iterating over attachments.\n\n4.  **In-Depth Breakdown**\n\n    *   **Main Details**: Displays all the core information about the meeting, such as its name, date/time range, location, leader, and description.\n    *   **Attachments**: If there are any attachments, it displays them in a list, with a download link for each one.'),
('src/main/webapp/views/public/my_feedback.jsp', '1.  **File Overview & Purpose**\n\n    This JSP displays a list of all general feedback submissions made by the currently logged-in user, allowing them to track the status of their suggestions and bug reports.\n\n2.  **Architectural Role**\n\n    This is a read-only **View Tier** page. It receives a list of `FeedbackSubmission` objects from the `MyFeedbackServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   JSTL Core Library: For iterating over the user''s submissions.\n\n4.  **In-Depth Breakdown**\n\n    *   **Feedback Listing**: It iterates over the `submissions` list and displays each one in a card.\n    *   **Feedback Card**: Each card shows the submission''s subject, a snippet of the content, the submission date, and its current `status`. The status text is styled with a CSS class based on its value (e.g., `status-new`, `status-done`) for better visual identification.'),
('src/main/webapp/views/public/pack_kit.jsp', '1.  **File Overview & Purpose**\n\n    This JSP provides a simple, printable packing list for a specific inventory kit. It is designed with a minimal layout, intended to be accessed via a QR code scan.\n\n2.  **Architectural Role**\n\n    This is a utility **View Tier** page with a specialized layout. It receives a `kit` object and a list of `kitItems` from the `PackKitServlet`.\n\n3.  **In-Depth Breakdown**\n\n    *   **Minimal Layout**: The `main_header.jspf` is intentionally *not* included. This page has its own minimal `<head>` section to create a clean, print-friendly view without the sidebar or other site navigation.\n    *   **Header**: Displays the name and description of the kit.\n    *   **Packing List**: Renders a simple table that lists the required quantity and name for each item in the kit. It also includes a checkbox for each item, allowing a user to physically check off items as they pack the kit.'),
('src/main/webapp/views/public/passwort.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the form that allows a logged-in user to change their own password.\n\n2.  **Architectural Role**\n\n    This is a simple form-based **View Tier** page that submits data to the `PasswordServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **Form**: Contains a standard HTML form with fields for the current password, new password, and new password confirmation.\n    *   **Password Toggle**: Each password input has a corresponding icon (`.password-toggle-icon`) that allows the user to toggle the visibility of the password text. This functionality is provided by the global `main.js`.\n    *   **CSRF Token**: Includes the hidden `csrfToken` input field.'),
('src/main/webapp/views/public/profile.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the user''s \"My Profile\" page. It is a comprehensive page that displays a wide range of user-specific information in different sections.\n\n2.  **Architectural Role**\n\n    This is a data-rich **View Tier** page. It receives a large amount of data from the `ProfileServlet`, including the `user` object, `eventHistory`, `qualifications`, `achievements`, and `passkeys`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `profile.js`: Provides the logic for toggling the edit mode and submitting profile changes via AJAX.\n    *   `passkey_auth.js`: Provides the logic for the \"Register New Device\" button.\n\n4.  **In-Depth Breakdown**\n\n    *   **Profile Data Form**: The main user data (email, class) is displayed within a form. The `profile.js` script toggles the input fields between read-only and editable states.\n    *   **Change Request Notice**: Conditionally displays a message if the user has a pending profile change request.\n    *   **Achievements**: Iterates over the `achievements` list to display the icons and names of all earned achievements.\n    *   **Event History & Qualifications**: Displays the user''s event history and qualifications in separate tables.\n    *   **Passkey Management**: Iterates over the user''s registered `passkeys`, displaying each one with a \"Delete\" button. Also includes the \"Register New Device\" button to start the passkey registration flow.'),
('src/main/webapp/views/public/qr_action.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the simplified, mobile-friendly page for performing a quick inventory transaction, typically accessed via a QR code.\n\n2.  **Architectural Role**\n\n    This is a specialized **View Tier** page with a minimal layout. It receives an `item` object and a list of `activeEvents` from the `StorageItemActionServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `qr_action.js`: Provides the dynamic client-side validation for the quantity input.\n\n4.  **In-Depth Breakdown**\n\n    *   **Minimal Layout**: Like `pack_kit.jsp`, this page omits the standard header to provide a focused, full-screen experience on mobile devices.\n    *   **Form**: Contains a single form that POSTs to the `StorageTransactionServlet`. The form has `data-*` attributes that hold the item''s quantity details for use by `qr_action.js`.\n    *   **Fields**: Includes an input for quantity, a dropdown to optionally associate the transaction with an active event, and a textarea for notes.\n    *   **Action Buttons**: Includes two separate submit buttons (`<button type=\"submit\">`), one for checking out (\"Entnehmen\") and one for checking in (\"Einräumen\"). The `name` attribute of these buttons determines the `type` parameter sent to the servlet.');

-- This script populates the wiki_documentation table with the final batch of entries.
-- This content should be appended to the existing V8__Populate_wiki_data.sql file.

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/webapp/views/public/storage_item_details.jsp', '1.  **File Overview & Purpose**\n\n    This JSP renders the detailed view for a single inventory item. It displays all core data about the item, its image, and presents its transaction and maintenance history in a tabbed interface.\n\n2.  **Architectural Role**\n\n    This is a core view in the **View Tier**. It receives a `StorageItem` object, a `List<StorageLogEntry>`, and a `List<MaintenanceLogEntry>` from the `StorageItemDetailsServlet` and is responsible for rendering this data in a user-friendly format.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `storage_item_details.js`: Provides the client-side interactivity for the lightbox and tabs.\n    *   JSTL Core Library: Used extensively to display data from the model objects.\n\n4.  **In-Depth Breakdown**\n\n    *   **Main Details Card**: Displays the item''s name, image (if available), and a list of its core properties (status, quantities, location, etc.) using `$${item.propertyName}`. The image is a `.lightbox-trigger` to enable the full-screen view.\n    *   **Tabbed Interface**:\n        *   Uses two buttons (`.modal-tab-button`) to control which content pane is visible.\n        *   The **History Tab** (`#history-tab`) contains two views: a desktop table and a mobile card list, which are conditionally displayed using CSS media queries. Both views iterate over the `history` collection to display each `StorageLogEntry`.\n        *   The **Maintenance Tab** (`#maintenance-tab`) has a similar structure, iterating over the `maintenanceHistory` collection to display `MaintenanceLogEntry` objects.\n    *   **Lightbox**: The HTML for the lightbox overlay is included at the bottom of the page, ready to be activated by the JavaScript.'),
('src/main/webapp/WEB-INF/web.xml', '1.  **File Overview & Purpose**\n\n    This is the Web Application Deployment Descriptor for the TechnikTeam project. It''s a standard Jakarta EE configuration file that provides the servlet container (e.g., Tomcat) with essential information about the application''s structure, servlets, filters, listeners, and session configuration.\n\n2.  **Architectural Role**\n\n    Web/Controller Tier Configuration. This file is the primary entry point for configuring how the servlet container interacts with the application''s web components.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Guice**: The `com.google.inject.servlet.GuiceFilter` is central to the application''s architecture.\n\n4.  **In-Depth Breakdown**\n\n    *   **`<listener>`**:\n        *   `ApplicationInitializerListener`: A custom listener that runs on startup to initialize services like Flyway for database migration.\n        *   `GuiceConfig`: A `GuiceServletContextListener` that creates the Guice Injector, making dependency injection available to the application.\n        *   `AppContextListener`: A custom listener for handling application shutdown, specifically for deregistering JDBC drivers to prevent memory leaks.\n        *   `SessionListener`: A listener that tracks session creation and destruction to manage active sessions via the `SessionManager`.\n    *   **`<filter>` and `<filter-mapping>`**:\n        *   `guiceFilter`: This is the most important filter. It intercepts *all* incoming requests (`/*`) and routes them through Guice''s servlet pipeline. This allows servlets managed by Guice to have their dependencies injected automatically. `async-supported` is enabled for asynchronous operations like Server-Sent Events.\n    *   **`<session-config>`**:\n        *   `session-timeout`: Sets the session to expire after 30 minutes of inactivity.\n        *   `cookie-config`: Configures the session cookie to be `http-only` (inaccessible to client-side scripts) for security. `secure` is set to `false`, suitable for local development over HTTP.\n    *   **`<welcome-file-list>`**: Defines `/` as the welcome file, meaning requests to the root context path will be handled by the servlet mapped to `/`.\n    *   **`<jsp-config>`**: Ensures that Expression Language (EL) is enabled for all JSP and JSPF files.\n    *   **`<error-page>`**: Maps specific HTTP error codes (400, 401, 403, 404, 500, 503) and general `java.lang.Throwable` exceptions to custom error pages located in `/views/error/`. This provides a user-friendly error handling experience.');

-- This script populates the wiki_documentation table with all missing entries in a single, valid transaction.
INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/dao/CourseDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO is responsible for all CRUD (Create, Read, Update, Delete) operations on the `courses` table. It manages the lifecycle of course templates, which act as blueprints for schedulable meetings.\n\n2.  **Architectural Role**\n\n    This class belongs to the **DAO (Data Access) Tier**. It directly interacts with the database to manage course data and is primarily called by the `AdminCourseServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `Course` (Model): The data model object this DAO works with.\n\n4.  **In-Depth Breakdown**\n\n    *   **`createCourse(Course course)`**: Inserts a new course template into the database.\n    *   **`getCourseById(int courseId)`**: Retrieves a single course template by its primary key.\n    *   **`getAllCourses()`**: Fetches a list of all course templates, ordered by name.\n    *   **`updateCourse(Course course)`**: Updates the details of an existing course template.\n    *   **`deleteCourse(int courseId)`**: Deletes a course template. Due to `ON DELETE CASCADE` constraints in the database, this will also delete all associated meetings and attendance records.\n    *   **`mapResultSetToCourse(ResultSet rs)`**: A private helper method to convert a database row into a `Course` object.'),
('src/main/java/de/technikteam/dao/DatabaseManager.java', '1.  **File Overview & Purpose**\n\n    This class manages the application''s database connection pool. It uses the high-performance HikariCP library to create and manage a pool of database connections, which is significantly more efficient than opening a new connection for every database query. It is configured as a Guice Singleton to ensure only one connection pool exists for the entire application.\n\n2.  **Architectural Role**\n\n    This is a critical **Infrastructure** component supporting the **DAO (Data Access) Tier**. It is injected into every DAO class, providing them with a standardized way to obtain database connections.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `ConfigurationService`.\n    *   **HikariCP (`com.zaxxer.hikari.HikariDataSource`)**: The underlying connection pooling library.\n    *   `ConfigurationService`: Used to get the database URL, username, and password from `config.properties`.\n\n4.  **In-Depth Breakdown**\n\n    *   **`DatabaseManager(ConfigurationService configService)` (Constructor)**: This is where the connection pool is initialized. It reads the database credentials, sets various pool parameters (like pool size and timeouts), and creates the `HikariDataSource` instance. It throws a `RuntimeException` if initialization fails, preventing the application from starting without a valid database connection.\n    *   **`getConnection()`**: The primary method called by DAOs. It borrows a connection from the pool. If the pool is exhausted or unavailable, it will wait for a connection to become free or throw a `SQLException`.\n    *   **`closeDataSource()`**: A cleanup method (not currently called but good practice to have) that would shut down the entire connection pool.'),
('src/main/java/de/technikteam/dao/EventChatDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages all database interactions for the real-time event chat feature. It handles posting new messages, retrieving the chat history for an event, and performing updates (edits) and soft deletes on messages in the `event_chat_messages` table.\n\n2.  **Architectural Role**\n\n    This class belongs to the **DAO (Data Access) Tier**. It is used exclusively by the `EventChatSocket` WebSocket endpoint to persist and retrieve chat data.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `EventChatMessage` (Model): The data model for a chat message.\n\n4.  **In-Depth Breakdown**\n\n    *   **`postMessage(EventChatMessage message)`**: Inserts a new chat message and returns the fully populated object (including the new ID and timestamp) by calling `getMessageById` immediately after insertion.\n    *   **`getMessagesForEvent(int eventId)`**: Retrieves the entire chat history for an event, ordered by time. It performs a `LEFT JOIN` on the `users` table to get the `chat_color` for the sender and the username of the person who deleted a message.\n    *   **`updateMessage(int messageId, int userId, String newText)`**: Updates the text of a message. It includes a `WHERE` clause to ensure a user can only edit their own messages and that the message has not been deleted.\n    *   **`deleteMessage(int messageId, int deletersUserId, boolean isAdmin)`**: Performs a soft delete by setting the `is_deleted` flag and recording who deleted the message. The SQL query is conditional: if `isAdmin` is true, any message can be deleted; otherwise, the `WHERE` clause ensures a user can only delete their own messages.'),
('src/main/java/de/technikteam/dao/EventCustomFieldDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages the database operations for custom event sign-up fields. It handles saving the definitions of custom fields for an event (`event_custom_fields` table) and saving user responses to those fields (`event_custom_field_responses` table).\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is used by the `EventService` to save field definitions and by the `EventActionServlet` to save user responses during sign-up.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `EventCustomField`, `EventCustomFieldResponse` (Models): The data models this DAO works with.\n\n4.  **In-Depth Breakdown**\n\n    *   **`saveCustomFieldsForEvent(...)`**: A transactional method that first deletes all existing custom fields for an event and then uses a batch insert to add the new list of fields. This ensures the set of fields is always in sync with what was submitted in the admin form.\n    *   **`getCustomFieldsForEvent(int eventId)`**: Retrieves all custom field definitions for a given event, used to build the sign-up modal.\n    *   **`saveResponse(EventCustomFieldResponse response)`**: Saves a single user''s answer to a custom field. It uses an `INSERT ... ON DUPLICATE KEY UPDATE` statement so a user can change their response without causing a database error.'),
('src/main/java/de/technikteam/dao/EventDAO.java', '1.  **File Overview & Purpose**\n\n    This is one of the most complex and central DAOs in the application. It manages all database operations for the `events` table and its many related tables, including `event_attendance`, `event_assignments`, `event_skill_requirements`, and `event_storage_reservations`. It provides a wide range of methods for CRUD operations, user interactions (sign-up/off), and complex queries for reporting and the UI.\n\n2.  **Architectural Role**\n\n    This class is a cornerstone of the **DAO (Data Access) Tier**. It is used by numerous services and servlets, including `EventService`, `AdminEventServlet`, `HomeServlet`, `EventDetailsServlet`, and `ReportDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `Event`, `User`, `SkillRequirement`, `StorageItem` (Models): The various data models this DAO creates and populates.\n\n4.  **In-Depth Breakdown**\n\n    *   **Transactional Methods (`createEvent`, `updateEvent`, `saveSkillRequirements`, `saveReservations`)**: These methods are designed to be called within a transaction managed by the `EventService`. They take a `Connection` object as a parameter to ensure all operations are part of the same atomic unit.\n    *   **User Interaction Methods (`signUpForEvent`, `signOffFromEvent`)**: Handle user sign-ups and sign-offs by inserting or updating records in the `event_attendance` table.\n    *   **Complex Queries**:\n        *   `getUpcomingEventsForUser(...)`: A complex query that finds events a user is qualified for by checking their qualifications against the event''s skill requirements.\n        *   `getQualifiedAndAvailableUsersForEvent(...)`: The most complex query in this DAO. It finds users who meet all skill requirements for an event AND are not assigned to another event with an overlapping time frame. This is the core of the \"Crew Finder\" feature.\n    *   **Data Aggregation**: Methods like `getEventById` and `getAllEvents` perform `LEFT JOIN`s to enrich the `Event` object with related data like the leader''s username.\n    *   **`mapResultSetToEvent` / `mapResultSetToSimpleUser`**: Private helper methods to reduce code duplication when creating model objects from query results.'),
('src/main/java/de/technikteam/dao/EventFeedbackDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages all database interactions related to event-specific feedback. It handles the creation of feedback forms (`feedback_forms` table) and the storage of user responses (`feedback_responses` table), including ratings and comments.\n\n2.  **Architectural Role**\n\n    This class belongs to the **DAO (Data Access) Tier**. It is used by the `FeedbackServlet` to facilitate the event feedback workflow after an event has concluded.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `FeedbackForm`, `FeedbackResponse` (Models): The data models this DAO works with.\n\n4.  **In-Depth Breakdown**\n\n    *   **`createFeedbackForm(FeedbackForm form)`**: Inserts a new feedback form record, typically when the first user attempts to give feedback for an event that doesn''t yet have a form.\n    *   **`saveFeedbackResponse(FeedbackResponse response)`**: Saves a user''s rating and comments. It uses an `INSERT ... ON DUPLICATE KEY UPDATE` statement to prevent a user from submitting feedback multiple times for the same event.\n    *   **`getFeedbackFormForEvent(int eventId)`**: Retrieves the feedback form associated with a specific event.\n    *   **`getResponsesForForm(int formId)`**: Fetches all submitted responses for a given form, used for administrative review.\n    *   **`hasUserSubmittedFeedback(int formId, int userId)`**: A quick check to see if a user has already provided feedback, used to prevent the form from being displayed to them again.'),
('src/main/java/de/technikteam/dao/EventTaskDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages all database operations for event tasks and their complex relationships. It handles the transactional creation and updating of tasks (`event_tasks` table) along with their associated user assignments (`event_task_assignments`), required items (`event_task_storage_items`), and required kits (`event_task_kits`).\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is a critical component used by the `TaskActionServlet` to manage tasks and by the `EventDetailsServlet` and `HomeServlet` to display task information.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides connections for its transactional methods.\n    *   `EventTask`, `User`, `StorageItem`, `InventoryKit` (Models).\n\n4.  **In-Depth Breakdown**\n\n    *   **`saveTask(...)`**: This is the core method. It wraps the entire process of saving a task and its associations in a single, manual database transaction to ensure data integrity. It first saves the main task record, then clears all existing associations, and finally batch-inserts the new user, item, and kit associations.\n    *   **`getTasksForEvent(int eventId)`**: A complex query that retrieves all tasks for an event and, using `LEFT JOIN`s, aggregates all assigned users, required items, and required kits into their respective lists within each `EventTask` object. It uses a `LinkedHashMap` to correctly group the joined data.\n    *   **User Action Methods (`claimTask`, `unclaimTask`)**: Handle a user volunteering for or leaving a task in an \"open pool\". The `claimTask` method includes a subquery to ensure the `required_persons` limit is not exceeded.\n    *   **`getOpenTasksForUser(int userId)`**: A specific query to fetch only the tasks assigned to a user that are still open, for display on their home dashboard.'),
('src/main/java/de/technikteam/dao/FeedbackSubmissionDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages all database interactions for general user feedback submissions, which are displayed on the administrative Kanban board. It handles creating new submissions, retrieving them for display, and updating their status and display order as they are moved through the workflow.\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is used by the `FeedbackServlet` to create submissions and by the `AdminFeedbackServlet` and its associated `Action` classes to manage them.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `FeedbackSubmission` (Model).\n\n4.  **In-Depth Breakdown**\n\n    *   **`createSubmission(...)`**: Inserts a new feedback record with a default status of `\"NEW\"`.\n    *   **`getAllSubmissions()`**: Retrieves all submissions, ordered first by a custom status order (to match the Kanban columns) and then by their display order within that status.\n    *   **`updateStatus(int submissionId, String newStatus, Connection conn)`**: Updates the status of a single submission. It is designed to be called within a transaction.\n    *   **`updateOrderForStatus(List<Integer> orderedIds, Connection conn)`**: A key method for the Kanban board. It takes a list of submission IDs in their new order and performs a batch `UPDATE` to set their `display_order` accordingly. This is also designed to be called within a transaction.\n    *   **`updateStatusAndTitle(...)`**: A combined update method used by the feedback details modal.'),
('src/main/java/de/technikteam/dao/FileDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO is responsible for managing both the metadata of files in the `files` and `file_categories` tables and the interaction with the physical files on the server''s filesystem. It provides a complete abstraction layer for file management.\n\n2.  **Architectural Role**\n\n    This is a hybrid **DAO (Data Access) Tier** class. It performs standard database operations but also contains logic that interacts with the filesystem, an external resource. It is used by servlets that manage or serve files, such as `FileServlet`, `AdminFileServlet`, and `MarkdownEditorServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects `DatabaseManager` and `ConfigurationService`.\n    *   `DatabaseManager`: For database connections.\n    *   `ConfigurationService`: To get the base path of the `upload.directory`.\n    *   `java.nio.file.Files`: For reading and writing physical files.\n\n4.  **In-Depth Breakdown**\n\n    *   **`getAllFilesGroupedByCategory(User user)`**: Retrieves all files and organizes them into a `Map` where the key is the category name. It includes logic to filter files based on the user''s role (`required_role`).\n    *   **Filesystem Interaction (`getDocumentContentByPath`, `updateFileContent`, `deleteFile`)**: These methods bridge the gap between the database and the filesystem.\n        *   `updateFileContent` writes a string directly to a physical file.\n        *   The `deleteFile` method is transactional in nature: it first deletes the database record, and only if that is successful, it proceeds to delete the physical file from the disk.\n    *   **Category Management (`getAllCategories`, `createCategory`, etc.)**: Provides full CRUD functionality for the `file_categories` table.'),
('src/main/java/de/technikteam/dao/InventoryKitDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages all database operations related to inventory kits. It handles the CRUD lifecycle for the kits themselves (`inventory_kits` table) and manages their contents through the `inventory_kit_items` junction table.\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is primarily used by the `AdminKitServlet` for management, the `PackKitServlet` for displaying packing lists, and `EventTaskDAO` when kits are associated with tasks.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `InventoryKit`, `InventoryKitItem` (Models).\n\n4.  **In-Depth Breakdown**\n\n    *   **CRUD Operations (`createKit`, `getKitById`, `updateKit`, `deleteKit`)**: Standard methods for managing the main kit records.\n    *   **`getAllKitsWithItems()`**: A key method that retrieves all kits and, using a `LEFT JOIN` and a `Map`-based aggregation strategy, populates each kit object with a list of its contained items and their quantities.\n    *   **`getItemsForKit(int kitId)`**: Retrieves the contents for a single, specific kit.\n    *   **`updateKitItems(...)`**: A transactional method that handles updating the contents of a kit. It first deletes all existing item associations for the kit and then performs a batch insert of the new list of items and quantities, ensuring the kit''s contents are always in sync with the last submitted form.'),
('src/main/java/de/technikteam/dao/StorageLogDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO is responsible for all interactions with the `storage_log` table. Its purpose is to create transaction records when inventory items are checked in or out, and to retrieve the history of these transactions for a specific item.\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is used by the `StorageService` to log transactions and by the `StorageItemDetailsServlet` to display an item''s history.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `StorageLogEntry` (Model): The data model for a log entry.\n\n4.  **In-Depth Breakdown**\n\n    *   **`logTransaction(...)`**: Inserts a new transaction record into the `storage_log` table. This method takes a `Connection` object as a parameter because it is designed to be called from within a larger transaction managed by the `StorageService`.\n    *   **`getHistoryForItem(int itemId)`**: Retrieves the complete transaction history for a single item, ordered from newest to oldest. It joins with the `users` table to include the username of the person who performed each transaction.'),
('src/main/java/de/technikteam/dao/TodoDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages all database operations for the administrative To-Do list feature. It handles CRUD for both categories (`todo_categories`) and tasks (`todo_tasks`), and includes methods for batch-updating their display order to support drag-and-drop functionality.\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is used exclusively by the `TodoService` to persist and retrieve all To-Do list data.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `TodoCategory`, `TodoTask` (Models).\n\n4.  **In-Depth Breakdown**\n\n    *   **`getAllCategoriesWithTasks()`**: The main retrieval method. It fetches all categories and, using a `LEFT JOIN`, also fetches all their associated tasks in a single query. It then uses a `LinkedHashMap` to aggregate the flat result set into a structured list of `TodoCategory` objects, each containing its list of `TodoTask` objects.\n    *   **`createCategory(...)` / `createTask(...)`**: These methods use a subquery (`SELECT COALESCE(MAX(display_order), -1) + 1 FROM ...`) to automatically assign the new item the next available display order index, ensuring it appears at the bottom of the list.\n    *   **`updateCategoryOrder(...)` / `updateTaskOrders(...)`**: These methods are crucial for the drag-and-drop feature. They accept a list of IDs in their new order and perform a batch `UPDATE` to efficiently persist the new sorting to the database within a single transaction.'),
('src/main/java/de/technikteam/dao/UserDAO.java', '1.  **File Overview & Purpose**\n\n    This is the central DAO for managing user accounts. It handles all database operations for the `users` table, including credential validation, CRUD operations, password changes, and managing the user-permission relationship in the `user_permissions` table.\n\n2.  **Architectural Role**\n\n    This is a critical class in the **DAO (Data Access) Tier**. It is used by the `LoginServlet` for authentication, by the `UserService` for transactional updates, and by numerous other servlets and DAOs to retrieve user information.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   **Spring Security Crypto (`BCryptPasswordEncoder`)**: The library used for securely hashing and verifying passwords.\n    *   `PermissionDAO`: Used to fetch the permissions for a user.\n\n4.  **In-Depth Breakdown**\n\n    *   **`validateUser(String username, String password)`**: The core authentication method. It fetches the user''s `password_hash` from the database and uses `passwordEncoder.matches()` to securely compare it with the provided password. If validation is successful, it fetches the user''s permissions and returns a fully populated `User` object.\n    *   **`getPermissionsForUser(int userId)`**: Retrieves all permission keys for a given user.\n    *   **`updateUserPermissions(int userId, String[] permissionIds, Connection conn)`**: A transactional method that first deletes all of a user''s existing permissions and then batch-inserts the new set.\n    *   **`createUser(...)` / `updateUser(...)`**: Standard CRUD methods. `createUser` hashes the provided password before storing it.\n    *   **`changePassword(...)`**: Securely updates a user''s password by hashing the new password before saving it.'),
('src/main/java/de/technikteam/dao/UserQualificationsDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages the `user_qualifications` table, which links users to the courses they have attended or completed. It is the persistence layer for tracking user skills and qualifications.\n\n2.  **Architectural Role**\n\n    This class belongs to the **DAO (Data Access) Tier**. It is used by the `MatrixServlet` and `AdminAttendanceServlet` to update qualifications based on meeting attendance, and by the `ProfileServlet` to display a user''s qualifications.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `UserQualification` (Model).\n\n4.  **In-Depth Breakdown**\n\n    *   **`getQualificationsForUser(int userId)`**: Retrieves all qualifications for a single user.\n    *   **`getAllQualifications()`**: Fetches all qualification records for all users, primarily for building the data structures needed by the Qualification Matrix.\n    *   **`updateQualificationStatus(...)`**: The core update method. It uses an `INSERT ... ON DUPLICATE KEY UPDATE` statement (an \"upsert\") to create or update a qualification record. It also contains special logic: if the new status is `\"NICHT BESUCHT\"`, it deletes the record entirely instead of updating it.'),
('src/main/java/de/technikteam/model/WikiEntry.java', '1.  **File Overview & Purpose**\n\n    This is a simple Plain Old Java Object (POJO) that serves as the data model for a single wiki documentation page. It represents a record from the `wiki_documentation` table.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used to transfer wiki data between the `WikiDAO`, the `WikiService`, and the administrative servlets that manage the wiki.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This is a self-contained POJO.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the wiki entry.\n        *   `filePath`: A unique string representing the path of the documented file within the project (e.g., \"src/main/java/de/technikteam/service/UserService.java\"). This is the key used for lookups.\n        *   `content`: A `longtext` field containing the Markdown documentation for the file.\n    *   **Getters and Setters**: Standard boilerplate methods for accessing and modifying the object''s properties.'),
('src/main/java/de/technikteam/service/WikiService.java', '1.  **File Overview & Purpose**\n\n    This service class acts as the business logic and presentation layer for the technical documentation wiki. It is responsible for reading the project structure from the `Wiki.md` file, fetching the corresponding documentation from the `WikiDAO`, and dynamically generating the HTML for the navigation tree that is displayed on the wiki index page.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Service Tier**. It is a singleton that is initialized once at application startup. It serves as a facade for the `AdminWikiServlet`, providing the fully rendered HTML tree. It caches the wiki entries in memory to reduce database lookups.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `WikiDAO`.\n    *   `WikiDAO`: Used to fetch all wiki entries from the database during initialization.\n    *   `java.util.regex.Pattern`: Used to parse the Markdown links from the `Wiki.md` file.\n\n4.  **In-Depth Breakdown**\n\n    *   **`initialize()`**: Called by the constructor. It fetches all `WikiEntry` objects from the DAO and stores them in a `Map` (`wikiEntriesByPath`) for fast lookups. It then calls `parseProjectTree()` to generate and cache the final HTML.\n    *   **`parseProjectTree()`**: The core logic of the service.\n        1.  It reads the `Wiki.md` file from the classpath.\n        2.  It iterates through each line of the file, keeping track of the indentation level to correctly open and close `<ul>` and `<li>` tags, thus building the nested list structure.\n        3.  For each line that contains a Markdown link (e.g., `[`FileName.java`](path/to/File.java)`), it extracts the file name and the file path.\n        4.  It uses the extracted `filePath` to look up the corresponding `WikiEntry` in its internal `wikiEntriesByPath` map.\n        5.  If an entry is found, it generates an `<a>` tag with an `href` pointing to `/admin/wiki/details?id=...`, using the ID from the database entry.\n        6.  If no database entry is found for a path in the `Wiki.md` file, it renders the link as plain text with a \"(No Doc)\" warning.\n    *   **`getProjectTreeHtml()`**: A simple getter that returns the pre-generated HTML string to the `AdminWikiServlet`.'),
('src/main/java/de/technikteam/servlet/admin/action/UpdateWikiAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class encapsulates the logic for saving updated content for a wiki documentation page. It is triggered by an AJAX request from the admin wiki editor. It sanitizes the incoming content and persists it to the database.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It is the server-side endpoint for the \"Save\" button in the wiki editor UI.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `WikiDAO` and `AdminLogService`.\n    *   `WikiDAO`: The DAO used to update the content in the `wiki_documentation` table.\n    *   `AdminLogService`: To create an audit trail of the documentation update.\n    *   `MarkdownUtil`: A security utility used to sanitize the user-provided Markdown content before saving it.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** The main execution method for the update wiki action.\n        *   **Logic:**\n            1.  **Authorization:** Checks if the user is a full admin with `ACCESS_ADMIN_PANEL` permission.\n            2.  **Parameter Parsing:** Retrieves the `wikiId` and `content` from the request.\n            3.  **Sanitization:** It calls `MarkdownUtil.sanitize()` on the received content to strip any potentially malicious HTML or script tags.\n            4.  **Data Retrieval:** It fetches the original `WikiEntry` from the database to ensure it exists and to get its file path for logging.\n            5.  **Database Update:** It calls `wikiDAO.updateWikiContent()` with the sanitized content.\n            6.  **Logging & Response:** If the update is successful, it logs the action and returns an `ApiResponse.success`. Otherwise, it returns an `ApiResponse.error`.'),
('src/main/java/de/technikteam/servlet/admin/AdminAchievementServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet handles all administrative CRUD (Create, Read, Update, Delete) operations for achievements. It displays the list of all defined achievements and provides a modal for creating and editing them. It also includes an API-like action to fetch the data for a single achievement to populate the edit modal.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It is the controller for the `admin_achievements.jsp` view. It interacts with the `AchievementDAO` for data persistence and the `AdminLogService` for auditing.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects `AchievementDAO`, `CourseDAO`, and `AdminLogService`.\n    *   `AchievementDAO`: The primary DAO for managing achievement data.\n    *   `CourseDAO`: Used to provide a list of courses for the \"Qualification\" achievement type in the creation modal.\n    *   `AdminLogService`: To log all create, update, and delete actions.\n    *   **Gson**: For serializing achievement data to JSON for the AJAX-powered edit modal.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(...)`**: Routes requests. If `action=getAchievementData`, it calls `getAchievementDataAsJson`. Otherwise, it fetches all achievements and courses and forwards to the JSP.\n    *   **`doPost(...)`**: Routes POST requests to the appropriate handler (`handleCreateOrUpdate` or `handleDelete`) based on the `action` parameter.\n    *   **`getAchievementDataAsJson(...)`**: Acts as a mini API endpoint. It fetches an achievement by its ID and returns it as a JSON object.\n    *   **`handleCreateOrUpdate(...)`**: A single method to handle both creation and updates. It checks for an `id` parameter to distinguish between the two operations, performs the necessary authorization check for the specific action, creates an `Achievement` object from the request parameters, calls the appropriate DAO method, logs the action, and sets a session message.\n    *   **`handleDelete(...)`**: Handles the deletion of an achievement, including the authorization check, DAO call, logging, and session message.'),
('src/main/java/de/technikteam/servlet/admin/AdminAttendanceServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet acts as a dedicated endpoint for updating meeting attendance records. It processes POST requests, typically from the Qualification Matrix page, to set a user''s attendance status for a specific meeting.\n\n2.  **Architectural Role**\n\n    This is a specialized controller in the **Web/Controller Tier**. It handles a single, specific action: updating attendance. It is not responsible for rendering a view. It interacts with several DAOs to perform the update and create a detailed audit log.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects `MeetingAttendanceDAO`, `UserDAO`, `MeetingDAO`, and `AdminLogService`.\n    *   `MeetingAttendanceDAO`: The DAO that performs the actual database update.\n    *   `UserDAO`, `MeetingDAO`: Used to fetch the names of the user and meeting for the detailed log message.\n    *   `AdminLogService`: To create an audit trail of the attendance change.\n    *   `CSRFUtil`: For security validation.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doPost(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** The single method to process attendance updates.\n        *   **Logic:**\n            1.  **Security:** Validates the CSRF token.\n            2.  **Parameter Parsing:** Retrieves `userId`, `meetingId`, the boolean `attended` status, and any `remarks` from the request.\n            3.  **Database Update:** Calls `attendanceDAO.setAttendance()` to persist the changes.\n            4.  **Logging:** If the update is successful, it fetches the user and meeting objects to construct a detailed, human-readable log message (e.g., \"Teilnahme für Nutzer ''TestUser'' ... auf ''TEILGENOMMEN'' gesetzt.\") and sends it to the `AdminLogService`.\n            5.  **Feedback & Redirect:** Sets a success or error message in the session and redirects the user back to the page they came from (either `/admin/matrix` or another page).'),
('src/main/java/de/technikteam/servlet/admin/AdminChangeRequestServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for displaying the administrative page for pending user profile change requests. It fetches all requests with a \"PENDING\" status and forwards them to the `admin_requests.jsp` view for review.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It acts as the controller for the requests overview page. Its associated actions (approve/deny) are handled by the `FrontControllerServlet` and its `Action` classes.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects `ProfileChangeRequestDAO` and `UserDAO`.\n    *   `ProfileChangeRequestDAO`: The DAO used to fetch the list of pending requests.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the `/admin/requests` page.\n        *   **Logic:**\n            1.  **Authorization:** It checks if the logged-in admin has the `USER_UPDATE` permission, as reviewing change requests is a form of updating user data.\n            2.  **Data Fetching:** It calls `requestDAO.getPendingRequests()` to get the list of all pending requests.\n            3.  **Forwarding:** It sets the list as a request attribute and forwards to `admin_requests.jsp`.'),
('src/main/java/de/technikteam/servlet/admin/AdminDashboardServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves the initial HTML shell for the administrative dashboard. Its primary responsibility is to fetch some initial, non-dynamic data and forward to the `admin_dashboard.jsp` page. The majority of the dashboard''s content is then loaded asynchronously by JavaScript.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It is the controller for the main admin landing page. It is intentionally lightweight, delegating most of the data loading to the client-side and the `AdminDashboardApiServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `StorageDAO` and `StatisticsDAO`.\n    *   `StorageDAO`: Used to get a count of defective items.\n    *   `StatisticsDAO`: Used to get simple counts of users and active events for the static widgets.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for `/admin/dashboard`.\n        *   **Logic:**\n            1.  It fetches the list of defective items from `storageDAO`.\n            2.  It fetches the total user count and active event count from `statisticsDAO`.\n            3.  It sets these pieces of data as request attributes.\n            4.  It forwards the request to `admin_dashboard.jsp`. The JSP then uses this initial data to render the static widgets, while the dynamic widgets show a \"Loading...\" message until the JavaScript populates them.'),
('src/main/java/de/technikteam/servlet/admin/AdminDefectServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for displaying the \"Defekte Artikel\" (Defective Items) management page. It fetches a list of all inventory items that have a defective quantity greater than zero and forwards them to the view for display.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Web/Controller Tier**. It is the controller for the `admin_defect_list.jsp` view. It interacts directly with the `StorageDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `StorageDAO`.\n    *   `StorageDAO`: The DAO used to fetch the list of defective items.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the `/admin/defekte` page.\n        *   **Logic:**\n            1.  It calls `storageDAO.getDefectiveItems()` to get the specific list of items that require attention.\n            2.  It sets this list as a request attribute named `defectiveItems`.\n            3.  It forwards the request to `admin_defect_list.jsp` for rendering.'),
('src/main/java/de/technikteam/servlet/admin/AdminFileManagementServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves the main administrative page for managing files and categories. It fetches a complete list of *all* files (regardless of their `required_role`) and all defined categories, then forwards this data to the `admin_files.jsp` view.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It is the controller for the main file management interface.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `FileDAO`.\n    *   `FileDAO`: The DAO used to fetch all files and categories.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the `/admin/dateien` page.\n        *   **Logic:**\n            1.  It creates a \"proxy\" `User` object with the `ACCESS_ADMIN_PANEL` permission. This is a clever way to trick the `fileDAO.getAllFilesGroupedByCategory()` method into returning *all* files, including those marked for Admins only, without having to write a separate DAO method.\n            2.  It fetches all file categories using `fileDAO.getAllCategories()`.\n            3.  It sets both the grouped files map and the categories list as request attributes.\n            4.  It forwards the request to `admin_files.jsp`.'),
('src/main/java/de/technikteam/servlet/admin/AdminFileServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is a dedicated controller that handles all state-changing actions related to file and category management, such as uploading, updating, deleting, and reassigning files. It is mapped to `/admin/dateien/*` and uses the path info (e.g., `/create`, `/delete`) to route actions.\n\n2.  **Architectural Role**\n\n    This is a multi-action controller in the **Web/Controller Tier**. It processes multipart form data for file uploads and standard form data for other actions. It interacts with the `FileDAO`, `ConfigurationService`, and `AdminLogService`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `FileDAO`, `ConfigurationService`, and `AdminLogService`.\n    *   `@MultipartConfig`: A standard servlet annotation that enables this servlet to handle `multipart/form-data` requests (i.e., file uploads).\n    *   `FileDAO`: To perform all database operations and interact with the filesystem.\n    *   `ConfigurationService`: To get the path to the upload directory.\n    *   `AdminLogService`: To create an audit trail for all actions.\n    *   `CSRFUtil`: For security validation.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doPost(...)`**: The main entry point. It validates the CSRF token and uses a `switch` statement on the request''s `pathInfo` to delegate to the appropriate handler method.\n    *   **`handleCreateUpload(...)`**: Manages new file uploads. It validates the file type, generates a unique filename to prevent collisions, writes the file to disk, and then creates the corresponding metadata record in the database using `FileDAO`.\n    *   **`handleUpdateUpload(...)`**: Handles uploading a new version of an existing file. It finds the existing file record to get the correct filepath and overwrites the physical file on disk. It then \"touches\" the database record to update its timestamp.\n    *   **`handleDelete(...)`**: Deletes a file record and its corresponding physical file.\n    *   **`handleReassign(...)`**: Changes the `category_id` of a file record.\n    *   **`handleCreateCategory(...)` / `handleDeleteCategory(...)`**: Manages the CRUD operations for file categories.'),
('src/main/java/de/technikteam/servlet/admin/AdminKitServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet handles all administrative CRUD operations for inventory kits. It serves the main kit management page, which uses an accordion interface, and processes POST requests to create, update, and delete kits and their contents.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It is the controller for the `admin_kits.jsp` view. It interacts with the `InventoryKitDAO` and `StorageDAO` for data, and the `AdminLogService` for auditing.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects `InventoryKitDAO`, `StorageDAO`, and `AdminLogService`.\n    *   `InventoryKitDAO`: The primary DAO for managing kits and their contents.\n    *   `StorageDAO`: Used to get a list of all available items to populate the dropdowns in the UI.\n    *   `AdminLogService`: To log all state-changing actions.\n    *   **Gson**: To serialize the list of available items into JSON for use by the client-side JavaScript.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(...)`**: Fetches all kits (with their items) and a complete list of all storage items. It then forwards this data to the `admin_kits.jsp` page. It also provides a JSON endpoint (`?action=getKitItems`) for the client-side script to fetch the contents of a single kit asynchronously.\n    *   **`doPost(...)`**: A router that delegates to handler methods (`handleCreateKit`, `handleUpdateKit`, etc.) based on the `action` parameter.\n    *   **`handleCreateKit(...)` / `handleUpdateKit(...)` / `handleDeleteKit(...)`**: These methods handle the basic CRUD operations for the kit itself (not its contents), log the action, set a session message, and redirect.\n    *   **`handleUpdateKitItems(...)`**: This method handles the submission of the form inside the accordion. It takes the arrays of `itemIds` and `quantities` and passes them to the transactional `kitDAO.updateKitItems()` method, which synchronizes the kit''s contents in the database.'),
('src/main/java/de/technikteam/servlet/admin/AdminLogServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for displaying the administrative action log. It fetches all log entries from the database and forwards them to the `admin_log.jsp` view for rendering.\n\n2.  **Architectural Role**\n\n    This is a simple read-only controller in the **Web/Controller Tier**. It interacts directly with the `AdminLogDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `AdminLogDAO`.\n    *   `AdminLogDAO`: The DAO used to fetch all log entries.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the `/admin/log` page.\n        *   **Logic:**\n            1.  Ensures an admin user is logged in.\n            2.  Calls `adminLogDAO.getAllLogs()` to retrieve the complete history of administrative actions.\n            3.  Sets the resulting list as a request attribute named `logs`.\n            4.  Forwards the request to `admin_log.jsp`.'),
('src/main/java/de/technikteam/servlet/admin/AdminSystemServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves the initial HTML shell for the \"Systemstatus\" page. Its only job is to forward the request to the `admin_system.jsp` view. All data for this page is loaded asynchronously by JavaScript.\n\n2.  **Architectural Role**\n\n    This is a very simple controller in the **Web/Controller Tier**. It acts as a passthrough to its corresponding view.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for `/admin/system`.\n        *   **Logic:** It performs a single action: `request.getRequestDispatcher(\"/views/admin/admin_system.jsp\").forward(request, response);`'),
('src/main/java/de/technikteam/servlet/admin/AdminWikiDetailsServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for displaying the content of a single wiki documentation page. It retrieves the specific wiki entry from the database based on an ID parameter and forwards it to the `admin_wiki_details.jsp` view for rendering.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It acts as the controller for the detailed wiki view page. It interacts with the `WikiDAO` to fetch the content.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `WikiDAO`.\n    *   `WikiDAO`: The DAO used to fetch the wiki entry by its ID.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for `/admin/wiki/details`.\n        *   **Logic:**\n            1.  **Authorization:** It performs a strict check to ensure only users with the master `ACCESS_ADMIN_PANEL` permission can view the technical wiki.\n            2.  **Parameter Validation:** It requires a numerical `id` parameter.\n            3.  **Data Fetching:** It calls `wikiDAO.getWikiEntryById()` to retrieve the documentation content.\n            4.  **Error Handling:** If the entry is not found, it sends a 404 error.\n            5.  **Forwarding:** It sets the `wikiEntry` object as a request attribute and forwards to `admin_wiki_details.jsp`.'),
('src/main/java/de/technikteam/servlet/admin/AdminWikiServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves the main index page for the technical documentation wiki. It uses the `WikiService` to get the pre-generated HTML for the project navigation tree and forwards it to the `admin_wiki_index.jsp` view.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It is the controller for the wiki''s main landing page. It delegates all complex logic to the `WikiService`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `WikiService`.\n    *   `WikiService`: The service that contains the cached, pre-rendered HTML for the wiki navigation tree.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for `/admin/wiki`.\n        *   **Logic:**\n            1.  **Authorization:** It performs a strict check to ensure only users with the master `ACCESS_ADMIN_PANEL` permission can access the wiki.\n            2.  **Service Call:** It calls `wikiService.getProjectTreeHtml()` to retrieve the cached HTML.\n            3.  **Forwarding:** It sets the HTML string as a request attribute named `projectTreeHtml` and forwards to `admin_wiki_index.jsp`.'),
('src/main/java/de/technikteam/servlet/admin/FrontControllerServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet implements the Front Controller design pattern. It acts as a single, centralized handler for a variety of administrative actions. Instead of having numerous small servlets for each action (e.g., `CreateUserServlet`, `DeleteUserServlet`), this servlet receives all requests to `/admin/action/*`, determines the requested action, and dispatches the request to a dedicated `Action` class that contains the business logic. This approach cleans up the `web.xml` (or `ServiceModule`), promotes a clean separation of concerns, and simplifies the handling of AJAX requests.\n\n2.  **Architectural Role**\n\n    This is a core component of the **Web/Controller Tier**. It is a dispatcher that decouples the URL from the specific code that handles the action.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: The constructor uses Guice to inject an instance of every single `Action` class.\n    *   `Action` (Interface): The common interface that all action classes implement.\n    *   **Gson**: Used to serialize the `ApiResponse` returned by the action into a JSON string.\n\n4.  **In-Depth Breakdown**\n\n    *   **`actions` (Map)**: A `Map` that holds all the action instances, keyed by a unique string (e.g., \"user.create\", \"feedback.delete\"). This map is populated in the constructor.\n    *   **`doPost(HttpServletRequest request, HttpServletResponse response)`**:\n        *   **Purpose:** The single method that handles all incoming action requests.\n        *   **Logic:**\n            1.  It extracts the `entity` from the path info (e.g., `/user` becomes `user`).\n            2.  It extracts the `actionName` from a request parameter (e.g., `?action=create`).\n            3.  It combines these to create an `actionKey` (e.g., `\"user.create\"`).\n            4.  It looks up the corresponding `Action` object in the `actions` map.\n            5.  If an action is found, it calls the `action.execute()` method.\n            6.  It takes the `ApiResponse` object returned by the action, sets the HTTP status code based on its success, and serializes it to JSON for the response.'),
('src/main/java/de/technikteam/servlet/admin/MatrixServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for gathering all the data required to render the complex Qualification Matrix. It fetches all users, all courses, all meetings for each course, and all attendance records, then organizes this data into structures that the `admin_matrix.jsp` view can easily consume to build the table.\n\n2.  **Architectural Role**\n\n    This is a data-intensive controller in the **Web/Controller Tier**. Its primary job is to aggregate data from multiple DAOs into a coherent view model for a specific, complex UI component.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects all necessary DAOs (`UserDAO`, `CourseDAO`, `MeetingDAO`, `MeetingAttendanceDAO`).\n    *   **DAOs**: Each DAO is used to fetch a piece of the required data.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for `/admin/matrix`.\n        *   **Logic:**\n            1.  **Fetch Users & Courses:** Retrieves the complete lists of all users and all courses.\n            2.  **Fetch Meetings:** It iterates through the list of courses and, for each one, fetches its list of scheduled meetings, storing the results in a `Map<Integer, List<Meeting>>` where the key is the course ID.\n            3.  **Fetch Attendance:** It fetches *all* attendance records from the `meeting_attendance` table and transforms this list into a `Map<String, MeetingAttendance>`. The key for this map is a concatenated string like `\"userId-meetingId\"`. This creates a highly efficient lookup structure for the JSP, which can check a user''s attendance for a specific meeting in O(1) time instead of having to loop through lists.\n            4.  **Forwarding:** It sets all four data structures (`allUsers`, `allCourses`, `meetingsByCourse`, `attendanceMap`) as request attributes and forwards to `admin_matrix.jsp`.');

-- This script populates the wiki_documentation table with all remaining entries to complete the documentation.
INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/dao/WikiDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO is responsible for all database interactions with the `wiki_documentation` table. It provides simple CRUD (Create, Read, Update, Delete) operations for managing the content of the technical documentation wiki pages.\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is used by the `WikiService` to load the documentation into its cache at startup, and by the `AdminWikiDetailsServlet` and `UpdateWikiAction` to display and save changes to the wiki content.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `WikiEntry` (Model): The data model object that this DAO creates and populates.\n\n4.  **In-Depth Breakdown**\n\n    *   **`getWikiEntryById(int id)`**: Retrieves a single wiki page by its primary key.\n    *   **`getAllWikiEntries()`**: Fetches all wiki pages from the database, ordered by their file path. This is used by the `WikiService` to populate its initial cache.\n    *   **`updateWikiContent(int id, String content)`**: Updates the `content` field for a specific wiki entry. This is the main method used for saving changes from the admin editor.'),
('src/main/java/de/technikteam/servlet/admin/AdminCourseServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet handles all administrative CRUD operations for course templates. It lists all templates, provides an API endpoint to fetch data for a single template, and processes POST requests to create, update, or delete them.\n\n2.  **Architectural Role**\n\n    This is a controller in the **Web/Controller Tier** for the `admin_course_list.jsp` view. It interacts with the `CourseDAO` for persistence and the `AdminLogService` for auditing.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects `CourseDAO` and `AdminLogService`.\n    *   `CourseDAO`: The primary DAO for all course template operations.\n    *   `AdminLogService`: To log all state-changing actions.\n    *   **Gson**: For serializing course data to JSON for the edit modal.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(...)`**: Routes requests. If `action=getCourseData`, it serves JSON data for a single course. Otherwise, it fetches all courses and forwards to the main list view.\n    *   **`doPost(...)`**: Routes POST requests to handlers for `delete` or `create`/`update`.\n    *   **`handleCreateOrUpdate(...)`**: A single method that handles both creating and updating course templates based on the presence of an `id` parameter. It logs the action and sets a session message.\n    *   **`handleDelete(...)`**: Deletes a course template. This action will cascade in the database, deleting all associated meetings, attendance, and qualifications.'),
('src/main/java/de/technikteam/servlet/admin/AdminEventServlet.java', '1.  **File Overview & Purpose**\n\n    This is a large, multi-functional servlet that serves as the central controller for all administrative event management. It handles displaying the event list, providing JSON data for modals, and processing a wide variety of POST actions for creating, updating, deleting, assigning users, and changing the status of events.\n\n2.  **Architectural Role**\n\n    This is a core controller in the **Web/Controller Tier**. It orchestrates the entire admin event workflow, interacting with the `EventService` for complex transactional operations and multiple DAOs for data retrieval.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `EventService` and a wide array of DAOs.\n    *   `EventService`: Used for the transactional creation and updating of events and their related data.\n    *   `EventDAO`: Used for most read operations and simple state changes.\n    *   Other DAOs (`CourseDAO`, `UserDAO`, etc.): Used to fetch data needed to populate the UI (e.g., dropdowns in modals).\n    *   `AdminLogService`: For comprehensive auditing of all actions.\n    *   `AchievementService`: To trigger achievement checks when an event is completed.\n    *   `NotificationService`: To broadcast UI updates and send invitations.\n    *   **Gson**: Heavily used to serialize data for the AJAX-powered UI.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(...)`**: Acts as a router. The default action is `listEvents`, which fetches all data needed for the page. It also provides API-like actions (`getEventData`, `getAssignmentData`) to serve JSON to the client-side scripts.\n    *   **`doPost(...)`**: A large router that delegates to specific handler methods based on the `action` parameter (`handleCreateOrUpdate`, `handleDelete`, etc.).\n    *   **`handleCreateOrUpdate(...)`**: Gathers all event data from the multi-part form request and passes it to `eventService.createOrUpdateEvent()`, which handles the complex, multi-table transaction.\n    *   **`handleStatusUpdate(...)`**: Changes the status of an event (e.g., from `GEPLANT` to `LAUFEND`). If the new status is `ABGESCHLOSSEN`, it triggers the `AchievementService` to check for new achievements for all assigned users.\n    *   **`handleInviteUsers(...)`**: Called from the \"Crew Finder\" modal. It iterates through the selected user IDs and sends a real-time invitation notification to each one via the `NotificationService`.'),
('src/main/java/de/technikteam/servlet/admin/AdminFeedbackServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for displaying the administrative Feedback Board. It fetches all user feedback submissions and groups them by their status to be rendered in a Kanban-style layout on the `admin_feedback.jsp` page.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It acts as the controller for the feedback board view. The interactive functionality (drag-and-drop, modals) is handled by the `FrontControllerServlet` and its `Action` classes.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `FeedbackSubmissionDAO`.\n    *   `FeedbackSubmissionDAO`: The DAO used to fetch all feedback submissions.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the `/admin/feedback` page.\n        *   **Logic:**\n            1.  **Authorization:** Ensures the user has admin access.\n            2.  **Data Fetching:** It calls `submissionDAO.getAllSubmissions()` to get a single, sorted list of all feedback items.\n            3.  **Data Grouping:** It uses a Java Stream to group the flat list of submissions into a `Map<String, List<FeedbackSubmission>>`, where the key is the submission''s status.\n            4.  **Forwarding:** It sets the `groupedSubmissions` map and the `feedbackStatusOrder` list (which defines the column order) as request attributes and forwards to `admin_feedback.jsp`.'),
('src/main/java/de/technikteam/servlet/admin/AdminMeetingServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet handles all administrative CRUD operations for specific, schedulable meetings. It displays the list of meetings for a given course, provides a JSON endpoint to fetch data for a single meeting, and processes POST requests to create, update, and delete meetings and their attachments.\n\n2.  **Architectural Role**\n\n    This is a controller in the **Web/Controller Tier** for the `admin_meeting_list.jsp` view. It manages the lifecycle of `Meeting` objects, which are children of a `Course`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects multiple DAOs and services.\n    *   `MeetingDAO`, `CourseDAO`, `AttachmentDAO`, `UserDAO`: Used to fetch and persist data.\n    *   `AdminLogService`: For auditing all actions.\n    *   `ConfigurationService`: To get the file upload directory path.\n    *   **Gson**: To serialize meeting and attachment data to JSON for the edit modal.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(...)`**: Routes requests. If `action=getMeetingData`, it serves JSON. Otherwise, it calls `listMeetings`.\n    *   **`listMeetings(...)`**: Fetches the parent course, its list of meetings, and a list of all users (for the ''leader'' dropdown), then forwards to the JSP.\n    *   **`getMeetingDataAsJson(...)`**: Fetches a single meeting and its attachments and returns them as a combined JSON object.\n    *   **`doPost(...)`**: Routes POST requests to handlers for `create`/`update`, `delete`, or `deleteAttachment`.\n    *   **`handleCreateOrUpdate(...)`**: Manages the creation and updating of meeting records. It also handles an optional file upload for an attachment within the same form submission.\n    *   **`handleDelete(...)`**: Deletes a meeting record and logs the action.\n    *   **`handleDeleteAttachment(...)`**: Deletes an attachment record from the database and also deletes the corresponding physical file from the server''s disk.'),
('src/main/java/de/technikteam/servlet/admin/AdminReportServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves as the controller for the \"Berichte & Analysen\" (Reports & Analytics) page. It handles both the display of the main reports dashboard (with charts) and the generation of specific, detailed tabular reports, including an option to export them as CSV files.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It is a data-centric controller that uses the `ReportDAO` to fetch aggregated data for display and export.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `ReportDAO`.\n    *   `ReportDAO`: The specialized DAO containing all the complex SQL queries for generating report data.\n    *   **Gson**: Used to serialize chart data into JSON for the main reports dashboard.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(...)`**: The main entry point. It checks for a `report` parameter.\n        *   If no `report` parameter is present, it fetches the summary data needed for the main dashboard charts (`getEventCountByMonth`, `getUserParticipationStats`), serializes it to JSON, and forwards to `admin_reports.jsp`.\n        *   If a `report` parameter *is* present, it calls `handleSpecificReport`.\n    *   **`handleSpecificReport(...)`**: This method acts as a router for detailed reports. It uses a `switch` statement on the `reportType` to call the appropriate method in `ReportDAO`. It then checks for an `export` parameter. If `export=csv`, it calls `exportToCsv`; otherwise, it forwards the data to the generic `report_display.jsp` template.\n    *   **`exportToCsv(...)`**: This method generates a CSV file from the report data. It sets the appropriate HTTP headers (`Content-Type: text/csv`, `Content-Disposition`) and then iterates through the list of data, writing the headers and each row to the response writer. It includes an `escapeCsvField` helper to correctly handle values that contain commas or quotes.'),
('src/main/java/de/technikteam/servlet/admin/AdminStorageServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is the central controller for all administrative actions related to inventory management. It handles displaying the complete list of storage items and processes POST requests for creating, updating, deleting, repairing, and changing the status of items.\n\n2.  **Architectural Role**\n\n    This is a comprehensive controller in the **Web/Controller Tier** for the `admin_storage_list.jsp` view. It uses the `StorageService` for complex, transactional operations and the `StorageDAO` and `MaintenanceLogDAO` for other tasks.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects DAOs and Services.\n    *   `StorageService`: For handling transactional defect status updates.\n    *   `StorageDAO`: For most CRUD and status update operations.\n    *   `MaintenanceLogDAO`: For logging repair and maintenance actions.\n    *   `AdminLogService`: For auditing all actions.\n    *   `ConfigurationService`: For handling image file uploads.\n    *   **Gson**: To serialize item data for the AJAX-powered edit modal.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(...)`**: Provides the main list view and a JSON endpoint (`?action=getItemData`) for the edit modal.\n    *   **`doPost(...)`**: A router that delegates to handler methods based on the `action` parameter.\n    *   **`handleCreateOrUpdate(...)`**: A large method that handles both creating and updating items. It processes all form fields, manages optional image uploads (saving the file and storing its path), and calls the appropriate DAO method. It includes logic to preserve existing data (like the image path) during an update if a new file is not provided.\n    *   **`handleDefectStatusUpdate(...)`**: This method delegates the complex logic of updating an item''s defective status to the `StorageService.updateDefectiveItemStatus()` method, which handles the operation within a transaction.\n    *   **`handleRepair(...)`**: Processes a repair action. It calls `storageDAO.repairItems()` to adjust the defective quantity and then creates a corresponding `MaintenanceLogEntry` to document the repair.'),
('src/main/java/de/technikteam/servlet/admin/AdminUserServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is the controller for the main \"Benutzerverwaltung\" (User Management) page. It handles displaying the list of all users, showing detailed views of a single user, and providing a JSON API endpoint to fetch data for the user editing modal. All state-changing actions (create, update, delete, etc.) are delegated to the `FrontControllerServlet`.\n\n2.  **Architectural Role**\n\n    This is a read-focused controller in the **Web/Controller Tier**. It gathers all necessary data for the user management UI and forwards it to the appropriate JSP.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `UserDAO`, `EventDAO`, `RoleDAO`, and `PermissionDAO`.\n    *   `UserDAO`: To fetch the list of users and details for a single user.\n    *   `EventDAO`: To get a user''s event history for the details page.\n    *   `RoleDAO`: To get the list of all available roles for the edit modal dropdown.\n    *   `PermissionDAO`: To get the list of all available permissions for the edit modal checklist.\n    *   **Gson**: To serialize user and permission data into JSON for the client-side script.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(...)`**: A router that delegates to handler methods based on the `action` parameter.\n    *   **`listUsers(...)`**: The default action. It fetches all users, all roles, and all permissions. It groups the permissions by category (e.g., USER, EVENT) to provide a more organized structure for the JSON payload, which the `admin_users.js` script uses to build the tabbed, grouped checklist in the modal.\n    *   **`getUserDataAsJson(...)`**: An API-like endpoint that fetches a single user''s data along with the set of their currently assigned permission IDs. This is called by the JavaScript when an admin clicks the \"Edit\" button.\n    *   **`showUserDetails(...)`**: Fetches a single user and their complete event participation history and forwards to the `admin_user_details.jsp` view.');

-- This script documents the files changed or added to implement full CRUD functionality for the wiki.
INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/servlet/admin/api/AdminWikiApiServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet provides a JSON API endpoint for the administrative wiki feature. Its primary responsibility is to serve the hierarchical structure of the wiki documentation (the file tree) as a JSON object. This data is then consumed by the frontend to dynamically render the navigation sidebar.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier** (API sub-layer). It acts as the data source for the `admin_wiki.js` script. It delegates the complex task of building the tree structure to the `WikiService`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `WikiService`.\n    *   `WikiService`: The service that contains the cached, pre-built data structure of the wiki tree.\n    *   **Gson**: Used to serialize the tree data into a JSON object.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the wiki''s tree data.\n        *   **Logic:**\n            1.  **Authorization:** It ensures the requesting user has `ACCESS_ADMIN_PANEL` permission.\n            2.  **Service Call:** It calls `wikiService.getWikiTreeAsData()` to get the pre-built `Map` representing the file tree.\n            3.  **JSON Response:** It serializes this map into a JSON string and writes it to the response.'),
('src/main/java/de/technikteam/servlet/admin/action/CreateWikiAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class encapsulates the logic for creating a new wiki documentation page. It receives a file path and initial content from an admin, creates a new entry in the database, and returns the newly created entry.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It is the server-side endpoint for the \"New Page\" modal in the wiki interface.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `WikiDAO` and `AdminLogService`.\n    *   `WikiDAO`: The DAO used to insert the new record into the `wiki_documentation` table.\n    *   `AdminLogService`: To create an audit trail for the new page creation.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** The main execution method for the create wiki page action.\n        *   **Logic:**\n            1.  **Authorization:** Checks if the user has `ACCESS_ADMIN_PANEL` permission.\n            2.  **Parameter Validation:** Retrieves the `filePath` and `content` from the request and ensures the path is not empty.\n            3.  **Database Insert:** Creates a new `WikiEntry` object and calls `wikiDAO.createWikiEntry()` to save it.\n            4.  **Logging & Response:** If the creation is successful, it logs the action and returns an `ApiResponse.success` containing the newly created `WikiEntry` object (now with its ID). If it fails (likely due to a duplicate file path), it returns an `ApiResponse.error`.'),
('src/main/java/de/technikteam/servlet/admin/action/DeleteWikiAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class encapsulates the logic for deleting a wiki documentation page. It receives the ID of the wiki entry to be deleted, removes it from the database, and logs the action.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It is the server-side endpoint for the \"Delete\" button in the wiki interface.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `WikiDAO` and `AdminLogService`.\n    *   `WikiDAO`: The DAO used to delete the record from the `wiki_documentation` table.\n    *   `AdminLogService`: To create an audit trail for the deletion.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** The main execution method for the delete wiki page action.\n        *   **Logic:**\n            1.  **Authorization:** Checks if the user has `ACCESS_ADMIN_PANEL` permission.\n            2.  **Data Retrieval:** It first fetches the `WikiEntry` to be deleted. This is important for logging the file path of the deleted entry.\n            3.  **Database Deletion:** It calls `wikiDAO.deleteWikiEntry()` with the provided ID.\n            4.  **Logging & Response:** If the deletion is successful, it logs the action and returns an `ApiResponse.success`. Otherwise, it returns an `ApiResponse.error`.'),
('src/main/java/de/technikteam/servlet/admin/action/GetWikiContentAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class is a simple data retrieval command. Its sole purpose is to fetch the full content and metadata of a single wiki entry from the database and return it as the data payload in an `ApiResponse`.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It serves as the API endpoint for the client-side JavaScript (`admin_wiki.js`) to populate the content pane when a user clicks on a file in the navigation tree.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `WikiDAO`.\n    *   `WikiDAO`: The DAO used to retrieve the wiki entry by its ID.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** Fetches and returns the details of one wiki entry.\n        *   **Logic:**\n            1.  **Authorization:** Ensures the user has `ACCESS_ADMIN_PANEL` permission.\n            2.  It parses the `id` from the request parameters.\n            3.  It calls `wikiDAO.getWikiEntryById()`.\n            4.  If an entry is found, it returns an `ApiResponse.success` with the `WikiEntry` object as the data payload.\n            5.  If no entry is found, it returns an `ApiResponse.error`.');

-- This script updates the documentation for files modified or created to implement full wiki CRUD functionality.
INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/dao/WikiDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO is responsible for all database interactions with the `wiki_documentation` table. It provides full CRUD (Create, Read, Update, Delete) operations for managing the content of the technical documentation wiki pages.\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is used by the `WikiService` to load the documentation into its cache at startup, and by the various `Wiki` action classes to display and save changes to the wiki content.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `WikiEntry` (Model): The data model object that this DAO creates and populates.\n\n4.  **In-Depth Breakdown**\n\n    *   **`getWikiEntryById(int id)`**: Retrieves a single wiki page by its primary key.\n    *   **`getAllWikiEntries()`**: Fetches all wiki pages from the database, ordered by their file path. This is used by the `WikiService` to populate its initial cache.\n    *   **`updateWikiContent(int id, String content)`**: Updates the `content` field for a specific wiki entry.\n    *   **`createWikiEntry(WikiEntry entry)`**: Inserts a new documentation record into the database and returns the created object with its new ID.\n    *   **`deleteWikiEntry(int id)`**: Deletes a wiki documentation record from the database by its primary key.'),
('src/main/java/de/technikteam/service/WikiService.java', '1.  **File Overview & Purpose**\n\n    This service class acts as the business logic and data preparation layer for the technical documentation wiki. It is responsible for fetching all wiki entries from the `WikiDAO` at startup and building a hierarchical, nested `Map` that represents the project''s file tree. This data structure is then serialized to JSON by the `AdminWikiApiServlet`.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Service Tier**. It is a singleton that is initialized once at application startup. It serves as a facade for the `AdminWikiApiServlet`, providing the complete wiki structure as a data object, abstracting away the details of how the tree is constructed.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `WikiDAO`.\n    *   `WikiDAO`: Used to fetch all wiki entries from the database during initialization.\n\n4.  **In-Depth Breakdown**\n\n    *   **`initialize()`**: Called by the constructor. It triggers the `buildWikiTreeData()` method to generate and cache the tree structure in memory.\n    *   **`buildWikiTreeData()`**: The core logic of the service. It fetches all `WikiEntry` objects, splits their `filePath` strings by the ''/'' delimiter, and iteratively builds a nested map structure. Each key in the map is a directory or file name, and the final value for a file is the `WikiEntry` object itself.\n    *   **`getWikiTreeAsData()`**: A simple getter that returns the pre-generated and cached `Map` data structure to the API servlet.'),
('src/main/java/de/technikteam/servlet/admin/AdminWikiServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves the main index page for the technical documentation wiki (`admin_wiki_index.jsp`). Its sole responsibility is to perform an authorization check and then forward the request to the JSP file. All dynamic content, such as the navigation tree and page content, is loaded asynchronously by the client-side JavaScript.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It is the main entry point for the wiki feature but is intentionally lightweight, acting only as a gatekeeper and view dispatcher.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This servlet no longer has direct dependencies as all data handling is done via API calls from the client.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for `/admin/wiki`.\n        *   **Logic:**\n            1.  **Authorization:** It performs a strict check to ensure only users with the master `ACCESS_ADMIN_PANEL` permission can access the wiki.\n            2.  **Forwarding:** It forwards the request directly to `admin_wiki_index.jsp`, without setting any data attributes.'),
('src/main/java/de/technikteam/servlet/admin/action/CreateWikiAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class encapsulates the logic for creating a new wiki documentation page. It receives a file path and initial content from an admin, creates a new entry in the database, and returns the newly created entry.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It is the server-side endpoint for the \"New Page\" modal in the wiki interface.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `WikiDAO` and `AdminLogService`.\n    *   `WikiDAO`: The DAO used to insert the new record into the `wiki_documentation` table.\n    *   `AdminLogService`: To create an audit trail for the new page creation.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** The main execution method for the create wiki page action.\n        *   **Logic:**\n            1.  **Authorization:** Checks if the user has `ACCESS_ADMIN_PANEL` permission.\n            2.  **Parameter Validation:** Retrieves the `filePath` and `content` from the request and ensures the path is not empty.\n            3.  **Database Insert:** Creates a new `WikiEntry` object and calls `wikiDAO.createWikiEntry()` to save it.\n            4.  **Logging & Response:** If the creation is successful, it logs the action and returns an `ApiResponse.success` containing the newly created `WikiEntry` object (now with its ID). If it fails (likely due to a duplicate file path), it returns an `ApiResponse.error`.'),
('src/main/java/de/technikteam/servlet/admin/action/DeleteWikiAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class encapsulates the logic for deleting a wiki documentation page. It receives the ID of the wiki entry to be deleted, removes it from the database, and logs the action.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It is the server-side endpoint for the \"Delete\" button in the wiki interface.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `WikiDAO` and `AdminLogService`.\n    *   `WikiDAO`: The DAO used to delete the record from the `wiki_documentation` table.\n    *   `AdminLogService`: To create an audit trail for the deletion.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** The main execution method for the delete wiki page action.\n        *   **Logic:**\n            1.  **Authorization:** Checks if the user has `ACCESS_ADMIN_PANEL` permission.\n            2.  **Data Retrieval:** It first fetches the `WikiEntry` to be deleted. This is important for logging the file path of the deleted entry.\n            3.  **Database Deletion:** It calls `wikiDAO.deleteWikiEntry()` with the provided ID.\n            4.  **Logging & Response:** If the deletion is successful, it logs the action and returns an `ApiResponse.success`. Otherwise, it returns an `ApiResponse.error`.'),
('src/main/java/de/technikteam/servlet/admin/action/GetWikiContentAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class is a simple data retrieval command. Its sole purpose is to fetch the full content and metadata of a single wiki entry from the database and return it as the data payload in an `ApiResponse`.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It serves as the API endpoint for the client-side JavaScript (`admin_wiki.js`) to populate the content pane when a user clicks on a file in the navigation tree.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `WikiDAO`.\n    *   `WikiDAO`: The DAO used to retrieve the wiki entry by its ID.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** Fetches and returns the details of one wiki entry.\n        *   **Logic:**\n            1.  **Authorization:** Ensures the user has `ACCESS_ADMIN_PANEL` permission.\n            2.  It parses the `id` from the request parameters.\n            3.  It calls `wikiDAO.getWikiEntryById()`.\n            4.  If an entry is found, it returns an `ApiResponse.success` with the `WikiEntry` object as the data payload.\n            5.  If no entry is found, it returns an `ApiResponse.error`.')
ON DUPLICATE KEY UPDATE content=VALUES(content);
