-- This script populates the wiki_documentation table with all missing entries in a single, valid transaction.
INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('src/main/java/de/technikteam/dao/CourseDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO is responsible for all CRUD (Create, Read, Update, Delete) operations on the `courses` table. It manages the lifecycle of course templates, which act as blueprints for schedulable meetings.\n\n2.  **Architectural Role**\n\n    This class belongs to the **DAO (Data Access) Tier**. It directly interacts with the database to manage course data and is primarily called by the `AdminCourseServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `Course` (Model): The data model object this DAO works with.\n\n4.  **In-Depth Breakdown**\n\n    *   **`createCourse(Course course)`**: Inserts a new course template into the database.\n    *   **`getCourseById(int courseId)`**: Retrieves a single course template by its primary key.\n    *   **`getAllCourses()`**: Fetches a list of all course templates, ordered by name.\n    *   **`updateCourse(Course course)`**: Updates the details of an existing course template.\n    *   **`deleteCourse(int courseId)`**: Deletes a course template. Due to `ON DELETE CASCADE` constraints in the database, this will also delete all associated meetings and attendance records.\n    *   **`mapResultSetToCourse(ResultSet rs)`**: A private helper method to convert a database row into a `Course` object.'),
('src/main/java/de/technikteam/dao/DatabaseManager.java', '1.  **File Overview & Purpose**\n\n    This class manages the application''s database connection pool. It uses the high-performance HikariCP library to create and manage a pool of database connections, which is significantly more efficient than opening a new connection for every database query. It is configured as a Guice Singleton to ensure only one connection pool exists for the entire application.\n\n2.  **Architectural Role**\n\n    This is a critical **Infrastructure** component supporting the **DAO (Data Access) Tier**. It is injected into every DAO class, providing them with a standardized way to obtain database connections.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `ConfigurationService`.\n    *   **HikariCP (`com.zaxxer.hikari.HikariDataSource`)**: The underlying connection pooling library.\n    *   `ConfigurationService`: Used to get the database URL, username, and password from `config.properties`.\n\n4.  **In-Depth Breakdown**\n\n    *   **`DatabaseManager(ConfigurationService configService)` (Constructor)**: This is where the connection pool is initialized. It reads the database credentials, sets various pool parameters (like pool size and timeouts), and creates the `HikariDataSource` instance. It throws a `RuntimeException` if initialization fails, preventing the application from starting without a valid database connection.\n    *   **`getConnection()`**: The primary method called by DAOs. It borrows a connection from the pool. If the pool is exhausted or unavailable, it will wait for a connection to become free or throw a `SQLException`.\n    *   **`closeDataSource()`**: A cleanup method (not currently called but good practice to have) that would shut down the entire connection pool.'),
('src/main/java/de/technikteam/dao/EventChatDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages all database interactions for the real-time event chat feature. It handles posting new messages, retrieving the chat history for an event, and performing updates (edits) and soft deletes on messages in the `event_chat_messages` table.\n\n2.  **Architectural Role**\n\n    This class belongs to the **DAO (Data Access) Tier**. It is used exclusively by the `EventChatSocket` WebSocket endpoint to persist and retrieve chat data.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `EventChatMessage` (Model): The data model for a chat message.\n\n4.  **In-Depth Breakdown**\n\n    *   **`postMessage(EventChatMessage message)`**: Inserts a new chat message and returns the fully populated object (including the new ID and timestamp) by calling `getMessageById` immediately after insertion.\n    *   **`getMessagesForEvent(int eventId)`**: Retrieves the entire chat history for an event, ordered by time. It performs a `LEFT JOIN` on the `users` table to get the `chat_color` for the sender and the username of the person who deleted a message.\n    *   **`updateMessage(int messageId, int userId, String newText)`**: Updates the text of a message. It includes a `WHERE` clause to ensure a user can only edit their own messages and that the message has not been deleted.\n    *   **`deleteMessage(int messageId, int deletersUserId, boolean isAdmin)`**: Performs a soft delete by setting the `is_deleted` flag and recording who deleted the message. The SQL query is conditional: if `isAdmin` is true, any message can be deleted; otherwise, the `WHERE` clause ensures a user can only delete their own messages.'),
('src/main/java/de/technikteam/dao/EventCustomFieldDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages the database operations for custom event sign-up fields. It handles saving the definitions of custom fields for an event (`event_custom_fields` table) and saving user responses to those fields (`event_custom_field_responses` table).\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is used by the `EventService` to save field definitions and by the `EventActionServlet` to save user responses during sign-up.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `EventCustomField`, `EventCustomFieldResponse` (Models): The data models this DAO works with.\n\n4.  **In-Depth Breakdown**\n\n    *   **`saveCustomFieldsForEvent(...)`**: A transactional method that first deletes all existing custom fields for an event and then uses a batch insert to add the new list of fields. This ensures the set of fields is always in sync with what was submitted in the admin form.\n    *   **`getCustomFieldsForEvent(int eventId)`**: Retrieves all custom field definitions for a given event, used to build the sign-up modal.\n    *   **`saveResponse(EventCustomFieldResponse response)`**: Saves a single user''s answer to a custom field. It uses an `INSERT ... ON DUPLICATE KEY UPDATE` statement so a user can change their response without causing a database error.'),
('src/main/java/de/technikteam/dao/EventDAO.java', '1.  **File Overview & Purpose**\n\n    This is one of the most complex and central DAOs in the application. It manages all database operations for the `events` table and its many related tables, including `event_attendance`, `event_assignments`, `event_skill_requirements`, and `event_storage_reservations`. It provides a wide range of methods for CRUD operations, user interactions (sign-up/off), and complex queries for reporting and the UI.\n\n2.  **Architectural Role**\n\n    This class is a cornerstone of the **DAO (Data Access) Tier**. It is used by numerous services and servlets, including `EventService`, `AdminEventServlet`, `HomeServlet`, `EventDetailsServlet`, and `ReportDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `Event`, `User`, `SkillRequirement`, `StorageItem` (Models): The various data models this DAO creates and populates.\n\n4.  **In-Depth Breakdown**\n\n    *   **Transactional Methods (`createEvent`, `updateEvent`, `saveSkillRequirements`, `saveReservations`)**: These methods are designed to be called within a transaction managed by the `EventService`. They take a `Connection` object as a parameter to ensure all operations are part of the same atomic unit.\n    *   **User Interaction Methods (`signUpForEvent`, `signOffFromEvent`)**: Handle user sign-ups and sign-offs by inserting or updating records in the `event_attendance` table.\n    *   **Complex Queries**:\n        *   `getUpcomingEventsForUser(...)`: A complex query that finds events a user is qualified for by checking their qualifications against the event''s skill requirements.\n        *   `getQualifiedAndAvailableUsersForEvent(...)`: The most complex query in this DAO. It finds users who meet all skill requirements for an event AND are not assigned to another event with an overlapping time frame. This is the core of the \"Crew Finder\" feature.\n    *   **Data Aggregation**: Methods like `getEventById` and `getAllEvents` perform `LEFT JOIN`s to enrich the `Event` object with related data like the leader''s username.\n    *   **`mapResultSetToEvent` / `mapResultSetToSimpleUser`**: Private helper methods to reduce code duplication when creating model objects from query results.'),
('src/main/java/de/technikteam/dao/EventFeedbackDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages all database interactions related to event-specific feedback. It handles the creation of feedback forms (`feedback_forms` table) and the storage of user responses (`feedback_responses` table), including ratings and comments.\n\n2.  **Architectural Role**\n\n    This class belongs to the **DAO (Data Access) Tier**. It is used by the `FeedbackServlet` to facilitate the event feedback workflow after an event has concluded.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `FeedbackForm`, `FeedbackResponse` (Models): The data models this DAO works with.\n\n4.  **In-Depth Breakdown**\n\n    *   **`createFeedbackForm(FeedbackForm form)`**: Inserts a new feedback form record, typically when the first user attempts to give feedback for an event that doesn''t yet have a form.\n    *   **`saveFeedbackResponse(FeedbackResponse response)`**: Saves a user''s rating and comments. It uses an `INSERT ... ON DUPLICATE KEY UPDATE` statement to prevent a user from submitting feedback multiple times for the same event.\n    *   **`getFeedbackFormForEvent(int eventId)`**: Retrieves the feedback form associated with a specific event.\n    *   **`getResponsesForForm(int formId)`**: Fetches all submitted responses for a given form, used for administrative review.\n    *   **`hasUserSubmittedFeedback(int formId, int userId)`**: A quick check to see if a user has already provided feedback, used to prevent the form from being displayed to them again.'),
('src/main/java/de/technikteam/dao/EventTaskDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages all database operations for event tasks and their complex relationships. It handles the transactional creation and updating of tasks (`event_tasks` table) along with their associated user assignments (`event_task_assignments`), required items (`event_task_storage_items`), and required kits (`event_task_kits`).\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is a critical component used by the `TaskActionServlet` to manage tasks and by the `EventDetailsServlet` and `HomeServlet` to display task information.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides connections for its transactional methods.\n    *   `EventTask`, `User`, `StorageItem`, `InventoryKit` (Models).\n\n4.  **In-Depth Breakdown**\n\n    *   **`saveTask(...)`**: This is the core method. It wraps the entire process of saving a task and its associations in a single, manual database transaction to ensure data integrity. It first saves the main task record, then clears all existing associations, and finally batch-inserts the new user, item, and kit associations.\n    *   **`getTasksForEvent(int eventId)`**: A complex query that retrieves all tasks for an event and, using `LEFT JOIN`s, aggregates all assigned users, required items, and required kits into their respective lists within each `EventTask` object. It uses a `LinkedHashMap` to correctly group the joined data.\n    *   **User Action Methods (`claimTask`, `unclaimTask`)**: Handle a user volunteering for or leaving a task in an \"open pool\". The `claimTask` method includes a subquery to ensure the `required_persons` limit is not exceeded.\n    *   **`getOpenTasksForUser(int userId)`**: A specific query to fetch only the tasks assigned to a user that are still open, for display on their home dashboard.'),
('src/main/java/de/technikteam/dao/FeedbackSubmissionDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages all database interactions for general user feedback submissions, which are displayed on the administrative Kanban board. It handles creating new submissions, retrieving them for display, and updating their status and display order as they are moved through the workflow.\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is used by the `FeedbackServlet` to create submissions and by the `AdminFeedbackServlet` and its associated `Action` classes to manage them.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `FeedbackSubmission` (Model).\n\n4.  **In-Depth Breakdown**\n\n    *   **`createSubmission(...)`**: Inserts a new feedback record with a default status of `\"NEW\"`.\n    *   **`getAllSubmissions()`**: Retrieves all submissions, ordered first by a custom status order (to match the Kanban columns) and then by their display order within that status.\n    *   **`updateStatus(int submissionId, String newStatus, Connection conn)`**: Updates the status of a single submission. It is designed to be called within a transaction.\n    *   **`updateOrderForStatus(List<Integer> orderedIds, Connection conn)`**: A key method for the Kanban board. It takes a list of submission IDs in their new order and performs a batch `UPDATE` to set their `display_order` accordingly. This is also designed to be called within a transaction.\n    *   **`updateStatusAndTitle(...)`**: A combined update method used by the feedback details modal.'),
('src/main/java/de/technikteam/dao/FileDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO is responsible for managing both the metadata of files in the `files` and `file_categories` tables and the interaction with the physical files on the server''s filesystem. It provides a complete abstraction layer for file management.\n\n2.  **Architectural Role**\n\n    This is a hybrid **DAO (Data Access) Tier** class. It performs standard database operations but also contains logic that interacts with the filesystem, an external resource. It is used by servlets that manage or serve files, such as `FileServlet`, `AdminFileServlet`, and `MarkdownEditorServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects `DatabaseManager` and `ConfigurationService`.\n    *   `DatabaseManager`: For database connections.\n    *   `ConfigurationService`: To get the base path of the `upload.directory`.\n    *   `java.nio.file.Files`: For reading and writing physical files.\n\n4.  **In-Depth Breakdown**\n\n    *   **`getAllFilesGroupedByCategory(User user)`**: Retrieves all files and organizes them into a `Map` where the key is the category name. It includes logic to filter files based on the user''s role (`required_role`).\n    *   **Filesystem Interaction (`getDocumentContentByPath`, `updateFileContent`, `deleteFile`)**: These methods bridge the gap between the database and the filesystem.\n        *   `updateFileContent` writes a string directly to a physical file.\n        *   The `deleteFile` method is transactional in nature: it first deletes the database record, and only if that is successful, it proceeds to delete the physical file from the disk.\n    *   **Category Management (`getAllCategories`, `createCategory`, etc.)**: Provides full CRUD functionality for the `file_categories` table.'),
('src/main/java/de/technikteam/dao/InventoryKitDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages all database operations related to inventory kits. It handles the CRUD lifecycle for the kits themselves (`inventory_kits` table) and manages their contents through the `inventory_kit_items` junction table.\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is primarily used by the `AdminKitServlet` for management, the `PackKitServlet` for displaying packing lists, and `EventTaskDAO` when kits are associated with tasks.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `InventoryKit`, `InventoryKitItem` (Models).\n\n4.  **In-Depth Breakdown**\n\n    *   **CRUD Operations (`createKit`, `getKitById`, `updateKit`, `deleteKit`)**: Standard methods for managing the main kit records.\n    *   **`getAllKitsWithItems()`**: A key method that retrieves all kits and, using a `LEFT JOIN` and a `Map`-based aggregation strategy, populates each kit object with a list of its contained items and their quantities.\n    *   **`getItemsForKit(int kitId)`**: Retrieves the contents for a single, specific kit.\n    *   **`updateKitItems(...)`**: A transactional method that handles updating the contents of a kit. It first deletes all existing item associations for the kit and then performs a batch insert of the new list of items and quantities, ensuring the kit''s contents are always in sync with the last submitted form.'),
('src/main/java/de/technikteam/dao/StorageLogDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO is responsible for all interactions with the `storage_log` table. Its purpose is to create transaction records when inventory items are checked in or out, and to retrieve the history of these transactions for a specific item.\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is used by the `StorageService` to log transactions and by the `StorageItemDetailsServlet` to display an item''s history.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `StorageLogEntry` (Model): The data model for a log entry.\n\n4.  **In-Depth Breakdown**\n\n    *   **`logTransaction(...)`**: Inserts a new transaction record into the `storage_log` table. This method takes a `Connection` object as a parameter because it is designed to be called from within a larger transaction managed by the `StorageService`.\n    *   **`getHistoryForItem(int itemId)`**: Retrieves the complete transaction history for a single item, ordered from newest to oldest. It joins with the `users` table to include the username of the person who performed each transaction.'),
('src/main/java/de/technikteam/dao/TodoDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages all database operations for the administrative To-Do list feature. It handles CRUD for both categories (`todo_categories`) and tasks (`todo_tasks`), and includes methods for batch-updating their display order to support drag-and-drop functionality.\n\n2.  **Architectural Role**\n\n    This class is part of the **DAO (Data Access) Tier**. It is used exclusively by the `TodoService` to persist and retrieve all To-Do list data.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `TodoCategory`, `TodoTask` (Models).\n\n4.  **In-Depth Breakdown**\n\n    *   **`getAllCategoriesWithTasks()`**: The main retrieval method. It fetches all categories and, using a `LEFT JOIN`, also fetches all their associated tasks in a single query. It then uses a `LinkedHashMap` to aggregate the flat result set into a structured list of `TodoCategory` objects, each containing its list of `TodoTask` objects.\n    *   **`createCategory(...)` / `createTask(...)`**: These methods use a subquery (`SELECT COALESCE(MAX(display_order), -1) + 1 FROM ...`) to automatically assign the new item the next available display order index, ensuring it appears at the bottom of the list.\n    *   **`updateCategoryOrder(...)` / `updateTaskOrders(...)`**: These methods are crucial for the drag-and-drop feature. They accept a list of IDs in their new order and perform a batch `UPDATE` to efficiently persist the new sorting to the database within a single transaction.'),
('src/main/java/de/technikteam/dao/UserDAO.java', '1.  **File Overview & Purpose**\n\n    This is the central DAO for managing user accounts. It handles all database operations for the `users` table, including credential validation, CRUD operations, password changes, and managing the user-permission relationship in the `user_permissions` table.\n\n2.  **Architectural Role**\n\n    This is a critical class in the **DAO (Data Access) Tier**. It is used by the `LoginServlet` for authentication, by the `UserService` for transactional updates, and by numerous other servlets and DAOs to retrieve user information.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   **Spring Security Crypto (`BCryptPasswordEncoder`)**: The library used for securely hashing and verifying passwords.\n    *   `PermissionDAO`: Used to fetch the permissions for a user.\n\n4.  **In-Depth Breakdown**\n\n    *   **`validateUser(String username, String password)`**: The core authentication method. It fetches the user''s `password_hash` from the database and uses `passwordEncoder.matches()` to securely compare it with the provided password. If validation is successful, it fetches the user''s permissions and returns a fully populated `User` object.\n    *   **`getPermissionsForUser(int userId)`**: Retrieves all permission keys for a given user.\n    *   **`updateUserPermissions(int userId, String[] permissionIds, Connection conn)`**: A transactional method that first deletes all of a user''s existing permissions and then batch-inserts the new set.\n    *   **`createUser(...)` / `updateUser(...)`**: Standard CRUD methods. `createUser` hashes the provided password before storing it.\n    *   **`changePassword(...)`**: Securely updates a user''s password by hashing the new password before saving it.'),
('src/main/java/de/technikteam/dao/UserQualificationsDAO.java', '1.  **File Overview & Purpose**\n\n    This DAO manages the `user_qualifications` table, which links users to the courses they have attended or completed. It is the persistence layer for tracking user skills and qualifications.\n\n2.  **Architectural Role**\n\n    This class belongs to the **DAO (Data Access) Tier**. It is used by the `MatrixServlet` and `AdminAttendanceServlet` to update qualifications based on meeting attendance, and by the `ProfileServlet` to display a user''s qualifications.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `DatabaseManager`.\n    *   `DatabaseManager`: Provides database connections.\n    *   `UserQualification` (Model).\n\n4.  **In-Depth Breakdown**\n\n    *   **`getQualificationsForUser(int userId)`**: Retrieves all qualifications for a single user.\n    *   **`getAllQualifications()`**: Fetches all qualification records for all users, primarily for building the data structures needed by the Qualification Matrix.\n    *   **`updateQualificationStatus(...)`**: The core update method. It uses an `INSERT ... ON DUPLICATE KEY UPDATE` statement (an \"upsert\") to create or update a qualification record. It also contains special logic: if the new status is `\"NICHT BESUCHT\"`, it deletes the record entirely instead of updating it.'),
('src/main/java/de/technikteam/model/WikiEntry.java', '1.  **File Overview & Purpose**\n\n    This is a simple Plain Old Java Object (POJO) that serves as the data model for a single wiki documentation page. It represents a record from the `wiki_documentation` table.\n\n2.  **Architectural Role**\n\n    This class is part of the **Model Tier**. It is used to transfer wiki data between the `WikiDAO`, the `WikiService`, and the administrative servlets that manage the wiki.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This is a self-contained POJO.\n\n4.  **In-Depth Breakdown**\n\n    *   **Fields:**\n        *   `id`: The primary key of the wiki entry.\n        *   `filePath`: A unique string representing the path of the documented file within the project (e.g., \"src/main/java/de/technikteam/service/UserService.java\"). This is the key used for lookups.\n        *   `content`: A `longtext` field containing the Markdown documentation for the file.\n    *   **Getters and Setters**: Standard boilerplate methods for accessing and modifying the object''s properties.'),
('src/main/java/de/technikteam/service/WikiService.java', '1.  **File Overview & Purpose**\n\n    This service class acts as the business logic and presentation layer for the technical documentation wiki. It is responsible for reading the project structure from the `Wiki.md` file, fetching the corresponding documentation from the `WikiDAO`, and dynamically generating the HTML for the navigation tree that is displayed on the wiki index page.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Service Tier**. It is a singleton that is initialized once at application startup. It serves as a facade for the `AdminWikiServlet`, providing the fully rendered HTML tree. It caches the wiki entries in memory to reduce database lookups.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `WikiDAO`.\n    *   `WikiDAO`: Used to fetch all wiki entries from the database during initialization.\n    *   `java.util.regex.Pattern`: Used to parse the Markdown links from the `Wiki.md` file.\n\n4.  **In-Depth Breakdown**\n\n    *   **`initialize()`**: Called by the constructor. It fetches all `WikiEntry` objects from the DAO and stores them in a `Map` (`wikiEntriesByPath`) for fast lookups. It then calls `parseProjectTree()` to generate and cache the final HTML.\n    *   **`parseProjectTree()`**: The core logic of the service.\n        1.  It reads the `Wiki.md` file from the classpath.\n        2.  It iterates through each line of the file, keeping track of the indentation level to correctly open and close `<ul>` and `<li>` tags, thus building the nested list structure.\n        3.  For each line that contains a Markdown link (e.g., `[`FileName.java`](path/to/File.java)`), it extracts the file name and the file path.\n        4.  It uses the extracted `filePath` to look up the corresponding `WikiEntry` in its internal `wikiEntriesByPath` map.\n        5.  If an entry is found, it generates an `<a>` tag with an `href` pointing to `/admin/wiki/details?id=...`, using the ID from the database entry.\n        6.  If no database entry is found for a path in the `Wiki.md` file, it renders the link as plain text with a \"(No Doc)\" warning.\n    *   **`getProjectTreeHtml()`**: A simple getter that returns the pre-generated HTML string to the `AdminWikiServlet`.'),
('src/main/java/de/technikteam/servlet/admin/action/UpdateWikiAction.java', '1.  **File Overview & Purpose**\n\n    This `Action` class encapsulates the logic for saving updated content for a wiki documentation page. It is triggered by an AJAX request from the admin wiki editor. It sanitizes the incoming content and persists it to the database.\n\n2.  **Architectural Role**\n\n    This is a command object in the **Web/Controller Tier**, executed by the `FrontControllerServlet`. It is the server-side endpoint for the \"Save\" button in the wiki editor UI.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `WikiDAO` and `AdminLogService`.\n    *   `WikiDAO`: The DAO used to update the content in the `wiki_documentation` table.\n    *   `AdminLogService`: To create an audit trail of the documentation update.\n    *   `MarkdownUtil`: A security utility used to sanitize the user-provided Markdown content before saving it.\n\n4.  **In-Depth Breakdown**\n\n    *   **`execute(...)`**:\n        *   **Purpose:** The main execution method for the update wiki action.\n        *   **Logic:**\n            1.  **Authorization:** Checks if the user is a full admin with `ACCESS_ADMIN_PANEL` permission.\n            2.  **Parameter Parsing:** Retrieves the `wikiId` and `content` from the request.\n            3.  **Sanitization:** It calls `MarkdownUtil.sanitize()` on the received content to strip any potentially malicious HTML or script tags.\n            4.  **Data Retrieval:** It fetches the original `WikiEntry` from the database to ensure it exists and to get its file path for logging.\n            5.  **Database Update:** It calls `wikiDAO.updateWikiContent()` with the sanitized content.\n            6.  **Logging & Response:** If the update is successful, it logs the action and returns an `ApiResponse.success`. Otherwise, it returns an `ApiResponse.error`.'),
('src/main/java/de/technikteam/servlet/admin/AdminAchievementServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet handles all administrative CRUD (Create, Read, Update, Delete) operations for achievements. It displays the list of all defined achievements and provides a modal for creating and editing them. It also includes an API-like action to fetch the data for a single achievement to populate the edit modal.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It is the controller for the `admin_achievements.jsp` view. It interacts with the `AchievementDAO` for data persistence and the `AdminLogService` for auditing.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects `AchievementDAO`, `CourseDAO`, and `AdminLogService`.\n    *   `AchievementDAO`: The primary DAO for managing achievement data.\n    *   `CourseDAO`: Used to provide a list of courses for the \"Qualification\" achievement type in the creation modal.\n    *   `AdminLogService`: To log all create, update, and delete actions.\n    *   **Gson**: For serializing achievement data to JSON for the AJAX-powered edit modal.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(...)`**: Routes requests. If `action=getAchievementData`, it calls `getAchievementDataAsJson`. Otherwise, it fetches all achievements and courses and forwards to the JSP.\n    *   **`doPost(...)`**: Routes POST requests to the appropriate handler (`handleCreateOrUpdate` or `handleDelete`) based on the `action` parameter.\n    *   **`getAchievementDataAsJson(...)`**: Acts as a mini API endpoint. It fetches an achievement by its ID and returns it as a JSON object.\n    *   **`handleCreateOrUpdate(...)`**: A single method to handle both creation and updates. It checks for an `id` parameter to distinguish between the two operations, performs the necessary authorization check for the specific action, creates an `Achievement` object from the request parameters, calls the appropriate DAO method, logs the action, and sets a session message.\n    *   **`handleDelete(...)`**: Handles the deletion of an achievement, including the authorization check, DAO call, logging, and session message.'),
('src/main/java/de/technikteam/servlet/admin/AdminAttendanceServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet acts as a dedicated endpoint for updating meeting attendance records. It processes POST requests, typically from the Qualification Matrix page, to set a user''s attendance status for a specific meeting.\n\n2.  **Architectural Role**\n\n    This is a specialized controller in the **Web/Controller Tier**. It handles a single, specific action: updating attendance. It is not responsible for rendering a view. It interacts with several DAOs to perform the update and create a detailed audit log.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects `MeetingAttendanceDAO`, `UserDAO`, `MeetingDAO`, and `AdminLogService`.\n    *   `MeetingAttendanceDAO`: The DAO that performs the actual database update.\n    *   `UserDAO`, `MeetingDAO`: Used to fetch the names of the user and meeting for the detailed log message.\n    *   `AdminLogService`: To create an audit trail of the attendance change.\n    *   `CSRFUtil`: For security validation.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doPost(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** The single method to process attendance updates.\n        *   **Logic:**\n            1.  **Security:** Validates the CSRF token.\n            2.  **Parameter Parsing:** Retrieves `userId`, `meetingId`, the boolean `attended` status, and any `remarks` from the request.\n            3.  **Database Update:** Calls `attendanceDAO.setAttendance()` to persist the changes.\n            4.  **Logging:** If the update is successful, it fetches the user and meeting objects to construct a detailed, human-readable log message (e.g., \"Teilnahme f√ºr Nutzer ''TestUser'' ... auf ''TEILGENOMMEN'' gesetzt.\") and sends it to the `AdminLogService`.\n            5.  **Feedback & Redirect:** Sets a success or error message in the session and redirects the user back to the page they came from (either `/admin/matrix` or another page).'),
('src/main/java/de/technikteam/servlet/admin/AdminChangeRequestServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for displaying the administrative page for pending user profile change requests. It fetches all requests with a \"PENDING\" status and forwards them to the `admin_requests.jsp` view for review.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It acts as the controller for the requests overview page. Its associated actions (approve/deny) are handled by the `FrontControllerServlet` and its `Action` classes.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects `ProfileChangeRequestDAO` and `UserDAO`.\n    *   `ProfileChangeRequestDAO`: The DAO used to fetch the list of pending requests.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the `/admin/requests` page.\n        *   **Logic:**\n            1.  **Authorization:** It checks if the logged-in admin has the `USER_UPDATE` permission, as reviewing change requests is a form of updating user data.\n            2.  **Data Fetching:** It calls `requestDAO.getPendingRequests()` to get the list of all pending requests.\n            3.  **Forwarding:** It sets the list as a request attribute and forwards to `admin_requests.jsp`.'),
('src/main/java/de/technikteam/servlet/admin/AdminDashboardServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves the initial HTML shell for the administrative dashboard. Its primary responsibility is to fetch some initial, non-dynamic data and forward to the `admin_dashboard.jsp` page. The majority of the dashboard''s content is then loaded asynchronously by JavaScript.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It is the controller for the main admin landing page. It is intentionally lightweight, delegating most of the data loading to the client-side and the `AdminDashboardApiServlet`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `StorageDAO` and `StatisticsDAO`.\n    *   `StorageDAO`: Used to get a count of defective items.\n    *   `StatisticsDAO`: Used to get simple counts of users and active events for the static widgets.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for `/admin/dashboard`.\n        *   **Logic:**\n            1.  It fetches the list of defective items from `storageDAO`.\n            2.  It fetches the total user count and active event count from `statisticsDAO`.\n            3.  It sets these pieces of data as request attributes.\n            4.  It forwards the request to `admin_dashboard.jsp`. The JSP then uses this initial data to render the static widgets, while the dynamic widgets show a \"Loading...\" message until the JavaScript populates them.'),
('src/main/java/de/technikteam/servlet/admin/AdminDefectServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for displaying the \"Defekte Artikel\" (Defective Items) management page. It fetches a list of all inventory items that have a defective quantity greater than zero and forwards them to the view for display.\n\n2.  **Architectural Role**\n\n    This class belongs to the **Web/Controller Tier**. It is the controller for the `admin_defect_list.jsp` view. It interacts directly with the `StorageDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `StorageDAO`.\n    *   `StorageDAO`: The DAO used to fetch the list of defective items.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the `/admin/defekte` page.\n        *   **Logic:**\n            1.  It calls `storageDAO.getDefectiveItems()` to get the specific list of items that require attention.\n            2.  It sets this list as a request attribute named `defectiveItems`.\n            3.  It forwards the request to `admin_defect_list.jsp` for rendering.'),
('src/main/java/de/technikteam/servlet/admin/AdminFileManagementServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves the main administrative page for managing files and categories. It fetches a complete list of *all* files (regardless of their `required_role`) and all defined categories, then forwards this data to the `admin_files.jsp` view.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It is the controller for the main file management interface.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `FileDAO`.\n    *   `FileDAO`: The DAO used to fetch all files and categories.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the `/admin/dateien` page.\n        *   **Logic:**\n            1.  It creates a \"proxy\" `User` object with the `ACCESS_ADMIN_PANEL` permission. This is a clever way to trick the `fileDAO.getAllFilesGroupedByCategory()` method into returning *all* files, including those marked for Admins only, without having to write a separate DAO method.\n            2.  It fetches all file categories using `fileDAO.getAllCategories()`.\n            3.  It sets both the grouped files map and the categories list as request attributes.\n            4.  It forwards the request to `admin_files.jsp`.'),
('src/main/java/de/technikteam/servlet/admin/AdminFileServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is a dedicated controller that handles all state-changing actions related to file and category management, such as uploading, updating, deleting, and reassigning files. It is mapped to `/admin/dateien/*` and uses the path info (e.g., `/create`, `/delete`) to route actions.\n\n2.  **Architectural Role**\n\n    This is a multi-action controller in the **Web/Controller Tier**. It processes multipart form data for file uploads and standard form data for other actions. It interacts with the `FileDAO`, `ConfigurationService`, and `AdminLogService`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `FileDAO`, `ConfigurationService`, and `AdminLogService`.\n    *   `@MultipartConfig`: A standard servlet annotation that enables this servlet to handle `multipart/form-data` requests (i.e., file uploads).\n    *   `FileDAO`: To perform all database operations and interact with the filesystem.\n    *   `ConfigurationService`: To get the path to the upload directory.\n    *   `AdminLogService`: To create an audit trail for all actions.\n    *   `CSRFUtil`: For security validation.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doPost(...)`**: The main entry point. It validates the CSRF token and uses a `switch` statement on the request''s `pathInfo` to delegate to the appropriate handler method.\n    *   **`handleCreateUpload(...)`**: Manages new file uploads. It validates the file type, generates a unique filename to prevent collisions, writes the file to disk, and then creates the corresponding metadata record in the database using `FileDAO`.\n    *   **`handleUpdateUpload(...)`**: Handles uploading a new version of an existing file. It finds the existing file record to get the correct filepath and overwrites the physical file on disk. It then \"touches\" the database record to update its timestamp.\n    *   **`handleDelete(...)`**: Deletes a file record and its corresponding physical file.\n    *   **`handleReassign(...)`**: Changes the `category_id` of a file record.\n    *   **`handleCreateCategory(...)` / `handleDeleteCategory(...)`**: Manages the CRUD operations for file categories.'),
('src/main/java/de/technikteam/servlet/admin/AdminKitServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet handles all administrative CRUD operations for inventory kits. It serves the main kit management page, which uses an accordion interface, and processes POST requests to create, update, and delete kits and their contents.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It is the controller for the `admin_kits.jsp` view. It interacts with the `InventoryKitDAO` and `StorageDAO` for data, and the `AdminLogService` for auditing.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects `InventoryKitDAO`, `StorageDAO`, and `AdminLogService`.\n    *   `InventoryKitDAO`: The primary DAO for managing kits and their contents.\n    *   `StorageDAO`: Used to get a list of all available items to populate the dropdowns in the UI.\n    *   `AdminLogService`: To log all state-changing actions.\n    *   **Gson**: To serialize the list of available items into JSON for use by the client-side JavaScript.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(...)`**: Fetches all kits (with their items) and a complete list of all storage items. It then forwards this data to the `admin_kits.jsp` page. It also provides a JSON endpoint (`?action=getKitItems`) for the client-side script to fetch the contents of a single kit asynchronously.\n    *   **`doPost(...)`**: A router that delegates to handler methods (`handleCreateKit`, `handleUpdateKit`, etc.) based on the `action` parameter.\n    *   **`handleCreateKit(...)` / `handleUpdateKit(...)` / `handleDeleteKit(...)`**: These methods handle the basic CRUD operations for the kit itself (not its contents), log the action, set a session message, and redirect.\n    *   **`handleUpdateKitItems(...)`**: This method handles the submission of the form inside the accordion. It takes the arrays of `itemIds` and `quantities` and passes them to the transactional `kitDAO.updateKitItems()` method, which synchronizes the kit''s contents in the database.'),
('src/main/java/de/technikteam/servlet/admin/AdminLogServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for displaying the administrative action log. It fetches all log entries from the database and forwards them to the `admin_log.jsp` view for rendering.\n\n2.  **Architectural Role**\n\n    This is a simple read-only controller in the **Web/Controller Tier**. It interacts directly with the `AdminLogDAO`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `AdminLogDAO`.\n    *   `AdminLogDAO`: The DAO used to fetch all log entries.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for the `/admin/log` page.\n        *   **Logic:**\n            1.  Ensures an admin user is logged in.\n            2.  Calls `adminLogDAO.getAllLogs()` to retrieve the complete history of administrative actions.\n            3.  Sets the resulting list as a request attribute named `logs`.\n            4.  Forwards the request to `admin_log.jsp`.'),
('src/main/java/de/technikteam/servlet/admin/AdminSystemServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves the initial HTML shell for the \"Systemstatus\" page. Its only job is to forward the request to the `admin_system.jsp` view. All data for this page is loaded asynchronously by JavaScript.\n\n2.  **Architectural Role**\n\n    This is a very simple controller in the **Web/Controller Tier**. It acts as a passthrough to its corresponding view.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for `/admin/system`.\n        *   **Logic:** It performs a single action: `request.getRequestDispatcher(\"/views/admin/admin_system.jsp\").forward(request, response);`'),
('src/main/java/de/technikteam/servlet/admin/AdminWikiDetailsServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for displaying the content of a single wiki documentation page. It retrieves the specific wiki entry from the database based on an ID parameter and forwards it to the `admin_wiki_details.jsp` view for rendering.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It acts as the controller for the detailed wiki view page. It interacts with the `WikiDAO` to fetch the content.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `WikiDAO`.\n    *   `WikiDAO`: The DAO used to fetch the wiki entry by its ID.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for `/admin/wiki/details`.\n        *   **Logic:**\n            1.  **Authorization:** It performs a strict check to ensure only users with the master `ACCESS_ADMIN_PANEL` permission can view the technical wiki.\n            2.  **Parameter Validation:** It requires a numerical `id` parameter.\n            3.  **Data Fetching:** It calls `wikiDAO.getWikiEntryById()` to retrieve the documentation content.\n            4.  **Error Handling:** If the entry is not found, it sends a 404 error.\n            5.  **Forwarding:** It sets the `wikiEntry` object as a request attribute and forwards to `admin_wiki_details.jsp`.'),
('src/main/java/de/technikteam/servlet/admin/AdminWikiServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet serves the main index page for the technical documentation wiki. It uses the `WikiService` to get the pre-generated HTML for the project navigation tree and forwards it to the `admin_wiki_index.jsp` view.\n\n2.  **Architectural Role**\n\n    This class is part of the **Web/Controller Tier**. It is the controller for the wiki''s main landing page. It delegates all complex logic to the `WikiService`.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects the `WikiService`.\n    *   `WikiService`: The service that contains the cached, pre-rendered HTML for the wiki navigation tree.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for `/admin/wiki`.\n        *   **Logic:**\n            1.  **Authorization:** It performs a strict check to ensure only users with the master `ACCESS_ADMIN_PANEL` permission can access the wiki.\n            2.  **Service Call:** It calls `wikiService.getProjectTreeHtml()` to retrieve the cached HTML.\n            3.  **Forwarding:** It sets the HTML string as a request attribute named `projectTreeHtml` and forwards to `admin_wiki_index.jsp`.'),
('src/main/java/de/technikteam/servlet/admin/FrontControllerServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet implements the Front Controller design pattern. It acts as a single, centralized handler for a variety of administrative actions. Instead of having numerous small servlets for each action (e.g., `CreateUserServlet`, `DeleteUserServlet`), this servlet receives all requests to `/admin/action/*`, determines the requested action, and dispatches the request to a dedicated `Action` class that contains the business logic. This approach cleans up the `web.xml` (or `ServiceModule`), promotes a clean separation of concerns, and simplifies the handling of AJAX requests.\n\n2.  **Architectural Role**\n\n    This is a core component of the **Web/Controller Tier**. It is a dispatcher that decouples the URL from the specific code that handles the action.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: The constructor uses Guice to inject an instance of every single `Action` class.\n    *   `Action` (Interface): The common interface that all action classes implement.\n    *   **Gson**: Used to serialize the `ApiResponse` returned by the action into a JSON string.\n\n4.  **In-Depth Breakdown**\n\n    *   **`actions` (Map)**: A `Map` that holds all the action instances, keyed by a unique string (e.g., \"user.create\", \"feedback.delete\"). This map is populated in the constructor.\n    *   **`doPost(HttpServletRequest request, HttpServletResponse response)`**:\n        *   **Purpose:** The single method that handles all incoming action requests.\n        *   **Logic:**\n            1.  It extracts the `entity` from the path info (e.g., `/user` becomes `user`).\n            2.  It extracts the `actionName` from a request parameter (e.g., `?action=create`).\n            3.  It combines these to create an `actionKey` (e.g., `\"user.create\"`).\n            4.  It looks up the corresponding `Action` object in the `actions` map.\n            5.  If an action is found, it calls the `action.execute()` method.\n            6.  It takes the `ApiResponse` object returned by the action, sets the HTTP status code based on its success, and serializes it to JSON for the response.'),
('src/main/java/de/technikteam/servlet/admin/MatrixServlet.java', '1.  **File Overview & Purpose**\n\n    This servlet is responsible for gathering all the data required to render the complex Qualification Matrix. It fetches all users, all courses, all meetings for each course, and all attendance records, then organizes this data into structures that the `admin_matrix.jsp` view can easily consume to build the table.\n\n2.  **Architectural Role**\n\n    This is a data-intensive controller in the **Web/Controller Tier**. Its primary job is to aggregate data from multiple DAOs into a coherent view model for a specific, complex UI component.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `@Inject`: Injects all necessary DAOs (`UserDAO`, `CourseDAO`, `MeetingDAO`, `MeetingAttendanceDAO`).\n    *   **DAOs**: Each DAO is used to fetch a piece of the required data.\n\n4.  **In-Depth Breakdown**\n\n    *   **`doGet(HttpServletRequest request, HttpServletResponse response)`**\n        *   **Purpose:** Handles GET requests for `/admin/matrix`.\n        *   **Logic:**\n            1.  **Fetch Users & Courses:** Retrieves the complete lists of all users and all courses.\n            2.  **Fetch Meetings:** It iterates through the list of courses and, for each one, fetches its list of scheduled meetings, storing the results in a `Map<Integer, List<Meeting>>` where the key is the course ID.\n            3.  **Fetch Attendance:** It fetches *all* attendance records from the `meeting_attendance` table and transforms this list into a `Map<String, MeetingAttendance>`. The key for this map is a concatenated string like `\"userId-meetingId\"`. This creates a highly efficient lookup structure for the JSP, which can check a user''s attendance for a specific meeting in O(1) time instead of having to loop through lists.\n            4.  **Forwarding:** It sets all four data structures (`allUsers`, `allCourses`, `meetingsByCourse`, `attendanceMap`) as request attributes and forwards to `admin_matrix.jsp`.');