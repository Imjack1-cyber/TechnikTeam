-- Flyway migration V6, Part 1

INSERT INTO `wiki_documentation` (`file_path`, `content`) VALUES
('pom.xml', '1.  **File Overview & Purpose**\n\n    This is the Project Object Model (POM) file for Maven, the build and dependency management tool for this project. It defines the project''s coordinates, dependencies, build settings, and plugins. It is the central configuration file for building the `TechnikTeam.jar` artifact.\n\n2.  **Architectural Role**\n\n    This is a core project configuration file, not belonging to a specific architectural tier. It defines the project''s structure and the libraries that will be available at runtime for all tiers.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Spring Boot Starters**: Provide a one-stop-shop for all the dependencies needed for a specific functionality (e.g., `spring-boot-starter-web`, `spring-boot-starter-security`).\n    *   **Flyway**: Manages database schema migrations, ensuring the database is always in a consistent and up-to-date state.\n    *   **MariaDB/MySQL Connector**: The JDBC driver for the database.\n    *   **Log4j 2**: A robust logging framework used for application-wide logging and auditing.\n    *   **JWT (jjwt)**: A library for creating and parsing JSON Web Tokens for stateless authentication.\n    *   **Swagger/Springdoc**: For automatic generation of API documentation.\n\n4.  **In-Depth Breakdown**\n\n    *   **`<parent>`**: Inherits default settings from the `spring-boot-starter-parent`, which manages dependency versions and default plugin configurations.\n    *   **`<properties>`**: Defines common version numbers for dependencies (`springdoc-openapi.version`, `jjwt.version`, etc.) and sets the project''s Java version to `21`.\n    *   **`<dependencies>`**: Contains the list of all external libraries the project depends on. Key groups include:\n        *   **Spring Boot**: Core starters for Web, Data JPA, Security, Validation, WebSocket, and Log4j2.\n        *   **Database**: `flyway-core`, `flyway-mysql`, and `mariadb-java-client` provide everything needed for database migration and connectivity.\n        *   **Security**: The `jjwt` artifacts for JWT handling and `webauthn-server-core` for Passkey support.\n        *   **API Documentation**: `springdoc-openapi-starter-webmvc-ui` integrates Swagger UI.\n        *   **Utilities**: Various libraries for tasks like iCalendar generation (`ical4j`), caching (`caffeine`), and JSON serialization (`gson` is included via Spring Boot).\n    *   **`<build>`**: Configures the Maven build process.\n        *   `spring-boot-maven-plugin`: Packages the application as an executable JAR.\n        *   `maven-compiler-plugin`: Configures the Java compiler version.'),
('src/main/java/de/technikteam/config/DateFormatter.java', '1.  **File Overview & Purpose**\n\n    This is a utility class providing static methods for consistent date and time formatting throughout the application. It ensures that all `java.time.LocalDateTime` objects are displayed in a standardized, German-locale format (e.g., \"10.06.2025, 17:45 Uhr\").\n\n2.  **Architectural Role**\n\n    This is a cross-cutting concern utility, used primarily in the **Model** and **Web/API** tiers. Models use it to provide pre-formatted strings for DTOs, ensuring a consistent user experience.\n\n3.  **Key Dependencies & Libraries**\n\n    *   `java.time.LocalDateTime`: The modern Java date-time API object that this class formats.\n    *   `java.time.format.DateTimeFormatter`: The core Java class used for defining and applying date-time format patterns.\n\n4.  **In-Depth Breakdown**\n\n    *   **`formatDateTime(LocalDateTime ldt)`**\n        *   **Method Signature:** `public static String formatDateTime(LocalDateTime ldt)`\n        *   **Purpose:** Formats a `LocalDateTime` into a full date and time string.\n        *   **Parameters:**\n            *   `ldt` (LocalDateTime): The date-time object to format.\n        *   **Returns:** A formatted string like \"dd.MM.yyyy, HH:mm\" (e.g., \"10.06.2025, 17:45\"), or an empty string if the input is null.\n        *   **Side Effects:** None.\n\n    *   **`formatDate(LocalDateTime ldt)`**\n        *   **Method Signature:** `public static String formatDate(LocalDateTime ldt)`\n        *   **Purpose:** Formats a `LocalDateTime` into a date-only string.\n        *   **Parameters:**\n            *   `ldt` (LocalDateTime): The date-time object to format.\n        *   **Returns:** A formatted string like \"dd.MM.yyyy\" (e.g., \"10.06.2025\"), or an empty string if the input is null.\n        *   **Side Effects:** None.\n\n    *   **`formatDateTimeRange(LocalDateTime start, LocalDateTime end)`**\n        *   **Method Signature:** `public static String formatDateTimeRange(LocalDateTime start, LocalDateTime end)`\n        *   **Purpose:** Intelligently formats a date range. It provides a more compact format if the start and end times are on the same day.\n        *   **Parameters:**\n            *   `start` (LocalDateTime): The start of the range.\n            *   `end` (LocalDateTime): The end of the range (can be null).\n        *   **Returns:** A user-friendly string representing the range.\n            *   If `end` is null: \"10.06.2025, 17:45 Uhr\"\n            *   If same day: \"10.06.2025, 17:45 - 19:00 Uhr\"\n            *   If different days: \"10.06.2025, 17:45 Uhr - 11.06.2025, 18:00 Uhr\"\n        *   **Side Effects:** None.'),
('src/main/java/de/technikteam/config/GlobalExceptionHandler.java', '1.  **File Overview & Purpose**\n\n    This class is a centralized, global exception handler for the Spring Boot application. Annotated with `@ControllerAdvice`, it intercepts exceptions thrown from any controller (`@RestController`) and transforms them into a standardized, user-friendly JSON `ApiResponse` object. This ensures that the frontend always receives a consistent error structure and prevents the leakage of sensitive stack traces.\n\n2.  **Architectural Role**\n\n    This is a cross-cutting **Configuration** component that operates at the boundary of the **Web/API Tier**. It provides a uniform error handling policy for the entire REST API.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Spring Framework (`@ControllerAdvice`, `@ExceptionHandler`)**: Core annotations for creating a global exception handler.\n    *   `ApiResponse` (Model): The standard DTO used for all API responses, including errors.\n\n4.  **In-Depth Breakdown**\n\n    *   **`handleValidationExceptions(MethodArgumentNotValidException ex)`**\n        *   **Purpose:** Specifically handles exceptions thrown when `@Valid` validation fails on a request body (DTO).\n        *   **Logic:** It extracts all field validation errors, concatenates them into a single, human-readable message, and returns an `ApiResponse` with an HTTP 400 (Bad Request) status.\n\n    *   **`handleAccessDeniedException(AccessDeniedException ex)`**\n        *   **Purpose:** Handles exceptions thrown by Spring Security when a user, although authenticated, does not have the required permission/authority to access an endpoint (e.g., due to `@PreAuthorize` checks).\n        *   **Logic:** Returns a standard `ApiResponse` with a clear "Access Denied" message and an HTTP 403 (Forbidden) status.\n\n    *   **`handleAllExceptions(Exception ex)`**\n        *   **Purpose:** A catch-all handler for any other unhandled exceptions that may occur within the application.\n        *   **Logic:** It logs the exception (implicitly done by Spring Boot) and returns a generic "internal server error" `ApiResponse` with an HTTP 500 status. It includes the exception message in the data payload for debugging purposes (which might be stripped in a hardened production environment).'),
('src/main/java/de/technikteam/config/LocalDateTimeAdapter.java', '1.  **File Overview & Purpose**\n\n    This is a custom `TypeAdapter` for the Gson library, designed to handle both serialization and deserialization of `java.time.LocalDateTime` objects. It ensures these objects are consistently formatted as ISO 8601 strings (e.g., \"2025-07-25T10:30:00\") in JSON, which is a robust and standard way to exchange date-time information.\n\n2.  **Architectural Role**\n\n    This is a **Configuration** / **Utility** class. It is crucial for the **Web/API Tier** controllers that consume or produce JSON containing `LocalDateTime` objects. A `TypeAdapter` handles both directions of data conversion.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Gson (`com.google.gson.TypeAdapter`)**: The base class from the Gson library for creating custom serialization and deserialization logic.\n    *   `java.time.LocalDateTime`: The modern Java date-time API class this adapter handles.\n\n4.  **In-Depth Breakdown**\n\n    *   **`write(JsonWriter out, LocalDateTime value)`**\n        *   **Method Signature:** `public void write(JsonWriter out, LocalDateTime value) throws IOException`\n        *   **Purpose:** Serializes a `LocalDateTime` object to its JSON string representation.\n        *   **Parameters:**\n            *   `out` (JsonWriter): The Gson stream writer.\n            *   `value` (LocalDateTime): The object to write.\n        *   **Returns:** void.\n        *   **Side Effects:** Writes the ISO-formatted date-time string or `null` to the output JSON stream.\n\n    *   **`read(JsonReader in)`**\n        *   **Method Signature:** `public LocalDateTime read(JsonReader in) throws IOException`\n        *   **Purpose:** Deserializes an ISO-formatted date-time string from JSON into a `LocalDateTime` object.\n        *   **Parameters:**\n            *   `in` (JsonReader): The Gson stream reader.\n        *   **Returns:** A `LocalDateTime` object, or `null` if the JSON value was null.\n        *   **Side Effects:** Reads from the input JSON stream.'),
('src/main/java/de/technikteam/config/GuiceConfig.java', '1.  **File Overview & Purpose**\n\n    This class serves as the central configuration entry point for the Google Guice dependency injection framework. As a `GuiceServletContextListener`, it is automatically invoked by the servlet container on application startup, creating the main Guice `Injector` that will manage the lifecycle of all services, DAOs, and servlets.\n\n2.  **Architectural Role**\n\n    This is a core **Configuration** file that bootstraps the entire application''s architecture. It connects the servlet container''s lifecycle to the Guice dependency injection container.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Guice (`com.google.inject.Guice`)**: The main class from the Guice library used to create the injector.\n    *   **Guice Servlet (`com.google.inject.servlet.GuiceServletContextListener`)**: The base class that integrates Guice with the Jakarta Servlet lifecycle.\n    *   `ServiceModule.java`: The custom module where all the application''s bindings (dependencies) are defined.\n\n4.  **In-Depth Breakdown**\n\n    *   **`getInjector()`**\n        *   **Method Signature:** `protected Injector getInjector()`\n        *   **Purpose:** This is the core method of the `GuiceServletContextListener`. It is called once by the container when the application starts. Its responsibility is to create and return the application''s central `Injector`.\n        *   **Parameters:** None.\n        *   **Returns:** The configured `Injector` instance.\n        *   **Side Effects:** It instantiates the `ServiceModule`, which in turn defines all the dependency injection bindings for the entire application. The returned injector is then stored in the `ServletContext` by the `GuiceFilter` for later use.'),
('src/main/java/de/technikteam/config/LocalDateAdapter.java', '1.  **File Overview & Purpose**\n\n    This is a custom serializer for the Gson library, specifically designed to handle the `java.time.LocalDate` class. Its purpose is to ensure `LocalDate` objects are consistently converted into a standard `YYYY-MM-DD` string format when serializing Java objects to JSON.\n\n2.  **Architectural Role**\n\n    This is a **Configuration** / **Utility** class that operates at the boundary between the **Service/Controller Tiers** and the **View/Client-Side Tier**. It is used by any servlet that needs to serialize data containing `LocalDate` objects into JSON for an API response.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Gson (`com.google.gson.JsonSerializer`)**: The core interface from the Gson library that this class implements to provide custom serialization logic.\n    *   **java.time.LocalDate**: The modern Java Date API class for representing a date without time-of-day.\n\n4.  **In-Depth Breakdown**\n\n    *   **`serialize(LocalDate date, Type typeOfSrc, JsonSerializationContext context)`**\n        *   **Method Signature:** `public JsonElement serialize(LocalDate date, Type typeOfSrc, JsonSerializationContext context)`\n        *   **Purpose:** This method is called by Gson whenever it encounters a `LocalDate` object during serialization. It formats the date into an ISO standard string.\n        *   **Parameters:**\n            *   `date` (LocalDate): The `LocalDate` object to be serialized.\n            *   `typeOfSrc` (Type): The specific generic type of the source object.\n            *   `context` (JsonSerializationContext): The context for serialization that Gson is using.\n        *   **Returns:** A `JsonPrimitive` containing the date as a string in `YYYY-MM-DD` format (e.g., \"2025-07-25\"), or `null` if the input date is null.\n        *   **Side Effects:** None.'),
('src/main/java/de/technikteam/config/Permissions.java', '1.  **File Overview & Purpose**\n\n    This final class acts as a central, static repository for all permission key constants used in the application. Its primary purpose is to eliminate \"magic strings\" when checking for user permissions, thereby improving code readability, maintainability, and preventing hard-to-find bugs from typos.\n\n2.  **Architectural Role**\n\n    This is a cross-cutting **Configuration** file. It is used by the **Service Tier** (e.g., `AuthorizationService`), the **Web/Controller Tier** (e.g., `AdminFilter`, servlets), and the **View Tier** (JSPs) to perform consistent permission checks.\n\n3.  **Key Dependencies & Libraries**\n\n    *   None. This class is self-contained.\n\n4.  **In-Depth Breakdown**\n\n    The class contains a series of `public static final String` constants. Each constant represents a specific, granular permission within the system. The constants are grouped by functional area (e.g., User Management, Event Management) for clarity.\n\n    *   **`ACCESS_ADMIN_PANEL`**: The most powerful permission. It grants unrestricted access to all administrative functions, acting as a \"superuser\" or \"root\" key.\n    *   **`USER_*` constants**: Permissions related to creating, reading, updating, deleting, and resetting passwords for user accounts.\n    *   **`EVENT_*` constants**: Permissions for managing events, including creating, editing, deleting, assigning personnel, and managing tasks within an event.\n    *   **`ACHIEVEMENT_VIEW`**: A special key used specifically by the `NavigationRegistry` to determine if the \"Abzeichen\" link should be visible in the admin sidebar. It''s a meta-permission based on having any other achievement-related CRUD permission.\n    *   **`ADMIN_DASHBOARD_ACCESS`**: Another special key for the `NavigationRegistry` that grants visibility to the \"Admin Dashboard\" link if the user has *any* administrative permission.'),
('src/main/java/de/technikteam/config/ServiceModule.java', '1.  **File Overview & Purpose**\n\n    This is the core configuration module for the Google Guice dependency injection framework. It defines all the application''s bindings, instructing Guice how to create and wire together objects. It binds service interfaces to their implementations, registers DAOs as singletons, and maps URL patterns to their corresponding servlets.\n\n2.  **Architectural Role**\n\n    This is a central **Configuration** file that orchestrates the entire application''s object graph. It defines the relationships between the **Web/Controller**, **Service**, and **DAO** tiers.\n\n3.  **Key Dependencies & Libraries**\n\n    *   **Guice Servlet (`com.google.inject.servlet.ServletModule`)**: The base class for modules that configure servlets and filters.\n\n4.  **In-Depth Breakdown**\n\n    *   **`configureServlets()`**: This method contains all the binding logic.\n        *   **Service, DAO, and Action Bindings**: The first section uses `bind(ClassName.class).in(Scopes.SINGLETON);` to register all service, DAO, and action classes as singletons. This ensures that only one instance of each of these classes exists throughout the application''s lifecycle, which is crucial for managing shared resources like caches and database connections.\n        *   **Servlet Bindings**: The second section explicitly binds every servlet class in the application as a singleton. This is a prerequisite before they can be mapped to a URL.\n        *   **Servlet Mappings**: The final, large section uses `serve(\"url-pattern\").with(ServletClass.class);` to map URL patterns to the servlets that should handle them. This is the heart of the application''s routing.\n            *   It maps public-facing URLs like `/home` and `/lager`.\n            *   It maps all administrative URLs under `/admin/*`.\n            *   It maps all API endpoints under `/api/*`.\n            *   The `FrontControllerServlet` is mapped to `/admin/action/*` to handle various administrative POST actions using a Command pattern.');
COMMIT;